<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>JSON Hyper-Schema Example</title>
		<link rel="stylesheet" href="css/main.css">
		<link rel="stylesheet" href="css/json-highlight.css">
		<link rel="stylesheet" href="renderers/basic.jsonary.css" />
		<link rel="stylesheet" href="renderers/common.css" />
		<meta name="viewport" content="width=960">
	</head>
	<body>
		<script src="jsonary.js"></script>
		<script src="plugins/jsonary.undo.js"></script>
		<script src="renderers/basic.jsonary.js"></script>
		<script src="renderers/list-schemas.js"></script>
		<script src="renderers/list-links.js"></script>
		<div align="center">
			<div id="content">
				<h1>JSON Hyper-Schema Example</h1>
				<div class="tagline">Show me what you've got</div>

				<div id="nav">
					back to
					<a class="nav-link" href=".">main page</a>
				</div>
				

				<h2>Describing the data</h2>
				<div class="section">
					<p>Let's assume that we already have an API, and we'll go through the process of writing a hyper-schema for it.
					<p>First off, here is our data, fetched from <code>/websites/123</code>:

<pre class="highlight-json">
{
    "id": 123,
    "title": "Welcome!",
    "summary": "Anything is possible",
    "website": "http://zombo.com/",
    "rating": 4.5
}
</pre>

					<p>So, let's write an extremely basic schema for this data:
<pre class="highlight-json-schema">
{
	"title": "Website summary",
	"description": "Provides a title and summary for a website.  Users can also post comments about the site.",
	"type": "object",
	"properties": {
		"id": {"type": "integer"},
		"title": {"type": "string"},
		"summary": {"type": "string"},
		"website": {"type": "string"},
		"rating": {"type": "number"}
	}
}
</pre>

					<p>So far so good.  Most keywords used here can be guessed.  The <code>"type"</code> keyword can have a value of "null", "boolean", "integer", "number", "string", "object" or "array".  The <code>"properties"</code> property provides sub-schemas for the individual properties.
				</div>
				
				<h2>Posting comments</h2>
				<div class="section">
					<p>But, as mentioned in the description above, users should be able to post comments about the site - let's say that in the hyper-schema, using the <code>"links"</code> keyword.
<pre class="highlight-json-schema">
{
	"title": "Website summary",
	"description": "Provides a title and summary for a website.  Users can also post/view comments about the site.",
	"type": "object",
	"properties": {
		...
	},
	"links": [
		{
			"rel": "comment",
			"href": "/websites/{id}/comments",
			"method": "POST"
		}
	]
}
</pre>

					<p>The value of <code>"href"</code> is a URI Template (<a href="http://tools.ietf.org/html/rfc6570">RFC 6570</a>).  For any given piece of actual data, that value will be filled out using the "id" attribute from the actual data.
				</div>
				
				<h2>Describing submission data</h2>
				<div class="section">
					<p>OK - but the client still doesn't know exactly what to POST to create a comment.  But we can specify a schema for the submission data:
<pre class="highlight-json-schema">
{
	...
	"links": [
		{
			"rel": "comment",
			"href": "/websites/{id}/comments",
			"method": "POST",
			"schema": {
				"title": "New comment",
				"type": "object",
				"properties": {
					"name": {
						"title": "Your name",
						"type": "string"
					},
					"message": {
						"title": "Message",
						"type": "string"
					},
					"rating": {
						"title": "Rating",
						"type": "integer",
						"minimum": 0,
						"maximum": 5
					}
				},
				"required": ["name", "message"]
			}
		}
	]
}
</pre>

					<p>All right!  Now, a client looking at the hyper-schema can know exactly what data to POST, and where to POST it.  Let's see that rendered using the default renderers in Jsonary:
					<pre class="example" id="example0"></pre>
<script>
var data = Jsonary.create({
    "id": 123,
    "title": "Welcome!",
    "summary": "Anything is possible",
    "website": "http://zombo.com/",
    "rating": 4.5
}, null, 4);
var schema = Jsonary.createSchema({
	"title": "Website summary",
	"description": "Provides a title and summary for a website.  Users can also post comments about the site.",
	"type": "object",
	"properties": {
		"id": {"type": "integer"},
		"title": {"type": "string"},
		"summary": {"type": "string"},
		"website": {"type": "string"},
		"rating": {"type": "number"}
	},
	"links": [
		{
			"rel": "comment",
			"href": "/websites/{id}/comments",
			"method": "POST",
			"schema": {
				"title": "New comment",
				"type": "object",
				"properties": {
					"name": {
						"title": "Your name",
						"type": "string"
					},
					"message": {
						"title": "Message",
						"type": "string"
					},
					"rating": {
						"title": "Rating",
						"type": "integer",
						"minimum": 0,
						"maximum": 5
					}
				},
				"required": ["name", "message"]
			}
		}
	]
});
data.addSchema(schema);
data.renderTo("example0");

Jsonary.addLinkPreHandler(function (link, submissionData) {
	alert("Intercepted " + link.method + " to " + link.href + "\n" + "Data: " + JSON.stringify(submissionData.value(), null, 4));
	return false; // cancel the request
});
</script>
				</div>
			</div>
		</div>
		<script src="js/json-highlight.js"></script>
	</body>
</html>
