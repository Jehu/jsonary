<html>
  <head>
		<title>Hyperlinks in Jsonary</title>
		<link rel="stylesheet" href="../../css/main.css">
		<link rel="stylesheet" href="../../renderers/basic.jsonary.css">
		<meta name="viewport" content="width=960">
	</head>
	<body>
		<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
		<script src="../../jsonary.js"></script>
		<script src="../../renderers/basic.jsonary.js"></script>
		<div align="center">
			<div id="content">
				<h1>Hyperlinks</h1>
				<div class="tagline">handling links defined in JSON Schema</div>
				
				<div id="nav">
					back to
					<a class="nav-link" href="../">walkthrough</a>
					<a class="nav-link" href="../../">main page</a>
				</div>
				
				<div class="resource-list">
					The demos on this page use the following files:
					<ul>
						<li><span class="filename">jsonary.js</span> - the core Jsonary library
						<li><span class="filename">basic.jsonary.js</span> - a default set of renderers, that look similar to plain JSON
						<li><span class="filename">basic.jsonary.css</span> - the stylesheet used by the above renderers
					</ul>
				</div>
	
				<h2>Defining a hyperlink</h2>
				<div class="section">
					<p>One of the many wonders of JSON Schemas is their ability to define hyperlinks on the data that they describe.
					<p>These are defined using the <code>links</code> keyword in schemas.  Links are specified as an array of Link Description Objects, like in this example schema:
<pre class="example code">
{
	"title": "Schema with links",
	"links": [
		{
			"href": "home.json",
			"rel": "home"
		},
		{
			"href": "page2.json",
			"rel": "next"
		}
	]
}
</pre>
					<p>"<span class="user-quote">Well OK,</span>" you say, "<span class="user-quote">but the URIs are fixed!  You'll need a different schema for every bit of data!</span>".
					<p>That's a good point.  Luckily for us, JSON Schema has a way around this.  The URI specified in the <code>href</code> property is a <em>template</em>, which is filled with values from the instance data.
					<p>For example, let's look at this data: (<a href="data-list.json">data-list.json</a>)
<pre class="example code">
[
	{
		"id": 12345,
		"content": "foo"
	},
	{
		"id": 99999,
		"content": "bar"
	}
]
</pre>
					<p>We would like to define a link on each of the items in that array, pointing to comments on that item.  The URI of the link should be "<code>http://example.com/items/<I>{id}</I>/comments</code>", where <code><I>{id}</I></code> is replaced by the "id" property from the data.
					<p>Actually, that is exactly the syntax we need to use.  So let's take this schema: (<a href="schema-list.json">schema-list.json</a>)
<pre class="example code">
{
	"title": "Adaptive links",
	"items": {
		"title": "Sub-schema",
		"links": [
			{
				"href": "http://example.com/items/{id}/comments",
				"rel": "comments"
			}
		]
	}
}
</pre>
					<p>And let's render our item:<a href="#" onclick="exampleList(); return false">click to run</a>
					<div class="example" id="example-list"></div>
					<script>
function exampleList() {
	function renderData(data) {
		var element = document.getElementById('example-list');
		Jsonary.render(element, data);
	}
	Jsonary.getData("data-list.json", renderData, "schema-list.json");
}
// Put in the link handler that provides a popup with the URL
// SHHH!  We haven't learned about these yet!
Jsonary.getSchema("schema-list.json#/items", function (schema) {
	var linkDefinition = schema.links()[0];
	linkDefinition.addHandler(function (link, submissionData, request) {
		alert(link.href);
	});
});
					</script>
					<p>Hopefully, next to the schema titles annotating the data, you should see some links, labelled "comments" according to the <code>rel</code> value.
					<p>If you select these links, you should see a popup containing the URI of the link that you clicked.  The URIs are different for the two items, due to their different values for "<code>id</code>".
				</div>

				<h2>Submitting data</h2>
				<div class="section">
					<p>Hyperlinks in JSON Schema can define data to be submitted with the link.  The following properties are all optional:
					<ul>
						<li><code>schema</code> - specifies the form the data should take, as a JSON Schema.</li>
						<li><code>method</code> - the method (GET/POST/etc.) with which the link should be accessed. Defaults to "GET".</li>
						<li><code>encType</code> - the encoding method for the data.</li>
					</ul>
					<p>Any of these options can be omitted.
					<p>For example, here is a link definition that defines some data: (<a href="data-list.json">schema-link.json</a>)
<pre class="example code">
{
	"title": "Example schema",
	"links": [
		{
			"href": "mirror.php",
			"rel": "example",
			"method": "POST",
			"enctype": "application/x-www-form-urlencoded",
			"schema": {
				"type": "object",
				"properties": {
					"num": {"type": "integer"},
					"str": {"type": "string"}
				},
				"required": ["num", "str"],
				"additionalProperties": {"type": "boolean"}
			}
		}
	]
}
</pre>
					<p>Let's take a look at what an instance described by that schema might look like:
					<p><I>Note: this example uses PHP, and therefore will not work if you are viewing this on GitHub.</I>
					<div class="example" id="example-link"></div>
					<p>When you click the link, a prompt should appear in which you can edit some data to submit.  The response (from <code>mirror.php</code>) will be shown below:
					<div class="example" id="example-link-response"></div>
					<script>
var element = document.getElementById('example-link');
var data = Jsonary.create("Some test data").addSchema("schema-link.json");
Jsonary.render(element, data);

Jsonary.getSchema("schema-link.json", function (schema) {
	var linkDefinition = schema.links()[0];
	linkDefinition.addHandler(function (link, submissionData, request) {
		var element = document.getElementById('example-link-response');
		alert("Submitted data to: " + link.href);
		request.getData(function (data) {
			Jsonary.render(element, data);
		});
	});
});
					</script>
					<p>When you submit the link data, you should (hopefully) see the data returned by <code>mirror.php</code>, which includes the POST data.
					<p>You may notice that the POST data is formatted exactly like a query string in a URL.  This is the encoding defined by the media type <code>application/x-www-form-urlencoded</code>, and it is the default encoding when using HTML forms.
				</div>

				<h2>Submitting JSON data</h2>
				<div class="section">
					<p>When using the <code>application/x-www-form-urlencoding</code> encoding, all the data is bundled up into a query string, and therefore loses all type information.  The number <code>2</code> is indistinguisable from the string <code>"2"</code>.
					<p>Fortunately, this is not the only encoding we can use.  We can use any media type, including <code>application/json</code>: (<a href="data-list.json">schema-link-json.json</a>)
<pre class="example code">
{
	"title": "Example schema",
	"links": [
		{
			"href": "mirror.php?some=parameters&because=why_not",
			"rel": "example",
			"method": "POST",
			"encType": "application/json",
			"schema": {
				"type": "object",
				"properties": {
					"num": {"type": "integer"},
					"str": {"type": "string"}
				},
				"required": ["num", "str"],
				"additionalProperties": {"type": "boolean"}
			}
		}
	]
}
</pre>
					<p>This is actually the default value of <code>encType</code> for POST links in JSON Schema (if you are making GET requests, then only <code>application/x-www-form-urlencoded</code> is available).  Let's look at what happens when we use that link:
					<p><I>Note: this example uses PHP, and therefore will not work if you are viewing this on GitHub.</I>
					<div class="example" id="example-link-json"></div>
					<p>The response from <code>mirror.php</code> will be shown below:
					<div class="example" id="example-link-json-response"></div>
					<script>
var element = document.getElementById('example-link-json');
var data = Jsonary.create("Some more data").addSchema("schema-link-json.json");
Jsonary.render(element, data);

Jsonary.getSchema("schema-link-json.json", function (schema) {
	var linkDefinition = schema.links()[0];
	linkDefinition.addHandler(function (link, submissionData, request) {
		var element = document.getElementById('example-link-json-response');
		alert("Submitted data to: " + link.href);
		request.getData(function (data) {
			Jsonary.render(element, data);
		});
	});
});
					</script>
					<p>As you can hopefully see, the data being sent as the POST body is now encoded as JSON.
					<p><B>Please note</B>: submitting JSON data as above is <U>not</U> the same as submitting JSON data as a string value in an HTML form.  Submitting JSON data as an input with name "<code>jsonData</code>" would end up POSTing something like this:
					<pre class="example">jsonData=%7B%22num%22%3A0%2C%22str%22%3A%22value%22%7D</pre>
				</div>
			</div>
		</div>
	</body>
</html>
