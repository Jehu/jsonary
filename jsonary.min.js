"undefined"==typeof localStorage&&(window.localStorage={});Array.isArray||(Array.isArray=function(z){return"[object Array]"===Object.prototype.toString.apply(z)});Array.prototype.indexOf||(Array.prototype.indexOf=function(z,u){for(var A=u||0;A<this.length;A++)if(this[A]===z)return A;return-1});Object.keys||(Object.keys=function(z){var u=[],A;for(A in z)z.hasOwnProperty(A)&&u.push(A);return u});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
"object"!==typeof JSON&&(JSON={});
(function(){function z(m){return 10>m?"0"+m:m}function u(m){G.lastIndex=0;return G.test(m)?'"'+m.replace(G,function(m){var j=I[m];return"string"===typeof j?j:"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+m+'"'}function A(m,C){var j,t,D,v,z=s,d,f=C[m];f&&("object"===typeof f&&"function"===typeof f.toJSON)&&(f=f.toJSON(m));"function"===typeof E&&(f=E.call(C,m,f));switch(typeof f){case "string":return u(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);
case "object":if(!f)return"null";s+=F;d=[];if("[object Array]"===Object.prototype.toString.apply(f)){v=f.length;for(j=0;j<v;j+=1)d[j]=A(j,f)||"null";D=0===d.length?"[]":s?"[\n"+s+d.join(",\n"+s)+"\n"+z+"]":"["+d.join(",")+"]";s=z;return D}if(E&&"object"===typeof E){v=E.length;for(j=0;j<v;j+=1)"string"===typeof E[j]&&(t=E[j],(D=A(t,f))&&d.push(u(t)+(s?": ":":")+D))}else for(t in f)Object.prototype.hasOwnProperty.call(f,t)&&(D=A(t,f))&&d.push(u(t)+(s?": ":":")+D);D=0===d.length?"{}":s?"{\n"+s+d.join(",\n"+
s)+"\n"+z+"}":"{"+d.join(",")+"}";s=z;return D}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+z(this.getUTCMonth()+1)+"-"+z(this.getUTCDate())+"T"+z(this.getUTCHours())+":"+z(this.getUTCMinutes())+":"+z(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var B=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
G=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s,F,I={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},E;"function"!==typeof JSON.stringify&&(JSON.stringify=function(m,u,j){var t;F=s="";if("number"===typeof j)for(t=0;t<j;t+=1)F+=" ";else"string"===typeof j&&(F=j);if((E=u)&&"function"!==typeof u&&("object"!==typeof u||"number"!==typeof u.length))throw Error("JSON.stringify");return A("",{"":m})});
"function"!==typeof JSON.parse&&(JSON.parse=function(m,u){function j(m,s){var t,d,f=m[s];if(f&&"object"===typeof f)for(t in f)Object.prototype.hasOwnProperty.call(f,t)&&(d=j(f,t),void 0!==d?f[t]=d:delete f[t]);return u.call(m,s,f)}var s;m=String(m);B.lastIndex=0;B.test(m)&&(m=m.replace(B,function(j){return"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(m.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return s=eval("("+m+")"),"function"===typeof u?j({"":s},""):s;throw new SyntaxError("JSON.parse");})})();
(function(z){function u(a){var b=a.match(/^[a-zA-Z\-]+:/);null!=b&&0<b.length?(this.scheme=b[0].substring(0,b[0].length-1),a=a.substring(b[0].length)):this.scheme=null;"//"==a.substring(0,2)?(this.doubleSlash=!0,a=a.substring(2)):this.doubleSlash=!1;b=a.indexOf("#");if(0<=b){var c;c=a.substring(b+1);-1!=c.indexOf("?")?(c.isQuery=!1,c=void 0):c=A(c);this.fragment=c;a=a.substring(0,b)}else this.hash=null;b=a.indexOf("?");0<=b?(c=a.substring(b+1),this.query=A(c),a=a.substring(0,b)):this.query=null;b=
a.indexOf("@");if(0<=b){c=a.substring(0,b);var e=c.indexOf(":");-1==e?(this.username=c,this.password=null):(this.username=c.substring(0,e),this.password=c.substring(e+1));a=a.substring(b+1)}else this.password=this.username=null;b=0;if(null!=this.scheme||this.doubleSlash)b=a.indexOf("/");0<=b?(this.path=a.substring(b),""==this.path&&(this.path=null),a=a.substring(0,b)):this.path=null;e=a.indexOf(":");0<=e?(this.port=a.substring(e+1),a=a.substring(0,e)):this.port=null;this.domain=""==a?null:a}function A(a){a=
a.split("&");for(var b=[],c=0;c<a.length;c++){var e=a[c],h=e.indexOf("=");if(-1==h)b.push({key:e});else{var r=e.substring(0,h),e=e.substring(h+1);b.push({key:r,value:decodeURIComponent(e)})}}for(r in ba)b[r]=ba[r];b.isQuery=!0;return b}function B(a){var b="";ja[a.charAt(0)]&&(b=a.charAt(0),a=a.substring(1));var c=",",e="",h=!0,r=!1;"+"==b?h=!1:"."==b?c=e=".":"/"==b?c=e="/":"#"==b?(e="#",h=!1):";"==b?(c=e=";",r=!0):"?"==b?(e="?",c="&",r=!0):"&"==b&&(c=e="&",r=!0);b=[];a=a.split(",");for(var d=[],f=
0;f<a.length;f++){var x=a[f],g=null;-1!=x.indexOf(":")&&(g=x.split(":"),x=g[0],g=parseInt(g[1]));for(var p={};ka[x.charAt(x.length-1)];)p[x.charAt(x.length-1)]=!0,x=x.substring(0,x.length-1);d.push({truncate:g,name:x,suffices:p});b.push(x)}a=function(a){for(var b=e,f=0;f<d.length;f++){var g=d[f];0<f&&(b+=c);var x=a(g.name);if(Array.isArray(x)){r&&(b+=g.name+"=");for(var K=0;K<x.length;K++)0<K&&(b+=g.suffices["*"]?c:",",g.suffices["*"]&&r&&(b+=g.name+"=")),b+=h?encodeURIComponent(x[K]).replace("!",
"%21"):encodeURI(x[K]).replace("%25","%")}else if("object"==typeof x){r&&!g.suffices["*"]&&(b+=g.name+"=");var K=!0,p;for(p in x)K||(b+=g.suffices["*"]?c:","),K=!1,b+=h?encodeURIComponent(p).replace("!","%21"):encodeURI(p).replace("%25","%"),b+=g.suffices["*"]?"=":",",b+=h?encodeURIComponent(x[p]).replace("!","%21"):encodeURI(x[p]).replace("%25","%")}else r&&(b+=g.name+"="),null!=g.truncate&&(x=x.substring(0,g.truncate)),b+=h?encodeURIComponent(x).replace("!","%21"):encodeURI(x).replace("%25","%")}return b};
a.varNames=b;return a}function G(a){a=a.split("{");for(var b=[a.shift()],c=[],e=[];0<a.length;){var h=a.shift(),r=h.split("}")[0],h=h.substring(r.length+1),r=B(r);c.push(r);b.push(h);e=e.concat(r.varNames)}this.fill=function(a){for(var e=b[0],h=0;h<c.length;h++)e+=(0,c[h])(a),e+=b[h+1];return e};this.varNames=e}function s(a,b){for(var c in b)(function(b,c){a[b]=function(){return c}})(c,b[c])}function F(a){this.contents={};this.keyOrder=[];this.context=a}function I(a){this.listeners=[];this.context=
a}function E(a,b){var c=this;this.baseUrl=a.url;this.fragment=b;null==b&&(b="");this.url=this.baseUrl+"#"+encodeURI(b);this.getRoot=function(b){a.getRoot(function(a){b.call(a,a,c)})};this.getData=function(e){null==b||""==b?a.document.getRoot(function(a){e.call(a,a,c)}):a.document.getFragment(b,function(a){e.call(a,a,c)})};this.getRawResponse=function(b){a.getResponse(function(a){b.call(a,a,c)})}}function m(a,b,c,e,h){a=l.resolveRelativeUri(a);c=l.encodeData(c,e);"GET"==b&&""!=c&&(a=-1==a.indexOf("?")?
a+"?":a+"&",a+=c,c="");l.log(l.logLevel.STANDARD,"Sending request for: "+a);this.errorMessage=this.successful=void 0;this.url=a;var r=void 0==c||""==c;this.responseListeners=new I(this);this.document=new D(a,r,!0);this.fetched=!1;this.fetchData(a,b,c,e,h);this.invalidate=function(){"GET"==b&&this.fetchData(a,b,c,e,h)}}function C(a,b,c,e,h){e(h,this);var r=this;this.url=a;this.responseListeners=new I(this);this.document=new D(a,!0,!0);this.document.setRaw(b);this.profileUrl=c;void 0!=c&&this.document.raw.addSchema(c);
a==c?this.document.setRoot(""):this.document.raw.whenSchemasStable(function(){var a=r.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),r.document.setRoot(a)):r.document.setRoot("")});this.successful=!0;this.errorMessage=void 0;this.fetched=!1;this.invalidate=function(){this.fetchData(a,"GET",void 0,"application/x-www-form-urlencoded",c)}}function j(a){this.operations=[];void 0==a&&(a="");this.prefix=a}function t(a,b,c){this._patchType=a;this._subject=b;
this._subjectValue=void 0;"move"==a?this._target=c:this._value=c}function D(a,b,c){function e(a){H.increment();var b=ca.concat(d);H.add(function(){for(var c=0;c<b.length;c++)b[c].call(h,a,h)});H.decrement()}var h=this;this.readOnly=!!c;this.url=a;this.isDefinitive=b;var r={};this.raw=new v(this,r);this.root=null;var d=[];this.registerChangeListener=function(a){d.push(a)};this.setRaw=function(a){var b=this.raw.defined();r.setValue(a);b&&(r.setValue(a),b=new j,b.replace(this.raw.pointerPath(),a),e(b))};
var f=new I(this);this.getRoot=function(a){null==this.root?f.add(a):a.call(this,this.root)};this.setRoot=function(a){this.root=this.raw.subPath(a);f.notify(this.root)};this.patch=function(a){if(this.readOnly)throw Error("Cannot update read-only document");if(S)void 0==this.batchPatch&&(this.batchPatch=new j,T.push(this)),this.batchPatch.operations=this.batchPatch.operations.concat(a.operations);else{H.increment();var b=a.filter("?"),c=a.filterRemainder("?");this.raw.patch(b);this.root.patch(c);e(a);
H.decrement()}};this.affectedData=function(a){for(var b=a.subject(),c=null,c="?"==b||"?/"==b.substring(0,2)?this.raw.subPath(b.substring(1)):this.root.subPath(b),b=[];void 0!=c;)b.push(c),c=c.parent();if("move"==a.action()){a=a.target();c=null;c="?"==a||"?/"==a.substring(0,2)?this.raw.subPath(a.substring(1)):this.root.subPath(a);for(b.push();void 0!=c;)b.push(c),c=c.parent()}return b}}function v(a,b,c,e){this.uniqueId=la++;this.document=a;this.readOnly=function(){return a.readOnly};var h=void 0,r=
void 0,d=0,f=[],g={},p={};this.property=function(a){void 0==g[a]&&(p[a]={},g[a]=new v(this.document,p[a],this,a),"object"==r&&(p[a].setValue(h[a]),void 0!==h[a]&&b.schemas.addSchemasForProperty(a,g[a])));return g[a]};var n={},y={};this.item=function(a){if(!O.test(a))throw Error("Index must be a positive integer (or integer-value string)");void 0==n[a]&&(y[a]={},n[a]=new v(this.document,y[a],this,a),"array"==r&&(y[a].setValue(h[a]),void 0!==h[a]&&b.schemas.addSchemasForIndex(a,n[a])));return n[a]};
this.parent=function(){return c};this.parentKey=function(){return e};this.pointerPath=function(){return this.document.root==this?"":void 0!=c?c.pointerPath()+"/"+l.encodePointerComponent(e):"?"};this.basicType=function(){return r};this.value=function(){if("object"==r){for(var a={},b=0;b<f.length;b++){var c=f[b];a[c]=void 0!=g[c]?g[c].value():h[c]}return a}if("array"==r){a=[];for(b=0;b<d;b++)a[b]=void 0!=n[b]?n[b].value():h[b];return a}return h};this.keys=function(){return f.slice(0)};this.length=
function(){return d};this.patch=function(a){var c=this,e=this.pointerPath(),q={};a.each(function(a,l){if(l.subjectEquals(e))if("replace"==l.action()||"add"==l.action())l.setSubjectValue(c.value()),b.setValue(l.value());else{if("remove"!=l.action()&&"move"!=l.action())throw Error("Unrecognised patch operation: "+l.action());}else if(l.targetEquals(e))"move"==l.action()&&b.setValue(l.subjectValue());else{var k=l.subjectChild(e);if(k)if(q[k]=!0,"object"==r)if("add"==l.action()){var j=f.indexOf(k);if(-1!=
j)throw Error("Cannot add existing key: "+k);f.push(k);h[k]=l.value();void 0!=g[k]&&(p[k].setValue(l.value()),b.schemas.addSchemasForProperty(k,g[k]))}else if("remove"==l.action()||"move"==l.action()){j=f.indexOf(k);if(-1==j)throw Error("Cannot delete missing key: "+k);l.setSubjectValue(c.propertyValue(k));f.splice(j,1);void 0!=p[k]&&p[k].setValue(void 0);delete h[k]}else{if("replace"!=l.action())throw Error("Unrecognised patch operation: "+l.action());}else if("array"==r){if(!O.test(k))throw Error("Cannot patch non-numeric index: "+
k);j=parseInt(k);if("add"==l.action()){if(j>d)throw Error("Cannot add past the end of the list");for(k=d-1;k>=j;k--)void 0!=y[k+1]&&(void 0==n[k]?y[k+1].setValue(h[k]):y[k+1].setValue(n[k].value()));h.splice(j,0,l.value());d++;void 0!=n[h.length-1]&&b.schemas.addSchemasForIndex(h.length-1,n[h.length-1])}else if("remove"==l.action()||"move"==l.action()){if(j>=d)throw Error("Cannot remove a non-existent index");l.setSubjectValue(c.itemValue(j));for(k=j;k<d-1;k++)void 0!=y[k]&&(void 0==n[k+1]?y[k].setValue(h[k+
1]):y[k].setValue(n[k+1].value()));void 0!=y[d-1]&&y[d-1].setValue(void 0);d--;h.splice(j,1)}else if("replace"!=l.action())throw Error("Unrecognised patch operation: "+l.action());}if(k=l.targetChild(e))if(q[k]=!0,"object"==r){if("move"==l.action()){j=f.indexOf(k);if(-1!=j)throw Error("Cannot move to existing key: "+k);f.push(k);h[k]=l.subjectValue();void 0!=g[k]&&b.schemas.addSchemasForProperty(k,g[k])}}else if("array"==r){if(!O.test(k))throw Error("Cannot patch non-numeric index: "+k);j=parseInt(k);
if("move"==l.action()){if(j>d)throw Error("Cannot add past the end of the list");for(k=d-1;k>=j;k--)void 0!=y[k+1]&&(void 0==n[k]?y[k+1].setValue(h[k]):y[k+1].setValue(n[k].value()));h.splice(j,0,l.subjectValue());d++;void 0!=n[h.length-1]&&b.schemas.addSchemasForIndex(h.length-1,n[h.length-1])}}}});if("object"==r)for(var k=0;k<f.length;k++){var j=f[k],J=a.filter("/"+l.encodePointerComponent(j));J.isEmpty()||this.property(j).patch(J)}else if("array"==r)for(k=0;k<d;k++)J=a.filter("/"+l.encodePointerComponent(k)),
J.isEmpty()||this.index(k).patch(J);for(j in q)b.schemas.update(j)};b.setValue=function(a){var c=l.guessBasicType(a,r),e=h;h=a;if(c!=r){if("object"==r)for(var k in g)p[k].setValue(void 0);else if("array"==r)for(var j in n)y[j].setValue(void 0);r=c}if("object"==c){for(k in g)a.hasOwnProperty(k)?(g[k].defined()||b.schemas.addSchemasForProperty(k,g[k]),p[k].setValue(a[k])):p[k].setValue(void 0);f=Object.keys(a);d=0}else if("array"==c){for(j in n)j<a.length?(n[j].defined()||b.schemas.addSchemasForIndex(j,
n[j]),y[j].setValue(a[j])):y[j].setValue(void 0);f=[];d=a.length}else f=[],d=0;void 0===a?void 0!==e&&b.schemas.clear():b.schemas.update(null)};b.schemas=new da(this);this.schemas=function(){return b.schemas.getSchemas()};this.whenSchemasStable=function(a){b.schemas.whenSchemasStable(a);return this};this.links=function(a){return b.schemas.getLinks(a)};this.addLink=function(a){b.schemas.addLink(a);return this};this.addSchema=function(a,c){var e=this;a instanceof w?a.each(function(a,b){e.addSchema(b,
c)}):b.schemas.addSchema(a,c);return this};this.removeSchema=function(a){b.schemas.removeSchema(a);return this};this.addSchemaMatchMonitor=function(a,c,e,h,r){return b.schemas.addSchemaMatchMonitor(a,c,e,h,r)}}function L(a,b){return q.getData(a,function(a,e){var h=a.asSchema();void 0!=b&&b.call(h,h,e)})}function d(a){void 0==U[a]&&(U[a]=q.createSchema({type:a}));return U[a]}function f(a){this.data=a;a.referenceUrl();a.propertyValue("id");var b=[];a=a.property("links");void 0!==a&&a.indices(function(a,
e){b[b.length]=new g(e)});this.links=function(){return b.slice(0)};this.schemaTitle=this.title()}function g(a){this.data=a;var b;b=a.propertyValue("href");if("{@}"==b)b="{+%73elf}";else{for(var c=[],e=!1,h=!1,r=0;r<b.length;r++){var d=b.charAt(r);e?h?")"==d?")"==b.charAt(r+1)?(c.push(V[")"]),r++):h=!1:void 0!=V[d]?c.push(V[d]):c.push(encodeURIComponent(d)):"$"==d?c.push("%73elf"):"("==d?")"==b.charAt(r+1)?(c.push("%65mpty"),r++):h=!0:("}"==d&&(e=!1),c.push(d)):("{"==d&&(e=!0),c.push(d))}b=c.join("")}this.uriTemplate=
new G(b);this.dataParts=[];for(b=0;b<this.uriTemplate.varNames.length;b++)this.dataParts.push(p(this.uriTemplate.varNames[b]));b=a.property("schema");b.defined()?(b=b.asSchema(),this.submissionSchemas=new w([b])):this.submissionSchemas=new w;a=a.property("targetSchema");a.defined()&&(this.targetSchema=a.asSchema());this.handlers=[];this.preHandlers=[]}function p(a){return"%65mpty"==a?"":"%73elf"==a?null:decodeURIComponent(a)}function y(a,b,c){this.rawLink=a;this.definition=b;this.subjectData=c;this.href=
a.href;b=this.href.indexOf("#");0<=b?(this.hrefBase=this.href.substring(0,b),this.hrefFragment=this.href.substring(b+1)):(this.hrefBase=this.href,this.hrefFragment="");this.rel=a.rel;this.method=void 0!=a.method?a.method:"edit"==a.rel?"PUT":"create"==a.rel?"POST":"delete"==a.rel?"DELETE":"GET";void 0!=a.enctype&&(a.encType=a.enctype,delete a.enctype);this.encType=void 0==a.encType?"GET"==this.method?"application/x-www-form-urlencoded":"POST"==this.method||"PUT"==this.method?"application/json":"application/x-www-form-urlencoded":
a.encType;null!=this.definition&&(this.submissionSchemas=this.definition.submissionSchemas,this.targetSchema=this.definition.targetSchema)}function k(a,b,c,e){var h=this;this.monitorKey=a;this.match=!1;this.matchFailReason=new n("initial failure",null);this.monitors=new F(c);this.impatientCallbacks=e;this.propertyMatches={};this.indexMatches={};this.dependencies={};this.dependencyKeys={};this.schemaLoaded=!1;this.data=b;c.getFull(function(a){h.schemaLoaded=!0;h.schema=a;h.basicTypes=a.basicTypes();
h.setupXorSelectors();h.setupOrSelectors();h.setupAndMatches();h.setupNotMatches();h.dataUpdated()})}function n(a,b,c){this.message=a;this.schema=b;this.subMatchFailReason=c}function J(a,b,c){var e=this;this.options=b;this.selectedOption=this.matchCallback=null;this.data=c;this.subMatches=[];this.subSchemaKeys=[];for(var h=0;h<b.length;h++)this.subSchemaKeys[h]=l.getKeyVariant(a,"option"+h),this.subMatches[h]=c.addSchemaMatchMonitor(this.subSchemaKeys[h],b[h],function(){e.update()},!1,!0);this.update()}
function W(a,b,c){var e=this;this.options=b;this.matchCallback=null;this.selectedOptions=[];this.data=c;this.subMatches=[];this.subSchemaKeys=[];for(var h=0;h<b.length;h++)this.subSchemaKeys[h]=l.getKeyVariant(a,"option"+h),this.subMatches[h]=c.addSchemaMatchMonitor(this.subSchemaKeys[h],b[h],function(){e.update()},!1,!0);this.update()}function ma(){X=!1;var a=[],b;for(b in P){var c=P[b];a.push({data:c,pointerPath:c.pointerPath()})}P={};a.sort(function(a,b){return a.pointerPath.length-b.pointerPath.length});
b=[];for(c=0;c<a.length;c++)b[c]=a[c].data;for(c=0;c<Y.length;c++)Y[c].call(null,b)}function Z(a){for(var b=0;b<a.length;b++)this[b]=a[b];this.length=a.length}function w(a,b){if(void 0==a)this.length=0;else{void 0==b&&(b=a);this.fixed=function(){var c=b.length<a.length?new w(b):this;this.fixed=function(){return c};return c};var c;for(c=0;c<a.length;c++)this[c]=a[c];this.length=a.length}}function da(a){this.dataObj=a;this.schemas={};this.schemasFixed={};this.links={};this.matches={};this.xorSelectors=
{};this.orSelectors={};this.dependencySelectors={};this.schemaFlux=0;this.schemasStable=!0;this.schemasStableListeners=new I(a);this.pendingNotify=!1;this.cachedLinkList=this.cachedSchemaList=null}function ea(a,b){this.dataObj=a;this.potentialLink=b;this.active=!1;this.rawLink=null;this.updateMonitors=new F(a)}function na(a,b,c,e){var h=l.getKeyVariant(b,"$");this.xorSelector=new J(b,a,e.dataObj);this.xorSelector.onMatchChange(function(b){e.removeSchema(h);null!=b?e.addSchema(b,h,c,!1):0<a.length&&
e.addSchema(a[0],h,c,!1)})}function oa(a,b,c,e){for(var h=[],d=[],f=0;f<a.length;f++)h[f]=l.getKeyVariant(b,"$"+f),d[f]=!1;this.orSelector=new W(b,a,e.dataObj);this.orSelector.onMatchChange(function(b){for(var f=0;f<a.length;f++){for(var N=!1,g=0;g<b.length;g++)if(a[f]==b[g]){N=!0;break}N&&!d[f]?e.addSchema(a[f],h[f],c,!1):!N&&d[f]&&e.removeSchema(h[f]);d[f]=N}0==b.length&&0<a.length&&e.addSchema(a[0],h[0],c,!1)})}function fa(a,b,c,e){this.inferredSchemaKeys={};this.applied={};this.schema=a;this.schemaKeyHistory=
c;this.schemaSet=e;a=this.schema.data.property("dependencies").keys();for(c=0;c<a.length;c++)e=a[c],this.inferredSchemaKeys[e]=l.getKeyVariant(b,"$"+c),this.dataUpdated(e)}var q={toString:function(){return"[JsonApi]"}};z.Jsonary=q;u.prototype={toString:function(){var a="";null!=this.scheme&&(a+=this.scheme+":");this.doubleSlash&&(a+="//");null!=this.username&&(a+=this.username,null!=this.password&&(a+=":"+this.password),a+="@");null!=this.domain&&(a+=this.domain);null!=this.port&&(a+=":"+this.port);
null!=this.path&&(a+=this.path);null!=this.query&&(a+="?"+this.query);null!=this.fragment&&(a+="#"+this.fragment);return a}};u.resolve=function(a,b){if(void 0==b)return a;if(void 0==a)return b;a instanceof u||(a=new u(a));result=new u(b+"");if(null==result.scheme&&(result.scheme=a.scheme,result.doubleSlash=a.doubleSlash,null==result.domain))if(result.domain=a.domain,result.port=a.port,result.username=a.username,result.password=a.password,null==result.path)result.path=a.path,null==result.query&&(result.query=
a.query);else if("/"!=result.path.charAt(0)&&null!=a.path){var c="/"==a.path.charAt(0),e;e=c?a.path.substring(1).split("/"):a.path.split("/");".."==e[e.length-1]&&e.push("");e.pop();for(var h=e.length-1;0<=h;h--)"."==e[h]&&e.slice(h,1);for(var d=result.path.split("/"),h=0;h<d.length;h++){var f=d[h];if("."!=f)if(".."==f)if(0<e.length&&".."!=e[e.length-1])e.pop();else{if(!c){e=e.concat(d.slice(h));break}}else e.push(f)}result.path=(c?"/":"")+e.join("/")}return result.toString()};u.parse=function(a){return new u(a)};
var ba={toString:function(){for(var a=[],b=0;b<this.length;b++)"undefined"==typeof this[b].value?a.push(this[b].key):a.push(this[b].key+"="+encodeURIComponent(this[b].value));return a.join("&")},get:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a)return this[c].value;return b},set:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a){this[c].value=b;return}this.push({key:a,value:b})}};q.Uri=u;var ja={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},ka={"*":!0},l={guessBasicType:function(a){if(null===
a)return"null";if(Array.isArray(a))return"array";if("object"==typeof a)return"object";if("string"==typeof a)return"string";if("number"==typeof a)return 0==a%1?"integer":"number";if("boolean"==typeof a)return"boolean"},resolveRelativeUri:function(a,b){return u.resolve(a,b)},urlsEqual:function(a,b){"#"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));"#"==b.charAt(b.length-1)&&(b=b.substring(0,b.length-1));return a==b},linksEqual:function(a,b){if(void 0==a||void 0==b)return a==b;if(a.length!=b.length)return!1;
for(var c=0;c<a.length;c++){var e=a[c],h=b[c];if(e.href!=h.href||e.rel!=h.rel||(e.method!=h.method||e["enc-type"]!=h["enc-type"])||e.schema!=h.schema)return!1}return!0},log:function(a,b){try{a>=l.logLevel.ERROR&&(window.alert("ERROR: "+b),console.log("ERROR: "+b),console.trace()),a>=l.logLevel.WARNING&&console.log("WARNING: "+b)}catch(c){}},logLevel:{DEBUG:-1,STANDARD:0,WARNING:1,ERROR:2},getKeyVariant:function(a,b){void 0==b&&(b=l.getUniqueKey());b+="";if(0<=b.indexOf("."))throw Error("variant name cannot contain a dot: "+
b);return a+"."+b},keyIsVariant:function(a,b){a+="";b+="";return a===b||a.substring(0,b.length+1)===b+"."},keyIsRoot:function(a){return-1==a.indexOf(".")},hcf:function(a,b){a=Math.abs(a);for(b=Math.abs(b);;){var c=a%b;if(0==c)return b;if(isNaN(c))return NaN;a=b;b=c}},recursiveCompare:function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(!l.recursiveCompare(a[c],b[c]))return!1;return!0}if("object"==typeof a){for(c in a)if(void 0===b[c]&&
void 0!==a[c])return!1;for(c in b)if(void 0===a[c]&&void 0!==a[c])return!1;for(c in a)if(!l.recursiveCompare(a[c],b[c]))return!1;return!0}return a===b},lcm:function(a,b){return Math.abs(a*b/this.hcf(a,b))},encodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.stringify(a);if("application/x-www-form-urlencoded"==b)return l.formEncode(a);throw Error("Unknown encoding type: "+this.encType);},decodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");
if("application/json"==b)return JSON.parse(a);if("application/x-www-form-urlencoded"==b)return l.formDecode(a);throw Error("Unknown encoding type: "+this.encType);},formEncode:function(a,b){void 0==b&&(b="");var c=[];if(Array.isArray(a))for(var e=0;e<a.length;e++){var h=""==b?e:b+encodeURIComponent("[]"),d=""==b?e:b+encodeURIComponent("["+e+"]"),f=a[e];null==f?c.push(h+"=null"):"object"==typeof f?c.push(l.formEncode(f,d)):"boolean"==typeof f?f?c.push(h+"=true"):c.push(h+"=false"):c.push(h+"="+encodeURIComponent(f))}else if("object"==
typeof a)for(h in a)a.hasOwnProperty(h)&&(f=a[h],""!=b&&(h=b+encodeURIComponent("["+h+"]")),"null"==f?c.push(h+"=null"):"object"==typeof f?c.push(l.formEncode(f,h)):"boolean"==typeof f?f?c.push(h+"=true"):c.push(h+"=false"):c.push(h+"="+encodeURIComponent(f)));else c.push(encodeURIComponent(a));return c.join("&")},formDecode:function(a){var b={};a=a.split("&");for(var c=0;c<a.length;c++){var e=a[c],h=e,d="";0<=e.indexOf("=")&&(h=e.substring(0,e.indexOf("=")),d=decodeURIComponent(e.substring(e.indexOf("=")+
1)),"true"==d?d=!0:"false"==d?d=!1:"null"==d?d=null:parseFloat(d)+""==d&&(d=parseFloat(d)));for(var h=decodeURIComponent(h),e=b,h=h.split("["),f=1;f<h.length;f++)h[f]=h[f].substring(0,h[f].length-1);for(f=0;f<h.length;f++)Array.isArray(e)&&""==h[f]&&(h[f]=e.length),f==h.length-1?e[h[f]]=d:(void 0==e[h[f]]&&(e[h[f]]=""==h[f+1]?[]:{}),e=e[h[f]])}return b},escapeHtml:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},encodePointerComponent:function(a){return a.toString().replace("~",
"~0").replace("/","~1")},decodePointerComponent:function(a){return a.toString().replace("~1","/").replace("~0","~")},splitPointer:function(a){a=a.split("/");""==a[0]&&a.shift();for(var b=0;b<a.length;b++)a[b]=l.decodePointerComponent(a[b]);return a},joinPointer:function(){for(var a="",b=0;b<parts.length;b++)a+="/"+l.encodePointerComponent(parts[b]);return a}},pa=0;l.getUniqueKey=function(){return pa++};q.getMonitorKey=l.getUniqueKey;q.getKeyVariant=function(a,b){return l.getKeyVariant(a,"~"+b)};q.keyIsVariant=
l.keyIsVariant;q.log=function(a,b){if("number"!=typeof a)throw alert("First argument to log() must be a number (preferably enum value from .logLevel)"),Error("First argument to log() must be a number (preferably enum value from .logLevel)");l.log(a,b)};q.setLogFunction=function(a){l.log=a};q.logLevel=l.logLevel;q.encodeData=l.encodeData;q.decodeData=l.decodeData;q.encodePointerComponent=l.encodePointerComponent;q.decodePointerComponent=l.decodePointerComponent;q.splitPointer=l.splitPointer;q.joinPointer=
l.joinPointer;q.escapeHtml=l.escapeHtml;q.extend=function(a){for(var b in a)void 0==q[b]&&(q[b]=a[b])};F.prototype={add:function(a,b){if("string"!=typeof a&&"number"!=typeof a)throw Error("First argument must be a monitorKey, obtained using getMonitorKey()");this.contents[a]=b;this.addKey(a)},addKey:function(a){var b;for(b=0;b<this.keyOrder.length;b++){var c=this.keyOrder[b];if(c==a)return;if(l.keyIsVariant(a,c)){this.keyOrder.splice(b,0,a);return}}this.keyOrder.push(a)},remove:function(a){delete this.contents[a];
this.removeKey(a);a+=".";for(var b in this.contents)b.substring(0,a.length)==a&&(this.removeKey(b),delete this.contents[b])},removeKey:function(a){a=this.keyOrder.indexOf(a);0<=a&&this.keyOrder.splice(a,1)},notify:function(){for(var a=arguments,b=0;b<this.keyOrder.length;b++)this.contents[this.keyOrder[b]].apply(this.context,a)},isEmpty:function(){for(var a in this.contents)if(0!==this.contents[a].length)return!1;return!0}};I.prototype={add:function(a){this.listeners[this.listeners.length]=a},notify:function(){for(var a=
arguments;0<this.listeners.length;)this.listeners.shift().apply(this.context,a)},isEmpty:function(){return 0===this.listeners.length}};var H={depth:0,callbacks:[],increment:function(){this.depth++},decrement:function(){this.depth--;if(0>this.depth)throw Error("DelayedCallbacks.depth cannot be < 0");for(;0==this.depth&&0<this.callbacks.length;){var a=this.callbacks.shift();this.depth++;a();this.depth--}},add:function(a){this.depth++;this.callbacks.push(a);this.decrement()}};"undefined"==typeof XMLHttpRequest&&
(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}throw Error("This browser does not support XMLHttpRequest.");});var Q={};setInterval(function(){M.empty()},1E4);var M=function(a,b){if(void 0!==b)Q[a]=b,(new Date).getTime();else return Q[a]};M.cacheSeconds=10;M.empty=function(){};M.invalidate=function(a){"string"==typeof a&&(a=l.resolveRelativeUri(a));
for(var b in Q){var c=Q[b],e=c.url;"string"==typeof a?-1!=e.indexOf(a)&&c.invalidate():a.test(e)&&c.invalidate()}};q.defaultCache=M;q.invalidate=M.invalidate;E.prototype={};q.addToCache=function(a,b,c,e){a=l.resolveRelativeUri(a);void 0==e&&(e=q.defaultCache);var h=JSON.stringify(a)+":"+JSON.stringify({});new C(a,b,c,e,h)};q.getData=function(a,b,c){"string"==typeof a&&(a={url:a});var e;a:{var h=a.url,d=a.method,f=a.data,g=a.encType;a=null;if(void 0==h)throw Error("URL cannot be undefined");h=l.resolveRelativeUri(h);
void 0==d&&(d="GET");void 0===f&&(f={});var k=null,p=h.indexOf("#");0<=p&&(k=decodeURI(h.substring(p+1)),h=h.substring(0,p));void 0==g&&(g="GET"==d?"application/x-www-form-urlencoded":"POST"==d||"PUT"==d?"application/json":"application/x-www-form-urlencoded");void 0==a&&(a=q.defaultCache);if(p=a&&"GET"==d&&"application/x-www-form-urlencoded"==g){e=JSON.stringify(h)+":"+JSON.stringify(f);var n=a(e);if(void 0!=n){e=new E(n,k);break a}}c=new m(h,d,f,g,c);p&&a(e,c);e=new E(c,k)}void 0!=b&&e.getData(b);
return e};q.isRequest=function(a){return a instanceof m||a instanceof E};var aa=l.getUniqueKey();m.prototype={beingUsed:function(){return void 0==this.baseContext?(l.log(l.logLevel.DEBUG,"No base context: "+this.url),!0):0<this.baseContext.retainCount()},getResponse:function(a){this.responseListeners.add(a);this.checkForFullResponse()},checkForFullResponse:function(){this.document.raw.defined()&&this.responseListeners.notify(this.document.raw,this)},ajaxSuccess:function(a,b,c){this.fetched=!0;var e=
this;e.successful=!0;l.log(l.logLevel.STANDARD,"Request success: "+this.url);var h=b.replace(/\r\n/g,"\n").split("\n"),d={},f=null,g={};for(b=0;b<h.length;b++){var k=h[b].split(": ")[0];""!=k&&(f=h[b].substring(k.length+2),"\r"==f[f.length-1]&&(f=f.substring(0,f.length-1)),k=k.toLowerCase(),void 0==d[k]?d[k]=f:"object"==typeof d[k]?d[k].push(f):d[k]=[d[k],f])}l.log(l.logLevel.DEBUG,"headers: "+JSON.stringify(d,null,4));f=d["content-type"].split(";")[0];h=d["content-type"].substring(f.length+1).split(",");
for(b=0;b<h.length;b++){var k=h[b].split("=")[0],p=h[b].substring(k.length+1),k=k.trim();""!=k&&(g[k]=p)}e.headers=d;e.contentType=f;e.contentTypeParameters=g;e.document.setRaw(a);e.profileUrl=null;e.document.raw.removeSchema(aa);void 0!=g.profile?(b=g.profile,b=l.resolveRelativeUri(e.url,b),e.profileUrl=b,e.document.raw.addSchema(b,aa)):void 0!=c&&e.document.raw.addSchema(c,aa);void 0!=g.root&&(a={href:g.root,rel:"root"},e.document.raw.addLink(a));if(d.link){d="object"==typeof d.link?d.link:[d.link];
for(b=0;b<d.length;b++){a=d[b];a=a.trim().split(";");c=a.shift().trim();c=c.substring(1,c.length-2);c={href:c};for(g=0;g<a.length;g++)f=a[g],h=f.substring(0,f.indexOf("=")).trim(),f=f.substring(h.length+1),'"'==f.charAt(0)&&(f=JSON.parse(f)),"type"==h&&(h="mediaType"),c[h]=f;e.document.raw.addLink(c)}}e.checkForFullResponse();e.document.raw.whenSchemasStable(function(){var a=e.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),e.document.setRoot(a)):e.document.setRoot("")})},
ajaxError:function(a){this.fetched=!0;var b=this;b.successful=!1;b.errorMessage=a;l.log(l.logLevel.WARNING,"Error fetching: "+this.url+" ("+a+")");b.document.setRaw(void 0);b.document.raw.whenSchemasStable(function(){b.checkForFullResponse();b.document.setRoot("")})},fetchData:function(a,b,c,e,h){var d=this,f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){var a=f.responseText;try{a=JSON.parse(a)}catch(b){d.ajaxError(b);return}var c=f.getAllResponseHeaders();
if(""==c){for(var c=[],e="Cache-Control Content-Language Content-Type Expires Last-Modified Pragma".split(" "),g=0;g<e.length;g++){var k=f.getResponseHeader(e[g]);""!=k&&null!=k&&c.push(e[g]+": "+k)}c=c.join("\n")}d.ajaxSuccess(a,c,h)}else d.ajaxError("HTTP Status "+f.status)};if(("GET"==b||"DELETE"==b)&&void 0!=c&&""!=c)a=-1==a.indexOf("?")?a+"?":a+"&",a+=c,c=void 0;if(q.config.antiCacheUrls){var g="_="+Math.random();a=-1==a.indexOf("?")?a+("?"+g):a+("&"+g)}f.open(b,a,!0);f.setRequestHeader("Content-Type",
e);f.setRequestHeader("If-Modified-Since","Thu, 01 Jan 1970 00:00:00 GMT");f.send(c)}};C.prototype=m.prototype;j.prototype={isEmpty:function(){return 0==this.operations.length},each:function(a){for(var b=0;b<this.operations.length;b++)a.call(this,b,this.operations[b]);return this},plain:function(){for(var a=[],b=0;b<this.operations.length;b++)a[b]=this.operations[b].plain();return a},condense:function(){},filterImmediate:function(){for(var a=new j(this.prefix),b=0;b<this.operations.length;b++){var c=
this.operations[b];c.immediateChild(this.prefix)&&a.operations.push(c)}return a},filter:function(a){a=this.prefix+a;for(var b=new j(a),c=0;c<this.operations.length;c++){var e=this.operations[c];e.hasPrefix(a)&&b.operations.push(e)}return b},filterRemainder:function(a){a=this.prefix+a;for(var b=new j(this.prefix),c=0;c<this.operations.length;c++){var e=this.operations[c];e.hasPrefix(a)||b.operations.push(e)}return b},replace:function(a,b){var c=new t("replace",a,b);this.operations.push(c);return this},
add:function(a,b){var c=new t("add",a,b);this.operations.push(c);return this},remove:function(a){a=new t("remove",a);this.operations.push(a);return this},move:function(a,b){var c=new t("move",a,b);this.operations.push(c);return this},inverse:function(){for(var a=new j(this.prefix),b=0;b<this.operations.length;b++)a.operations[b]=this.operations[b].inverse();a.operations.reverse();return a}};t.prototype={action:function(){return this._patchType},value:function(){return this._value},subject:function(){return this._subject},
setSubjectValue:function(a){this._subjectValue=a;return this},subjectValue:function(){return this._subjectValue},inverse:function(){switch(this._patchType){case "replace":return new t("replace",this._subject,this._subjectValue);case "add":return(new t("remove",this._subject)).setSubjectValue(this._value);case "remove":return new t("add",this._subject,this._subjectValue);case "move":return new t("move",this._target,this._subject);default:throw Error("Unrecognised patch type for inverse: "+this._patchType);
}},depthFrom:function(a){"object"==typeof a&&(a=a.pointerPath());a+="/";var b=NaN;if(this._subject.substring(0,a.length)==a)var c=this._subject.substring(a.length),b=0==c?0:c.split("/").length;void 0!=this._target&&this._target.substring(0,a.length)==a&&(c=this._target.substring(a.length),a=0==c?0:c.split("/").length,a>b||(b=a));return b},subjectEquals:function(a){return this._subject==a},subjectChild:function(a){a+="/";return this._subject.substring(0,a.length)==a&&(a=this._subject.substring(a.length),
-1==a.indexOf("/"))?decodeURIComponent(a):!1},subjectRelative:function(a){a+="/";return this._subject.substring(0,a.length)==a?this._subject.substring(a.length-1):!1},target:function(){return this._target},targetEquals:function(a){return this._target==a},targetChild:function(a){if(void 0!=this._target)return a+="/",this._target.substring(0,a.length)==a&&(a=this._target.substring(a.length),-1==a.indexOf("/"))?decodeURIComponent(a):!1},targetRelative:function(a){a+="/";return this._target.substring(0,
a.length)==a?this._target.substring(a.length-1):!1},plain:function(){var a={};a[this._patchType]=this._subject;"remove"!=this._patchType&&("move"==this._patchType?a.to=this._target:a.value=this._value);return a},matches:function(a){return this._subject==a||"move"==this._patchType&&this._target==a?!0:!1},hasPrefix:function(a){"object"==typeof a&&(a=a.pointerPath());if(this.matches(a))return!0;a+="/";return this._subject.substring(0,a.length)==a||"move"==this._patchType&&this._target.substring(0,a.length)==
a?!0:!1}};var ca=[];q.registerChangeListener=function(a){ca.push(a)};var S=!1,T=[];q.batch=function(a){if(void 0!=a)return q.batch(),a(),q.batchDone(),this;S=!0;return this};q.batchDone=function(){for(S=!1;0<T.length;){var a=T.shift(),b=a.batchPatch;delete a.batchPatch;a.patch(b)}return this};D.prototype={resolveUrl:function(a){return u.resolve(this.url,a)},getFragment:function(a,b){this.getRoot(function(c){""!=a&&(c=c.subPath(a));b.call(this,c)})},get:function(a){return this.root.get(a)},set:function(a,
b){this.root.set(a,b);return this},move:function(a,b){var c=new j;c.move(a,b);this.patch(c);return this}};var O=/^(0|[1-9]\d*)$/,la=0;v.prototype={referenceUrl:function(){if(this.document.isDefinitive){var a=this.pointerPath();if(""==a||"/"==a.charAt(0))return this.document.url+"#"+encodeURI(this.pointerPath())}},subPath:function(a){a=a.split("/");if(""!=a[0])throw Error("Path must begin with / (or be empty)");for(var b=this,c=1;c<a.length;c++)a[c]=l.decodePointerComponent(a[c]),b="array"==b.basicType()?
b.index(a[c]):b.property(a[c]);return b},defined:function(){return void 0!=this.basicType()},setValue:function(a){if("undefined"==typeof a)return this.remove();if("object"!=this.basicType()&&"array"!=this.basicType()&&this.value()===a)return this;var b=new j;this.defined()?b.replace(this.pointerPath(),a):b.add(this.pointerPath(),a);this.document.patch(b,this);return this},remove:function(){var a=new j;a.remove(this.pointerPath());this.document.patch(a,this);return this},itemValue:function(a){return this.index(a).value()},
removeItem:function(a){this.index(a).remove();return this},insertItem:function(a,b){if("array"!=this.basicType())throw Error("cannot insert into a non-array");var c=new j;c.add(this.item(a).pointerPath(),b);this.document.patch(c,this);return this},push:function(a){if("array"==this.basicType())this.index(this.length()).setValue(a);else throw Error("Can only push() on an array");return this},propertyValue:function(a){return this.property(a).value()},removeProperty:function(a){this.property(a).remove();
return this},moveTo:function(a){if("object"==typeof a){if(a.document!=this.document){var b=this.value();this.remove();a.setValue(b);return a}a=a.pointerPath()}var b=new j,c=this.pointerPath();if(a!=c)return b.move(c,a),this.document.patch(b,this),this.document.root.subPath(a)},getLink:function(a){return this.links(a)[0]},equals:function(a){var b;b=this.basicType();if(b!=a.basicType())return!1;if("array"==b){if(this.length()!==a.length())return!1;for(b=0;b<this.length();b++)if(!this.index(b).equals(a.index(b)))return!1;
return!0}if("object"==b){var c=this.keys(),e=a.keys();if(c.length!=e.length)return!1;c.sort();e.sort();for(b=0;b<c.length;b++)if(c[b]!==e[b])return!1;for(b=0;b<c.length;b++)if(e=c[b],!this.property(e).equals(a.property(e)))return!1;return!0}return this.value()===a.value()},readOnlyCopy:function(){if(this.readOnly())return this;var a=q.create(this.value(),this.document.url+"#:copy",!0);this.schemas().each(function(b,c){a.addSchema(c)});return a},editableCopy:function(){var a=q.create(this.value(),
this.document.url+"#:copy",!1),b=l.getUniqueKey();this.schemas().fixed().each(function(c,e){a.addSchema(e,b)});return a},asSchema:function(){var a=new f(this.readOnlyCopy());this.readOnly()&&s(this,{asSchema:a});return a},asLink:function(a){var b=this.readOnlyCopy(),b=new g(b);a=void 0==a?b.linkForData(this):b.linkForData(a);this.readOnly()&&s(this,{asLink:a});return a},items:function(a){for(var b=0;b<this.length();b++){var c=this.index(b);a.call(c,b,c)}return this},properties:function(a,b,c){"function"==
typeof a&&(b=a,a=this.keys());if(b)for(var e=0;e<a.length;e++){var h=this.property(a[e]);b.call(h,a[e],h)}if(c){b=this.keys();for(e=0;e<b.length;e++)-1==a.indexOf(b[e])&&(h=this.property(b[e]),c.call(h,b[e],h))}return this},resolveUrl:function(a){for(var b=this;b;){var c=b.getLink("self");if(c)return u.resolve(c.href,a);b=b.parent()}return this.document.resolveUrl(a)},get:function(a){return this.subPath(a).value()},set:function(a,b){this.subPath(a).setValue(b);return this},json:function(){return JSON.stringify(this.value())}};
v.prototype.indices=v.prototype.items;v.prototype.indexValue=v.prototype.itemValue;v.prototype.removeIndex=v.prototype.removeItem;v.prototype.index=function(a){return this.item(a)};q.extendData=function(a){for(var b in a)void 0==v.prototype[b]&&(v.prototype[b]=a[b])};q.create=function(a,b,c){a="object"==typeof a?JSON.parse(JSON.stringify(a)):a;var e=void 0!=b;void 0!=b&&-1!=b.indexOf("#")&&(""!=b.substring(b.indexOf("#")+1)&&(e=!1),b=b.substring(0,b.indexOf("#")));b=new D(b,e,c);b.setRaw(a);b.setRoot("");
return b.root};q.isData=function(a){return a instanceof v};v.prototype.deflate=function(){var a=[];this.schemas().each(function(b,c){void 0!=c.referenceUrl()?a.push(c.referenceUrl()):a.push(c.data.deflate())});return{baseUrl:this.document.url,readOnly:this.readOnly(),value:this.value(),schemas:a}};q.inflate=function(a){for(var b=q.create(a.value,a.baseUrl,a.readOnly),c=0;c<a.schemas.length;c++){var e=a.schemas[c];"object"==typeof e&&(e=q.inflate(e).asSchema());b.addSchema(e)}return b};q.createSchema=
function(a,b){return q.create(a,b,!0).asSchema()};q.isSchema=function(a){return a instanceof f};q.getSchema=L;var R="null boolean integer number string array object".split(" "),U={};f.prototype={toString:function(){return"<Schema "+this.data+">"},referenceUrl:function(){return this.data.referenceUrl()},isFull:function(){return void 0===this.data.propertyValue("$ref")},getFull:function(a){var b=this.data.propertyValue("$ref");if(void 0===b)return a&&a.call(this,this,void 0),this;b=this.data.resolveUrl(b);
if("#"==b.charAt(0)&&(1==b.length||"/"==b.charAt(1))){var c=this.data.document.root,b=decodeURIComponent(b.substring(1)),c=c.subPath(b).asSchema();if(a)a.call(c,c,null);else return c}else a&&L(b,a);return this},title:function(){var a=this.data.propertyValue("title");void 0==a&&(a=null);return a},hasDefault:function(){return this.data.property("default").defined()},defaultValue:function(){return this.data.propertyValue("default")},propertySchemas:function(a){var b=[],c=this.data.property("properties").property(a);
c.defined()&&b.push(c.asSchema());this.data.property("patternProperties").properties(function(c,h){RegExp(c).test(a)&&b.push(h.asSchema())});0==b.length&&(c=this.data.property("additionalProperties"),c.defined()&&b.push(c.asSchema()));return new w(b)},propertyDependencies:function(a){var b=this.data.property("dependencies");return b.defined()&&(a=b.property(a),a.defined())?"string"==a.basicType()?[a.value()]:"array"==a.basicType()?a.value():[a.asSchema()]:[]},indexSchemas:function(a){var b=this.data.property("items");
if(!b.defined())return new w;"array"==b.basicType()?(a=b.index(a),a.defined()||(a=this.data.property("additionalItems"))):a=b;return a.defined()?(a=a.asSchema(),new w([a])):new w},andSchemas:function(){var a=[],b=this.data.property("extends");b.defined()&&("array"==b.basicType()?b.indices(function(b,e){a.push(e.asSchema())}):a.push(b.asSchema()));this.data.property("allOf").items(function(b,e){a.push(e.asSchema())});return new w(a)},notSchemas:function(){var a=[],b=this.data.property("disallow");
b.defined()&&("array"==b.basicType()?b.indices(function(b,e){"string"==e.basicType()?a.push(q.createSchema({type:e.value()})):a.push(e.asSchema())}):"string"==b.basicType()?a.push(q.createSchema({type:b.value()})):a.push(b.asSchema()));this.data.property("not").defined()&&a.push(this.data.property("not").asSchema());return a},types:function(){var a=this.data.property("type");if(a.defined()){if("string"===a.basicType())return"all"==a.value()?R.slice(0):[a.value()];for(var b=[],c=0;c<a.length();c++)if("string"==
a.item(c).basicType()){if("all"==a.item(c).value())return R.slice(0);b.push(a.item(c).value())}else return R.slice(0);-1!=b.indexOf("number")&&-1==b.indexOf("integer")&&b.push("integer");return b}return R.slice(0)},xorSchemas:function(){var a=[],b=this.data.property("type");if(b.defined())for(var c=0;c<b.length();c++)if("string"!=b.item(c).basicType()){var e=[];b.items(function(a,b){"string"==b.basicType()?e.push(d(b.value())):e.push(b.asSchema())});a.push(e);break}this.data.property("oneOf").defined()&&
(e=[],this.data.property("oneOf").items(function(a,b){e.push(b.asSchema())}),a.push(e));return a},orSchemas:function(){var a=[];this.data.property("type");if(this.data.property("anyOf").defined()){var b=[];this.data.property("anyOf").items(function(a,e){b.push(e.asSchema())});a.push(b)}return a},equals:function(a,b){var c=this;b&&(a=a.getFull(),c=this.getFull());if(c===a)return!0;var e=c.referenceUrl(),h=a.referenceUrl();b&&!c.isFull()&&(e=c.data.resolveUrl(this.data.propertyValue("$ref")));b&&!a.isFull()&&
(h=a.data.resolveUrl(a.data.propertyValue("$ref")));return void 0!==e&&void 0!==h?l.urlsEqual(e,h):this.data.equals(a.data)},enumValues:function(){return this.data.propertyValue("enum")},enumData:function(){return this.data.property("enum")},minItems:function(){var a=this.data.propertyValue("minItems");return void 0==a?0:a},maxItems:function(){return this.data.propertyValue("maxItems")},tupleTypingLength:function(){return"array"!=this.data.property("items").basicType()?0:this.data.property("items").length()},
minLength:function(){var a=this.data.propertyValue("minLength");return void 0==a?0:a},maxLength:function(){return this.data.propertyValue("maxLength")},numberInterval:function(){return this.data.propertyValue("divisibleBy")},minimum:function(){return this.data.propertyValue("minimum")},exclusiveMinimum:function(){return!!this.data.propertyValue("exclusiveMinimum")},maximum:function(){return this.data.propertyValue("maximum")},exclusiveMaximum:function(){return!!this.data.propertyValue("exclusiveMaximum")},
minProperties:function(){var a=this.data.propertyValue("minProperties");return void 0==a?0:a},maxProperties:function(){return this.data.propertyValue("maxProperties")},definedProperties:function(a){if(a)return this.definedProperties(),this.definedProperties(a);var b=this.data.property("properties").keys();this.definedProperties=function(a){a=a||[];for(var e=[],h=0;h<b.length;h++)-1==a.indexOf(b[h])&&e.push(b[h]);return e};return b.slice(0)},knownProperties:function(a){if(a)return this.knownProperties(),
this.knownProperties(a);var b={};this.data.property("properties").properties(function(a){b[a]=!0});a=this.requiredProperties();for(var c=0;c<a.length;c++)b[a[c]]=!0;var e=Object.keys(b);this.knownProperties=function(a){a=a||[];for(var b=[],c=0;c<e.length;c++)-1==a.indexOf(e[c])&&b.push(e[c]);return b};return e.slice(0)},requiredProperties:function(){var a=this.data.propertyValue("required");"object"!=typeof a&&(a=[]);var b=this.data.property("properties");void 0!=b&&b.properties(function(b,e){var h=
e.property("required");void 0!=h&&("boolean"==h.basicType()&&h.value())&&a.push(b)});return a},allowedAdditionalProperties:function(){return!1!==this.data.propertyValue("additionalProperties")},getLink:function(a){for(var b=this.links(),c=0;c<b.length;c++)if(b[c].rel()==a)return b[c]},asList:function(){return new w([this])},format:function(){return this.data.propertyValue("format")}};f.prototype.basicTypes=f.prototype.types;f.prototype.extendSchemas=f.prototype.andSchemas;f.prototype.isComplete=f.prototype.isFull;
q.extendSchema=function(a){for(var b in a)void 0==f.prototype[b]&&(f.prototype[b]=a[b])};var V={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};g.prototype={addHandler:function(a){this.handlers.unshift(a);return this},addPreHandler:function(a){this.preHandlers.push(a);return this},canApplyTo:function(a){var b,c,e=null;for(b=0;b<this.dataParts.length;b++)if(c=this.dataParts[b],null===c?e=a:"object"==a.basicType()?e=a.property(c):"array"==a.basicType()&&O.test(c)&&(e=a.index(c)),void 0==e||!e.defined()||
"null"==e.basicType())return!1;return!0},linkForData:function(a){var b=this.data.value(),c=this.uriTemplate.fill(function(b){b=p(b);return null==b?a.value():"array"==a.basicType()?a.itemValue(b):a.propertyValue(b)});b.href=a.resolveUrl(c);b.rel=b.rel.toLowerCase();return new y(b,this,a)},usesKey:function(a){var b;for(b=0;b<this.dataParts.length;b++)if(this.dataParts[b]===a)return!0;return!1},rel:function(){return this.data.propertyValue("rel").toLowerCase()}};var ga=[],ha=[];q.addLinkHandler=function(a){ga.unshift(a)};
q.addLinkPreHandler=function(a){ha.push(a)};var ia=l.getUniqueKey();y.prototype={toString:function(){return this.href},createSubmissionData:function(a){var b=this.hrefBase,c=this.submissionSchemas;if(void 0!=a&&0==c.length&&"PUT"==this.method)return Jsonary.getData(this.href,function(b){a(b.editableCopy())}),this;if(void 0!=a)c.createValue(function(e){e=q.create(e,b);for(var h=0;h<c.length;h++)e.addSchema(c[h],ia);a(e)});else{for(var e=c.createValue(),e=q.create(e,b),h=0;h<c.length;h++)e.addSchema(c[h],
ia);return e}},follow:function(a,b){"function"==typeof a&&(b=a,a=void 0);void 0!==a?a instanceof v||(a=q.create(a)):a=q.create(void 0);for(var c=ha.concat(this.definition.preHandlers),e=0;e<c.length;e++){var h=c[e];if(!1===h.call(this,this,a))return l.log(l.logLevel.DEBUG,"Link cancelled: "+this.href),null}e=a.value();c=q.getData({url:this.href,method:this.method,data:e,encType:this.encType},null,this.targetSchema);a=a.readOnlyCopy();var d=this.definition.handlers.concat(ga);void 0!==b&&d.unshift(b);
for(e=0;e<d.length&&!(h=d[e],!1===h.call(this,this,a,c));e++);return c}};k.prototype={setupXorSelectors:function(){var a=this;this.xorSelectors={};for(var b=this.schema.xorSchemas(),c=0;c<b.length;c++){var e=new J(l.getKeyVariant(this.monitorKey,"xor"+c),b[c],this.data);this.xorSelectors[c]=e;e.onMatchChange(function(){a.update()},!1)}},setupOrSelectors:function(){var a=this;this.orSelectors={};for(var b=this.schema.orSchemas(),c=0;c<b.length;c++){var e=new W(l.getKeyVariant(this.monitorKey,"or"+
c),b[c],this.data);this.orSelectors[c]=e;e.onMatchChange(function(){a.update()},!1)}},setupAndMatches:function(){var a=this;this.andMatches=[];this.schema.andSchemas().each(function(b,c){var e=l.getKeyVariant(a.monitorKey,"and"+b),e=a.data.addSchemaMatchMonitor(e,c,function(){a.update()},!1,!0);a.andMatches.push(e)})},setupNotMatches:function(){var a=this;this.notMatches=[];for(var b=this.schema.notSchemas(),c=0;c<b.length;c++)(function(b,c){var d=l.getKeyVariant(a.monitorKey,"not"+b),d=a.data.addSchemaMatchMonitor(d,
c,function(){a.update()},!1,!0);a.notMatches.push(d)})(c,b[c])},addMonitor:function(a,b){this.monitors.add(this.monitorKey,a);!1!==b&&a.call(this.schema,this.match,this.matchFailReason);return this},dataUpdated:function(a){if(this.schemaLoaded){var b=this;if("object"==this.data.basicType()){this.indexMatches={};this.data.properties(function(a,c){if(void 0==b.propertyMatches[a]){var e=[],d=b.schema.propertySchemas(a);d.each(function(f){var g=c.addSchemaMatchMonitor(b.monitorKey,d[f],function(){b.subMatchUpdated(a,
g)},!1,!0);e.push(g)});b.propertyMatches[a]=e;b.addDependencies(a)}});var c=[];for(a in this.propertyMatches)this.data.property(a).defined()||c.push(a);for(var e=0;e<c.length;e++)a=c[e],delete this.propertyMatches[a],void 0!=this.dependencyKeys[a]&&(this.data.removeSchema(this.dependencyKeys[a]),delete this.dependencies[a],delete this.dependencyKeys[a])}else if("array"==this.data.basicType()){this.propertyMatches={};this.data.indices(function(c,e){if(void 0==b.indexMatches[c]){var d=[],f=b.schema.indexSchemas(c);
f.each(function(c){var h=e.addSchemaMatchMonitor(b.monitorKey,f[c],function(){b.subMatchUpdated(a,h)},!1,!0);d.push(h)});b.indexMatches[c]=d}});c=[];for(a in this.indexMatches)this.data.length()<=a&&c.push(a);for(e=0;e<c.length;e++)delete this.indexMatches[c[e]]}else this.propertyMatches={},this.indexMatches={};this.update()}},addDependencies:function(a){var b=this,c=this.schema.propertyDependencies(a);this.dependencies[a]=[];this.dependencyKeys[a]=[];for(var e=0;e<c.length;e++){var h=c[e];"string"==
typeof h?this.dependencies[a].push(h):function(c){var e=l.getKeyVariant(b.monitorKey,"dep:"+a+":"+c);b.dependencyKeys[a].push(e);e=b.data.addSchemaMatchMonitor(e,h,function(){b.dependencyUpdated(a,c)},!1,!0);b.dependencies[a].push(e)}(e)}},notify:function(){this.monitors.notify(this.match,this.matchFailReason)},setMatch:function(a,b){var c=this,e=this.match,h=this.matchFailReason;this.matchFailReason=(this.match=a)?null:b;if(this.impatientCallbacks)return this.notify();this.pendingNotify||(this.pendingNotify=
!0,H.add(function(){c.pendingNotify=!1;if(!c.match||!e)(c.match||e||!c.matchFailReason.equals(h))&&c.notify()}))},subMatchUpdated:function(){this.update()},subMatchRemoved:function(){this.update()},dependencyUpdated:function(){this.update()},update:function(){try{this.matchAgainstBasicTypes(),this.matchAgainstSubMatches(),this.matchAgainstImmediateConstraints(),this.setMatch(!0)}catch(a){if(a instanceof n)this.setMatch(!1,a);else throw a;}},matchAgainstBasicTypes:function(){for(var a=this.data.basicType(),
b=0;b<this.basicTypes.length;b++)if(this.basicTypes[b]==a||"integer"==a&&"number"==this.basicTypes[b])return;throw new n("Data does not match any of the basic types: "+this.basicTypes,this.schema);},matchAgainstSubMatches:function(){for(var a=0;a<this.andMatches.length;a++){var b=this.andMatches[a];if(!b.match){var c="extended schema #"+a+": "+b.message;throw new n(c,this.schema,b.failReason);}}for(a=0;a<this.notMatches.length;a++)if(this.notMatches[a].match)throw c='"not" schema #'+a+" matches",
new n(c,this.schema);for(c in this.xorSelectors)if(a=this.xorSelectors[c],null==a.selectedOption)throw c="XOR #"+c+": "+a.failReason.message,new n(c,this.schema,a.failReason);for(c in this.orSelectors)if(a=this.orSelectors[c],0==a.selectedOptions.length)throw c="OR #"+c+": no matches",new n(c,this.schema);for(c in this.propertyMatches)for(var e=this.propertyMatches[c],a=0;a<e.length;a++)if(b=e[a],!b.match)throw c=c+": "+b.matchFailReason.message,new n(c,this.schema,b.matchFailReason);for(c in this.indexMatches){e=
this.indexMatches[c];for(a=0;a<e.length;a++)if(b=e[a],!b.match)throw c=c+": "+b.matchFailReason.message,new n(c,this.schema,b.matchFailReason);}},matchAgainstImmediateConstraints:function(){this.matchAgainstEnums();this.matchAgainstNumberConstraints();this.matchAgainstArrayConstraints();this.matchAgainstObjectConstraints()},matchAgainstEnums:function(){var a=this.schema.enumData();if(a.defined()){for(var b=0;b<a.length();b++)if(a.index(b).equals(this.data))return;throw new n("Data does not match enum: "+
JSON.stringify(a.value())+" ("+JSON.stringify(this.data.value())+")",this.schema);}},matchAgainstNumberConstraints:function(){if(!("number"!=this.data.basicType()&&"integer"!=this.data.basicType())){var a=this.data.value(),b=this.schema.numberInterval();if(void 0!=b&&0!=a%b)throw new n("Number must be divisible by "+b);b=this.schema.minimum();if(void 0!==b)if(this.schema.exclusiveMinimum()){if(a<=b)throw new n("Number must be > "+b);}else if(a<b)throw new n("Number must be >= "+b);b=this.schema.maximum();
if(void 0!=b)if(this.schema.exclusiveMaximum()){if(a>=b)throw new n("Number must be < "+b);}else if(a>b)throw new n("Number must be <= "+b);}},matchAgainstArrayConstraints:function(){if("array"==this.data.basicType()){var a=this.schema.minItems();if(void 0!==a&&a>this.data.length())throw new n("Data is not long enough - minimum length is "+a,this.schema);a=this.schema.maxItems();if(void 0!==a&&a<this.data.length())throw new n("Data is too long - maximum length is "+a,this.schema);}},matchAgainstObjectConstraints:function(){if("object"==
this.data.basicType()){for(var a=this.schema.requiredProperties(),b=0;b<a.length;b++){var c=a[b];if(!this.data.property(c).defined())throw new n("Missing key "+JSON.stringify(c),this.schema);}if(!1==this.schema.allowedAdditionalProperties())for(var a=this.schema.definedProperties(),e=this.data.keys(),b=0;b<e.length;b++)if(-1==a.indexOf(e[b]))throw new n("Not allowed additional property: "+JSON.stringify(c),this.schema);this.matchAgainstDependencies()}},matchAgainstDependencies:function(){for(var a in this.dependencies)if(void 0!=
this.data.property(a))for(var b=this.dependencies[a],c=0;c<b.length;c++){var e=b[c];if("string"==typeof e){if(!this.data.property(e).defined())throw new n("Dependency - property "+JSON.stringify(a)+" requires property "+JSON.stringify(e),this.schema);}else if(!e.match)throw new n("Dependency for "+a,this.schema,e.matchFailReason);}}};n.prototype=Error();n.prototype.toString=function(){return this.message+" in "+this.schema.title()};n.prototype.equals=function(a){if(!(a instanceof n))return!1;if(null==
this.subMatchFailReason){if(null!=a.subMatchFailReason)return!1}else if(null==a.subMatchFailReason||!this.subMatchFailReason.equals(a.subMatchFailReason))return!1;return this.message==a.message&&(null==this.schema&&null==a.schema||null!=this.schema&&null!=a.schema&&this.schema.equals(a.schema))};J.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOption);return this},update:function(){for(var a=null,b="No matches",c=0;c<this.subMatches.length;c++)if(this.subMatches[c].match)if(null==
a)a=this.options[c],b=null;else{b="multiple matches";a=null;break}this.failReason=new n(b);this.selectedOption!=a&&(this.selectedOption=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOption))}};W.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOptions);return this},update:function(){for(var a=[],b=0;b<this.subMatches.length;b++)this.subMatches[b].match&&a.push(this.options[b]);var c=!1;if(a.length!=this.selectedOptions.length)c=
!0;else for(b=0;b<a.length;b++)if(a[b]!=this.selectedOptions[b]){c=!0;break}c&&(this.selectedOptions=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOptions))}};var Y=[];q.registerSchemaChangeListener=function(a){Y.push(a)};var P={},X=!1;Z.prototype={rel:function(a){if(void 0==a)return this;var b=[],c;for(c=0;c<this.length;c++)this[c].rel===a&&(b[b.length]=this[c]);return new Z(b)}};var qa={"null":!0,"boolean":!0,integer:!0,number:!0,string:!0,array:!0,object:!0};w.prototype=
{indexOf:function(a,b){for(var c=this.length-1;0<=c&&!a.equals(this[c],b);)c--;return c},containsUrl:function(a){if(a instanceof RegExp)for(var b=0;b<this.length;b++){var c=this[b];if(a.test(c.referenceUrl()))return!0}else{0>a.indexOf("#")&&(a+="#");for(b=0;b<this.length;b++)if(c=this[b],c=c.referenceUrl(),null!=c&&c.substring(c.length-a.length)==a)return!0}return!1},links:function(){var a=[],b,c;for(b=0;b<this.length;b++)c=this[b],a=a.concat(c.links());return a},each:function(a){for(var b=0;b<this.length;b++)a.call(this,
b,this[b]);return this},concat:function(a){for(var b=[],c=0;c<this.length;c++)b.push(this[c]);for(c=0;c<a.length;c++)b.push(a[c]);return new w(b)},definedProperties:function(a){if(a)return this.definedProperties(),this.definedProperties(a);var b=!0,c={};this.each(function(a,e){if(b){e.allowedAdditionalProperties()||(b=!1,c={});for(var d=e.definedProperties(),f=0;f<d.length;f++)c[d[f]]=!0}else if(!e.allowedAdditionalProperties()){b=!1;for(var g={},d=e.definedProperties(),f=0;f<d.length;f++)c[d[f]]&&
(g[d[f]]=!0);c=g}});var e=Object.keys(c);s(this,{allowedAdditionalProperties:b});this.definedProperties=function(a){a=a||[];for(var b=[],c=0;c<e.length;c++)-1==a.indexOf(e[c])&&b.push(e[c]);return b};return e},knownProperties:function(a){if(a)return this.knownProperties(),this.knownProperties(a);var b;if(this.allowedAdditionalProperties()){b=this.definedProperties().slice(0);a=this.requiredProperties();for(var c=0;c<a.length;c++)-1==b.indexOf(a[c])&&b.push(a[c])}else b=this.definedProperties();this.knownProperties=
function(a){a=a||[];for(var c=[],d=0;d<b.length;d++)-1==a.indexOf(b[d])&&c.push(b[d]);return c};return b.slice(0)},allowedAdditionalProperties:function(){var a=!0;this.each(function(b,c){a=a&&c.allowedAdditionalProperties()});s(this,{additionalProperties:a});return a},minProperties:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minProperties();c>a&&(a=c)}return a},maxProperties:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxProperties();c>a||(a=c)}return a},types:function(){for(var a=
qa,b=0;b<this.length;b++){for(var c=this[b].basicTypes(),e={},h=0;h<c.length;h++){var d=c[h];a[d]&&(e[d]=!0)}a=e}return Object.keys(a)},numberInterval:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].numberInterval();void 0!=c&&(a=void 0==a?c:l.lcm(a,c))}for(b=0;b<this.length;b++){for(var c=this[b].basicTypes(),e=!1,h=0;h<c.length;h++)if("number"==c[h]){e=!1;break}else"integer"==c[h]&&(e=!0);if(e)return void 0==a?1:l.lcm(a,1)}s(this,{numberInterval:a});return a},minimum:function(){for(var a=
void 0,b=!1,c=0;c<this.length;c++){var e=this[c].minimum();if(void 0!=e&&(void 0==a||a<e))a=e,b=this[c].exclusiveMinimum()}s(this,{minimum:a,exclusiveMinimum:b});return a},exclusiveMinimum:function(){this.minimum();return this.exclusiveMinimum()},maximum:function(){for(var a=void 0,b=!1,c=0;c<this.length;c++){var e=this[c].maximum();if(void 0!=e&&(void 0==a||a>e))a=e,b=this[c].exclusiveMaximum()}s(this,{maximum:a,exclusiveMaximum:b});return a},exclusiveMaximum:function(){this.minimum();return this.exclusiveMinimum()},
minLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minLength();c>a&&(a=c)}s(this,{minLength:a});return a},maxLength:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxLength();c>a||(a=c)}s(this,{maxLength:a});return a},minItems:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minItems();c>a&&(a=c)}s(this,{minItems:a});return a},maxItems:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxItems();c>a||(a=c)}s(this,{maxItems:a});return a},
tupleTypingLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].tupleTypingLength();c>a&&(a=c)}return a},requiredProperties:function(){for(var a={},b=[],c=0;c<this.length;c++)for(var e=this[c].requiredProperties(),h=0;h<e.length;h++){var d=e[h];a[d]||(a[d]=!0,b.push(d))}return b},enumValues:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].enumData();if(c.defined())if(void 0==a)a=[],c.indices(function(b,c){a[b]=c});else{var e=[];c.indices(function(b,c){for(var d=0;d<a.length;d++)a[d].equals(c)&&
e.push(c)});a=e}}if(void 0!=a){c=[];for(b=0;b<a.length;b++)c[b]=a[b].value();return c}},allCombinations:function(a){function b(){y--;if(0>=y){for(var b=[new w([])],e=0;e<n.length;e++){for(var h=n[e],d=[],f=0;f<h.length;f++)for(var g=0;g<b.length;g++)d.push(b[g].concat(h[f]));b=d}for(e=0;e<b.length;e++)b[e]=c.concat(b[e]);a(b)}}if(a&&!this.isFull())return this.getFull(function(b){b.allCombinations(a)}),[];for(var c=this,e=this.xorSchemas(),h=0;h<e.length;h++){for(var d=!1,f=0;f<e[h].length;f++){var g=
e[h][f];if(0<=this.indexOf(g,!!a)){d=!0;break}}if(!d){for(var k=[],p=1,f=0;f<e[h].length;f++)g=e[h][f],a?(p++,this.concat([g]).allCombinations(function(b){k=k.concat(b);p--;0>=p&&a(k)})):(d=this.concat([g]).allCombinations(),k=k.concat(d));a&&(p--,0>=p&&a(k));return k}}for(var l=this.orSchemas(),e=null,n=[],y=1,h=0;h<l.length;h++)(function(e){for(var h=[],d=!1,f=0;f<l[e].length;f++){var g=l[e][f];-1==c.indexOf(g,!!a)?h.push(g):d=!0}if(0<h.length){f=[[]];for(g=0;g<h.length;g++){for(var k=[],r=0;r<
f.length;r++)k.push(f[r]),k.push(f[r].concat([h[g]]));f=k}d||f.shift();if(a){n[e]=[];for(h=0;h<f.length;h++)d=new w(f[h]),y++,d.allCombinations(function(a){n[e]=n[e].concat(a);b()})}else n[e]=f}})(h);e=[new w([])];for(h=0;h<n.length;h++){f=n[h];d=[];for(g=0;g<f.length;g++)for(var j=0;j<e.length;j++)d.push(e[j].concat(f[g]));e=d}for(h=0;h<e.length;h++)e[h]=this.concat(e[h]);a&&b();return e},createValue:function(a,b){function c(b){if(void 0!==b){var c=l.guessBasicType(b);if(-1==e.indexOf(c)&&("integer"!=
c||-1==e.indexOf("number")))b=void 0}void 0!==b&&void 0===d&&(d=b);h--;a&&0>=h&&a(d);if(0>=h)return d}if(b){for(var e=this.basicTypes(),h=0,d=void 0,f=0;f<this.length;f++)if(this[f].hasDefault()&&(h++,c(this[f].defaultValue())))return d;var g=this.enumValues();if(void 0!=g){h+=g.length;for(f=0;f<g.length;f++)if(c(g[f]))return d}else{h+=e.length;for(f=0;f<e.length;f++)if(g=e[f],"null"==g){if(c(null))return d}else if("boolean"==g){if(c(!0))return!0}else if("integer"==g||"number"==g){if(g=this.createValueNumber(),
c(g))return d}else if("string"==g){if(g=this.createValueString(),c(g))return d}else if("array"==g)if(a)this.createValueArray(function(a){c(a)});else{if(g=this.createValueArray(),c(g))return d}else if("object"==g)if(a)g=this.createValueObject(function(a){c(a)});else if(g=this.createValueObject(),c(g))return d}return c(d)}if(null!=a)this.allCombinations(function(b){function c(e){e>=b.length&&a(void 0);b[e].createValue(function(b){void 0!==b?a(b):c(e+1)},!0)}c(0)});else for(var g=this.allCombinations(),
f=0;f<g.length;f++){var k=g[f].createValue(null,!0);if(void 0!==k)return k}},createValueNumber:function(){var a=this.exclusiveMinimum(),b=this.minimum(),c=this.maximum(),e=this.exclusiveMaximum(),d=this.numberInterval(),f=void 0;if(void 0!=b&&void 0!=c){if(b>c||b==c&&(a||e))return;if(void 0!=d){if(f=Math.ceil(b/d)*d,a&&f==b&&(f+=d),f>c||f==c&&e)return}else f=0.5*(b+c)}else void 0!=b?(f=b,void 0!=d&&(f=Math.ceil(f/d)*d),a&&f==b&&(void 0!=d?f+=d:f++)):void 0!=c?(f=c,void 0!=d&&(f=Math.floor(f/d)*d),
e&&f==c&&(void 0!=d?f-=d:f--)):f=0;return f},createValueString:function(){return""},createValueArray:function(a){var b=this,c=[],e=this.minItems();if(!e)return a&&a(c),c;for(var d=e,f=0;f<e;f++)(function(e){a?b.createValueForIndex(e,function(b){c[e]=b;d--;0==d&&a(c)}):c[e]=b.createValueForIndex(e)})(f);return c},createValueObject:function(a){var b=this,c={},e=this.requiredProperties();if(0==e.length)return a&&a(c),c;for(var d=e.length,f=0;f<e.length;f++)(function(e){a?b.createValueForProperty(e,function(b){c[e]=
b;d--;0==d&&a(c)}):c[e]=b.createValueForProperty(e)})(e[f]);return c},createValueForIndex:function(a,b){return this.indexSchemas(a).createValue(b)},indexSchemas:function(a){for(var b=new w,c=0;c<this.length;c++)b=b.concat(this[c].indexSchemas(a));return b},createValueForProperty:function(a,b){return this.propertySchemas(a).createValue(b)},propertySchemas:function(a){for(var b=new w,c=0;c<this.length;c++)b=b.concat(this[c].propertySchemas(a));return b},propertyDependencies:function(a){for(var b=[],
c={},e=0;e<this.length;e++)for(var d=this[e].propertyDependencies(a),f=0;f<d.length;f++)"string"==typeof d[f]?c[d[f]]||(c[d[f]]=!0,b.push(d[f])):b.push(d[f]);return b},isFull:function(){for(var a=0;a<this.length;a++){if(!this[a].isFull())return!1;for(var b=this[a].andSchemas(),c=0;c<b.length;c++)if(-1==this.indexOf(b[c],!0))return!1}return!0},getFull:function(a){function b(f){c+=f.length;for(var g=0;g<f.length;g++)f[g].getFull(function(f){for(var g=0;g<e.length;g++)if(f.equals(e[g])){c--;0==c&&(f=
new w(e,d),a.call(f,f));return}e.push(f);f=f.extendSchemas();b(f);c--;0==c&&(f=new w(e,d),a.call(f,f))})}if(0==this.length)return a.call(this,this),this;var c=0,e=[],d=this.fixed();b(this);return this},formats:function(){for(var a=[],b=0;b<this.length;b++){var c=this[b].format();null!=c&&a.push(c)}return a},xorSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].xorSchemas());return a},orSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].orSchemas());return a}};
w.prototype.basicTypes=w.prototype.types;w.prototype.potentialLinks=w.prototype.links;q.extendSchemaList=function(a){for(var b in a)void 0==w.prototype[b]&&(w.prototype[b]=a[b])};q.createSchemaList=function(a){Array.isArray(a)||(a=[a]);return new w(a)};l.getUniqueKey();da.prototype={update:function(a){this.updateLinksWithKey(a);this.updateDependenciesWithKey(a);this.updateMatchesWithKey(a)},updateFromSelfLink:function(){this.cachedLinkList=null;var a=[],b;for(b in this.links)for(var c=this.links[b],
e=0;e<c.length;e++){var d=c[e];"self"==d.rel()&&(d.active=!1)}for(b in this.links){c=this.links[b];for(e=0;e<c.length;e++)d=c[e],"self"==d.rel()&&(d.update(),d.active&&(a.push(d),d.active=!1,this.cachedLinkList=null))}for(var e=0;e<a.length;e++)a[e].active=!0;for(b in this.links){c=this.links[b];for(e=0;e<c.length;e++)d=c[e],"self"!=d.rel()&&d.update()}this.dataObj.properties(function(a,b){b.addLink(null)});this.dataObj.items(function(a,b){b.addLink(null)})},updateLinksWithKey:function(a){var b,c,
e,d,f=[];for(b in this.links){e=this.links[b];for(c=0;c<e.length;c++)d=e[c],(d.usesKey(a)||null==a)&&f.push(d)}if(0<f.length){a=null;for(c=0;c<f.length;c++)if(d=f[c],b=d.active?d.rawLink.rawLink.href:null,d.update(),(d.active?d.rawLink.rawLink.href:null)!=b&&"self"==d.rel()){a=d;break}null!=a&&this.updateFromSelfLink(a);this.invalidateSchemaState()}},updateMatchesWithKey:function(a){var b=[];for(schemaKey in this.matches)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++){var e=this.matches[b[c]];
if(void 0!=e)for(var d=0;d<e.length;d++)e[d].dataUpdated(a)}},updateDependenciesWithKey:function(a){var b=[];for(schemaKey in this.dependencySelectors)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++)for(var e=this.dependencySelectors[b[c]],d=0;d<e.length;d++)e[d].dataUpdated(a)},alreadyContainsSchema:function(a,b){for(var c=0;c<b.length;c++){var e=b[c];if(void 0!=this.schemas[e])for(var d=0;d<this.schemas[e].length;d++)if(a.equals(this.schemas[e][d]))return!0}return!1},addSchema:function(a,
b,c,e){var d=this;void 0==b&&(b=l.getUniqueKey());void 0==e&&(e=!0);void 0==c?c=[b]:c[c.length]=b;void 0==this.schemas[b]&&(this.schemas[b]=[]);this.schemaFlux++;"string"==typeof a&&(a=q.createSchema({$ref:a}));a.getFull(function(a){if(d.alreadyContainsSchema(a,c))d.schemaFlux--,d.checkForSchemasStable();else{H.increment();d.schemas[b].push(a);d.schemasFixed[b]=d.schemasFixed[b]||e;d.dataObj.properties(function(e,d){for(var f=l.getKeyVariant(b,"prop"),h=a.propertySchemas(e),g=0;g<h.length;g++)d.addSchema(h[g],
f,c)});d.dataObj.indices(function(e,d){l.getKeyVariant(b,"idx");var f=a.indexSchemas(e);for(e=0;e<f.length;e++)d.addSchema(f[e],b,c)});for(var f=a.extendSchemas(),g=0;g<f.length;g++)d.addSchema(f[g],b,c,e);d.addLinks(a.links(),b,c);d.addXorSelectors(a,b,c);d.addOrSelectors(a,b,c);d.addDependencySelector(a,b,c);d.schemaFlux--;d.invalidateSchemaState();H.decrement()}})},addLinks:function(a,b,c){var e,d;void 0==this.links[b]&&(this.links[b]=[]);var f=null;for(e=0;e<a.length;e++)d=new ea(this.dataObj,
a[e]),this.links[b].push(d),this.addMonitorForLink(d,b,c),d.update(),d.active&&"self"==d.rawLink.rawLink.rel&&(f=d);null!=f&&this.updateFromSelfLink(f);this.invalidateSchemaState()},addXorSelectors:function(a,b,c){a=a.xorSchemas();for(var e=[],d=0;d<a.length;d++){var f=new na(a[d],l.getKeyVariant(b,"xor"+d),c,this);e.push(f)}this.xorSelectors[b]=void 0==this.xorSelectors[b]?e:this.xorSelectors[b].concat(e)},addOrSelectors:function(a,b,c){a=a.orSchemas();for(var e=[],d=0;d<a.length;d++){var f=new oa(a[d],
l.getKeyVariant(b,"or"+d),c,this);e.push(f)}this.orSelectors[b]=void 0==this.orSelectors[b]?e:this.orSelectors[b].concat(e)},addDependencySelector:function(a,b,c){a=[new fa(a,l.getKeyVariant(b,"dep"),c,this)];this.dependencySelectors[b]=void 0==this.dependencySelectors[b]?a:this.dependencySelectors[b].concat(a)},addLink:function(a){if(null==a)this.updateFromSelfLink(),this.invalidateSchemaState();else{var b=l.getUniqueKey();a=q.create(a);a=new g(a);this.addLinks([a],b)}},addMonitorForLink:function(a,
b,c){var e=this;if("describedby"===a.rel()){var d=l.getKeyVariant(b);a.addMonitor(d,function(b){e.removeSchema(d);b&&(b=q.createSchema({$ref:a.rawLink.href}),e.addSchema(b,d,c,!1))})}},addSchemaMatchMonitor:function(a,b,c,e,d){b=new k(a,this.dataObj,b,d);void 0==this.matches[a]&&(this.matches[a]=[]);this.matches[a].push(b);b.addMonitor(c,e);return b},removeSchema:function(a){H.increment();this.dataObj.indices(function(b,c){c.removeSchema(a)});this.dataObj.properties(function(b,c){c.removeSchema(a)});
var b,c,d=[];for(b in this.schemas)l.keyIsVariant(b,a)&&d.push(b);for(b in this.links)l.keyIsVariant(b,a)&&d.push(b);for(b in this.matches)l.keyIsVariant(b,a)&&d.push(b);for(c=0;c<d.length;c++)b=d[c],delete this.schemas[b],delete this.links[b],delete this.matches[b],delete this.xorSelectors[b],delete this.orSelectors[b],delete this.dependencySelectors[b];0<d.length&&this.invalidateSchemaState();H.decrement()},clear:function(){this.schemas={};this.links={};this.matches={};this.invalidateSchemaState()},
getSchemas:function(){if(null!==this.cachedSchemaList)return this.cachedSchemaList;var a=[],b={},c,d,f,g,k,p;for(f in this.schemas){g=this.schemas[f];var n=this.schemasFixed[f];for(c=0;c<g.length;c++){k=g[c];n&&(b[k.data.uniqueId]=k);p=!1;for(d=0;d<a.length;d++)if(k.equals(a[d])){p=!0;break}p||a.push(k)}}c=[];for(f in b)c.push(b[f]);return this.cachedSchemaList=new w(a,c)},getLinks:function(a){var b,c,d,f;if(null!==this.cachedLinkList)return this.cachedLinkList.rel(a);var g=[];for(b in this.links){f=
this.links[b];for(c=0;c<f.length;c++)d=f[c],d.active&&g.push(d.rawLink)}this.cachedLinkList=new Z(g);return this.cachedLinkList.rel(a)},invalidateSchemaState:function(){this.cachedLinkList=this.cachedSchemaList=null;this.schemasStable=!1;this.checkForSchemasStable()},checkForSchemasStable:function(){if(0<this.schemaFlux)return!1;var a,b,c,d;for(b in this.schemas){c=this.schemas[b];for(a=0;a<c.length;a++)if(d=c[a],!d.isComplete())return this.schemasStable=!1}this.schemasStable||(this.schemasStable=
!0,a=this.dataObj,P[a.uniqueId]=a,X||(X=!0,H.add(ma)));this.schemasStableListeners.notify(this.dataObj,this.getSchemas());return!0},addSchemasForProperty:function(a,b){for(var c in this.schemas)for(var d=l.getKeyVariant(c,"prop"),f=0;f<this.schemas[c].length;f++)for(var g=this.schemas[c][f].propertySchemas(a),k=0;k<g.length;k++)b.addSchema(g[k],d)},addSchemasForIndex:function(a,b){for(var c in this.schemas)for(var d=l.getKeyVariant(c,"idx"),f=0;f<this.schemas[c].length;f++)for(var g=this.schemas[c][f].indexSchemas(a),
k=0;k<g.length;k++)b.addSchema(g[k],d)},removeSubSchemas:function(a){for(var b in this.schemas)a.removeSchema(b)},whenSchemasStable:function(a){this.schemasStableListeners.add(a);this.checkForSchemasStable()}};ea.prototype={update:function(){var a=this.potentialLink.canApplyTo(this.dataObj);this.rawLink=a?this.potentialLink.linkForData(this.dataObj):null;this.active=a;this.updateMonitors.notify(this.active)},rel:function(){return this.potentialLink.rel()},usesKey:function(a){return this.potentialLink.usesKey(a)},
addMonitor:function(a,b){this.updateMonitors.add(a,b)}};fa.prototype={dataUpdated:function(a){if(null==a)for(var b=this.schema.data.property("dependencies").keys(),c=0;c<b.length;c++)a=b[c],this.dataUpdated(a);else if(this.schemaSet.dataObj.property(a).defined()){b=this.schema.propertyDependencies(a);for(c=0;c<b.length;c++){var d=b[c];"string"!=typeof d&&this.schemaSet.addSchema(d,this.inferredSchemaKeys[a],this.schemaKeyHistory,!1)}}else this.schemaSet.removeSchema(this.inferredSchemaKeys[a])}};
q.config={antiCacheUrls:!1};q.UriTemplate=G})(this);
(function(z){function u(d){return"object"==typeof d?JSON.parse(JSON.stringify(d)):d}function A(d){var f=this;this.elementLookup={};void 0==d&&(d=I+"."+E++ +".");var g=0;this.getElementId=function(){return d+g++};this.enhancementContexts={};this.enhancementActions={};this.enhancementInputs={};Jsonary.registerChangeListener(function(d,g){d.each(function(d,p){for(var j=g.affectedData(p),m=0;m<j.length;m++)f.update(j[m],p)})});Jsonary.registerSchemaChangeListener(function(d){for(var g={},k=0;k<d.length;k++){var n=
d[k],j=n.uniqueId,m=f.elementLookup[j];if(void 0==m||0==m.length)return;g[j]=m.slice(0)}for(var s=0;s<d.length;s++){n=d[s];j=n.uniqueId;m=g[j];for(k=0;k<m.length;k++)if(j=document.getElementById(m[k]),void 0!=j){var t=j.jsonaryContext,w=u(this.uiStartingState),v=F(n,w,t.usedComponents);v.uniqueId==t.renderer.uniqueId?v.render(j,n,t):t.baseContext.render(j,n,t.label,w)}}});this.rootContext=this;this.subContexts={};this.oldSubContexts={}}function B(d,f,g,p){d=j.render(d,f,null,g,p);j.oldSubContexts=
{};j.subContexts={};return d}function G(d){this.renderFunction=d.render||d.enhance;this.renderHtmlFunction=d.renderHtml;this.updateFunction=d.update;this.filterFunction=d.filter;this.actionFunction=d.action;for(var f in d)void 0==this[f]&&(this[f]=d[f]);this.uniqueId=t++;this.component=void 0!=d.component?d.component:C[C.length-1];"string"==typeof this.component&&(this.component=[this.component]);d.saveState&&(this.saveState=d.saveState);d.loadState&&(this.loadState=d.loadState)}function s(d,f,g,
p){p=!!p||void 0==p;for(var j=0;j<L.length&&!1!==(0,L[j])(d,f,g,p);j++);}function F(d,f,g){for(var p=d.schemas(),j=0;j<C.length;j++)if(-1==g.indexOf(C[j]))for(var k=C[j],n=v.length-1;0<=n;n--){var m=v[n];if(-1!=m.component.indexOf(k)&&m.canRender(d,p,f))return m}}var I="Jsonary",E=0,m={ADD_REMOVE:"ADD_REMOVE",TYPE_SELECTOR:"TYPE_SELECTOR",RENDERER:"DATA_RENDERER",add:function(d,f){void 0==this[d]&&(this[d]=d,-1!=C.indexOf(f)?C.splice(C.indexOf(f),0,this[d]):C.splice(C.length-1,0,this[d]))}},C=[m.ADD_REMOVE,
m.TYPE_SELECTOR,m.RENDERER];A.prototype={usedComponents:[],rootContext:null,baseContext:null,subContext:function(d,f){void 0==f&&(f={});return this.getSubContext(this.elementId,this.data,d,f)},subContextSavedStates:{},saveState:function(){var d={},f;for(f in this.subContexts)d[f]=this.subContexts[f].saveState();for(f in this.oldSubContexts)d[f]=this.oldSubContexts[f].saveState();return(this.renderer?this.renderer.saveState:G.prototype.saveState).call(this.renderer,this.uiState,d,this.data)},loadState:function(d){d=
(this.renderer?this.renderer.loadState:G.prototype.loadState).call(this.renderer,d);this.uiState=d[0];this.subContextSavedStates=d[1]},getSubContext:function(d,f,g,p){if("object"==typeof g&&null!=g)throw Error("Label cannot be an object");var j=g||""===g?g:f.uniqueId;void 0!=this.oldSubContexts[j]&&(this.subContexts[j]=this.oldSubContexts[j]);void 0!=this.subContexts[j]&&this.subContexts[j].data!=f&&(delete this.subContexts[j],delete this.oldSubContexts[j],delete this.subContextSavedStates[j]);this.subContextSavedStates[j]&&
(p=this.subContextSavedStates[j]);if(void 0==this.subContexts[j]){var k=[];this.data==f&&(k=this.usedComponents.slice(0),void 0!=this.renderer&&(k=k.concat(this.renderer.component)));"object"==typeof d&&(d=d.id);var n=function(d,f,g,k,p,j){this.rootContext=d;this.baseContext=f;this.label=g;this.data=k;this.uiStartingState=u(p||{});this.usedComponents=j;this.subContexts={};this.oldSubContexts={}};n.prototype=this.rootContext;this.subContexts[j]=new n(this.rootContext,this,g,f,p,k)}f=this.subContexts[j];
f.elementId=d;return f},clearOldSubContexts:function(){this.oldSubContexts=this.subContexts;this.subContexts={}},rerender:function(){var d=document.getElementById(this.elementId);null!=d&&(this.renderer.render(d,this.data,this),this.clearOldSubContexts())},render:function(d,f,g,p,j){void 0==p&&"object"==typeof g&&(p=g,g=null);"string"==typeof f&&(f=Jsonary.getData(f));if(void 0!=f.getData){var k=this;f.getData(function(f){k.render(d,f,g,p,j)})}else{"object"!=typeof p&&(p={});if(void 0==d.id||""==
d.id)d.id=this.getElementId();var n=d.jsonaryContext,m=this.getSubContext(d.id,f,g,p);d.jsonaryContext=m;if(n){var n=n.data.uniqueId,s=this.elementLookup[n].indexOf(d.id);0<=s&&this.elementLookup[n].splice(s,1)}n=f.uniqueId;void 0==this.elementLookup[n]&&(this.elementLookup[n]=[]);-1==this.elementLookup[n].indexOf(d.id)&&this.elementLookup[n].push(d.id);n=F(f,p,m.usedComponents);void 0!=n?(m.renderer=n,void 0==m.uiState&&m.loadState(m.uiStartingState),n.render(d,f,m),m.clearOldSubContexts()):d.innerHTML=
"NO RENDERER FOUND";j&&j(m)}},renderHtml:function(d,f,g){void 0==g&&"object"==typeof f&&(g=f,f=null);var p=this.getElementId();"string"==typeof d&&(d=Jsonary.getData(d));if(void 0!=d.getData){var j=this,k=!1;d.getData(function(n){if(k){var m=document.getElementById(p);m.className="";m?j.render(m,n,f,g):Jsonary.log(Jsonary.logLevel.WARNING,"Attempted delayed render to non-existent element: "+p)}else k=!0,d=n});if(!k)return k=!0,'<span id="'+p+'" class="loading">Loading...</span>'}!0===g&&(g=this.uiStartingState);
"object"!=typeof g&&(g={});var n=this.getSubContext(p,d,f,g),m=F(d,g,n.usedComponents);n.renderer=m;void 0==n.uiState&&n.loadState(n.uiStartingState);m=m.renderHtml(d,n);n.clearOldSubContexts();var s=d.uniqueId;void 0==this.elementLookup[s]&&(this.elementLookup[s]=[]);-1==this.elementLookup[s].indexOf(p)&&this.elementLookup[s].push(p);this.addEnhancement(p,n);return'<span id="'+p+'">'+m+"</span>"},update:function(d,f){var g=this.elementLookup[d.uniqueId];if(!(void 0==g||0==g.length))for(var g=g.slice(0),
j=0;j<g.length;j++){var m=document.getElementById(g[j]);if(void 0!=m){var k=m.jsonaryContext,n=u(this.uiStartingState),s=F(d,n,k.usedComponents);s.uniqueId==k.renderer.uniqueId?s.update(m,d,k,f):k.baseContext.render(m,d,k.label,n)}}},actionHtml:function(d,f){var g=2,j=!1,m="javascript:void(0)";"boolean"==typeof f&&(j=arguments[1],m=arguments[2]||m,f=arguments[3],g+=2);for(var k=[];g<arguments.length;g++)k.push(arguments[g]);g=this.getElementId();this.addEnhancementAction(g,f,this,k,j);return'<a href="'+
Jsonary.escapeHtml(m)+'" id="'+g+'" style="text-decoration: none">'+d+"</a>"},inputNameForAction:function(d){var f=!1,g=1;"boolean"==typeof d&&(f=d,d=arguments[1],g++);for(var j=[];g<arguments.length;g++)j.push(arguments[g]);g=this.getElementId();this.enhancementInputs[g]={inputName:g,actionName:d,context:this,params:j,historyChange:f};return g},addEnhancement:function(d,f){this.enhancementContexts[d]=f},addEnhancementAction:function(d,f,g,j,m){null==j&&(j=[]);this.enhancementActions[d]={actionName:f,
context:g,params:j,historyChange:m}},enhanceElement:function(d){for(var f=d;d;)if(1==d.nodeType&&this.enhanceElementSingle(d),d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!=f;)d=d.parentNode;if(d==f)break;d=d.nextSibling}},enhanceElementSingle:function(d){var f=d.id,g=this.enhancementContexts[f];void 0!=g&&(d.jsonaryContext=g,delete this.enhancementContexts[f],f=g.renderer,void 0!=f&&f.enhance(d,g.data,g));var j=this.enhancementActions[d.id];void 0!=j&&(delete this.enhancementActions[d.id],
d.onclick=function(){var d=j.context,f=[d,j.actionName].concat(j.params);d.renderer.action.apply(d.renderer,f)&&d.rerender();s(d.data,d,j.actionName,j.historyChange);return!1});var m=this.enhancementInputs[d.name];void 0!=m&&(delete this.enhancementInputs[d.name],d.onchange=function(){var d=this.value;"checkbox"==this.getAttribute("type")&&(d=this.checked);if("select"==this.tagName.toLowerCase()&&null!=this.getAttribute("multiple"))for(var d=[],f=0;f<this.options.length;f++){var g=this.options[f];
g.selected&&d.push(g.value)}f=m.context;d=[f,m.actionName,d].concat(m.params);f.renderer.action.apply(f.renderer,d)&&f.rerender();s(f.data,f,m.actionName,m.historyChange)});d=null}};var j=new A;setInterval(function(){var d=[],f;for(f in j.elementLookup){for(var g=j.elementLookup[f],p=!1,m=0;m<g.length;m++)if(document.getElementById(g[m])){p=!0;break}p||d.push(f)}for(m=0;m<d.length;m++)delete j.elementLookup[d[m]]},3E4);B.empty=void 0!=z.jQuery?function(d){z.jQuery(d).empty()}:function(d){d.innerHTML=
""};B.Components=m;var t=0;G.prototype={render:function(d,f,g){if(null==d)return Jsonary.log(Jsonary.logLevel.WARNING,"Attempted to render to non-existent element.\n\tData path: "+f.pointerPath()+"\n\tDocument: "+f.document.url),this;void 0!=d[0]&&(d=d[0]);B.empty(d);d.innerHTML=this.renderHtml(f,g);null!=this.renderFunction&&this.renderFunction(d,f,g);g.enhanceElement(d);return this},renderHtml:function(d,f){var g="";void 0!=this.renderHtmlFunction&&(g=this.renderHtmlFunction(d,f));return g},enhance:function(d,
f,g){null!=this.renderFunction&&this.renderFunction(d,f,g);return this},update:function(d,f,g,j){(void 0!=this.updateFunction?this.updateFunction(d,f,g,j):this.defaultUpdate(d,f,g,j))&&this.render(d,f,g);return this},action:function(d,f){return this.actionFunction.apply(this,arguments)},canRender:function(d,f,g){return void 0!=this.filterFunction?this.filterFunction(d,f,g):!0},defaultUpdate:function(d,f,g,j){d=!1;g="replace"!=j.action();f=f.pointerPath();if(j.subjectEquals(f)||g&&!1!==j.subjectChild(f))d=
!0;else if(void 0!=j.target()&&(j.targetEquals(f)||g&&!1!==j.targetChild(f)))d=!0;return d},saveState:function(d,f){var g={};for(key in d)g[key]=d[key];for(var j in f)for(var m in f[j])g[j+"-"+m]=f[j][m];for(key in g)Jsonary.isData(g[key])&&(g[key]=this.saveStateData(g[key]));return g},saveStateData:function(d){if(d){if(d.document.isDefinitive)return"url:"+d.referenceUrl();var f;if(!(f=d.saveStateId)){f=10;for(var g="";g.length<f;)g+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*
Math.random()));f=g}d.saveStateId=f;localStorage[d.saveStateId]=JSON.stringify({accessed:(new Date).getTime(),data:d.deflate()});return d.saveStateId}},loadState:function(d){var f={},g={},j;for(j in d)if(-1!=j.indexOf("-")){var m=j.split("-"),k=m.shift(),m=m.join("-");g[k]||(g[k]={});g[k][m]=d[j]}else f[j]=this.loadStateData(d[j])||d[j],Jsonary.isRequest(f[j])&&function(d){f[d].getData(function(g){f[d]=g})}(j);return[f,g]},loadStateData:function(d){if("string"==typeof d&&"url:"==d.substring(0,4)){d=
d.substring(4);var f=null;d=Jsonary.getData(d,function(d){f=d});return f||d}if(d){var g=localStorage[d];if(g)return g=JSON.parse(g),f=Jsonary.inflate(g.data),f.saveStateId=d,f}}};G.prototype.super_=G.prototype;var D={},v=[];B.register=function(d){d=new G(d);D[d.uniqueId]=d;v.push(d);return d};B.deregister=function(d){"object"==typeof d&&(d=d.uniqueId);delete D[d];for(var f=0;f<v.length;f++)v[f].uniqueId==d&&(v.splice(f,1),f--)};var L=[];B.addActionHandler=function(d){L.push(d)};"undefined"!=typeof z.jQuery&&
(m=function(d,f){var g=this[0];void 0!=g&&B(g,d,f);return this},Jsonary.extendData({$renderTo:function(d,f){"string"==typeof d&&(d=jQuery(d));var g=d[0];void 0!=g&&B(g,this,f)}}),m.register=function(d){if(void 0!=d.render){var f=d.render;d.render=function(d,g){var j=$(d);f.call(this,j,g)}}if(void 0!=d.update){var g=d.update;d.update=function(d,f,j){d=$(d);g.call(this,d,f,j)}}B.register(d)},m.empty=function(d){d.each(function(d,g){B.empty(g)})},jQuery.fn.extend({renderJson:m}),jQuery.extend({renderJson:m}));
Jsonary.extend({render:B,renderHtml:function(d,f,g){d=j.renderHtml(d,null,f,g);j.oldSubContexts={};j.subContexts={};return d}});Jsonary.extendData({renderTo:function(d,f){"string"==typeof d&&(d=document.getElementById(d));B(d,this,f)}})})(this);