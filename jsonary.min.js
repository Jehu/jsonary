"undefined"==typeof localStorage&&(window.localStorage={});Array.isArray||(Array.isArray=function(C){return"[object Array]"===Object.prototype.toString.apply(C)});Array.prototype.indexOf||(Array.prototype.indexOf=function(C,y){for(var B=y||0;B<this.length;B++)if(this[B]===C)return B;return-1});Object.keys||(Object.keys=function(C){var y=[],B;for(B in C)C.hasOwnProperty(B)&&y.push(B);return y});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
"object"!==typeof JSON&&(JSON={});
(function(){function C(h){return 10>h?"0"+h:h}function y(h){w.lastIndex=0;return w.test(h)?'"'+h.replace(w,function(h){var r=F[h];return"string"===typeof r?r:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function B(J,z){var r,l,A,w,v=h,D,d=z[J];d&&("object"===typeof d&&"function"===typeof d.toJSON)&&(d=d.toJSON(J));"function"===typeof E&&(d=E.call(z,J,d));switch(typeof d){case "string":return y(d);case "number":return isFinite(d)?String(d):"null";case "boolean":case "null":return String(d);
case "object":if(!d)return"null";h+=G;D=[];if("[object Array]"===Object.prototype.toString.apply(d)){w=d.length;for(r=0;r<w;r+=1)D[r]=B(r,d)||"null";A=0===D.length?"[]":h?"[\n"+h+D.join(",\n"+h)+"\n"+v+"]":"["+D.join(",")+"]";h=v;return A}if(E&&"object"===typeof E)for(w=E.length,r=0;r<w;r+=1)"string"===typeof E[r]&&(l=E[r],(A=B(l,d))&&D.push(y(l)+(h?": ":":")+A));else for(l in d)Object.prototype.hasOwnProperty.call(d,l)&&(A=B(l,d))&&D.push(y(l)+(h?": ":":")+A);A=0===D.length?"{}":h?"{\n"+h+D.join(",\n"+
h)+"\n"+v+"}":"{"+D.join(",")+"}";h=v;return A}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(h){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+C(this.getUTCMonth()+1)+"-"+C(this.getUTCDate())+"T"+C(this.getUTCHours())+":"+C(this.getUTCMinutes())+":"+C(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(h){return this.valueOf()});var K=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
w=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,G,F={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},E;"function"!==typeof JSON.stringify&&(JSON.stringify=function(y,z,r){var l;G=h="";if("number"===typeof r)for(l=0;l<r;l+=1)G+=" ";else"string"===typeof r&&(G=r);if((E=z)&&"function"!==typeof z&&("object"!==typeof z||"number"!==typeof z.length))throw Error("JSON.stringify");return B("",{"":y})});
"function"!==typeof JSON.parse&&(JSON.parse=function(h,y){function r(h,l){var v,w,d=h[l];if(d&&"object"===typeof d)for(v in d)Object.prototype.hasOwnProperty.call(d,v)&&(w=r(d,v),void 0!==w?d[v]=w:delete d[v]);return y.call(h,l,d)}var l;h=String(h);K.lastIndex=0;K.test(h)&&(h=h.replace(K,function(h){return"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return l=eval("("+h+")"),"function"===typeof y?r({"":l},""):l;throw new SyntaxError("JSON.parse");})})();
(function(C){function y(a){var b=a.match(/^[a-zA-Z\-]+:/);null!=b&&0<b.length?(this.scheme=b[0].substring(0,b[0].length-1),a=a.substring(b[0].length)):this.scheme=null;"//"==a.substring(0,2)?(this.doubleSlash=!0,a=a.substring(2)):this.doubleSlash=!1;b=a.indexOf("#");if(0<=b){var c;c=a.substring(b+1);-1!=c.indexOf("?")?(c.isQuery=!1,c=void 0):c=B(c);this.fragment=c;a=a.substring(0,b)}else this.hash=null;b=a.indexOf("?");0<=b?(c=a.substring(b+1),this.query=B(c),a=a.substring(0,b)):this.query=null;b=
a.indexOf("@");if(0<=b){c=a.substring(0,b);var f=c.indexOf(":");-1==f?(this.username=c,this.password=null):(this.username=c.substring(0,f),this.password=c.substring(f+1));a=a.substring(b+1)}else this.password=this.username=null;b=0;if(null!=this.scheme||this.doubleSlash)b=a.indexOf("/");0<=b?(this.path=a.substring(b),""==this.path&&(this.path=null),a=a.substring(0,b)):this.path=null;f=a.indexOf(":");0<=f?(this.port=a.substring(f+1),a=a.substring(0,f)):this.port=null;this.domain=""==a?null:a}function B(a){a=
a.split("&");for(var b=[],c=0;c<a.length;c++){var f=a[c],k=f.indexOf("=");if(-1==k)b.push({key:f});else{var u=f.substring(0,k),f=f.substring(k+1);b.push({key:u,value:decodeURIComponent(f)})}}for(u in ba)b[u]=ba[u];b.isQuery=!0;return b}function K(a){var b="";ja[a.charAt(0)]&&(b=a.charAt(0),a=a.substring(1));var c=",",f="",k=!0,u=!1;"+"==b?k=!1:"."==b?c=f=".":"/"==b?c=f="/":"#"==b?(f="#",k=!1):";"==b?(c=f=";",u=!0):"?"==b?(f="?",c="&",u=!0):"&"==b&&(c=f="&",u=!0);b=[];a=a.split(",");for(var d=[],e=
0;e<a.length;e++){var g=a[e],s=null;-1!=g.indexOf(":")&&(s=g.split(":"),g=s[0],s=parseInt(s[1]));for(var n={};ka[g.charAt(g.length-1)];)n[g.charAt(g.length-1)]=!0,g=g.substring(0,g.length-1);d.push({truncate:s,name:g,suffices:n});b.push(g)}a=function(a){for(var b=f,e=0;e<d.length;e++){var g=d[e];0<e&&(b+=c);var H=a(g.name);if(Array.isArray(H)){u&&(b+=g.name+"=");for(var L=0;L<H.length;L++)0<L&&(b+=g.suffices["*"]?c:",",g.suffices["*"]&&u&&(b+=g.name+"=")),b+=k?encodeURIComponent(H[L]).replace("!",
"%21"):encodeURI(H[L]).replace("%25","%")}else if("object"==typeof H){u&&!g.suffices["*"]&&(b+=g.name+"=");var L=!0,s;for(s in H)L||(b+=g.suffices["*"]?c:","),L=!1,b+=k?encodeURIComponent(s).replace("!","%21"):encodeURI(s).replace("%25","%"),b+=g.suffices["*"]?"=":",",b+=k?encodeURIComponent(H[s]).replace("!","%21"):encodeURI(H[s]).replace("%25","%")}else u&&(b+=g.name+"="),null!=g.truncate&&(H=H.substring(0,g.truncate)),b+=k?encodeURIComponent(H).replace("!","%21"):encodeURI(H).replace("%25","%")}return b};
a.varNames=b;return a}function w(a){a=a.split("{");for(var b=[a.shift()],c=[],f=[];0<a.length;){var k=a.shift(),u=k.split("}")[0],k=k.substring(u.length+1),u=K(u);c.push(u);b.push(k);f=f.concat(u.varNames)}this.fill=function(a){for(var f=b[0],k=0;k<c.length;k++)f+=(0,c[k])(a),f+=b[k+1];return f};this.varNames=f}function h(a,b){for(var c in b)(function(b,c){a[b]=function(){return c}})(c,b[c])}function G(a){this.contents={};this.keyOrder=[];this.context=a}function F(a){this.listeners=[];this.context=
a}function E(a,b){var c=this;this.baseUrl=a.url;this.fragment=b;null==b&&(b="");this.url=this.baseUrl+"#"+encodeURI(b);this.getRoot=function(b){a.getRoot(function(a){b.call(a,a,c)})};this.getData=function(f){null==b||""==b?a.document.getRoot(function(a){f.call(a,a,c)}):a.document.getFragment(b,function(a){f.call(a,a,c)})};this.getRawResponse=function(b){a.getResponse(function(a){b.call(a,a,c)})}}function J(a){this.httpCode=a;this.message="HTTP Status: "+a}function z(a,b,c,f,k){a=m.resolveRelativeUri(a);
c=m.encodeData(c,f);"GET"==b&&""!=c&&(a=-1==a.indexOf("?")?a+"?":a+"&",a+=c,c="");m.log(m.logLevel.STANDARD,"Sending request for: "+a);this.successful=void 0;this.error=null;this.url=a;var u=void 0==c||""==c;this.responseListeners=new F(this);this.document=new M(a,u,!0);this.fetched=!1;this.fetchData(a,b,c,f,k);this.invalidate=function(){"GET"==b&&this.fetchData(a,b,c,f,k)}}function r(a,b,c,f,k){f(k,this);var u=this;this.url=a;this.responseListeners=new F(this);this.document=new M(a,!0,!0);this.document.setRaw(b);
this.profileUrl=c;void 0!=c&&this.document.raw.addSchema(c);a==c?this.document.setRoot(""):this.document.raw.whenSchemasStable(function(){var a=u.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),u.document.setRoot(a)):u.document.setRoot("")});this.successful=!0;this.error=null;this.fetched=!1;this.invalidate=function(){this.fetchData(a,"GET",void 0,"application/x-www-form-urlencoded",c)}}function l(a){this.operations=[];void 0==a&&(a="");this.prefix=a}function A(a,
b,c){this._patchType=a;this._subject=b;this._subjectValue=void 0;"move"==a?this._target=c:this._value=c}function M(a,b,c){function f(a){I.increment();var b=ca.concat(d);I.add(function(){for(var c=0;c<b.length;c++)b[c].call(k,a,k)});I.decrement()}var k=this;this.readOnly=!!c;this.isDefinitive=!!b;this.url=a;this.error=null;var u={};this.raw=new v(this,u);this.root=null;var d=[];this.registerChangeListener=function(a){d.push(a)};this.setRaw=function(a){var b=this.raw.defined();u.setValue(a);b&&(u.setValue(a),
b=new l,b.replace(this.raw.pointerPath(),a),f(b))};var e=new F(this);this.getRoot=function(a){null==this.root?e.add(a):a.call(this,this.root)};this.setRoot=function(a){this.root=this.raw.subPath(a);e.notify(this.root)};this.patch=function(a){if(this.readOnly)throw Error("Cannot update read-only document");if(R)void 0==this.batchPatch&&(this.batchPatch=new l,S.push(this)),this.batchPatch.operations=this.batchPatch.operations.concat(a.operations);else{I.increment();var b=a.filter("?"),c=a.filterRemainder("?");
this.raw.patch(b);this.root.patch(c);f(a);I.decrement()}};this.affectedData=function(a){for(var b=a.subject(),c=null,c="?"==b||"?/"==b.substring(0,2)?this.raw.subPath(b.substring(1)):this.root.subPath(b),b=[];void 0!=c;)b.push(c),c=c.parent();if("move"==a.action())for(a=a.target(),c=null,c="?"==a||"?/"==a.substring(0,2)?this.raw.subPath(a.substring(1)):this.root.subPath(a),b.push();void 0!=c;)b.push(c),c=c.parent();return b}}function v(a,b,c,f){this.uniqueId=la++;this.document=a;this.readOnly=function(b){return b||
void 0===b?a.readOnly||this.schemas().readOnly()||void 0!=c&&c.readOnly(!0):a.readOnly};var k=void 0,u=void 0,d=0,e=[],g={},s={};this.property=function(a){void 0==g[a]&&(s[a]={},g[a]=new v(this.document,s[a],this,a),"object"==u&&(s[a].setValue(k[a]),void 0!==k[a]&&b.schemas.addSchemasForProperty(a,g[a])));return g[a]};var n={},p={};this.item=function(a){if(!N.test(a))throw Error("Index must be a positive integer (or integer-value string)");void 0==n[a]&&(p[a]={},n[a]=new v(this.document,p[a],this,
a),"array"==u&&(p[a].setValue(k[a]),void 0!==k[a]&&b.schemas.addSchemasForIndex(a,n[a])));return n[a]};this.parent=function(){return c};this.parentKey=function(){return f};this.pointerPath=function(){return this.document.root==this?"":void 0!=c?c.pointerPath()+"/"+m.encodePointerComponent(f):"?"};this.basicType=function(){return u};this.value=function(){if("object"==u){for(var a={},b=0;b<e.length;b++){var c=e[b];a[c]=void 0!=g[c]?g[c].value():k[c]}return a}if("array"==u){a=[];for(b=0;b<d;b++)a[b]=
void 0!=n[b]?n[b].value():k[b];return a}return k};this.keys=function(){return e.slice(0)};this.length=function(){return d};this.patch=function(a){var c=this,f=this.pointerPath(),q={};a.each(function(a,m){if(m.subjectEquals(f))if("replace"==m.action()||"add"==m.action())m.setSubjectValue(c.value()),b.setValue(m.value());else{if("remove"!=m.action()&&"move"!=m.action())throw Error("Unrecognised patch operation: "+m.action());}else if(m.targetEquals(f))"move"==m.action()&&b.setValue(m.subjectValue());
else{var h=m.subjectChild(f);if(h)if(q[h]=!0,"object"==u)if("add"==m.action()){var t=e.indexOf(h);if(-1!=t)throw Error("Cannot add existing key: "+h);e.push(h);k[h]=m.value();void 0!=g[h]&&(s[h].setValue(m.value()),b.schemas.addSchemasForProperty(h,g[h]))}else if("remove"==m.action()||"move"==m.action()){t=e.indexOf(h);if(-1==t)throw Error("Cannot delete missing key: "+h);m.setSubjectValue(c.propertyValue(h));e.splice(t,1);void 0!=s[h]&&s[h].setValue(void 0);delete k[h]}else{if("replace"!=m.action())throw Error("Unrecognised patch operation: "+
m.action());}else if("array"==u){if(!N.test(h))throw Error("Cannot patch non-numeric index: "+h);t=parseInt(h);if("add"==m.action()){if(t>d)throw Error("Cannot add past the end of the list");for(h=d-1;h>=t;h--)void 0!=p[h+1]&&(void 0==n[h]?p[h+1].setValue(k[h]):p[h+1].setValue(n[h].value()));k.splice(t,0,m.value());d++;void 0!=n[k.length-1]&&b.schemas.addSchemasForIndex(k.length-1,n[k.length-1])}else if("remove"==m.action()||"move"==m.action()){if(t>=d)throw Error("Cannot remove a non-existent index");
m.setSubjectValue(c.itemValue(t));for(h=t;h<d-1;h++)void 0!=p[h]&&(void 0==n[h+1]?p[h].setValue(k[h+1]):p[h].setValue(n[h+1].value()));void 0!=p[d-1]&&p[d-1].setValue(void 0);d--;k.splice(t,1)}else if("replace"!=m.action())throw Error("Unrecognised patch operation: "+m.action());}if(h=m.targetChild(f))if(q[h]=!0,"object"==u){if("move"==m.action()){t=e.indexOf(h);if(-1!=t)throw Error("Cannot move to existing key: "+h);e.push(h);k[h]=m.subjectValue();void 0!=g[h]&&b.schemas.addSchemasForProperty(h,
g[h])}}else if("array"==u){if(!N.test(h))throw Error("Cannot patch non-numeric index: "+h);t=parseInt(h);if("move"==m.action()){if(t>d)throw Error("Cannot add past the end of the list");for(h=d-1;h>=t;h--)void 0!=p[h+1]&&(void 0==n[h]?p[h+1].setValue(k[h]):p[h+1].setValue(n[h].value()));k.splice(t,0,m.subjectValue());d++;void 0!=n[k.length-1]&&b.schemas.addSchemasForIndex(k.length-1,n[k.length-1])}}}});if("object"==u)for(var h=0;h<e.length;h++){var l=e[h],t=a.filter("/"+m.encodePointerComponent(l));
t.isEmpty()||this.property(l).patch(t)}else if("array"==u)for(h=0;h<d;h++)t=a.filter("/"+m.encodePointerComponent(h)),t.isEmpty()||this.index(h).patch(t);for(l in q)b.schemas.update(l)};b.setValue=function(a){var c=m.guessBasicType(a,u),f=k;k=a;if(c!=u){if("object"==u)for(var h in g)s[h].setValue(void 0);else if("array"==u)for(var t in n)p[t].setValue(void 0);u=c}if("object"==c){for(h in g)a.hasOwnProperty(h)?(g[h].defined()||b.schemas.addSchemasForProperty(h,g[h]),s[h].setValue(a[h])):s[h].setValue(void 0);
e=Object.keys(a);d=0}else if("array"==c){for(t in n)t<a.length?(n[t].defined()||b.schemas.addSchemasForIndex(t,n[t]),p[t].setValue(a[t])):p[t].setValue(void 0);e=[];d=a.length}else e=[],d=0;void 0===a?void 0!==f&&b.schemas.clear():b.schemas.update(null)};b.schemas=new da(this);this.schemas=function(){return b.schemas.getSchemas()};this.whenSchemasStable=function(a){b.schemas.whenSchemasStable(a);return this};this.links=function(a){return b.schemas.getLinks(a)};this.addLink=function(a){b.schemas.addLink(a);
return this};this.addSchema=function(a,c){var f=this;a instanceof x?a.each(function(a,b){f.addSchema(b,c)}):b.schemas.addSchema(a,c);return this};this.removeSchema=function(a){b.schemas.removeSchema(a);return this};this.addSchemaMatchMonitor=function(a,c,f,k,d){return b.schemas.addSchemaMatchMonitor(a,c,f,k,d)}}function D(a,b){return q.getData(a,function(a,f){var k=a.asSchema();void 0!=b&&b.call(k,k,f)})}function d(a){void 0==T[a]&&(T[a]=q.createSchema({type:a}));return T[a]}function e(a){this.data=
a;a.referenceUrl();a.propertyValue("id");var b=[];a=a.property("links");void 0!==a&&a.indices(function(a,f){b[b.length]=new g(f)});this.links=function(){return b.slice(0)};this.schemaTitle=this.title()}function g(a){this.data=a;var b=w,c;c=a.propertyValue("href");if("{@}"==c)c="{+%73elf}";else{for(var f=[],k=!1,d=!1,e=0;e<c.length;e++){var g=c.charAt(e);k?d?")"==g?")"==c.charAt(e+1)?(f.push(U[")"]),e++):d=!1:void 0!=U[g]?f.push(U[g]):f.push(encodeURIComponent(g)):"$"==g?f.push("%73elf"):"("==g?")"==
c.charAt(e+1)?(f.push("%65mpty"),e++):d=!0:("}"==g&&(k=!1),f.push(g)):("{"==g&&(k=!0),f.push(g))}c=f.join("")}this.uriTemplate=new b(c);this.dataParts=[];for(b=0;b<this.uriTemplate.varNames.length;b++)this.dataParts.push(s(this.uriTemplate.varNames[b]));b=a.property("schema");b.defined()?(b=b.asSchema(),this.submissionSchemas=new x([b])):this.submissionSchemas=new x;a=a.property("targetSchema");a.defined()&&(this.targetSchema=a.asSchema());this.handlers=[];this.preHandlers=[]}function s(a){return"%65mpty"==
a?"":"%73elf"==a?null:decodeURIComponent(a)}function p(a,b,c){this.rawLink=a;this.definition=b;this.subjectData=c;this.href=a.href;b=this.href.indexOf("#");0<=b?(this.hrefBase=this.href.substring(0,b),this.hrefFragment=this.href.substring(b+1)):(this.hrefBase=this.href,this.hrefFragment="");this.rel=a.rel;this.title=a.title;this.method=void 0!=a.method?a.method:"edit"==a.rel?"PUT":"create"==a.rel?"POST":"delete"==a.rel?"DELETE":"GET";void 0!=a.enctype&&(a.encType=a.enctype,delete a.enctype);this.encType=
void 0==a.encType?"GET"==this.method?"application/x-www-form-urlencoded":"POST"==this.method||"PUT"==this.method?"application/json":"application/x-www-form-urlencoded":a.encType;null!=this.definition&&(this.submissionSchemas=this.definition.submissionSchemas,this.targetSchema=this.definition.targetSchema)}function t(a,b,c,f){var k=this;this.monitorKey=a;this.match=!1;this.matchFailReason=new n("initial failure",null);this.monitors=new G(c);this.impatientCallbacks=f;this.propertyMatches={};this.indexMatches=
{};this.dependencies={};this.dependencyKeys={};this.schemaLoaded=!1;this.data=b;c.getFull(function(a){k.schemaLoaded=!0;k.schema=a;k.basicTypes=a.basicTypes();k.setupXorSelectors();k.setupOrSelectors();k.setupAndMatches();k.setupNotMatches();k.dataUpdated()})}function n(a,b,c){this.message=a;this.schema=b;this.subMatchFailReason=c}function V(a,b,c){var f=this;this.options=b;this.selectedOption=this.matchCallback=null;this.data=c;this.subMatches=[];this.subSchemaKeys=[];for(var k=0;k<b.length;k++)this.subSchemaKeys[k]=
m.getKeyVariant(a,"option"+k),this.subMatches[k]=c.addSchemaMatchMonitor(this.subSchemaKeys[k],b[k],function(){f.update()},!1,!0);this.update()}function W(a,b,c){var f=this;this.options=b;this.matchCallback=null;this.selectedOptions=[];this.data=c;this.subMatches=[];this.subSchemaKeys=[];for(var k=0;k<b.length;k++)this.subSchemaKeys[k]=m.getKeyVariant(a,"option"+k),this.subMatches[k]=c.addSchemaMatchMonitor(this.subSchemaKeys[k],b[k],function(){f.update()},!1,!0);this.update()}function ma(){X=!1;
var a=[],b;for(b in O){var c=O[b];a.push({data:c,pointerPath:c.pointerPath()})}O={};a.sort(function(a,b){return a.pointerPath.length-b.pointerPath.length});b=[];for(c=0;c<a.length;c++)b[c]=a[c].data;for(c=0;c<Y.length;c++)Y[c].call(null,b)}function Z(a){for(var b=0;b<a.length;b++)this[b]=a[b];this.length=a.length}function x(a,b){if(void 0==a)this.length=0;else{void 0==b&&(b=a);this.fixed=function(){var c=b.length<a.length?new x(b):this;this.fixed=function(){return c};return c};var c;for(c=0;c<a.length;c++)this[c]=
a[c];this.length=a.length}}function da(a){this.dataObj=a;this.schemas={};this.schemasFixed={};this.links={};this.matches={};this.xorSelectors={};this.orSelectors={};this.dependencySelectors={};this.schemaFlux=0;this.schemasStable=!0;this.schemasStableListeners=new F(a);this.pendingNotify=!1;this.cachedLinkList=this.cachedSchemaList=null}function ea(a,b){this.dataObj=a;this.potentialLink=b;this.active=!1;this.rawLink=null;this.updateMonitors=new G(a)}function na(a,b,c,f){var k=m.getKeyVariant(b,"$");
this.xorSelector=new V(b,a,f.dataObj);this.xorSelector.onMatchChange(function(b){f.removeSchema(k);null!=b?f.addSchema(b,k,c,!1):0<a.length&&f.addSchema(a[0],k,c,!1)})}function oa(a,b,c,f){for(var k=[],d=[],e=0;e<a.length;e++)k[e]=m.getKeyVariant(b,"$"+e),d[e]=!1;this.orSelector=new W(b,a,f.dataObj);this.orSelector.onMatchChange(function(b){for(var e=0;e<a.length;e++){for(var g=!1,Q=0;Q<b.length;Q++)if(a[e]==b[Q]){g=!0;break}g&&!d[e]?f.addSchema(a[e],k[e],c,!1):!g&&d[e]&&f.removeSchema(k[e]);d[e]=
g}0==b.length&&0<a.length&&f.addSchema(a[0],k[0],c,!1)})}function fa(a,b,c,f){this.inferredSchemaKeys={};this.applied={};this.schema=a;this.schemaKeyHistory=c;this.schemaSet=f;a=this.schema.data.property("dependencies").keys();for(c=0;c<a.length;c++)f=a[c],this.inferredSchemaKeys[f]=m.getKeyVariant(b,"$"+c),this.dataUpdated(f)}var q={toString:function(){return"[JsonApi]"}};C.Jsonary=q;y.prototype={toString:function(){var a="";null!=this.scheme&&(a+=this.scheme+":");this.doubleSlash&&(a+="//");null!=
this.username&&(a+=this.username,null!=this.password&&(a+=":"+this.password),a+="@");null!=this.domain&&(a+=this.domain);null!=this.port&&(a+=":"+this.port);null!=this.path&&(a+=this.path);null!=this.query&&(a+="?"+this.query);null!=this.fragment&&(a+="#"+this.fragment);return a}};y.resolve=function(a,b){if(void 0==b)return a;if(void 0==a)return b;a instanceof y||(a=new y(a));var c=new y(b+"");if(null==c.scheme&&(c.scheme=a.scheme,c.doubleSlash=a.doubleSlash,null==c.domain))if(c.domain=a.domain,c.port=
a.port,c.username=a.username,c.password=a.password,null==c.path)c.path=a.path,null==c.query&&(c.query=a.query);else if("/"!=c.path.charAt(0)&&null!=a.path){var f="/"==a.path.charAt(0),k;k=f?a.path.substring(1).split("/"):a.path.split("/");".."==k[k.length-1]&&k.push("");k.pop();for(var d=k.length-1;0<=d;d--)"."==k[d]&&k.slice(d,1);for(var e=c.path.split("/"),d=0;d<e.length;d++){var g=e[d];if("."!=g)if(".."==g)if(0<k.length&&".."!=k[k.length-1])k.pop();else{if(!f){k=k.concat(e.slice(d));break}}else k.push(g)}c.path=
(f?"/":"")+k.join("/")}return c.toString()};y.parse=function(a){return new y(a)};var ba={toString:function(){for(var a=[],b=0;b<this.length;b++)"undefined"==typeof this[b].value?a.push(this[b].key):a.push(this[b].key+"="+encodeURIComponent(this[b].value));return a.join("&")},get:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a)return this[c].value;return b},set:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a){this[c].value=b;return}this.push({key:a,value:b})}};q.Uri=y;var ja=
{"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},ka={"*":!0},m={guessBasicType:function(a,b){if(null===a)return"null";if(Array.isArray(a))return"array";if("object"==typeof a)return"object";if("string"==typeof a)return"string";if("number"==typeof a)return 0==a%1?"integer":"number";if("boolean"==typeof a)return"boolean"},resolveRelativeUri:function(a,b){return y.resolve(a,b)},urlsEqual:function(a,b){"#"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));"#"==b.charAt(b.length-1)&&(b=b.substring(0,
b.length-1));return a==b},linksEqual:function(a,b){if(void 0==a||void 0==b)return a==b;if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++){var f=a[c],k=b[c];if(f.href!=k.href||f.rel!=k.rel||(f.method!=k.method||f["enc-type"]!=k["enc-type"])||f.schema!=k.schema)return!1}return!0},log:function(a,b){try{a>=m.logLevel.ERROR&&(window.alert("ERROR: "+b),console.log("ERROR: "+b),console.trace()),a>=m.logLevel.WARNING&&console.log("WARNING: "+b)}catch(c){}},logLevel:{DEBUG:-1,STANDARD:0,WARNING:1,
ERROR:2},getKeyVariant:function(a,b){void 0==b&&(b=m.getUniqueKey());b+="";if(0<=b.indexOf("."))throw Error("variant name cannot contain a dot: "+b);return a+"."+b},keyIsVariant:function(a,b){a+="";b+="";return a===b||a.substring(0,b.length+1)===b+"."},keyIsRoot:function(a){return-1==a.indexOf(".")},hcf:function(a,b){a=Math.abs(a);for(b=Math.abs(b);;){var c=a%b;if(0==c)return b;if(isNaN(c))return NaN;a=b;b=c}},recursiveCompare:function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!=b.length)return!1;
for(var c=0;c<a.length;c++)if(!m.recursiveCompare(a[c],b[c]))return!1;return!0}if("object"==typeof a){for(c in a)if(void 0===b[c]&&void 0!==a[c])return!1;for(c in b)if(void 0===a[c]&&void 0!==a[c])return!1;for(c in a)if(!m.recursiveCompare(a[c],b[c]))return!1;return!0}return a===b},lcm:function(a,b){return Math.abs(a*b/this.hcf(a,b))},encodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.stringify(a);if("application/x-www-form-urlencoded"==
b)return m.formEncode(a);throw Error("Unknown encoding type: "+this.encType);},decodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.parse(a);if("application/x-www-form-urlencoded"==b)return m.formDecode(a);throw Error("Unknown encoding type: "+this.encType);},formEncode:function(a,b){void 0==b&&(b="");var c=[];if(Array.isArray(a))for(var f=0;f<a.length;f++){var k=""==b?f:b+encodeURIComponent("[]"),d=""==b?f:b+encodeURIComponent("["+f+"]"),
e=a[f];null==e?c.push(k+"=null"):"object"==typeof e?c.push(m.formEncode(e,d)):"boolean"==typeof e?e?c.push(k+"=true"):c.push(k+"=false"):c.push(k+"="+encodeURIComponent(e))}else if("object"==typeof a)for(k in a)a.hasOwnProperty(k)&&(e=a[k],""!=b&&(k=b+encodeURIComponent("["+k+"]")),"null"==e?c.push(k+"=null"):"object"==typeof e?c.push(m.formEncode(e,k)):"boolean"==typeof e?e?c.push(k+"=true"):c.push(k+"=false"):c.push(k+"="+encodeURIComponent(e)));else c.push(encodeURIComponent(a));return c.join("&")},
formDecode:function(a){var b={};a=a.split("&");for(var c=0;c<a.length;c++){var f=a[c],k=f,d="";0<=f.indexOf("=")&&(k=f.substring(0,f.indexOf("=")),d=decodeURIComponent(f.substring(f.indexOf("=")+1)),"true"==d?d=!0:"false"==d?d=!1:"null"==d?d=null:parseFloat(d)+""==d&&(d=parseFloat(d)));for(var k=decodeURIComponent(k),f=b,k=k.split("["),e=1;e<k.length;e++)k[e]=k[e].substring(0,k[e].length-1);for(e=0;e<k.length;e++)Array.isArray(f)&&""==k[e]&&(k[e]=f.length),e==k.length-1?f[k[e]]=d:(void 0==f[k[e]]&&
(f[k[e]]=""==k[e+1]?[]:{}),f=f[k[e]])}return b},escapeHtml:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},encodePointerComponent:function(a){return a.toString().replace("~","~0").replace("/","~1")},decodePointerComponent:function(a){return a.toString().replace("~1","/").replace("~0","~")},splitPointer:function(a){a=a.split("/");""==a[0]&&a.shift();for(var b=0;b<a.length;b++)a[b]=m.decodePointerComponent(a[b]);
return a},joinPointer:function(a){a="";for(var b=0;b<parts.length;b++)a+="/"+m.encodePointerComponent(parts[b]);return a}};(function(){var a=0;m.getUniqueKey=function(){return a++}})();q.getMonitorKey=m.getUniqueKey;q.getKeyVariant=function(a,b){return m.getKeyVariant(a,"~"+b)};q.keyIsVariant=m.keyIsVariant;q.log=function(a,b){if("number"!=typeof a)throw alert("First argument to log() must be a number (preferably enum value from .logLevel)"),Error("First argument to log() must be a number (preferably enum value from .logLevel)");
m.log(a,b)};q.setLogFunction=function(a){m.log=a};q.logLevel=m.logLevel;q.encodeData=m.encodeData;q.decodeData=m.decodeData;q.encodePointerComponent=m.encodePointerComponent;q.decodePointerComponent=m.decodePointerComponent;q.splitPointer=m.splitPointer;q.joinPointer=m.joinPointer;q.escapeHtml=m.escapeHtml;q.extend=function(a){for(var b in a)void 0==q[b]&&(q[b]=a[b])};G.prototype={add:function(a,b){if("string"!=typeof a&&"number"!=typeof a)throw Error("First argument must be a monitorKey, obtained using getMonitorKey()");
this.contents[a]=b;this.addKey(a)},addKey:function(a){var b;for(b=0;b<this.keyOrder.length;b++){var c=this.keyOrder[b];if(c==a)return;if(m.keyIsVariant(a,c)){this.keyOrder.splice(b,0,a);return}}this.keyOrder.push(a)},remove:function(a){delete this.contents[a];this.removeKey(a);a+=".";for(var b in this.contents)b.substring(0,a.length)==a&&(this.removeKey(b),delete this.contents[b])},removeKey:function(a){a=this.keyOrder.indexOf(a);0<=a&&this.keyOrder.splice(a,1)},notify:function(){for(var a=arguments,
b=0;b<this.keyOrder.length;b++)this.contents[this.keyOrder[b]].apply(this.context,a)},isEmpty:function(){for(var a in this.contents)if(0!==this.contents[a].length)return!1;return!0}};F.prototype={add:function(a){this.listeners[this.listeners.length]=a},notify:function(){for(var a=arguments;0<this.listeners.length;)this.listeners.shift().apply(this.context,a)},isEmpty:function(){return 0===this.listeners.length}};var I={depth:0,callbacks:[],increment:function(){this.depth++},decrement:function(){this.depth--;
if(0>this.depth)throw Error("DelayedCallbacks.depth cannot be < 0");for(;0==this.depth&&0<this.callbacks.length;){var a=this.callbacks.shift();this.depth++;a();this.depth--}},add:function(a){this.depth++;this.callbacks.push(a);this.decrement()}};"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}throw Error("This browser does not support XMLHttpRequest.");
});(function(){var a={};setInterval(function(){b.empty()},1E4);var b=function(b,f){if(void 0!==f)a[b]=f,(new Date).getTime();else return a[b]};b.cacheSeconds=10;b.empty=function(a){};b.invalidate=function(b){"string"==typeof b&&(b=m.resolveRelativeUri(b));for(var f in a){var k=a[f],d=k.url;"string"==typeof b?-1!=d.indexOf(b)&&k.invalidate():b.test(d)&&k.invalidate()}};q.defaultCache=b;q.invalidate=b.invalidate})();E.prototype={};q.addToCache=function(a,b,c,f){a=m.resolveRelativeUri(a);void 0==f&&
(f=q.defaultCache);var k=JSON.stringify(a)+":"+JSON.stringify({});new r(a,b,c,f,k)};q.getData=function(a,b,c){"string"==typeof a&&(a={url:a});var f;a:{var k=a.url,d=a.method,e=a.data,g=a.encType;a=null;if(void 0==k)throw Error("URL cannot be undefined");k=m.resolveRelativeUri(k);void 0==d&&(d="GET");void 0===e&&(e={});var h=null,s=k.indexOf("#");0<=s&&(h=decodeURI(k.substring(s+1)),k=k.substring(0,s));void 0==g&&(g="GET"==d?"application/x-www-form-urlencoded":"POST"==d||"PUT"==d?"application/json":
"application/x-www-form-urlencoded");void 0==a&&(a=q.defaultCache);if(s=a&&"GET"==d&&"application/x-www-form-urlencoded"==g){f=JSON.stringify(k)+":"+JSON.stringify(e);var n=a(f);if(void 0!=n){f=new E(n,h);break a}}c=new z(k,d,e,g,c);s&&a(f,c);f=new E(c,h)}void 0!=b&&f.getData(b);return f};q.isRequest=function(a){return a instanceof z||a instanceof E};var aa=m.getUniqueKey();J.prototype=Error();q.HttpError=J;z.prototype={beingUsed:function(){return void 0==this.baseContext?(m.log(m.logLevel.DEBUG,
"No base context: "+this.url),!0):0<this.baseContext.retainCount()},getResponse:function(a){this.responseListeners.add(a);this.checkForFullResponse()},checkForFullResponse:function(){this.document.raw.defined()&&this.responseListeners.notify(this.document.raw,this)},ajaxSuccess:function(a,b,c){this.fetched=!0;var f=this;f.successful=!0;m.log(m.logLevel.STANDARD,"Request success: "+this.url);var k=b.replace(/\r\n/g,"\n").split("\n"),d={},e=null,g={};for(b=0;b<k.length;b++){var h=k[b].split(": ")[0];
""!=h&&(e=k[b].substring(h.length+2),"\r"==e[e.length-1]&&(e=e.substring(0,e.length-1)),h=h.toLowerCase(),void 0==d[h]?d[h]=e:"object"==typeof d[h]?d[h].push(e):d[h]=[d[h],e])}m.log(m.logLevel.DEBUG,"headers: "+JSON.stringify(d,null,4));e=d["content-type"].split(";")[0];k=d["content-type"].substring(e.length+1).split(",");for(b=0;b<k.length;b++){var h=k[b].split("=")[0],s=k[b].substring(h.length+1),h=h.trim();""!=h&&(g[h]=s)}f.headers=d;f.contentType=e;f.contentTypeParameters=g;f.document.setRaw(a);
f.profileUrl=null;f.document.raw.removeSchema(aa);void 0!=g.profile?(b=g.profile,b=m.resolveRelativeUri(f.url,b),f.profileUrl=b,f.document.raw.addSchema(b,aa)):void 0!=c&&f.document.raw.addSchema(c,aa);void 0!=g.root&&(a={href:g.root,rel:"root"},f.document.raw.addLink(a));if(d.link)for(d="object"==typeof d.link?d.link:[d.link],b=0;b<d.length;b++){a=d[b];a=a.trim().split(";");c=a.shift().trim();c=c.substring(1,c.length-1);c={href:c};for(g=0;g<a.length;g++)e=a[g],k=e.substring(0,e.indexOf("=")),e=e.substring(k.length+
1),k=k.trim(),'"'==e.charAt(0)&&(e=JSON.parse(e)),"type"==k&&(k="mediaType"),c[k]=e;f.document.raw.addLink(c)}f.checkForFullResponse();f.document.raw.whenSchemasStable(function(){var a=f.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),f.document.setRoot(a)):f.document.setRoot("")})},ajaxError:function(a,b){this.fetched=!0;var c=this;c.successful=!1;c.error=a;m.log(m.logLevel.WARNING,"Error fetching: "+this.url+" ("+a.message+")");c.document.error=a;c.document.setRaw(b);
c.document.raw.whenSchemasStable(function(){c.checkForFullResponse();c.document.setRoot("")})},fetchData:function(a,b,c,f,k){var d=this,e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState)if(200<=e.status&&300>e.status){var a=e.responseText||null;try{a=JSON.parse(a)}catch(b){if(204!=e.status){d.ajaxError(b,a);return}a=null}var c=e.getAllResponseHeaders();if(""==c){for(var c=[],f="Cache-Control Content-Language Content-Type Expires Last-Modified Pragma".split(" "),g=0;g<f.length;g++){var h=
e.getResponseHeader(f[g]);""!=h&&null!=h&&c.push(f[g]+": "+h)}c=c.join("\n")}d.ajaxSuccess(a,c,k)}else{a=e.responseText||null;try{a=JSON.parse(a)}catch(s){}d.ajaxError(new J(e.status,e),a)}};"GET"!=b&&"DELETE"!=b||(void 0==c||""==c)||(a=-1==a.indexOf("?")?a+"?":a+"&",a+=c,c=void 0);if(q.config.antiCacheUrls){var g="_="+Math.random();a=-1==a.indexOf("?")?a+("?"+g):a+("&"+g)}e.open(b,a,!0);e.setRequestHeader("Content-Type",f);e.setRequestHeader("If-Modified-Since","Thu, 01 Jan 1970 00:00:00 GMT");e.send(c)}};
r.prototype=z.prototype;l.prototype={isEmpty:function(){return 0==this.operations.length},each:function(a){for(var b=0;b<this.operations.length;b++)a.call(this,b,this.operations[b]);return this},plain:function(){for(var a=[],b=0;b<this.operations.length;b++)a[b]=this.operations[b].plain();return a},condense:function(){},filterImmediate:function(){for(var a=new l(this.prefix),b=0;b<this.operations.length;b++){var c=this.operations[b];c.immediateChild(this.prefix)&&a.operations.push(c)}return a},filter:function(a){a=
this.prefix+a;for(var b=new l(a),c=0;c<this.operations.length;c++){var f=this.operations[c];f.hasPrefix(a)&&b.operations.push(f)}return b},filterRemainder:function(a){a=this.prefix+a;for(var b=new l(this.prefix),c=0;c<this.operations.length;c++){var f=this.operations[c];f.hasPrefix(a)||b.operations.push(f)}return b},replace:function(a,b){var c=new A("replace",a,b);this.operations.push(c);return this},add:function(a,b){var c=new A("add",a,b);this.operations.push(c);return this},remove:function(a){a=
new A("remove",a);this.operations.push(a);return this},move:function(a,b){var c=new A("move",a,b);this.operations.push(c);return this},inverse:function(){for(var a=new l(this.prefix),b=0;b<this.operations.length;b++)a.operations[b]=this.operations[b].inverse();a.operations.reverse();return a}};A.prototype={action:function(){return this._patchType},value:function(){return this._value},subject:function(){return this._subject},setSubjectValue:function(a){this._subjectValue=a;return this},subjectValue:function(){return this._subjectValue},
inverse:function(){switch(this._patchType){case "replace":return new A("replace",this._subject,this._subjectValue);case "add":return(new A("remove",this._subject)).setSubjectValue(this._value);case "remove":return new A("add",this._subject,this._subjectValue);case "move":return new A("move",this._target,this._subject);default:throw Error("Unrecognised patch type for inverse: "+this._patchType);}},depthFrom:function(a){"object"==typeof a&&(a=a.pointerPath());var b=NaN;if(this._subject.substring(0,
a.length)==a){var c=this._subject.substring(a.length);0==c.length?b=0:"/"==c.charAt(0)&&(b=c.split("/").length)}if(void 0!=this._target&&this._target.substring(0,a.length)==a){var f,c=this._target.substring(a.length);0==c.length?f=0:"/"==c.charAt(0)&&(f=c.split("/").length);!isNaN(f)&&f<b&&(b=f)}return b},subjectEquals:function(a){return this._subject==a},subjectChild:function(a){a+="/";return this._subject.substring(0,a.length)==a&&(a=this._subject.substring(a.length),-1==a.indexOf("/"))?decodeURIComponent(a):
!1},subjectRelative:function(a){a+="/";return this._subject.substring(0,a.length)==a?this._subject.substring(a.length-1):!1},target:function(){return this._target},targetEquals:function(a){return this._target==a},targetChild:function(a){if(void 0!=this._target)return a+="/",this._target.substring(0,a.length)==a&&(a=this._target.substring(a.length),-1==a.indexOf("/"))?decodeURIComponent(a):!1},targetRelative:function(a){a+="/";return this._target.substring(0,a.length)==a?this._target.substring(a.length-
1):!1},plain:function(){var a={};a[this._patchType]=this._subject;"remove"!=this._patchType&&("move"==this._patchType?a.to=this._target:a.value=this._value);return a},matches:function(a){return this._subject==a||"move"==this._patchType&&this._target==a?!0:!1},hasPrefix:function(a){"object"==typeof a&&(a=a.pointerPath());if(this.matches(a))return!0;a+="/";return this._subject.substring(0,a.length)==a||"move"==this._patchType&&this._target.substring(0,a.length)==a?!0:!1}};var ca=[];q.registerChangeListener=
function(a){ca.push(a)};var R=!1,S=[];q.batch=function(a){if(void 0!=a)return q.batch(),a(),q.batchDone(),this;R=!0;return this};q.batchDone=function(){for(R=!1;0<S.length;){var a=S.shift(),b=a.batchPatch;delete a.batchPatch;a.patch(b)}return this};M.prototype={resolveUrl:function(a){return y.resolve(this.url,a)},getFragment:function(a,b){this.getRoot(function(c){""!=a&&(c=c.subPath(a));b.call(this,c)})},get:function(a){return this.root.get(a)},set:function(a,b){this.root.set(a,b);return this},move:function(a,
b){var c=new l;c.move(a,b);this.patch(c);return this}};var N=/^(0|[1-9]\d*)$/,la=0;v.prototype={referenceUrl:function(){if(this.document.isDefinitive){var a=this.pointerPath();if(""==a||"/"==a.charAt(0))return this.document.url+"#"+encodeURI(this.pointerPath())}},subPath:function(a){a=a.split("/");if(""!=a[0])throw Error("Path must begin with / (or be empty)");for(var b=this,c=1;c<a.length;c++)a[c]=m.decodePointerComponent(a[c]),b="array"==b.basicType()?b.index(a[c]):b.property(a[c]);return b},defined:function(){return void 0!=
this.basicType()},setValue:function(a){if("undefined"==typeof a)return this.remove();if("object"!=this.basicType()&&"array"!=this.basicType()&&this.value()===a)return this;var b=new l;this.defined()?b.replace(this.pointerPath(),a):b.add(this.pointerPath(),a);this.document.patch(b,this);return this},remove:function(){var a=new l;a.remove(this.pointerPath());this.document.patch(a,this);return this},itemValue:function(a){return this.index(a).value()},removeItem:function(a){this.index(a).remove();return this},
insertItem:function(a,b){if("array"!=this.basicType())throw Error("cannot insert into a non-array");var c=new l;c.add(this.item(a).pointerPath(),b);this.document.patch(c,this);return this},push:function(a){if("array"==this.basicType())this.index(this.length()).setValue(a);else throw Error("Can only push() on an array");return this},propertyValue:function(a){return this.property(a).value()},removeProperty:function(a){this.property(a).remove();return this},moveTo:function(a){if("object"==typeof a){if(a.document!=
this.document){var b=this.value();this.remove();a.setValue(b);return a}a=a.pointerPath()}var b=new l,c=this.pointerPath();if(a!=c)return b.move(c,a),this.document.patch(b,this),this.document.root.subPath(a)},getLink:function(a){return this.links(a)[0]},equals:function(a){var b;b=this.basicType();if(b!=a.basicType())return!1;if("array"==b){if(this.length()!==a.length())return!1;for(b=0;b<this.length();b++)if(!this.index(b).equals(a.index(b)))return!1;return!0}if("object"==b){var c=this.keys(),f=a.keys();
if(c.length!=f.length)return!1;c.sort();f.sort();for(b=0;b<c.length;b++)if(c[b]!==f[b])return!1;for(b=0;b<c.length;b++)if(f=c[b],!this.property(f).equals(a.property(f)))return!1;return!0}return this.value()===a.value()},readOnlyCopy:function(){if(this.readOnly(!1))return this;var a=q.create(this.value(),this.document.url+"#:copy",!0);this.schemas().each(function(b,c){a.addSchema(c)});return a},editableCopy:function(){var a=q.create(this.value(),this.document.url+"#:copy",!1),b=m.getUniqueKey();this.schemas().fixed().each(function(c,
f){a.addSchema(f,b)});return a},asSchema:function(){var a=new e(this.readOnlyCopy());this.readOnly(!1)&&h(this,{asSchema:a});return a},asLink:function(a){var b=this.readOnlyCopy(),b=new g(b);a=void 0==a?b.linkForData(this):b.linkForData(a);this.readOnly(!1)&&h(this,{asLink:a});return a},items:function(a){for(var b=0;b<this.length();b++){var c=this.index(b);a.call(c,b,c)}return this},properties:function(a,b,c){"function"==typeof a&&(b=a,a=this.keys());if(b)for(var f=0;f<a.length;f++){var k=this.property(a[f]);
b.call(k,a[f],k)}if(c)for("function"!=typeof c&&(c=b),b=this.keys(),f=0;f<b.length;f++)-1==a.indexOf(b[f])&&(k=this.property(b[f]),c.call(k,b[f],k));return this},resolveUrl:function(a){for(var b=this;b;){var c=b.getLink("self");if(c)return y.resolve(c.href,a);b=b.parent()}return this.document.resolveUrl(a)},get:function(a){return this.subPath(a).value()},set:function(a,b){this.subPath(a).setValue(b);return this},json:function(){return JSON.stringify(this.value())}};v.prototype.indices=v.prototype.items;
v.prototype.indexValue=v.prototype.itemValue;v.prototype.removeIndex=v.prototype.removeItem;v.prototype.index=function(a){return this.item(a)};q.extendData=function(a){for(var b in a)void 0==v.prototype[b]&&(v.prototype[b]=a[b])};q.create=function(a,b,c){a="object"==typeof a?JSON.parse(JSON.stringify(a)):a;var f=void 0!=b&&c;void 0!=b&&-1!=b.indexOf("#")&&(""!=b.substring(b.indexOf("#")+1)&&(f=!1),b=b.substring(0,b.indexOf("#")));b=new M(b,f,c);b.setRaw(a);b.setRoot("");return b.root};q.isData=function(a){return a instanceof
v};v.prototype.deflate=function(){var a=[];this.schemas().each(function(b,c){void 0!=c.referenceUrl()?a.push(c.referenceUrl()):a.push(c.data.deflate())});return{baseUrl:this.document.url,readOnly:this.document.readOnly,value:this.value(),schemas:a}};q.inflate=function(a){for(var b=q.create(a.value,a.baseUrl,a.readOnly),c=0;c<a.schemas.length;c++){var f=a.schemas[c];"object"==typeof f&&(f=q.inflate(f).asSchema());b.addSchema(f)}return b};q.createSchema=function(a,b){return q.create(a,b,!0).asSchema()};
q.isSchema=function(a){return a instanceof e};q.getSchema=D;var P="null boolean integer number string array object".split(" "),T={};e.prototype={toString:function(){return"<Schema "+this.data+">"},referenceUrl:function(){return this.data.referenceUrl()},isFull:function(){return void 0===this.data.propertyValue("$ref")},getFull:function(a){var b=this.data.propertyValue("$ref");if(void 0===b)return a&&a.call(this,this,void 0),this;b=this.data.resolveUrl(b);if("#"!=b.charAt(0)||1!=b.length&&"/"!=b.charAt(1))a&&
D(b,a);else{var c=this.data.document.root,b=decodeURIComponent(b.substring(1)),c=c.subPath(b).asSchema();if(a)a.call(c,c,null);else return c}return this},title:function(){var a=this.data.propertyValue("title");void 0==a&&(a=null);return a},hasDefault:function(){return this.data.property("default").defined()},defaultValue:function(){return this.data.propertyValue("default")},propertySchemas:function(a){var b=[],c=this.data.property("properties").property(a);c.defined()&&b.push(c.asSchema());this.data.property("patternProperties").properties(function(c,
k){RegExp(c).test(a)&&b.push(k.asSchema())});0==b.length&&(c=this.data.property("additionalProperties"),c.defined()&&b.push(c.asSchema()));return new x(b)},propertyDependencies:function(a){var b=this.data.property("dependencies");return b.defined()&&(a=b.property(a),a.defined())?"string"==a.basicType()?[a.value()]:"array"==a.basicType()?a.value():[a.asSchema()]:[]},indexSchemas:function(a){var b=this.data.property("items");if(!b.defined())return new x;"array"==b.basicType()?(a=b.index(a),a.defined()||
(a=this.data.property("additionalItems"))):a=b;return a.defined()?(a=a.asSchema(),new x([a])):new x},andSchemas:function(){var a=[],b=this.data.property("extends");b.defined()&&("array"==b.basicType()?b.indices(function(b,f){a.push(f.asSchema())}):a.push(b.asSchema()));this.data.property("allOf").items(function(b,f){a.push(f.asSchema())});return new x(a)},notSchemas:function(){var a=[],b=this.data.property("disallow");b.defined()&&("array"==b.basicType()?b.indices(function(b,f){"string"==f.basicType()?
a.push(q.createSchema({type:f.value()})):a.push(f.asSchema())}):"string"==b.basicType()?a.push(q.createSchema({type:b.value()})):a.push(b.asSchema()));this.data.property("not").defined()&&a.push(this.data.property("not").asSchema());return a},types:function(){var a=this.data.property("type");if(a.defined()){if("string"===a.basicType())return"all"==a.value()?P.slice(0):[a.value()];for(var b=[],c=0;c<a.length();c++)if("string"==a.item(c).basicType()){if("all"==a.item(c).value())return P.slice(0);b.push(a.item(c).value())}else return P.slice(0);
-1!=b.indexOf("number")&&-1==b.indexOf("integer")&&b.push("integer");return b}return P.slice(0)},xorSchemas:function(){var a=[],b=this.data.property("type");if(b.defined())for(var c=0;c<b.length();c++)if("string"!=b.item(c).basicType()){var f=[];b.items(function(a,b){"string"==b.basicType()?f.push(d(b.value())):f.push(b.asSchema())});a.push(f);break}this.data.property("oneOf").defined()&&(f=[],this.data.property("oneOf").items(function(a,b){f.push(b.asSchema())}),a.push(f));return a},orSchemas:function(){var a=
[];this.data.property("type");if(this.data.property("anyOf").defined()){var b=[];this.data.property("anyOf").items(function(a,f){b.push(f.asSchema())});a.push(b)}return a},equals:function(a,b){var c=this;b&&(a=a.getFull(),c=this.getFull());if(c===a)return!0;var f=c.referenceUrl(),k=a.referenceUrl();b&&!c.isFull()&&(f=c.data.resolveUrl(this.data.propertyValue("$ref")));b&&!a.isFull()&&(k=a.data.resolveUrl(a.data.propertyValue("$ref")));return void 0!==f&&void 0!==k?m.urlsEqual(f,k):this.data.equals(a.data)},
readOnly:function(){return!(!this.data.propertyValue("readOnly")&&!this.data.propertyValue("readonly"))},enumValues:function(){return this.data.propertyValue("enum")},enumData:function(){return this.data.property("enum")},minItems:function(){var a=this.data.propertyValue("minItems");return void 0==a?0:a},maxItems:function(){return this.data.propertyValue("maxItems")},tupleTypingLength:function(){return"array"!=this.data.property("items").basicType()?0:this.data.property("items").length()},minLength:function(){var a=
this.data.propertyValue("minLength");return void 0==a?0:a},maxLength:function(){return this.data.propertyValue("maxLength")},numberInterval:function(){return this.data.propertyValue("divisibleBy")},minimum:function(){return this.data.propertyValue("minimum")},exclusiveMinimum:function(){return!!this.data.propertyValue("exclusiveMinimum")},maximum:function(){return this.data.propertyValue("maximum")},exclusiveMaximum:function(){return!!this.data.propertyValue("exclusiveMaximum")},minProperties:function(){var a=
this.data.propertyValue("minProperties");return void 0==a?0:a},maxProperties:function(){return this.data.propertyValue("maxProperties")},definedProperties:function(a){if(a)return this.definedProperties(),this.definedProperties(a);var b=this.data.property("properties").keys();this.definedProperties=function(a){a=a||[];for(var f=[],k=0;k<b.length;k++)-1==a.indexOf(b[k])&&f.push(b[k]);return f};return b.slice(0)},knownProperties:function(a){if(a)return this.knownProperties(),this.knownProperties(a);
var b={};this.data.property("properties").properties(function(a,c){b[a]=!0});a=this.requiredProperties();for(var c=0;c<a.length;c++)b[a[c]]=!0;var f=Object.keys(b);this.knownProperties=function(a){a=a||[];for(var b=[],c=0;c<f.length;c++)-1==a.indexOf(f[c])&&b.push(f[c]);return b};return f.slice(0)},requiredProperties:function(){var a=this.data.propertyValue("required");"object"!=typeof a&&(a=[]);var b=this.data.property("properties");void 0!=b&&b.properties(function(b,f){var k=f.property("required");
void 0!=k&&("boolean"==k.basicType()&&k.value())&&a.push(b)});return a},allowedAdditionalProperties:function(){return!1!==this.data.propertyValue("additionalProperties")},getLink:function(a){for(var b=this.links(),c=0;c<b.length;c++)if(b[c].rel()==a)return b[c]},asList:function(){return new x([this])},format:function(){return this.data.propertyValue("format")}};e.prototype.basicTypes=e.prototype.types;e.prototype.extendSchemas=e.prototype.andSchemas;e.prototype.isComplete=e.prototype.isFull;q.extendSchema=
function(a){for(var b in a)void 0==e.prototype[b]&&(e.prototype[b]=a[b])};var U={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};g.prototype={addHandler:function(a){this.handlers.unshift(a);return this},addPreHandler:function(a){this.preHandlers.push(a);return this},canApplyTo:function(a){var b,c,f=null;for(b=0;b<this.dataParts.length;b++)if(c=this.dataParts[b],null===c?f=a:"object"==a.basicType()?f=a.property(c):"array"==a.basicType()&&N.test(c)&&(f=a.index(c)),void 0==f||!f.defined()||"null"==
f.basicType())return!1;return!0},linkForData:function(a){var b=this.data.value(),c=this.uriTemplate.fill(function(b){b=s(b);return null==b?a.value():"array"==a.basicType()?a.itemValue(b):a.propertyValue(b)});b.href=a.resolveUrl(c);b.rel=b.rel.toLowerCase();b.title=b.title;return new p(b,this,a)},usesKey:function(a){var b;for(b=0;b<this.dataParts.length;b++)if(this.dataParts[b]===a||null===this.dataParts[b])return!0;return!1},rel:function(){return this.data.propertyValue("rel").toLowerCase()}};var ga=
[],ha=[];q.addLinkHandler=function(a){ga.unshift(a)};q.addLinkPreHandler=function(a){ha.push(a)};var ia=m.getUniqueKey();p.prototype={toString:function(){return this.href},createSubmissionData:function(a){var b=this.hrefBase,c=this.submissionSchemas;if(void 0!=a&&0==c.length&&"PUT"==this.method)return Jsonary.getData(this.href,function(b){a(b.editableCopy())}),this;if(void 0!=a)c.createValue(function(f){f=q.create(f,b);for(var k=0;k<c.length;k++)f.addSchema(c[k],ia);a(f)});else{for(var f=c.createValue(),
f=q.create(f,b),k=0;k<c.length;k++)f.addSchema(c[k],ia);return f}},follow:function(a,b){"function"==typeof a&&(b=a,a=void 0);void 0!==a?a instanceof v||(a=q.create(a)):a=q.create(void 0);for(var c=ha.concat(this.definition.preHandlers),f=0;f<c.length;f++){var k=c[f];if(!1===k.call(this,this,a))return m.log(m.logLevel.DEBUG,"Link cancelled: "+this.href),null}f=a.value();c=q.getData({url:this.href,method:this.method,data:f,encType:this.encType},null,this.targetSchema);a=a.readOnlyCopy();var d=this.definition.handlers.concat(ga);
void 0!==b&&d.unshift(b);for(f=0;f<d.length;f++){k=d[f];if("function"!==typeof k)if(k)continue;else break;if(!1===k.call(this,this,a,c))break}return c}};t.prototype={setupXorSelectors:function(){var a=this;this.xorSelectors={};for(var b=this.schema.xorSchemas(),c=0;c<b.length;c++){var f=new V(m.getKeyVariant(this.monitorKey,"xor"+c),b[c],this.data);this.xorSelectors[c]=f;f.onMatchChange(function(b){a.update()},!1)}},setupOrSelectors:function(){var a=this;this.orSelectors={};for(var b=this.schema.orSchemas(),
c=0;c<b.length;c++){var f=new W(m.getKeyVariant(this.monitorKey,"or"+c),b[c],this.data);this.orSelectors[c]=f;f.onMatchChange(function(b){a.update()},!1)}},setupAndMatches:function(){var a=this;this.andMatches=[];this.schema.andSchemas().each(function(b,c){var f=m.getKeyVariant(a.monitorKey,"and"+b),f=a.data.addSchemaMatchMonitor(f,c,function(){a.update()},!1,!0);a.andMatches.push(f)})},setupNotMatches:function(){var a=this;this.notMatches=[];for(var b=this.schema.notSchemas(),c=0;c<b.length;c++)(function(b,
c){var d=m.getKeyVariant(a.monitorKey,"not"+b),d=a.data.addSchemaMatchMonitor(d,c,function(){a.update()},!1,!0);a.notMatches.push(d)})(c,b[c])},addMonitor:function(a,b){this.monitors.add(this.monitorKey,a);!1!==b&&a.call(this.schema,this.match,this.matchFailReason);return this},dataUpdated:function(a){if(this.schemaLoaded){var b=this;if("object"==this.data.basicType()){this.indexMatches={};this.data.properties(function(a,c){if(void 0==b.propertyMatches[a]){var f=[],d=b.schema.propertySchemas(a);d.each(function(e,
g){var h=c.addSchemaMatchMonitor(b.monitorKey,d[e],function(){b.subMatchUpdated(a,h)},!1,!0);f.push(h)});b.propertyMatches[a]=f;b.addDependencies(a)}});var c=[];for(a in this.propertyMatches)this.data.property(a).defined()||c.push(a);for(var f=0;f<c.length;f++)a=c[f],delete this.propertyMatches[a],void 0!=this.dependencyKeys[a]&&(this.data.removeSchema(this.dependencyKeys[a]),delete this.dependencies[a],delete this.dependencyKeys[a])}else if("array"==this.data.basicType()){this.propertyMatches={};
this.data.indices(function(c,f){if(void 0==b.indexMatches[c]){var d=[],e=b.schema.indexSchemas(c);e.each(function(c,k){var g=f.addSchemaMatchMonitor(b.monitorKey,e[c],function(){b.subMatchUpdated(a,g)},!1,!0);d.push(g)});b.indexMatches[c]=d}});c=[];for(a in this.indexMatches)this.data.length()<=a&&c.push(a);for(f=0;f<c.length;f++)delete this.indexMatches[c[f]]}else this.propertyMatches={},this.indexMatches={};this.update()}},addDependencies:function(a){var b=this,c=this.schema.propertyDependencies(a);
this.dependencies[a]=[];this.dependencyKeys[a]=[];for(var f=0;f<c.length;f++){var k=c[f];"string"==typeof k?this.dependencies[a].push(k):function(c){var f=m.getKeyVariant(b.monitorKey,"dep:"+a+":"+c);b.dependencyKeys[a].push(f);f=b.data.addSchemaMatchMonitor(f,k,function(){b.dependencyUpdated(a,c)},!1,!0);b.dependencies[a].push(f)}(f)}},notify:function(){this.monitors.notify(this.match,this.matchFailReason)},setMatch:function(a,b){var c=this,f=this.match,k=this.matchFailReason;this.matchFailReason=
(this.match=a)?null:b;if(this.impatientCallbacks)return this.notify();this.pendingNotify||(this.pendingNotify=!0,I.add(function(){c.pendingNotify=!1;c.match&&f||(c.match||f||!c.matchFailReason.equals(k))&&c.notify()}))},subMatchUpdated:function(a,b){this.update()},subMatchRemoved:function(a,b){this.update()},dependencyUpdated:function(a,b){this.update()},update:function(){try{this.matchAgainstBasicTypes(),this.matchAgainstSubMatches(),this.matchAgainstImmediateConstraints(),this.setMatch(!0)}catch(a){if(a instanceof
n)this.setMatch(!1,a);else throw a;}},matchAgainstBasicTypes:function(){for(var a=this.data.basicType(),b=0;b<this.basicTypes.length;b++)if(this.basicTypes[b]==a||"integer"==a&&"number"==this.basicTypes[b])return;throw new n("Data does not match any of the basic types: "+this.basicTypes,this.schema);},matchAgainstSubMatches:function(){for(var a=0;a<this.andMatches.length;a++){var b=this.andMatches[a];if(!b.match){var c="extended schema #"+a+": "+b.message;throw new n(c,this.schema,b.failReason);}}for(a=
0;a<this.notMatches.length;a++)if(this.notMatches[a].match)throw c='"not" schema #'+a+" matches",new n(c,this.schema);for(c in this.xorSelectors)if(a=this.xorSelectors[c],null==a.selectedOption)throw c="XOR #"+c+": "+a.failReason.message,new n(c,this.schema,a.failReason);for(c in this.orSelectors)if(a=this.orSelectors[c],0==a.selectedOptions.length)throw c="OR #"+c+": no matches",new n(c,this.schema);for(c in this.propertyMatches)for(var f=this.propertyMatches[c],a=0;a<f.length;a++)if(b=f[a],!b.match)throw c=
c+": "+b.matchFailReason.message,new n(c,this.schema,b.matchFailReason);for(c in this.indexMatches)for(f=this.indexMatches[c],a=0;a<f.length;a++)if(b=f[a],!b.match)throw c=c+": "+b.matchFailReason.message,new n(c,this.schema,b.matchFailReason);},matchAgainstImmediateConstraints:function(){this.matchAgainstEnums();this.matchAgainstNumberConstraints();this.matchAgainstArrayConstraints();this.matchAgainstObjectConstraints()},matchAgainstEnums:function(){var a=this.schema.enumData();if(a.defined()){for(var b=
0;b<a.length();b++)if(a.index(b).equals(this.data))return;throw new n("Data does not match enum: "+JSON.stringify(a.value())+" ("+JSON.stringify(this.data.value())+")",this.schema);}},matchAgainstNumberConstraints:function(){if("number"==this.data.basicType()||"integer"==this.data.basicType()){var a=this.data.value(),b=this.schema.numberInterval();if(void 0!=b&&0!=a%b)throw new n("Number must be divisible by "+b);b=this.schema.minimum();if(void 0!==b)if(this.schema.exclusiveMinimum()){if(a<=b)throw new n("Number must be > "+
b);}else if(a<b)throw new n("Number must be >= "+b);b=this.schema.maximum();if(void 0!=b)if(this.schema.exclusiveMaximum()){if(a>=b)throw new n("Number must be < "+b);}else if(a>b)throw new n("Number must be <= "+b);}},matchAgainstArrayConstraints:function(){if("array"==this.data.basicType()){var a=this.schema.minItems();if(void 0!==a&&a>this.data.length())throw new n("Data is not long enough - minimum length is "+a,this.schema);a=this.schema.maxItems();if(void 0!==a&&a<this.data.length())throw new n("Data is too long - maximum length is "+
a,this.schema);}},matchAgainstObjectConstraints:function(){if("object"==this.data.basicType()){for(var a=this.schema.requiredProperties(),b=0;b<a.length;b++){var c=a[b];if(!this.data.property(c).defined())throw new n("Missing key "+JSON.stringify(c),this.schema);}if(!1==this.schema.allowedAdditionalProperties())for(var a=this.schema.definedProperties(),f=this.data.keys(),b=0;b<f.length;b++)if(-1==a.indexOf(f[b]))throw new n("Not allowed additional property: "+JSON.stringify(c),this.schema);this.matchAgainstDependencies()}},
matchAgainstDependencies:function(){for(var a in this.dependencies)if(void 0!=this.data.property(a))for(var b=this.dependencies[a],c=0;c<b.length;c++){var f=b[c];if("string"==typeof f){if(!this.data.property(f).defined())throw new n("Dependency - property "+JSON.stringify(a)+" requires property "+JSON.stringify(f),this.schema);}else if(!f.match)throw new n("Dependency for "+a,this.schema,f.matchFailReason);}}};n.prototype=Error();n.prototype.toString=function(){return this.message+" in "+this.schema.title()};
n.prototype.equals=function(a){if(!(a instanceof n))return!1;if(null==this.subMatchFailReason){if(null!=a.subMatchFailReason)return!1}else if(null==a.subMatchFailReason||!this.subMatchFailReason.equals(a.subMatchFailReason))return!1;return this.message==a.message&&(null==this.schema&&null==a.schema||null!=this.schema&&null!=a.schema&&this.schema.equals(a.schema))};V.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOption);return this},update:function(){for(var a=
null,b="No matches",c=0;c<this.subMatches.length;c++)if(this.subMatches[c].match)if(null==a)a=this.options[c],b=null;else{b="multiple matches";a=null;break}this.failReason=new n(b);this.selectedOption!=a&&(this.selectedOption=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOption))}};W.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOptions);return this},update:function(){for(var a=[],b=0;b<this.subMatches.length;b++)this.subMatches[b].match&&
a.push(this.options[b]);var c=!1;if(a.length!=this.selectedOptions.length)c=!0;else for(b=0;b<a.length;b++)if(a[b]!=this.selectedOptions[b]){c=!0;break}c&&(this.selectedOptions=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOptions))}};var Y=[];q.registerSchemaChangeListener=function(a){Y.push(a)};var O={},X=!1;Z.prototype={rel:function(a){if(void 0==a)return this;var b=[],c;for(c=0;c<this.length;c++)this[c].rel===a&&(b[b.length]=this[c]);return new Z(b)}};var pa={"null":!0,
"boolean":!0,integer:!0,number:!0,string:!0,array:!0,object:!0};x.prototype={indexOf:function(a,b){for(var c=this.length-1;0<=c&&!a.equals(this[c],b);)c--;return c},containsUrl:function(a){if(a instanceof RegExp)for(var b=0;b<this.length;b++){var c=this[b];if(a.test(c.referenceUrl()))return!0}else for(0>a.indexOf("#")&&(a+="#"),b=0;b<this.length;b++)if(c=this[b],c=c.referenceUrl(),null!=c&&c.substring(c.length-a.length)==a)return!0;return!1},links:function(){var a=[],b,c;for(b=0;b<this.length;b++)c=
this[b],a=a.concat(c.links());return a},each:function(a){for(var b=0;b<this.length;b++)a.call(this,b,this[b]);return this},concat:function(a){for(var b=[],c=0;c<this.length;c++)b.push(this[c]);for(c=0;c<a.length;c++)b.push(a[c]);return new x(b)},title:function(){for(var a=[],b=0;b<this.length;b++){var c=this[b].title();c&&a.push(c)}return a.join(" - ")},definedProperties:function(a){if(a)return this.definedProperties(),this.definedProperties(a);var b=!0,c={};this.each(function(a,f){if(b){f.allowedAdditionalProperties()||
(b=!1,c={});for(var d=f.definedProperties(),e=0;e<d.length;e++)c[d[e]]=!0}else if(!f.allowedAdditionalProperties()){b=!1;for(var g={},d=f.definedProperties(),e=0;e<d.length;e++)c[d[e]]&&(g[d[e]]=!0);c=g}});var f=Object.keys(c);h(this,{allowedAdditionalProperties:b});this.definedProperties=function(a){a=a||[];for(var b=[],c=0;c<f.length;c++)-1==a.indexOf(f[c])&&b.push(f[c]);return b};return f},knownProperties:function(a){if(a)return this.knownProperties(),this.knownProperties(a);var b;if(this.allowedAdditionalProperties()){b=
this.definedProperties().slice(0);a=this.requiredProperties();for(var c=0;c<a.length;c++)-1==b.indexOf(a[c])&&b.push(a[c])}else b=this.definedProperties();this.knownProperties=function(a){a=a||[];for(var c=[],d=0;d<b.length;d++)-1==a.indexOf(b[d])&&c.push(b[d]);return c};return b.slice(0)},allowedAdditionalProperties:function(){var a=!0;this.each(function(b,c){a=a&&c.allowedAdditionalProperties()});h(this,{additionalProperties:a});return a},minProperties:function(){for(var a=0,b=0;b<this.length;b++){var c=
this[b].minProperties();c>a&&(a=c)}return a},maxProperties:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxProperties();c>a||(a=c)}return a},types:function(){for(var a=pa,b=0;b<this.length;b++){for(var c=this[b].basicTypes(),f={},k=0;k<c.length;k++){var d=c[k];a[d]&&(f[d]=!0)}a=f}return Object.keys(a)},numberInterval:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].numberInterval();void 0!=c&&(a=void 0==a?c:m.lcm(a,c))}for(b=0;b<this.length;b++){for(var c=this[b].basicTypes(),
f=!1,k=0;k<c.length;k++)if("number"==c[k]){f=!1;break}else"integer"==c[k]&&(f=!0);if(f)return void 0==a?1:m.lcm(a,1)}h(this,{numberInterval:a});return a},minimum:function(){for(var a=void 0,b=!1,c=0;c<this.length;c++){var f=this[c].minimum();void 0!=f&&(void 0==a||a<f)&&(a=f,b=this[c].exclusiveMinimum())}h(this,{minimum:a,exclusiveMinimum:b});return a},exclusiveMinimum:function(){this.minimum();return this.exclusiveMinimum()},maximum:function(){for(var a=void 0,b=!1,c=0;c<this.length;c++){var f=this[c].maximum();
void 0!=f&&(void 0==a||a>f)&&(a=f,b=this[c].exclusiveMaximum())}h(this,{maximum:a,exclusiveMaximum:b});return a},exclusiveMaximum:function(){this.minimum();return this.exclusiveMinimum()},minLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minLength();c>a&&(a=c)}h(this,{minLength:a});return a},maxLength:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxLength();c>a||(a=c)}h(this,{maxLength:a});return a},minItems:function(){for(var a=0,b=0;b<this.length;b++){var c=
this[b].minItems();c>a&&(a=c)}h(this,{minItems:a});return a},maxItems:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxItems();c>a||(a=c)}h(this,{maxItems:a});return a},tupleTypingLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].tupleTypingLength();c>a&&(a=c)}return a},requiredProperties:function(){for(var a={},b=[],c=0;c<this.length;c++)for(var f=this[c].requiredProperties(),k=0;k<f.length;k++){var d=f[k];a[d]||(a[d]=!0,b.push(d))}return b},readOnly:function(){for(var a=
!1,b=0;b<this.length;b++)if(this[b].readOnly()){a=!0;break}this.readOnly=function(){return a};return a},enumValues:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].enumData();if(c.defined())if(void 0==a)a=[],c.indices(function(b,c){a[b]=c});else{var f=[];c.indices(function(b,c){for(var d=0;d<a.length;d++)a[d].equals(c)&&f.push(c)});a=f}}if(void 0!=a){c=[];for(b=0;b<a.length;b++)c[b]=a[b].value();return c}},allCombinations:function(a){function b(){t--;if(0>=t){for(var b=[new x([])],
f=0;f<p.length;f++){for(var d=p[f],k=[],e=0;e<d.length;e++)for(var g=0;g<b.length;g++)k.push(b[g].concat(d[e]));b=k}for(f=0;f<b.length;f++)b[f]=c.concat(b[f]);a(b)}}if(a&&!this.isFull())return this.getFull(function(b){b.allCombinations(a)}),[];for(var c=this,f=this.xorSchemas(),d=0;d<f.length;d++){for(var e=!1,g=0;g<f[d].length;g++){var h=f[d][g];if(0<=this.indexOf(h,!!a)){e=!0;break}}if(!e){for(var s=[],m=1,g=0;g<f[d].length;g++)h=f[d][g],a?(m++,this.concat([h]).allCombinations(function(b){s=s.concat(b);
m--;0>=m&&a(s)})):(e=this.concat([h]).allCombinations(),s=s.concat(e));a&&(m--,0>=m&&a(s));return s}}for(var n=this.orSchemas(),f=null,p=[],t=1,d=0;d<n.length;d++)(function(f){for(var d=[],k=!1,e=0;e<n[f].length;e++){var g=n[f][e];-1==c.indexOf(g,!!a)?d.push(g):k=!0}if(0<d.length){e=[[]];for(g=0;g<d.length;g++){for(var h=[],u=0;u<e.length;u++)h.push(e[u]),h.push(e[u].concat([d[g]]));e=h}k||e.shift();if(a)for(p[f]=[],d=0;d<e.length;d++)k=new x(e[d]),t++,k.allCombinations(function(a){p[f]=p[f].concat(a);
b()});else p[f]=e}})(d);f=[new x([])];for(d=0;d<p.length;d++){g=p[d];e=[];for(h=0;h<g.length;h++)for(var q=0;q<f.length;q++)e.push(f[q].concat(g[h]));f=e}for(d=0;d<f.length;d++)f[d]=this.concat(f[d]);a&&b();return f},createValue:function(a,b){function c(b){if(void 0!==b){var c=m.guessBasicType(b);-1!=f.indexOf(c)||"integer"==c&&-1!=f.indexOf("number")||(b=void 0)}void 0!==b&&void 0===e&&(e=b);d--;a&&0>=d&&a(e);if(0>=d)return e}if(b){for(var f=this.basicTypes(),d=1,e=void 0,g=0;g<this.length;g++)if(this[g].hasDefault()&&
(d++,c(this[g].defaultValue())))return e;var h=this.enumValues();if(void 0!=h)for(d+=h.length,g=0;g<h.length;g++){if(c(h[g]))return e}else for(d+=f.length,g=0;g<f.length;g++)if(h=f[g],"null"==h){if(c(null))return e}else if("boolean"==h){if(c(!0))return!0}else if("integer"==h||"number"==h){if(h=this.createValueNumber(),c(h))return e}else if("string"==h){if(h=this.createValueString(),c(h))return e}else if("array"==h)if(a)this.createValueArray(function(a){c(a)});else{if(h=this.createValueArray(),c(h))return e}else if("object"==
h)if(a)h=this.createValueObject(function(a){c(a)});else if(h=this.createValueObject(),c(h))return e;return c(e)}if(null!=a)this.allCombinations(function(b){function c(f){if(f>=b.length)return a(void 0);b[f].createValue(function(b){void 0!==b?a(b):c(f+1)},!0)}c(0)});else for(var h=this.allCombinations(),g=0;g<h.length;g++){var s=h[g].createValue(null,!0);if(void 0!==s)return s}},createValueNumber:function(){var a=this.exclusiveMinimum(),b=this.minimum(),c=this.maximum(),f=this.exclusiveMaximum(),d=
this.numberInterval(),e=void 0;if(void 0!=b&&void 0!=c){if(b>c||b==c&&(a||f))return;if(void 0!=d){if(e=Math.ceil(b/d)*d,a&&e==b&&(e+=d),e>c||e==c&&f)return}else e=0.5*(b+c)}else void 0!=b?(e=b,void 0!=d&&(e=Math.ceil(e/d)*d),a&&e==b&&(void 0!=d?e+=d:e++)):void 0!=c?(e=c,void 0!=d&&(e=Math.floor(e/d)*d),f&&e==c&&(void 0!=d?e-=d:e--)):e=0;return e},createValueString:function(){return""},createValueArray:function(a){var b=this,c=[],f=this.minItems();if(!f)return a&&a(c),c;for(var d=f,e=0;e<f;e++)(function(f){a?
b.createValueForIndex(f,function(b){c[f]=b;d--;0==d&&a(c)}):c[f]=b.createValueForIndex(f)})(e);return c},createValueObject:function(a){var b=this,c={},f=this.requiredProperties();if(0==f.length)return a&&a(c),c;for(var d=f.length,e=0;e<f.length;e++)(function(f){a?b.createValueForProperty(f,function(b){c[f]=b;d--;0==d&&a(c)}):c[f]=b.createValueForProperty(f)})(f[e]);return c},createValueForIndex:function(a,b){return this.indexSchemas(a).createValue(b)},indexSchemas:function(a){for(var b=new x,c=0;c<
this.length;c++)b=b.concat(this[c].indexSchemas(a));return b},createValueForProperty:function(a,b){return this.propertySchemas(a).createValue(b)},propertySchemas:function(a){for(var b=new x,c=0;c<this.length;c++)b=b.concat(this[c].propertySchemas(a));return b},propertyDependencies:function(a){for(var b=[],c={},f=0;f<this.length;f++)for(var d=this[f].propertyDependencies(a),e=0;e<d.length;e++)"string"==typeof d[e]?c[d[e]]||(c[d[e]]=!0,b.push(d[e])):b.push(d[e]);return b},isFull:function(){for(var a=
0;a<this.length;a++){if(!this[a].isFull())return!1;for(var b=this[a].andSchemas(),c=0;c<b.length;c++)if(-1==this.indexOf(b[c],!0))return!1}return!0},getFull:function(a){function b(e){c+=e.length;for(var g=0;g<e.length;g++)e[g].getFull(function(e){for(var g=0;g<f.length;g++)if(e.equals(f[g])){c--;0==c&&(e=new x(f,d),a.call(e,e));return}f.push(e);e=e.extendSchemas();b(e);c--;0==c&&(e=new x(f,d),a.call(e,e))})}if(0==this.length)return a.call(this,this),this;var c=0,f=[],d=this.fixed();b(this);return this},
formats:function(){for(var a=[],b=0;b<this.length;b++){var c=this[b].format();null!=c&&a.push(c)}return a},xorSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].xorSchemas());return a},orSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].orSchemas());return a}};x.prototype.basicTypes=x.prototype.types;x.prototype.potentialLinks=x.prototype.links;q.extendSchemaList=function(a){for(var b in a)void 0==x.prototype[b]&&(x.prototype[b]=a[b])};q.createSchemaList=
function(a){Array.isArray(a)||(a=[a]);return new x(a)};m.getUniqueKey();da.prototype={update:function(a){this.updateLinksWithKey(a);this.updateDependenciesWithKey(a);this.updateMatchesWithKey(a)},updateFromSelfLink:function(){this.cachedLinkList=null;var a=[],b;for(b in this.links)for(var c=this.links[b],f=0;f<c.length;f++){var d=c[f];"self"==d.rel()&&(d.active=!1)}for(b in this.links)for(c=this.links[b],f=0;f<c.length;f++)d=c[f],"self"==d.rel()&&(d.update(),d.active&&(a.push(d),d.active=!1,this.cachedLinkList=
null));for(var f=0;f<a.length;f++)a[f].active=!0;for(b in this.links)for(c=this.links[b],f=0;f<c.length;f++)d=c[f],"self"!=d.rel()&&d.update();this.dataObj.properties(function(a,b){b.addLink(null)});this.dataObj.items(function(a,b){b.addLink(null)})},updateLinksWithKey:function(a){var b,c,f,d,e=[];for(b in this.links)for(f=this.links[b],c=0;c<f.length;c++)d=f[c],(d.usesKey(a)||null==a)&&e.push(d);if(0<e.length){a=null;for(c=0;c<e.length;c++)if(d=e[c],b=d.active?d.rawLink.rawLink.href:null,d.update(),
(d.active?d.rawLink.rawLink.href:null)!=b&&"self"==d.rel()){a=d;break}null!=a&&this.updateFromSelfLink(a);this.invalidateSchemaState()}},updateMatchesWithKey:function(a){var b=[];for(schemaKey in this.matches)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++){var d=this.matches[b[c]];if(void 0!=d)for(var e=0;e<d.length;e++)d[e].dataUpdated(a)}},updateDependenciesWithKey:function(a){var b=[];for(schemaKey in this.dependencySelectors)b.push(schemaKey);b.sort();b.reverse();for(var c=
0;c<b.length;c++)for(var d=this.dependencySelectors[b[c]],e=0;e<d.length;e++)d[e].dataUpdated(a)},alreadyContainsSchema:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(void 0!=this.schemas[d])for(var e=0;e<this.schemas[d].length;e++)if(a.equals(this.schemas[d][e]))return!0}return!1},addSchema:function(a,b,c,d){var e=this;void 0==b&&(b=m.getUniqueKey());void 0==d&&(d=!0);void 0==c?c=[b]:c[c.length]=b;void 0==this.schemas[b]&&(this.schemas[b]=[]);this.schemaFlux++;"string"==typeof a&&(a=q.createSchema({$ref:a}));
a.getFull(function(a,g){if(e.alreadyContainsSchema(a,c))e.schemaFlux--,e.checkForSchemasStable();else{I.increment();e.schemas[b].push(a);e.schemasFixed[b]=e.schemasFixed[b]||d;e.dataObj.properties(function(d,f){for(var e=m.getKeyVariant(b,"prop"),k=a.propertySchemas(d),g=0;g<k.length;g++)f.addSchema(k[g],e,c)});e.dataObj.indices(function(d,f){m.getKeyVariant(b,"idx");var e=a.indexSchemas(d);for(d=0;d<e.length;d++)f.addSchema(e[d],b,c)});for(var h=a.extendSchemas(),s=0;s<h.length;s++)e.addSchema(h[s],
b,c,d);e.addLinks(a.links(),b,c);e.addXorSelectors(a,b,c);e.addOrSelectors(a,b,c);e.addDependencySelector(a,b,c);e.schemaFlux--;e.invalidateSchemaState();I.decrement()}})},addLinks:function(a,b,c){var d,e;void 0==this.links[b]&&(this.links[b]=[]);var g=null;for(d=0;d<a.length;d++)e=new ea(this.dataObj,a[d]),this.links[b].push(e),this.addMonitorForLink(e,b,c),e.update(),e.active&&"self"==e.rawLink.rawLink.rel&&(g=e);null!=g&&this.updateFromSelfLink(g);this.invalidateSchemaState()},addXorSelectors:function(a,
b,c){a=a.xorSchemas();for(var d=[],e=0;e<a.length;e++){var g=new na(a[e],m.getKeyVariant(b,"xor"+e),c,this);d.push(g)}this.xorSelectors[b]=void 0==this.xorSelectors[b]?d:this.xorSelectors[b].concat(d)},addOrSelectors:function(a,b,c){a=a.orSchemas();for(var d=[],e=0;e<a.length;e++){var g=new oa(a[e],m.getKeyVariant(b,"or"+e),c,this);d.push(g)}this.orSelectors[b]=void 0==this.orSelectors[b]?d:this.orSelectors[b].concat(d)},addDependencySelector:function(a,b,c){a=[new fa(a,m.getKeyVariant(b,"dep"),c,
this)];this.dependencySelectors[b]=void 0==this.dependencySelectors[b]?a:this.dependencySelectors[b].concat(a)},addLink:function(a){if(null==a)this.updateFromSelfLink(),this.invalidateSchemaState();else if("invalidate"==a.rel||"invalidates"==a.rel){var b=this.dataObj.resolveUrl(a.href);q.invalidate(b)}else b=m.getUniqueKey(),a=q.create(a),a=new g(a),this.addLinks([a],b)},addMonitorForLink:function(a,b,c){var d=this;if("describedby"===a.rel()){var e=m.getKeyVariant(b);a.addMonitor(e,function(b){d.removeSchema(e);
b&&(b=q.createSchema({$ref:a.rawLink.href}),d.addSchema(b,e,c,!1))})}},addSchemaMatchMonitor:function(a,b,c,d,e){b=new t(a,this.dataObj,b,e);void 0==this.matches[a]&&(this.matches[a]=[]);this.matches[a].push(b);b.addMonitor(c,d);return b},removeSchema:function(a){I.increment();this.dataObj.indices(function(b,c){c.removeSchema(a)});this.dataObj.properties(function(b,c){c.removeSchema(a)});var b,c,d=[];for(b in this.schemas)m.keyIsVariant(b,a)&&d.push(b);for(b in this.links)m.keyIsVariant(b,a)&&d.push(b);
for(b in this.matches)m.keyIsVariant(b,a)&&d.push(b);for(c=0;c<d.length;c++)b=d[c],delete this.schemas[b],delete this.links[b],delete this.matches[b],delete this.xorSelectors[b],delete this.orSelectors[b],delete this.dependencySelectors[b];0<d.length&&this.invalidateSchemaState();I.decrement()},clear:function(){this.schemas={};this.links={};this.matches={};this.invalidateSchemaState()},getSchemas:function(){if(null!==this.cachedSchemaList)return this.cachedSchemaList;var a=[],b={},c,d,e,g,h,s;for(e in this.schemas){g=
this.schemas[e];var m=this.schemasFixed[e];for(c=0;c<g.length;c++){h=g[c];m&&(b[h.data.uniqueId]=h);s=!1;for(d=0;d<a.length;d++)if(h.equals(a[d])){s=!0;break}s||a.push(h)}}c=[];for(e in b)c.push(b[e]);return this.cachedSchemaList=new x(a,c)},getLinks:function(a){var b,c,d,e;if(null!==this.cachedLinkList)return this.cachedLinkList.rel(a);var g=[];for(b in this.links)for(e=this.links[b],c=0;c<e.length;c++)d=e[c],d.active&&g.push(d.rawLink);this.cachedLinkList=new Z(g);return this.cachedLinkList.rel(a)},
invalidateSchemaState:function(){this.cachedLinkList=this.cachedSchemaList=null;this.schemasStable=!1;this.checkForSchemasStable()},checkForSchemasStable:function(){if(0<this.schemaFlux)return!1;var a,b,c,d;for(b in this.schemas)for(c=this.schemas[b],a=0;a<c.length;a++)if(d=c[a],!d.isComplete())return this.schemasStable=!1;this.schemasStable||(this.schemasStable=!0,a=this.dataObj,O[a.uniqueId]=a,X||(X=!0,I.add(ma)));this.schemasStableListeners.notify(this.dataObj,this.getSchemas());return!0},addSchemasForProperty:function(a,
b){for(var c in this.schemas)for(var d=m.getKeyVariant(c,"prop"),e=0;e<this.schemas[c].length;e++)for(var g=this.schemas[c][e].propertySchemas(a),h=0;h<g.length;h++)b.addSchema(g[h],d)},addSchemasForIndex:function(a,b){for(var c in this.schemas)for(var d=m.getKeyVariant(c,"idx"),e=0;e<this.schemas[c].length;e++)for(var g=this.schemas[c][e].indexSchemas(a),h=0;h<g.length;h++)b.addSchema(g[h],d)},removeSubSchemas:function(a){for(var b in this.schemas)a.removeSchema(b)},whenSchemasStable:function(a){this.schemasStableListeners.add(a);
this.checkForSchemasStable()}};ea.prototype={update:function(a){this.rawLink=(a=this.potentialLink.canApplyTo(this.dataObj))?this.potentialLink.linkForData(this.dataObj):null;this.active=a;this.updateMonitors.notify(this.active)},rel:function(){return this.potentialLink.rel()},usesKey:function(a){return this.potentialLink.usesKey(a)},addMonitor:function(a,b){this.updateMonitors.add(a,b)}};fa.prototype={dataUpdated:function(a){if(null==a)for(var b=this.schema.data.property("dependencies").keys(),c=
0;c<b.length;c++)a=b[c],this.dataUpdated(a);else if(this.schemaSet.dataObj.property(a).defined())for(b=this.schema.propertyDependencies(a),c=0;c<b.length;c++){var d=b[c];"string"!=typeof d&&this.schemaSet.addSchema(d,this.inferredSchemaKeys[a],this.schemaKeyHistory,!1)}else this.schemaSet.removeSchema(this.inferredSchemaKeys[a])}};q.config={antiCacheUrls:!1};q.UriTemplate=w})(this);
(function(C){function y(d){return"object"==typeof d?JSON.parse(JSON.stringify(d)):d}function B(d){var e=this;this.elementLookup={};void 0==d&&(d=E+"."+J++ +".");var g=0;this.getElementId=function(){return d+g++};this.enhancementContexts={};this.enhancementActions={};this.enhancementInputs={};Jsonary.registerChangeListener(function(d,g){d.each(function(d,h){for(var s=g.affectedData(h),l=0;l<s.length;l++)e.update(s[l],h)})});Jsonary.registerSchemaChangeListener(function(d){for(var g={},h=0;h<d.length;h++){var n=
d[h],l=n.uniqueId,r=e.elementLookup[l];if(void 0==r||0==r.length)return;g[l]=r.slice(0)}for(var v=0;v<d.length;v++)for(n=d[v],l=n.uniqueId,r=g[l],h=0;h<r.length;h++)if(l=document.getElementById(r[h]),void 0!=l){var w=l.jsonaryContext,x=y(this.uiStartingState),z=F(n,x,w.usedComponents);z.uniqueId==w.renderer.uniqueId?z.render(l,n,w):w.baseContext.render(l,n,w.label,x)}});this.rootContext=this;this.subContexts={};this.oldSubContexts={}}function K(){var d=[],e;for(e in l.elementLookup){for(var g=l.elementLookup[e],
h=!1,p=0;p<g.length;p++)if(document.getElementById(g[p])){h=!0;break}h||d.push(e)}for(p=0;p<d.length;p++)delete l.elementLookup[d[p]];for(e in l.enhancementContexts)l.enhancementContexts[e]&&(d=l.enhancementContexts[e],Jsonary.log(Jsonary.logLevel.WARNING,"Orphaned context for element: "+JSON.stringify(e)+"\ncomponents:"+d.renderer.component.join(", ")+"\ndata: "+d.data.json()),l.enhancementContexts[e]=null);for(e in l.enhancementActions)l.enhancementActions[e]&&(d=l.enhancementActions[e].context,
Jsonary.log(Jsonary.logLevel.WARNING,"Orphaned action for element: "+JSON.stringify(e)+"\ncomponents:"+d.renderer.component.join(", ")+"\ndata: "+d.data.json()),l.enhancementActions[e]=null);for(e in l.enhancementInputs)l.enhancementInputs[e]&&(d=l.enhancementInputs[e].context,Jsonary.log(Jsonary.logLevel.WARNING,"Orphaned action for input: "+JSON.stringify(e)+"\ncomponents:"+d.renderer.component.join(", ")+"\ndata: "+d.data.json()),l.enhancementInputs[e]=null)}function w(d,e,g,h){var p=document.createElement("span");
d.innerHTML="";d.appendChild(p);d=l.render(p,e,null,g,h);l.oldSubContexts={};l.subContexts={};return d}function h(d){this.renderFunction=d.render||d.enhance;this.renderHtmlFunction=d.renderHtml;this.updateFunction=d.update;this.filterFunction=d.filter;this.actionFunction=d.action;for(var e in d)void 0==this[e]&&(this[e]=d[e]);this.uniqueId=A++;this.component=void 0!=d.component?d.component:r[r.length-1];"string"==typeof this.component&&(this.component=[this.component]);d.saveState&&(this.saveState=
d.saveState);d.loadState&&(this.loadState=d.loadState)}function G(d,e,g,h){h=!!h||void 0==h;for(var p=0;p<D.length&&!1!==(0,D[p])(d,e,g,h);p++);}function F(d,e,g){for(var h=d.schemas(),p=0;p<r.length;p++)if(-1==g.indexOf(r[p]))for(var t=r[p],n=v.length-1;0<=n;n--){var l=v[n];if(-1!=l.component.indexOf(t)&&l.canRender(d,h,e))return l}}var E="Jsonary",J=0,z={ADD_REMOVE:"ADD_REMOVE",TYPE_SELECTOR:"TYPE_SELECTOR",RENDERER:"DATA_RENDERER",add:function(d,e){void 0==this[d]&&(this[d]=d,-1!=r.indexOf(e)?
r.splice(r.indexOf(e),0,this[d]):r.splice(r.length-1,0,this[d]))}},r=[z.ADD_REMOVE,z.TYPE_SELECTOR,z.RENDERER];B.prototype={usedComponents:[],rootContext:null,baseContext:null,subContext:function(d,e){Jsonary.isData(d)&&(d="data"+d.uniqueId);e=e||{};var g=this.getSubContext(!1,this.data,d,e);g.renderer=this.renderer;g.parent=this;g.uiState||g.loadState(g.uiStartingState);return g},subContextSavedStates:{},saveState:function(){var d={},e;for(e in this.subContexts)d[e]=this.subContexts[e].saveState();
for(e in this.oldSubContexts)d[e]=this.oldSubContexts[e].saveState();return(this.renderer?this.renderer.saveState:h.prototype.saveState).call(this.renderer,this.uiState,d,this.data)},loadState:function(d){d=(this.renderer?this.renderer.loadState:h.prototype.loadState).call(this.renderer,d);this.uiState=d[0];this.subContextSavedStates=d[1]},getSubContext:function(d,e,g,h){if("object"==typeof g&&null!=g)throw Error("Label cannot be an object");var p=g||""===g?g:e.uniqueId;void 0!=this.oldSubContexts[p]&&
(this.subContexts[p]=this.oldSubContexts[p]);void 0!=this.subContexts[p]&&this.subContexts[p].data!=e&&(delete this.subContexts[p],delete this.oldSubContexts[p],delete this.subContextSavedStates[p]);this.subContextSavedStates[p]&&(h=this.subContextSavedStates[p],delete this.subContextSavedStates[p]);if(void 0==this.subContexts[p]){var t=[];this.data==e&&(t=this.usedComponents.slice(0),void 0!=this.renderer&&(t=t.concat(this.renderer.component)));"object"==typeof d&&(d=d.id);var n=function(d,e,g,h,
s,n){this.rootContext=d;this.baseContext=e;this.label=g;this.data=h;this.uiStartingState=y(s||{});this.usedComponents=n;this.subContexts={};this.oldSubContexts={}};n.prototype=this.rootContext;this.subContexts[p]=new n(this.rootContext,this,g,e,h,t)}e=this.subContexts[p];e.elementId=d;return e},clearOldSubContexts:function(){this.oldSubContexts=this.subContexts;this.subContexts={}},rerender:function(){if(this.parent&&!this.elementId)return this.parent.rerender();var d=document.getElementById(this.elementId);
null!=d&&(this.renderer.render(d,this.data,this),this.clearOldSubContexts())},render:function(d,e,g,h,p){void 0==h&&"object"==typeof g&&(h=g,g=null);"string"==typeof e&&(e=Jsonary.getData(e));if(void 0!=e.getData){var t=this;e.getData(function(e){t.render(d,e,g,h,p)})}else{"object"!=typeof h&&(h={});if(void 0==d.id||""==d.id)d.id=this.getElementId();var n=d.jsonaryContext,l=this.getSubContext(d.id,e,g,h);d.jsonaryContext=l;if(n){var n=n.data.uniqueId,r=this.elementLookup[n].indexOf(d.id);0<=r&&this.elementLookup[n].splice(r,
1)}n=e.uniqueId;void 0==this.elementLookup[n]&&(this.elementLookup[n]=[]);-1==this.elementLookup[n].indexOf(d.id)&&this.elementLookup[n].push(d.id);n=F(e,h,l.usedComponents);void 0!=n?(l.renderer=n,void 0==l.uiState&&l.loadState(l.uiStartingState),n.render(d,e,l),l.clearOldSubContexts()):d.innerHTML="NO RENDERER FOUND";p&&p(l)}},renderHtml:function(d,e,g){void 0==g&&"object"==typeof e&&(g=e,e=null);var h=this.getElementId();"string"==typeof d&&(d=Jsonary.getData(d));if(void 0!=d.getData){var p=this,
l=!1;d.getData(function(n){if(l){var r=document.getElementById(h);r.className="";r?p.render(r,n,e,g):Jsonary.log(Jsonary.logLevel.WARNING,"Attempted delayed render to non-existent element: "+h)}else l=!0,d=n});if(!l)return l=!0,'<span id="'+h+'" class="loading">Loading...</span>'}!0===g&&(g=this.uiStartingState);"object"!=typeof g&&(g={});var n=this.getSubContext(h,d,e,g),r=F(d,g,n.usedComponents);n.renderer=r;void 0==n.uiState&&n.loadState(n.uiStartingState);r=r.renderHtml(d,n);n.clearOldSubContexts();
var v=d.uniqueId;void 0==this.elementLookup[v]&&(this.elementLookup[v]=[]);-1==this.elementLookup[v].indexOf(h)&&this.elementLookup[v].push(h);this.addEnhancement(h,n);return'<span id="'+h+'">'+r+"</span>"},update:function(d,e){var g=this.elementLookup[d.uniqueId];if(void 0!=g&&0!=g.length)for(var g=g.slice(0),h=0;h<g.length;h++){var p=document.getElementById(g[h]);if(void 0!=p){var l=p.jsonaryContext||this.enhancementContexts[g[h]],n=y(this.uiStartingState),r=F(d,n,l.usedComponents);r.uniqueId==
l.renderer.uniqueId?r.update(p,d,l,e):l.baseContext.render(p,d,l.label,n)}}},actionHtml:function(d,e){var g=2,h=!1,l="javascript:void(0)";"boolean"==typeof e&&(h=arguments[1],l=arguments[2]||l,e=arguments[3],g+=2);for(var t=[];g<arguments.length;g++)t.push(arguments[g]);g=this.getElementId();this.addEnhancementAction(g,e,this,t,h);return'<a href="'+Jsonary.escapeHtml(l)+'" id="'+g+'" style="text-decoration: none">'+d+"</a>"},inputNameForAction:function(d){var e=!1,g=1;"boolean"==typeof d&&(e=d,d=
arguments[1],g++);for(var h=[];g<arguments.length;g++)h.push(arguments[g]);g=this.getElementId();this.enhancementInputs[g]={inputName:g,actionName:d,context:this,params:h,historyChange:e};return g},addEnhancement:function(d,e){this.enhancementContexts[d]=e},addEnhancementAction:function(d,e,g,h,l){null==h&&(h=[]);this.enhancementActions[d]={actionName:e,context:g,params:h,historyChange:l}},enhanceElement:function(d){for(var e=d;d;)if(d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!=e;)1==
d.nodeType&&this.enhanceElementSingle(d),d=d.parentNode;1==d.nodeType&&this.enhanceElementSingle(d);if(d==e)break;d=d.nextSibling}},enhanceElementSingle:function(d){var e=d.id,g=this.enhancementContexts[e];void 0!=g&&(d.jsonaryContext=g,delete this.enhancementContexts[e],e=g.renderer,void 0!=e&&e.enhance(d,g.data,g));var h=this.enhancementActions[d.id];void 0!=h&&(delete this.enhancementActions[d.id],d.onclick=function(){var d=h.context,e=[d,h.actionName].concat(h.params);d.renderer.action.apply(d.renderer,
e)&&d.rerender();G(d.data,d,h.actionName,h.historyChange);return!1});var l=this.enhancementInputs[d.name];void 0!=l&&(delete this.enhancementInputs[d.name],d.onchange=function(){var d=this.value;"checkbox"==this.getAttribute("type")&&(d=this.checked);if("select"==this.tagName.toLowerCase()&&null!=this.getAttribute("multiple"))for(var d=[],e=0;e<this.options.length;e++){var g=this.options[e];g.selected&&d.push(g.value)}e=l.context;d=[e,l.actionName,d].concat(l.params);e.renderer.action.apply(e.renderer,
d)&&e.rerender();G(e.data,e,l.actionName,l.historyChange)});d=null}};var l=new B;setInterval(K,3E4);Jsonary.cleanup=K;w.empty=void 0!=C.jQuery?function(d){C.jQuery(d).empty()}:function(d){d.innerHTML=""};w.Components=z;var A=0;h.prototype={updateAll:function(){var d=[],e;for(e in l.elementLookup)d=d.concat(l.elementLookup[e]);for(e=0;e<d.length;e++){var g=document.getElementById(d[e]);void 0!=g&&(g=g.jsonaryContext,(g.renderer.uniqueId=this.uniqueId)&&g.rerender())}},render:function(d,e,g){if(null==
d)return Jsonary.log(Jsonary.logLevel.WARNING,"Attempted to render to non-existent element.\n\tData path: "+e.pointerPath()+"\n\tDocument: "+e.document.url),this;void 0!=d[0]&&(d=d[0]);w.empty(d);d.innerHTML=this.renderHtml(e,g);null!=this.renderFunction&&this.renderFunction(d,e,g);g.enhanceElement(d);return this},renderHtml:function(d,e){var g="";void 0!=this.renderHtmlFunction&&(g=this.renderHtmlFunction(d,e));return g},enhance:function(d,e,g){null!=this.renderFunction&&this.renderFunction(d,e,
g);return this},update:function(d,e,g,h){(void 0!=this.updateFunction?this.updateFunction(d,e,g,h):this.defaultUpdate(d,e,g,h))&&this.render(d,e,g);return this},action:function(d,e){return this.actionFunction.apply(this,arguments)},canRender:function(d,e,g){return void 0!=this.filterFunction?this.filterFunction(d,e,g):!0},defaultUpdate:function(d,e,g,h){d=!1;g="replace"!=h.action();e=e.pointerPath();h.subjectEquals(e)||g&&!1!==h.subjectChild(e)?d=!0:void 0!=h.target()&&(h.targetEquals(e)||g&&!1!==
h.targetChild(e))&&(d=!0);return d},saveState:function(d,e,g){g={};for(key in d)g[key]=d[key];for(var h in e)for(var l in e[h])g[h+"-"+l]=e[h][l];for(key in g)Jsonary.isData(g[key])&&(g[key]=this.saveStateData(g[key]));return g},saveStateData:function(d){if(d){if(d.document.isDefinitive)return"url:"+d.referenceUrl();var e;if(!(e=d.saveStateId)){e=10;for(var g="";g.length<e;)g+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*Math.random()));e=g}d.saveStateId=e;
localStorage[d.saveStateId]=JSON.stringify({accessed:(new Date).getTime(),data:d.deflate()});return d.saveStateId}},loadState:function(d){var e={},g={},h;for(h in d)if(-1!=h.indexOf("-")){var l=h.split("-"),t=l.shift(),l=l.join("-");g[t]||(g[t]={});g[t][l]=d[h]}else e[h]=this.loadStateData(d[h])||d[h],Jsonary.isRequest(e[h])&&function(d){e[d].getData(function(g){e[d]=g})}(h);return[e,g]},loadStateData:function(d){if("string"==typeof d&&"url:"==d.substring(0,4)){d=d.substring(4);var e=null;d=Jsonary.getData(d,
function(d){e=d});return e||d}if(d){var g=localStorage[d];if(g)return g=JSON.parse(g),e=Jsonary.inflate(g.data),e.saveStateId=d,e}}};h.prototype.super_=h.prototype;var M={},v=[];w.register=function(d){d=new h(d);M[d.uniqueId]=d;v.push(d);return d};w.deregister=function(d){"object"==typeof d&&(d=d.uniqueId);delete M[d];for(var e=0;e<v.length;e++)v[e].uniqueId==d&&(v.splice(e,1),e--)};var D=[];w.addActionHandler=function(d){D.push(d)};"undefined"!=typeof C.jQuery&&(z=function(d,e){var g=this[0];void 0!=
g&&w(g,d,e);return this},Jsonary.extendData({$renderTo:function(d,e){"string"==typeof d&&(d=jQuery(d));var g=d[0];void 0!=g&&w(g,this,e)}}),z.register=function(d){if(void 0!=d.render){var e=d.render;d.render=function(d,g){var h=$(d);e.call(this,h,g)}}if(void 0!=d.update){var g=d.update;d.update=function(d,e,h){d=$(d);g.call(this,d,e,h)}}w.register(d)},z.empty=function(d){d.each(function(d,g){w.empty(g)})},jQuery.fn.extend({renderJson:z}),jQuery.extend({renderJson:z}));Jsonary.extend({render:w,renderHtml:function(d,
e,g){d=l.renderHtml(d,null,e,g);l.oldSubContexts={};l.subContexts={};return d}});Jsonary.extendData({renderTo:function(d,e){"string"==typeof d&&(d=document.getElementById(d));w(d,this,e)}})})(this);