"undefined"!=typeof window&&"undefined"==typeof localStorage&&(window.localStorage={});Array.isArray||(Array.isArray=function(h){return"[object Array]"===Object.prototype.toString.apply(h)});Array.prototype.indexOf||(Array.prototype.indexOf=function(h,v){for(var B=v||0;B<this.length;B++)if(this[B]===h)return B;return-1});Object.keys||(Object.keys=function(h){var v=[],B;for(B in h)h.hasOwnProperty(B)&&v.push(B);return v});
String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});Object.create||(Object.create=function(){function h(){}return function(v){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");h.prototype=v;return new h}}());"object"!==typeof JSON&&(JSON={});
(function(){function h(h){return 10>h?"0"+h:h}function v(h){K.lastIndex=0;return K.test(h)?'"'+h.replace(K,function(h){var t=J[h];return"string"===typeof t?t:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function B(h,L){var A,x,w,y,F=r,l,u=L[h];u&&("object"===typeof u&&"function"===typeof u.toJSON)&&(u=u.toJSON(h));"function"===typeof C&&(u=C.call(L,h,u));switch(typeof u){case "string":return v(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);
case "object":if(!u)return"null";r+=E;l=[];if("[object Array]"===Object.prototype.toString.apply(u)){y=u.length;for(A=0;A<y;A+=1)l[A]=B(A,u)||"null";w=0===l.length?"[]":r?"[\n"+r+l.join(",\n"+r)+"\n"+F+"]":"["+l.join(",")+"]";r=F;return w}if(C&&"object"===typeof C)for(y=C.length,A=0;A<y;A+=1)"string"===typeof C[A]&&(x=C[A],(w=B(x,u))&&l.push(v(x)+(r?": ":":")+w));else for(x in u)Object.prototype.hasOwnProperty.call(u,x)&&(w=B(x,u))&&l.push(v(x)+(r?": ":":")+w);w=0===l.length?"{}":r?"{\n"+r+l.join(",\n"+
r)+"\n"+F+"}":"{"+l.join(",")+"}";r=F;return w}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(r){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(h){return this.valueOf()});var M=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
K=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r,E,J={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},C;"function"!==typeof JSON.stringify&&(JSON.stringify=function(h,v,A){var x;E=r="";if("number"===typeof A)for(x=0;x<A;x+=1)E+=" ";else"string"===typeof A&&(E=A);if((C=v)&&"function"!==typeof v&&("object"!==typeof v||"number"!==typeof v.length))throw Error("JSON.stringify");return B("",{"":h})});
"function"!==typeof JSON.parse&&(JSON.parse=function(h,r){function v(h,t){var x,l,u=h[t];if(u&&"object"===typeof u)for(x in u)Object.prototype.hasOwnProperty.call(u,x)&&(l=v(u,x),void 0!==l?u[x]=l:delete u[x]);return r.call(h,t,u)}var x;h=String(h);M.lastIndex=0;M.test(h)&&(h=h.replace(M,function(h){return"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return x=eval("("+h+")"),"function"===typeof r?v({"":x},""):x;throw new SyntaxError("JSON.parse");})})();
(function(h){function v(a){var b=a.match(/^[a-zA-Z\-]+:/);null!=b&&0<b.length?(this.scheme=b[0].substring(0,b[0].length-1),a=a.substring(b[0].length)):this.scheme=null;"//"==a.substring(0,2)?(this.doubleSlash=!0,a=a.substring(2)):this.doubleSlash=!1;b=a.indexOf("#");if(0<=b){var d;d=a.substring(b+1);-1!=d.indexOf("?")?(d.isQuery=!1,d=void 0):d=B(d);this.fragment=d;a=a.substring(0,b)}else this.hash=null;b=a.indexOf("?");0<=b?(d=a.substring(b+1),this.query=B(d),a=a.substring(0,b)):this.query=null;b=
a.indexOf("@");if(0<=b){d=a.substring(0,b);var m=d.indexOf(":");-1==m?(this.username=d,this.password=null):(this.username=d.substring(0,m),this.password=d.substring(m+1));a=a.substring(b+1)}else this.password=this.username=null;b=0;if(null!=this.scheme||this.doubleSlash)b=a.indexOf("/");0<=b?(this.path=a.substring(b),""==this.path&&(this.path=null),a=a.substring(0,b)):this.path=null;m=a.indexOf(":");0<=m?(this.port=a.substring(m+1),a=a.substring(0,m)):this.port=null;this.domain=""==a?null:a}function B(a){for(var b=
a.split("&"),d=[],m=0;m<b.length;m++){var p=b[m],c=p.indexOf("=");if(-1==c)d.push({key:p});else{var G=p.substring(0,c),p=p.substring(c+1);d.push({key:G,value:decodeURIComponent(p)})}}for(G in U)d[G]=U[G];var f=JSON.stringify(d);d.toString=function(){return JSON.stringify(this)==f?a:U.toString.call(this)};d.isQuery=!0;return d}function M(a){var b="";ka[a.charAt(0)]&&(b=a.charAt(0),a=a.substring(1));var d=",",m="",p=!0,c=!1;"+"==b?p=!1:"."==b?d=m=".":"/"==b?d=m="/":"#"==b?(m="#",p=!1):";"==b?(d=m=";",
c=!0):"?"==b?(m="?",d="&",c=!0):"&"==b&&(d=m="&",c=!0);b=[];a=a.split(",");for(var G=[],f=0;f<a.length;f++){var e=a[f],g=null;-1!=e.indexOf(":")&&(g=e.split(":"),e=g[0],g=parseInt(g[1]));for(var h={};la[e.charAt(e.length-1)];)h[e.charAt(e.length-1)]=!0,e=e.substring(0,e.length-1);G.push({truncate:g,name:e,suffices:h});b.push(e)}a=function(a){for(var b=m,f=0;f<G.length;f++){var e=G[f];0<f&&(b+=d);var H=a(e.name);if(Array.isArray(H)){c&&(b+=e.name+"=");for(var g=0;g<H.length;g++)0<g&&(b+=e.suffices["*"]?
d:",",e.suffices["*"]&&c&&(b+=e.name+"=")),b+=p?encodeURIComponent(H[g]).replace("!","%21"):encodeURI(H[g]).replace("%25","%")}else if("object"==typeof H){c&&!e.suffices["*"]&&(b+=e.name+"=");var g=!0,N;for(N in H)g||(b+=e.suffices["*"]?d:","),g=!1,b+=p?encodeURIComponent(N).replace("!","%21"):encodeURI(N).replace("%25","%"),b+=e.suffices["*"]?"=":",",b+=p?encodeURIComponent(H[N]).replace("!","%21"):encodeURI(H[N]).replace("%25","%")}else c&&(b+=e.name+"="),null!=e.truncate&&(H=H.substring(0,e.truncate)),
b+=p?encodeURIComponent(H).replace("!","%21"):encodeURI(H).replace("%25","%")}return b};a.varNames=b;return a}function K(a){a=a.split("{");for(var b=[a.shift()],d=[],m=[];0<a.length;){var p=a.shift(),c=p.split("}")[0],p=p.substring(c.length+1),c=M(c);d.push(c);b.push(p);m=m.concat(c.varNames)}this.fill=function(a){for(var m=b[0],p=0;p<d.length;p++)m+=(0,d[p])(a),m+=b[p+1];return m};this.varNames=m}function r(a,b){for(var d in b)(function(b,d){a[b]=function(){return d}})(d,b[d])}function E(a){this.contents=
{};this.keyOrder=[];this.context=a}function J(a){this.listeners=[];this.context=a}function C(a,b){var d=this;this.baseUrl=a.url;this.fragment=b;null==b&&(b="");this.url=this.baseUrl+"#"+encodeURI(b);this.getRoot=function(b){a.getRoot(function(a){b.call(a,a,d)})};this.getData=function(m){null==b||""==b?a.document.getRoot(function(a){m.call(a,a,d)}):a.document.getFragment(b,function(a){m.call(a,a,d)})};this.getRawResponse=function(b){a.getResponse(function(a){b.call(a,a,d)})}}function t(a,b,d,m,p,c){if(void 0==
a)throw Error("URL cannot be undefined");a=n.resolveRelativeUri(a);void 0==b&&(b="GET");void 0===d&&(d={});var f=null,e=a.indexOf("#");0<=e&&(f=decodeURI(a.substring(e+1)),a=a.substring(0,e));void 0==m&&(m="GET"==b?"application/x-www-form-urlencoded":"POST"==b||"PUT"==b?"application/json":"application/x-www-form-urlencoded");void 0==p&&(p=h.defaultCache);var g=p&&"GET"==b&&"application/x-www-form-urlencoded"==m;if(g){var N=JSON.stringify(a)+":"+JSON.stringify(d),e=p(N);if(void 0!=e)return{request:e,
fragmentRequest:new C(e,f)}}a=new A(a,b,d,m,c,function(a){g&&p(N,a)});return{request:a,fragmentRequest:new C(a,f)}}function L(a){this.httpCode=a;this.message="HTTP Status: "+a}function A(a,b,d,m,p,c){c(this);a=n.resolveRelativeUri(a);d=n.encodeData(d,m);"GET"==b&&""!=d&&(a=-1==a.indexOf("?")?a+"?":a+"&",a+=d,d="");n.log(n.logLevel.STANDARD,"Sending request for: "+a);this.successful=void 0;this.error=null;this.url=a;c=void 0==d||""==d;this.responseListeners=new J(this);this.document=new F(a,c,!0);
this.fetched=!1;this.fetchData(a,b,d,m,p);this.invalidate=function(){"GET"==b&&this.fetchData(a,b,d,m,p)}}function x(a,b,d,m,p){m(p,this);var c=this;this.url=a;this.responseListeners=new J(this);this.document=new F(a,!0,!0);this.document.setRaw(b);this.profileUrl=d;void 0!=d&&this.document.raw.addSchema(d);a==d?this.document.setRoot(""):this.document.raw.whenSchemasStable(function(){var a=c.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),c.document.setRoot(a)):
c.document.setRoot("")});this.successful=!0;this.error=null;this.fetched=!1;this.invalidate=function(){this.fetchData(a,"GET",void 0,"application/x-www-form-urlencoded",d)}}function w(a){this.operations=[];void 0==a&&(a="");this.prefix=a}function y(a,b,d){this._patchType=a;this._subject=b;this._subjectValue=void 0;"move"==a?this._target=d:this._value=d}function F(a,b,d){function m(a){I.increment();var b=da.concat(f);I.add(function(){for(var d=0;d<b.length;d++)b[d].call(p,a,p)});I.decrement()}var p=
this;this.readOnly=!!d;this.isDefinitive=!!b;this.url=a;var c=this.error=null;this.rootPath=function(){return c};var e={};this.raw=new l(this,e);this.uniqueId=this.raw.uniqueId;this.root=null;var f=[];this.registerChangeListener=function(a){f.push(a)};this.setRaw=function(a){var b=this.raw.defined();e.setValue(a);b&&(e.setValue(a),b=new w,b.replace(this.raw.pointerPath(),a),m(b))};var g=new J(this);this.getRoot=function(a){null==this.root?g.add(a):a.call(this,this.root)};this.setRoot=function(a){c=
a;this.root=this.raw.subPath(a);g.notify(this.root)};this.patch=function(a){if(this.readOnly)throw Error("Cannot update read-only document");if(V)void 0==this.batchPatch&&(this.batchPatch=new w,W.push(this)),this.batchPatch.operations=this.batchPatch.operations.concat(a.operations);else{I.increment();var b=a.filter("?"),d=a.filterRemainder("?");this.raw.patch(b);this.root.patch(d);m(a);I.decrement()}};this.affectedData=function(a){for(var b=a.subject(),d=null,d="?"==b||"?/"==b.substring(0,2)?this.raw.subPath(b.substring(1)):
this.root.subPath(b),b=[];void 0!=d;)b.push(d),d=d.parent();if("move"==a.action())for(a=a.target(),d=null,d="?"==a||"?/"==a.substring(0,2)?this.raw.subPath(a.substring(1)):this.root.subPath(a),b.push();void 0!=d;)b.push(d),d=d.parent();return b}}function l(a,b,d,m){this.uniqueId=ma++;this.document=a;this.readOnly=function(b){return b||void 0===b?a.readOnly||this.schemas().readOnly()||void 0!=d&&d.readOnly(!0):a.readOnly};var p=void 0,c=void 0,e=0,f=[],g={},h={};this.property=function(a){void 0==g[a]&&
(h[a]={},g[a]=new l(this.document,h[a],this,a),"object"==c&&(h[a].setValue(p[a]),void 0!==p[a]&&b.schemas.addSchemasForProperty(a,g[a])));return g[a]};var q={},z={};this.item=function(a){if(!Q.test(a))throw Error("Index must be a positive integer (or integer-value string)");void 0==q[a]&&(z[a]={},q[a]=new l(this.document,z[a],this,a),"array"==c&&(z[a].setValue(p[a]),void 0!==p[a]&&b.schemas.addSchemasForIndex(a,q[a])));return q[a]};this.parent=function(){return d};this.parentKey=function(){return m};
this.pointerPath=function(){return this.document.root==this?"":void 0!=d?d.pointerPath()+"/"+n.encodePointerComponent(m):"?"};this.basicType=function(){return c};this.value=function(){if("object"==c){for(var a={},b=0;b<f.length;b++){var d=f[b];a[d]=void 0!=g[d]?g[d].value():p[d]}return a}if("array"==c){a=[];for(b=0;b<e;b++)a[b]=void 0!=q[b]?q[b].value():p[b];return a}return p};this.keys=function(){return f.slice(0)};this.length=function(){return e};this.patch=function(a){var d=this,m=this.pointerPath(),
s={};a.each(function(a,n){if(n.subjectEquals(m))if("replace"==n.action()||"add"==n.action())n.setSubjectValue(d.value()),b.setValue(n.value());else{if("remove"!=n.action()&&"move"!=n.action())throw Error("Unrecognised patch operation: "+n.action());}else if(n.targetEquals(m))"move"==n.action()&&b.setValue(n.subjectValue());else{var k=n.subjectChild(m);if("string"==typeof k)if(s[k]=!0,"object"==c)if("add"==n.action()){var l=f.indexOf(k);if(-1!=l)throw Error("Cannot add existing key: "+k);f.push(k);
p[k]=n.value();void 0!=g[k]&&(h[k].setValue(n.value()),b.schemas.addSchemasForProperty(k,g[k]))}else if("remove"==n.action()||"move"==n.action()){l=f.indexOf(k);if(-1==l)throw Error("Cannot delete missing key: "+k);n.setSubjectValue(d.propertyValue(k));f.splice(l,1);void 0!=h[k]&&h[k].setValue(void 0);delete p[k]}else{if("replace"!=n.action())throw Error("Unrecognised patch operation: "+n.action());}else if("array"==c){if(!Q.test(k))throw Error("Cannot patch non-numeric index: "+k);l=parseInt(k);
if("add"==n.action()){if(l>e)throw Error("Cannot add past the end of the list");for(k=e-1;k>=l;k--)void 0!=z[k+1]&&(void 0==q[k]?z[k+1].setValue(p[k]):z[k+1].setValue(q[k].value()));p.splice(l,0,n.value());e++;void 0!=q[p.length-1]&&b.schemas.addSchemasForIndex(p.length-1,q[p.length-1])}else if("remove"==n.action()||"move"==n.action()){if(l>=e)throw Error("Cannot remove a non-existent index");n.setSubjectValue(d.itemValue(l));for(k=l;k<e-1;k++)void 0!=z[k]&&(void 0==q[k+1]?z[k].setValue(p[k+1]):z[k].setValue(q[k+
1].value()));void 0!=z[e-1]&&z[e-1].setValue(void 0);e--;p.splice(l,1)}else if("replace"!=n.action())throw Error("Unrecognised patch operation: "+n.action());}k=n.targetChild(m);if("string"==typeof k)if(s[k]=!0,"object"==c){if("move"==n.action()){l=f.indexOf(k);if(-1!=l)throw Error("Cannot move to existing key: "+k);f.push(k);p[k]=n.subjectValue();void 0!=g[k]&&b.schemas.addSchemasForProperty(k,g[k])}}else if("array"==c){if(!Q.test(k))throw Error("Cannot patch non-numeric index: "+k);l=parseInt(k);
if("move"==n.action()){if(l>e)throw Error("Cannot add past the end of the list");for(k=e-1;k>=l;k--)void 0!=z[k+1]&&(void 0==q[k]?z[k+1].setValue(p[k]):z[k+1].setValue(q[k].value()));p.splice(l,0,n.subjectValue());e++;void 0!=q[p.length-1]&&b.schemas.addSchemasForIndex(p.length-1,q[p.length-1])}}}});if("object"==c)for(var k=0;k<f.length;k++){var l=f[k],r=a.filter("/"+n.encodePointerComponent(l));r.isEmpty()||this.property(l).patch(r)}else if("array"==c)for(k=0;k<e;k++)r=a.filter("/"+n.encodePointerComponent(k)),
r.isEmpty()||this.index(k).patch(r);for(l in s)b.schemas.update(l)};b.setValue=function(a){var d=n.guessBasicType(a,c),m=p;p=a;if(d!=c){if("object"==c)for(var k in g)h[k].setValue(void 0);else if("array"==c)for(var s in q)z[s].setValue(void 0);c=d}if("object"==d){for(k in g)a.hasOwnProperty(k)?(g[k].defined()||b.schemas.addSchemasForProperty(k,g[k]),h[k].setValue(a[k])):h[k].setValue(void 0);f=Object.keys(a);e=0}else if("array"==d){for(s in q)s<a.length?(q[s].defined()||b.schemas.addSchemasForIndex(s,
q[s]),z[s].setValue(a[s])):z[s].setValue(void 0);f=[];e=a.length}else f=[],e=0;void 0===a?void 0!==m&&b.schemas.clear():b.schemas.update(null)};b.schemas=new ea(this);this.schemas=function(){return b.schemas.getSchemas()};this.whenSchemasStable=function(a){b.schemas.whenSchemasStable(a);return this};this.links=function(a){return b.schemas.getLinks(a)};this.addLink=function(a){b.schemas.addLink(a);return this};this.addSchema=function(a,d){var m=this;a instanceof k?a.each(function(a,b){m.addSchema(b,
d)}):b.schemas.addSchema(a,d);return this};this.removeSchema=function(a){b.schemas.removeSchema(a);return this};this.addSchemaMatchMonitor=function(a,d,m,p,c){return b.schemas.addSchemaMatchMonitor(a,d,m,p,c)}}function u(a,b){return h.getData(a).getRawResponse(function(a,m){m.fragment&&(a=a.subPath(m.fragment));var p=a.asSchema();p.referenceUrl=function(){return m.url};void 0!=b&&b.call(p,p,m)})}function P(a){void 0==X[a]&&(X[a]=h.createSchema({type:a}));return X[a]}function D(a){this.data=a;a.referenceUrl();
a.propertyValue("id");var b=[];a=a.property("links");void 0!==a&&a.indices(function(a,m){b[b.length]=new O(m)});this.links=function(a){for(var m=[],p=0;p<b.length;p++){var c=b[p];void 0!=a&&c.rel!=a||m.push(c)}return m};this.schemaTitle=this.title()}function O(a){this.data=a;var b=K,d;d=a.propertyValue("href");if("{@}"==d)d="{+%73elf}";else{for(var m=[],p=!1,T=!1,e=0;e<d.length;e++){var f=d.charAt(e);p?T?")"==f?")"==d.charAt(e+1)?(m.push(Y[")"]),e++):T=!1:void 0!=Y[f]?m.push(Y[f]):m.push(encodeURIComponent(f)):
"$"==f?m.push("%73elf"):"("==f?")"==d.charAt(e+1)?(m.push("%65mpty"),e++):T=!0:("}"==f&&(p=!1),m.push(f)):("{"==f&&(p=!0),m.push(f))}d=m.join("")}this.uriTemplate=new b(d);this.dataParts=[];for(b=0;b<this.uriTemplate.varNames.length;b++)this.dataParts.push(c(this.uriTemplate.varNames[b]));b=a.property("schema");b.defined()?(b=b.asSchema(),this.submissionSchemas=new k([b])):this.submissionSchemas=new k;a=a.property("targetSchema");a.defined()&&(this.targetSchema=a.asSchema());this.handlers=[];this.preHandlers=
[]}function c(a){return"%65mpty"==a?"":"%73elf"==a?null:decodeURIComponent(a)}function f(a,b,d){this.rawLink=a;this.definition=b;this.subjectData=d;this.href=a.href;b=this.href.indexOf("#");0<=b?(this.hrefBase=this.href.substring(0,b),this.hrefFragment=this.href.substring(b+1)):(this.hrefBase=this.href,this.hrefFragment="");this.rel=a.rel;this.title=a.title;this.method=void 0!=a.method?a.method:"edit"==a.rel?"PUT":"create"==a.rel?"POST":"delete"==a.rel?"DELETE":"GET";void 0!=a.enctype&&(a.encType=
a.enctype,delete a.enctype);this.encType=void 0==a.encType?"GET"==this.method?"application/x-www-form-urlencoded":"POST"==this.method||"PUT"==this.method?"application/json":"application/x-www-form-urlencoded":a.encType;null!=this.definition&&(this.submissionSchemas=this.definition.submissionSchemas,this.targetSchema=this.definition.targetSchema)}function e(a,b,d,m){var c=this;this.monitorKey=a;this.match=!1;this.matchFailReason=new g("initial failure",null);this.monitors=new E(d);this.impatientCallbacks=
m;this.propertyMatches={};this.indexMatches={};this.dependencies={};this.dependencyKeys={};this.schemaLoaded=!1;this.data=b;d.getFull(function(a){c.schemaLoaded=!0;c.schema=a;c.basicTypes=a.basicTypes();c.setupXorSelectors();c.setupOrSelectors();c.setupAndMatches();c.setupNotMatches();c.dataUpdated()})}function g(a,b,d){this.message=a;this.schema=b;this.subMatchFailReason=d}function z(a,b,d){var m=this;this.options=b;this.selectedOption=this.matchCallback=null;this.data=d;this.subMatches=[];this.subSchemaKeys=
[];for(var c=0;c<b.length;c++)this.subSchemaKeys[c]=n.getKeyVariant(a,"option"+c),this.subMatches[c]=d.addSchemaMatchMonitor(this.subSchemaKeys[c],b[c],function(){m.update()},!1,!0);this.update()}function q(a,b,d){var m=this;this.options=b;this.matchCallback=null;this.selectedOptions=[];this.data=d;this.subMatches=[];this.subSchemaKeys=[];for(var c=0;c<b.length;c++)this.subSchemaKeys[c]=n.getKeyVariant(a,"option"+c),this.subMatches[c]=d.addSchemaMatchMonitor(this.subSchemaKeys[c],b[c],function(){m.update()},
!1,!0);this.update()}function s(){Z=!1;var a=[],b;for(b in R){var d=R[b];a.push({data:d,pointerPath:d.pointerPath()})}R={};a.sort(function(a,b){return a.pointerPath.length-b.pointerPath.length});b=[];for(d=0;d<a.length;d++)b[d]=a[d].data;for(d=0;d<aa.length;d++)aa[d].call(null,b)}function ba(a){for(var b=0;b<a.length;b++)this[b]=a[b];this.length=a.length}function k(a,b){if(void 0==a)this.length=0;else{void 0==b&&(b=a);this.fixed=function(){var d=b.length<a.length?new k(b):this;this.fixed=function(){return d};
return d};var d;for(d=0;d<a.length;d++)this[d]=a[d];this.length=a.length}}function ea(a){this.dataObj=a;this.schemas={};this.schemasFixed={};this.links={};this.matches={};this.xorSelectors={};this.orSelectors={};this.dependencySelectors={};this.schemaFlux=0;this.schemasStable=!0;this.schemasStableListeners=new J(a);this.pendingNotify=!1;this.cachedLinkList=this.cachedSchemaList=null}function fa(a,b){this.dataObj=a;this.potentialLink=b;this.active=!1;this.rawLink=null;this.updateMonitors=new E(a)}
function na(a,b,d,m){var c=n.getKeyVariant(b,"$");this.xorSelector=new z(b,a,m.dataObj);this.xorSelector.onMatchChange(function(b){m.removeSchema(c);null!=b?m.addSchema(b,c,d,!1):0<a.length&&m.addSchema(a[0],c,d,!1)})}function oa(a,b,d,m){for(var c=[],e=[],f=0;f<a.length;f++)c[f]=n.getKeyVariant(b,"$"+f),e[f]=!1;this.orSelector=new q(b,a,m.dataObj);this.orSelector.onMatchChange(function(b){for(var f=0;f<a.length;f++){for(var g=!1,G=0;G<b.length;G++)if(a[f]==b[G]){g=!0;break}g&&!e[f]?m.addSchema(a[f],
c[f],d,!1):!g&&e[f]&&m.removeSchema(c[f]);e[f]=g}0==b.length&&0<a.length&&m.addSchema(a[0],c[0],d,!1)})}function ga(a,b,d,m){this.inferredSchemaKeys={};this.applied={};this.schema=a;this.schemaKeyHistory=d;this.schemaSet=m;a=this.schema.data.property("dependencies").keys();for(d=0;d<a.length;d++)m=a[d],this.inferredSchemaKeys[m]=n.getKeyVariant(b,"$"+d),this.dataUpdated(m)}h.toString=function(){return"<Jsonary>"};h.plugins={};v.prototype={toString:function(){var a="";null!=this.scheme&&(a+=this.scheme+
":");this.doubleSlash&&(a+="//");null!=this.username&&(a+=this.username,null!=this.password&&(a+=":"+this.password),a+="@");null!=this.domain&&(a+=this.domain);null!=this.port&&(a+=":"+this.port);null!=this.path&&(a+=this.path);null!=this.query&&(a+="?"+this.query);null!=this.fragment&&(a+="#"+this.fragment);return a},resolve:function(a){a=new v(a+"");if(null==a.scheme&&(a.scheme=this.scheme,a.doubleSlash=this.doubleSlash,null==a.domain))if(a.domain=this.domain,a.port=this.port,a.username=this.username,
a.password=this.password,null==a.path)a.path=this.path,null==a.query&&(a.query=this.query);else if("/"!=a.path.charAt(0)&&null!=this.path){var b="/"==this.path.charAt(0),d;d=b?this.path.substring(1).split("/"):this.path.split("/");".."==d[d.length-1]&&d.push("");d.pop();for(var m=d.length-1;0<=m;m--)"."==d[m]&&d.slice(m,1);for(var c=a.path.split("/"),m=0;m<c.length;m++){var f=c[m];if("."!=f)if(".."==f)if(0<d.length&&".."!=d[d.length-1])d.pop();else{if(!b){d=d.concat(c.slice(m));break}}else d.push(f)}a.path=
(b?"/":"")+d.join("/")}return a.toString()}};h.baseUri=null;v.resolve=function(a,b){if(void 0==b)if(b=a,h.baseUri)a=h.baseUri;else if("undefined"!=typeof window)a=window.location.href;else return a;if(void 0==a)return b;a instanceof v||(a=new v(a));return a.resolve(b)};v.parse=function(a){return new v(a)};var U={toString:function(){for(var a=[],b=0;b<this.length;b++)"undefined"==typeof this[b].value?a.push(this[b].key):a.push(this[b].key+"="+encodeURIComponent(this[b].value));return a.join("&")},
get:function(a,b){for(var d=0;d<this.length;d++)if(this[d].key==a)return this[d].value;return b},set:function(a,b){for(var d=0;d<this.length;d++)if(this[d].key==a){this[d].value=b;return}this.push({key:a,value:b})}};h.Uri=v;var ka={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},la={"*":!0},n={guessBasicType:function(a,b){if(null===a)return"null";if(Array.isArray(a))return"array";if("object"==typeof a)return"object";if("string"==typeof a)return"string";if("number"==typeof a)return 0==a%1?"integer":
"number";if("boolean"==typeof a)return"boolean"},resolveRelativeUri:function(a,b){return v.resolve(a,b)},urlsEqual:function(a,b){"#"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));"#"==b.charAt(b.length-1)&&(b=b.substring(0,b.length-1));return a==b},linksEqual:function(a,b){if(void 0==a||void 0==b)return a==b;if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++){var m=a[d],c=b[d];if(m.href!=c.href||m.rel!=c.rel||(m.method!=c.method||m["enc-type"]!=c["enc-type"])||m.schema!=c.schema)return!1}return!0},
log:function(a,b){try{a>=n.logLevel.ERROR&&(window.alert("ERROR: "+b),console.log("ERROR: "+b),console.trace()),a>=n.logLevel.WARNING&&console.log("WARNING: "+b)}catch(d){}},logLevel:{DEBUG:-1,STANDARD:0,WARNING:1,ERROR:2},getKeyVariant:function(a,b){void 0==b&&(b=n.getUniqueKey());b+="";if(0<=b.indexOf("."))throw Error("variant name cannot contain a dot: "+b);return a+"."+b},keyIsVariant:function(a,b){a+="";b+="";return a===b||a.substring(0,b.length+1)===b+"."},keyIsRoot:function(a){return-1==a.indexOf(".")},
hcf:function(a,b){a=Math.abs(a);for(b=Math.abs(b);;){var d=a%b;if(0==d)return b;if(isNaN(d))return NaN;a=b;b=d}},recursiveCompare:function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(!n.recursiveCompare(a[d],b[d]))return!1;return!0}if("object"==typeof a){for(d in a)if(void 0===b[d]&&void 0!==a[d])return!1;for(d in b)if(void 0===a[d]&&void 0!==a[d])return!1;for(d in a)if(!n.recursiveCompare(a[d],b[d]))return!1;return!0}return a===b},lcm:function(a,
b){return Math.abs(a*b/this.hcf(a,b))},encodeData:function(a,b,d){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.stringify(a);if("application/x-www-form-urlencoded"==b)return"dotted"==d?n.formEncode(a,"",".","","|").replace(/%20/g,"+").replace(/%2F/g,"/"):"pretty"==d?n.formEncode(a,"","[","]").replace(/%20/g,"+").replace(/%2F/g,"/").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%7C/g,"|"):n.formEncode(a,"","[","]").replace(/%20/g,"+");throw Error("Unknown encoding type: "+
this.encType);},decodeData:function(a,b,d){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.parse(a);if("application/x-www-form-urlencoded"==b)return a=a.replace(/\+/g,"%20"),"dotted"==d?n.formDecode(a.replace(/%7C/g,"|"),".","","|"):n.formDecode(a,"[","]");throw Error("Unknown encoding type: "+this.encType);},formEncode:function(a,b,d,m,c){void 0==b&&(b="");var f=[];if(Array.isArray(a))for(var e=0;e<a.length;e++){var g=""==b?e:b+encodeURIComponent(d+m),h=""==
b?e:b+encodeURIComponent(d+e+m),k=a[e];null==k?f.push(g+"=null"):"object"==typeof k?(k=n.formEncode(k,h,d,m,c))&&f.push(k):"boolean"==typeof k?k?f.push(g+"=true"):f.push(g+"=false"):""===k?f.push(g):f.push(g+"="+encodeURIComponent(k))}else if("object"==typeof a)for(g in a){if(a.hasOwnProperty(g)&&(k=a[g],g=""!=b?b+encodeURIComponent(d+g+m):encodeURIComponent(g),void 0!==k))if(null===k)f.push(g+"=null");else if(c&&Array.isArray(k)){if(0<k.length){for(e=[];e.length<k.length;)e[e.length]=encodeURIComponent(k[e.length]);
e=c+e.join(c);f.push(g+"="+e)}}else"object"==typeof k?(k=n.formEncode(k,g,d,m,c))&&f.push(k):"boolean"==typeof k?k?f.push(g+"=true"):f.push(g+"=false"):""===k?f.push(g):f.push(g+"="+encodeURIComponent(k))}else f.push(encodeURIComponent(a));return f.join("&")},formDecodeString:function(a){"true"==a?a=!0:"false"==a?a=!1:"null"==a?a=null:parseFloat(a)+""==a&&(a=parseFloat(a));return a},formDecode:function(a,b,d,m){var c={};a=a.split("&");for(var f=0;f<a.length;f++){var e=a[f],g=e,k="";if(0<=e.indexOf("="))if(g=
e.substring(0,e.indexOf("=")),k=decodeURIComponent(e.substring(e.indexOf("=")+1)),m&&k.charAt(0)==m)for(k=k.split(m),k.shift(),e=0;e<k.length;e++)k[e]=n.formDecodeString(k[e]);else k=n.formDecodeString(k);for(var g=decodeURIComponent(g),h=c,g=g.split(b),e=1;e<g.length;e++)g[e]=g[e].substring(0,g[e].length-d.length);for(e=0;e<g.length;e++)Array.isArray(h)&&""==g[e]&&(g[e]=h.length),e==g.length-1?h[g[e]]=k:(void 0==h[g[e]]&&(h[g[e]]=""==g[e+1]?[]:{}),h=h[g[e]])}return c},escapeHtml:function(a){return(a+
"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},encodePointerComponent:function(a){return a.toString().replace("~","~0").replace("/","~1")},decodePointerComponent:function(a){return a.toString().replace("~1","/").replace("~0","~")},splitPointer:function(a){a=a.split("/");""==a[0]&&a.shift();for(var b=0;b<a.length;b++)a[b]=n.decodePointerComponent(a[b]);return a},joinPointer:function(a){for(var b="",d=0;d<a.length;d++)b+="/"+n.encodePointerComponent(a[d]);
return b},prettyJson:function(a){function b(a){try{for(var b=JSON.stringify(JSON.parse(a)).split('"'),c=0;c<b.length;c++){var e=b[c],e=e.replace(/:/g,": "),e=e.replace(/,/g,", ");b[c]=e;for(c++;c<b.length&&"\\"==b[c].charAt(b[c].length-1);)c++}return b.join('"')}catch(f){return a}}a=JSON.stringify(a,null,"\t");a=a.replace(/\{[^\{,}]*\}/g,b);a=a.replace(/\[[^\[,\]]*\]/g,b);return a=a.replace(/\[[^\{\[\}\]]*\]/g,b)}};(function(){var a=0;n.getUniqueKey=function(){return a++}})();h.getMonitorKey=n.getUniqueKey;
h.getKeyVariant=function(a,b){return n.getKeyVariant(a,"~"+b)};h.keyIsVariant=n.keyIsVariant;h.log=function(a,b){if("number"!=typeof a)throw alert("First argument to log() must be a number (preferably enum value from .logLevel)"),Error("First argument to log() must be a number (preferably enum value from .logLevel)");n.log(a,b)};h.setLogFunction=function(a){n.log=a};h.logLevel=n.logLevel;h.encodeData=n.encodeData;h.decodeData=n.decodeData;h.encodePointerComponent=n.encodePointerComponent;h.decodePointerComponent=
n.decodePointerComponent;h.splitPointer=n.splitPointer;h.joinPointer=n.joinPointer;h.escapeHtml=n.escapeHtml;h.prettyJson=n.prettyJson;h.extend=function(a){for(var b in a)void 0==h[b]&&(h[b]=a[b])};E.prototype={add:function(a,b){if("string"!=typeof a&&"number"!=typeof a)throw Error("First argument must be a monitorKey, obtained using getMonitorKey()");this.contents[a]=b;this.addKey(a)},addKey:function(a){var b;for(b=0;b<this.keyOrder.length;b++){var d=this.keyOrder[b];if(d==a)return;if(n.keyIsVariant(a,
d)){this.keyOrder.splice(b,0,a);return}}this.keyOrder.push(a)},remove:function(a){delete this.contents[a];this.removeKey(a);a+=".";for(var b in this.contents)b.substring(0,a.length)==a&&(this.removeKey(b),delete this.contents[b])},removeKey:function(a){a=this.keyOrder.indexOf(a);0<=a&&this.keyOrder.splice(a,1)},notify:function(){for(var a=arguments,b=0;b<this.keyOrder.length;b++)this.contents[this.keyOrder[b]].apply(this.context,a)},isEmpty:function(){for(var a in this.contents)if(0!==this.contents[a].length)return!1;
return!0}};J.prototype={add:function(a){this.listeners[this.listeners.length]=a},notify:function(){for(var a=arguments;0<this.listeners.length;)this.listeners.shift().apply(this.context,a)},isEmpty:function(){return 0===this.listeners.length}};var I={depth:0,callbacks:[],increment:function(){this.depth++},decrement:function(){this.depth--;if(0>this.depth)throw Error("DelayedCallbacks.depth cannot be < 0");for(;0==this.depth&&0<this.callbacks.length;){var a=this.callbacks.shift();this.depth++;a();
this.depth--}},add:function(a){this.depth++;this.callbacks.push(a);this.decrement()}};"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(d){}throw Error("This browser does not support XMLHttpRequest.");});h.ajaxFunction=function(a,b){var d=a.url,c=a.data,p=a.encType,e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==
e.readyState)if(200<=e.status&&300>e.status){var a=e.responseText||null;try{a=JSON.parse(a)}catch(d){if(204!=e.status){b(d,a);return}a=null}var c=e.getAllResponseHeaders();if(""==c){for(var c=[],m="Cache-Control Content-Language Content-Type Expires Last-Modified Pragma".split(" "),p=0;p<m.length;p++){var f=e.getResponseHeader(m[p]);""!=f&&null!=f&&c.push(m[p]+": "+f)}c=c.join("\n")}b(null,a,c)}else{a=e.responseText||null;try{a=JSON.parse(a)}catch(g){}c=e.getAllResponseHeaders();if(""==c){c=[];m=
"Cache-Control Content-Language Content-Type Expires Last-Modified Pragma".split(" ");for(p=0;p<m.length;p++)f=e.getResponseHeader(m[p]),""!=f&&null!=f&&c.push(m[p]+": "+f);c=c.join("\n")}b(new L(e.status,e),a,c)}};e.open(a.method,d,!0);e.setRequestHeader("Content-Type",p);e.setRequestHeader("If-Modified-Since","Thu, 01 Jan 1970 00:00:00 GMT");e.send(c)};(function(){var a={};setInterval(function(){b.empty()},1E4);var b=function(b,c){if(void 0!==c)a[b]=c,(new Date).getTime();else return a[b]};b.cacheSeconds=
10;b.empty=function(a){};b.invalidate=function(b){"string"==typeof b&&(b=n.resolveRelativeUri(b));for(var c in a){var p=a[c],e=p.url;"string"==typeof b?-1!=e.indexOf(b)&&p.invalidate():b.test(e)&&p.invalidate()}};h.defaultCache=b;h.invalidate=b.invalidate})();C.prototype={};h.addToCache=function(a,b,d,c){a=n.resolveRelativeUri(a);void 0==c&&(c=h.defaultCache);var p=JSON.stringify(a)+":"+JSON.stringify({});new x(a,b,d,c,p)};h.getData=function(a,b,d){"string"==typeof a&&(a={url:a});a=t(a.url,a.method,
a.data,a.encType,null,d).fragmentRequest;void 0!=b&&a.getData(b);return a};h.isRequest=function(a){return a instanceof A||a instanceof C};var ca=n.getUniqueKey();L.prototype=Error();h.HttpError=L;A.prototype={beingUsed:function(){return void 0==this.baseContext?(n.log(n.logLevel.DEBUG,"No base context: "+this.url),!0):0<this.baseContext.retainCount()},getResponse:function(a){this.responseListeners.add(a);this.checkForFullResponse()},checkForFullResponse:function(){this.document.raw.defined()&&this.responseListeners.notify(this.document.raw,
this)},ajaxSuccess:function(a,b,d){this.fetched=!0;var c=this;c.successful=!0;n.log(n.logLevel.STANDARD,"Request success: "+this.url);var p=b.replace(/\r\n/g,"\n").split("\n"),e={},f=null,g={};for(b=0;b<p.length;b++){var k=p[b].split(": ")[0];if(""!=k){var h=p[b].substring(k.length+2);"\r"==h[h.length-1]&&(h=h.substring(0,h.length-1));for(var k=k.toLowerCase(),q=h.split(", "),f=0;f<q.length;f++)h=q[f],void 0==e[k]?e[k]=h:"object"==typeof e[k]?e[k].push(h):e[k]=[e[k],h]}}n.log(n.logLevel.DEBUG,"headers: "+
JSON.stringify(e,null,4));f=e["content-type"].split(";")[0];h=e["content-type"].substring(f.length+1).split(",");for(b=0;b<h.length;b++)p=h[b].split("=")[0],k=h[b].substring(p.length+1),p=p.trim(),""!=p&&(g[p]=k);c.headers=e;c.contentType=f;c.contentTypeParameters=g;c.document.setRaw(a);c.profileUrl=null;c.document.raw.removeSchema(ca);void 0!=g.profile?(b=g.profile,b=n.resolveRelativeUri(c.url,b),c.profileUrl=b,c.document.raw.addSchema(b,ca)):void 0!=d&&c.document.raw.addSchema(d,ca);void 0!=g.root&&
(a={href:g.root,rel:"root"},c.document.raw.addLink(a));if(e.link)for(e="object"==typeof e.link?e.link:[e.link],b=0;b<e.length;b++){a=e[b];a=a.trim().split(";");d=a.shift().trim();d=d.substring(1,d.length-1);d={href:d};for(f=0;f<a.length;f++)h=a[f],g=h.substring(0,h.indexOf("=")),h=h.substring(g.length+1),g=g.trim(),'"'==h.charAt(0)&&(h=JSON.parse(h)),"type"==g&&(g="mediaType"),d[g]=h;c.document.raw.addLink(d)}c.checkForFullResponse();c.waitingForRoot=!0;c.document.raw.whenSchemasStable(function(){delete c.waitingForRoot;
var a=c.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),c.document.setRoot(a)):c.document.setRoot("")})},ajaxError:function(a,b){this.fetched=!0;var d=this;d.successful=!1;d.error=a;n.log(n.logLevel.WARNING,"Error fetching: "+this.url+" ("+a.message+")");d.document.error=a;d.document.setRaw(b);d.document.raw.whenSchemasStable(function(){d.checkForFullResponse();d.document.setRoot("")})},fetchData:function(a,b,d,c,e){var f=this;"GET"!=b&&"DELETE"!=b||(void 0==
d||""==d)||(a=-1==a.indexOf("?")?a+"?":a+"&",a+=d,d=void 0);if(h.config.antiCacheUrls){var g="_="+Math.random();a=-1==a.indexOf("?")?a+("?"+g):a+("&"+g)}var k={url:a,data:d,encType:c,method:b};h.ajaxFunction(k,function(a,b,d){a?f.ajaxError(a,b):(f.ajaxSuccess(b,d,e),"PUT"==k.method&&h.invalidate(k.url))})}};x.prototype=A.prototype;w.prototype={isEmpty:function(){return 0==this.operations.length},each:function(a){for(var b=0;b<this.operations.length;b++)a.call(this,b,this.operations[b]);return this},
plain:function(){for(var a=[],b=0;b<this.operations.length;b++)a[b]=this.operations[b].plain();return a},condense:function(){},filterImmediate:function(){for(var a=new w(this.prefix),b=0;b<this.operations.length;b++){var d=this.operations[b];d.immediateChild(this.prefix)&&a.operations.push(d)}return a},filter:function(a){a=this.prefix+a;for(var b=new w(a),d=0;d<this.operations.length;d++){var c=this.operations[d];c.hasPrefix(a)&&b.operations.push(c)}return b},filterRemainder:function(a){a=this.prefix+
a;for(var b=new w(this.prefix),d=0;d<this.operations.length;d++){var c=this.operations[d];c.hasPrefix(a)||b.operations.push(c)}return b},replace:function(a,b){var d=new y("replace",a,b);this.operations.push(d);return this},add:function(a,b){var d=new y("add",a,b);this.operations.push(d);return this},remove:function(a){a=new y("remove",a);this.operations.push(a);return this},move:function(a,b){var d=new y("move",a,b);this.operations.push(d);return this},inverse:function(){for(var a=new w(this.prefix),
b=0;b<this.operations.length;b++)a.operations[b]=this.operations[b].inverse();a.operations.reverse();return a}};y.prototype={action:function(){return this._patchType},value:function(){return this._value},subject:function(){return this._subject},setSubjectValue:function(a){this._subjectValue=a;return this},subjectValue:function(){return this._subjectValue},inverse:function(){switch(this._patchType){case "replace":return new y("replace",this._subject,this._subjectValue);case "add":return(new y("remove",
this._subject)).setSubjectValue(this._value);case "remove":return new y("add",this._subject,this._subjectValue);case "move":return new y("move",this._target,this._subject);default:throw Error("Unrecognised patch type for inverse: "+this._patchType);}},depthFrom:function(a){"object"==typeof a&&(a=a.pointerPath());var b=NaN;if(this._subject.substring(0,a.length)==a){var d=this._subject.substring(a.length);0==d.length?b=0:"/"==d.charAt(0)&&(b=d.split("/").length)}if(void 0!=this._target&&this._target.substring(0,
a.length)==a){var c,d=this._target.substring(a.length);0==d.length?c=0:"/"==d.charAt(0)&&(c=d.split("/").length);!isNaN(c)&&c<b&&(b=c)}return b},subjectEquals:function(a){return this._subject==a},subjectChild:function(a){a+="/";return this._subject.substring(0,a.length)==a&&(a=this._subject.substring(a.length),-1==a.indexOf("/"))?n.decodePointerComponent(a):!1},subjectRelative:function(a){a+="/";return this._subject.substring(0,a.length)==a?this._subject.substring(a.length-1):!1},target:function(){return this._target},
targetEquals:function(a){return this._target==a},targetChild:function(a){if(void 0!=this._target)return a+="/",this._target.substring(0,a.length)==a&&(a=this._target.substring(a.length),-1==a.indexOf("/"))?n.decodePointerComponent(a):!1},targetRelative:function(a){a+="/";return this._target.substring(0,a.length)==a?this._target.substring(a.length-1):!1},plain:function(){var a={};a[this._patchType]=this._subject;"remove"!=this._patchType&&("move"==this._patchType?a.to=this._target:a.value=this._value);
return a},matches:function(a){return this._subject==a||"move"==this._patchType&&this._target==a?!0:!1},hasPrefix:function(a){"object"==typeof a&&(a=a.pointerPath());if(this.matches(a))return!0;a+="/";return this._subject.substring(0,a.length)==a||"move"==this._patchType&&this._target.substring(0,a.length)==a?!0:!1}};var da=[];h.registerChangeListener=function(a){da.push(a)};var V=!1,W=[];h.batch=function(a){if(void 0!=a)return h.batch(),a(),h.batchDone(),this;V=!0;return this};h.batchDone=function(){for(V=
!1;0<W.length;){var a=W.shift(),b=a.batchPatch;delete a.batchPatch;a.patch(b)}return this};F.prototype={resolveUrl:function(a){return v.resolve(this.url,a)},getFragment:function(a,b){this.getRoot(function(d){""!=a&&(d=d.subPath(a));b.call(this,d)})},get:function(a){return this.root.get(a)},set:function(a,b){this.root.set(a,b);return this},move:function(a,b){var d=new w;d.move(a,b);this.patch(d);return this}};var Q=/^(0|[1-9]\d*)$/,ma=0;l.prototype={referenceUrl:function(){if(this.document.isDefinitive){var a=
this.pointerPath();if(""==a||"/"==a.charAt(0))return this.document.url+"#"+encodeURI(this.pointerPath())}},subPath:function(a){var b=a.split("/");if(""!=b[0])throw Error("Path must begin with / (or be empty): "+a);a=this;for(var d=1;d<b.length;d++)b[d]=n.decodePointerComponent(b[d]),a="array"==a.basicType()?a.index(b[d]):a.property(b[d]);return a},defined:function(){return void 0!=this.basicType()},setValue:function(a){if("undefined"==typeof a)return this.remove();if("object"!=this.basicType()&&"array"!=
this.basicType()&&this.value()===a)return this;var b=new w;this.defined()?b.replace(this.pointerPath(),a):b.add(this.pointerPath(),a);this.document.patch(b,this);return this},remove:function(){var a=new w;a.remove(this.pointerPath());this.document.patch(a,this);return this},itemValue:function(a){return this.index(a).value()},removeItem:function(a){this.index(a).remove();return this},insertItem:function(a,b){if("array"!=this.basicType())throw Error("cannot insert into a non-array");var d=new w;d.add(this.item(a).pointerPath(),
b);this.document.patch(d,this);return this},push:function(a){if("array"==this.basicType())this.index(this.length()).setValue(a);else throw Error("Can only push() on an array");return this},propertyValue:function(a){return this.property(a).value()},removeProperty:function(a){this.property(a).remove();return this},moveTo:function(a){if("object"==typeof a){if(a.document!=this.document){var b=this.value();this.remove();a.setValue(b);return a}a=a.pointerPath()}var b=new w,d=this.pointerPath();if(a!=d)return b.move(d,
a),this.document.patch(b,this),this.document.root.subPath(a)},getLink:function(a){return this.links(a)[0]},equals:function(a){var b;b=this.basicType();if(b!=a.basicType())return!1;if("array"==b){if(this.length()!==a.length())return!1;for(b=0;b<this.length();b++)if(!this.index(b).equals(a.index(b)))return!1;return!0}if("object"==b){var d=this.keys(),c=a.keys();if(d.length!=c.length)return!1;d.sort();c.sort();for(b=0;b<d.length;b++)if(d[b]!==c[b])return!1;for(b=0;b<d.length;b++)if(c=d[b],!this.property(c).equals(a.property(c)))return!1;
return!0}return this.value()===a.value()},readOnlyCopy:function(){if(this.readOnly(!1))return this;var a=h.create(this.value(),this.document.url+"#:copy",!0);this.schemas().each(function(b,d){a.addSchema(d)});return a},editableCopy:function(){var a=h.create(this.value(),this.document.url+"#:copy",!1),b=n.getUniqueKey();this.schemas().fixed().each(function(d,c){a.addSchema(c,b)});return a},asSchema:function(){var a=new D(this.readOnlyCopy());this.readOnly(!1)&&r(this,{asSchema:a});return a},asLink:function(a){var b=
this.readOnlyCopy(),b=new O(b);a=void 0==a?b.linkForData(this):b.linkForData(a);this.readOnly(!1)&&r(this,{asLink:a});return a},items:function(a){for(var b=0;b<this.length();b++){var d=this.index(b);a.call(d,b,d)}return this},properties:function(a,b,d){"function"==typeof a&&(b=a,a=this.keys());if(b)for(var c=0;c<a.length;c++){var e=this.property(a[c]);b.call(e,a[c],e)}if(d)for("function"!=typeof d&&(d=b),b=this.keys(),c=0;c<b.length;c++)-1==a.indexOf(b[c])&&(e=this.property(b[c]),d.call(e,b[c],e));
return this},resolveUrl:function(a){for(var b=this;b;){var d=b.getLink("self");if(d)return v.resolve(d.href,a);b=b.parent()}return this.document.resolveUrl(a)},get:function(a){return this.subPath(a).value()},set:function(a,b){this.subPath(a).setValue(b);return this},json:function(){return JSON.stringify(this.value())}};l.prototype.indices=l.prototype.items;l.prototype.indexValue=l.prototype.itemValue;l.prototype.removeIndex=l.prototype.removeItem;l.prototype.index=function(a){return this.item(a)};
h.extendData=function(a){for(var b in a)void 0==l.prototype[b]&&(l.prototype[b]=a[b])};h.create=function(a,b,d){a="object"==typeof a?JSON.parse(JSON.stringify(a)):a;var c=void 0!=b&&d;void 0!=b&&-1!=b.indexOf("#")&&(""!=b.substring(b.indexOf("#")+1)&&(c=!1),b=b.substring(0,b.indexOf("#")));b=new F(b,c,d);b.setRaw(a);b.setRoot("");return b.root};h.isData=function(a){return a instanceof l};l.prototype.deflate=function(){this.document.deflate();return{document:this.document.deflate(),path:this.pointerPath()}};
F.prototype.deflate=function(a){if(this.isDefinitive)return this.url;a=this.raw;var b=[];a.schemas().each(function(a,c){void 0!=c.referenceUrl()?b.push(c.referenceUrl()):b.push(c.data.deflate())});return{baseUrl:this.url,readOnly:this.readOnly,value:a.value(),schemas:b,root:this.rootPath()}};h.inflate=function(a,b){if(void 0!==a.path&&void 0!==a.document)return h.inflate(a.document).root.subPath(a.path);if("string"==typeof a){var d=t(a).request;b&&d.document.getRoot(function(a){a.whenSchemasStable(function(){b(null,
d.document)})});return d.document}for(var c=h.create(a.value,a.baseUrl,a.readOnly),e=0;e<a.schemas.length;e++){var f=a.schemas[e];"object"==typeof f&&(f=h.inflate(f).asSchema());c.addSchema(f)}c.document.setRoot(a.root);c=c.document;b&&b(null,c);return c};h.createSchema=function(a,b){return h.create(a,b,!0).asSchema()};h.isSchema=function(a){return a instanceof D};h.getSchema=u;var S="null boolean integer number string array object".split(" "),X={};D.prototype={toString:function(){return"<Schema "+
this.data+">"},referenceUrl:function(){return this.data.referenceUrl()},isFull:function(){return void 0===this.data.propertyValue("$ref")},getFull:function(a){var b=this.data.propertyValue("$ref");if(void 0===b)return a&&a.call(this,this,void 0),this;b=this.data.resolveUrl(b);if("#"!=b.charAt(0)||1!=b.length&&"/"!=b.charAt(1))a&&u(b,a);else{var d=this.data.document.root,b=decodeURIComponent(b.substring(1)),d=d.subPath(b).asSchema();if(a)a.call(d,d,null);else return d}return this},title:function(){var a=
this.data.propertyValue("title");void 0==a&&(a=null);return a},hasDefault:function(){return this.data.property("default").defined()},defaultValue:function(){return this.data.propertyValue("default")},propertySchemas:function(a){var b=[],d=this.data.property("properties").property(a);d.defined()&&b.push(d.asSchema());this.data.property("patternProperties").properties(function(d,c){RegExp(d).test(a)&&b.push(c.asSchema())});0==b.length&&(d=this.data.property("additionalProperties"),d.defined()&&b.push(d.asSchema()));
return new k(b)},propertyDependencies:function(a){var b=this.data.property("dependencies");return b.defined()&&(a=b.property(a),a.defined())?"string"==a.basicType()?[a.value()]:"array"==a.basicType()?a.value():[a.asSchema()]:[]},indexSchemas:function(a){var b=this.data.property("items");if(!b.defined())return new k;"array"==b.basicType()?(a=b.index(a),a.defined()||(a=this.data.property("additionalItems"))):a=b;return a.defined()?(a=a.asSchema(),new k([a])):new k},tupleTyping:function(){var a=this.data.property("items");
return"array"==a.basicType()?a.length():0},andSchemas:function(){var a=[],b=this.data.property("extends");b.defined()&&("array"==b.basicType()?b.indices(function(b,c){a.push(c.asSchema())}):a.push(b.asSchema()));this.data.property("allOf").items(function(b,c){a.push(c.asSchema())});return new k(a)},notSchemas:function(){var a=[],b=this.data.property("disallow");b.defined()&&("array"==b.basicType()?b.indices(function(b,c){"string"==c.basicType()?a.push(h.createSchema({type:c.value()})):a.push(c.asSchema())}):
"string"==b.basicType()?a.push(h.createSchema({type:b.value()})):a.push(b.asSchema()));this.data.property("not").defined()&&a.push(this.data.property("not").asSchema());return a},types:function(){var a=this.data.property("type");if(a.defined()){if("string"===a.basicType())return"all"==a.value()?S.slice(0):[a.value()];for(var b=[],d=0;d<a.length();d++)if("string"==a.item(d).basicType()){if("all"==a.item(d).value())return S.slice(0);b.push(a.item(d).value())}else return S.slice(0);-1!=b.indexOf("number")&&
-1==b.indexOf("integer")&&b.push("integer");return b}return S.slice(0)},xorSchemas:function(){var a=[],b=this.data.property("type");if(b.defined())for(var d=0;d<b.length();d++)if("string"!=b.item(d).basicType()){var c=[];b.items(function(a,b){"string"==b.basicType()?c.push(P(b.value())):c.push(b.asSchema())});a.push(c);break}this.data.property("oneOf").defined()&&(c=[],this.data.property("oneOf").items(function(a,b){c.push(b.asSchema())}),a.push(c));return a},orSchemas:function(){var a=[];this.data.property("type");
if(this.data.property("anyOf").defined()){var b=[];this.data.property("anyOf").items(function(a,c){b.push(c.asSchema())});a.push(b)}return a},equals:function(a,b){var d=this;b&&(a=a.getFull(),d=this.getFull());if(d===a)return!0;var c=d.referenceUrl(),e=a.referenceUrl();b&&!d.isFull()&&(c=d.data.resolveUrl(this.data.propertyValue("$ref")));b&&!a.isFull()&&(e=a.data.resolveUrl(a.data.propertyValue("$ref")));return void 0!==c&&void 0!==e?n.urlsEqual(c,e):this.data.equals(a.data)},readOnly:function(){return!(!this.data.propertyValue("readOnly")&&
!this.data.propertyValue("readonly"))},enumValues:function(){return this.data.propertyValue("enum")},enumData:function(){return this.data.property("enum")},minItems:function(){var a=this.data.propertyValue("minItems");return void 0==a?0:a},maxItems:function(){return this.data.propertyValue("maxItems")},tupleTypingLength:function(){return"array"!=this.data.property("items").basicType()?0:this.data.property("items").length()},minLength:function(){var a=this.data.propertyValue("minLength");return void 0==
a?0:a},maxLength:function(){return this.data.propertyValue("maxLength")},numberInterval:function(){return this.data.propertyValue("divisibleBy")},minimum:function(){return this.data.propertyValue("minimum")},exclusiveMinimum:function(){return!!this.data.propertyValue("exclusiveMinimum")},maximum:function(){return this.data.propertyValue("maximum")},exclusiveMaximum:function(){return!!this.data.propertyValue("exclusiveMaximum")},minProperties:function(){var a=this.data.propertyValue("minProperties");
return void 0==a?0:a},maxProperties:function(){return this.data.propertyValue("maxProperties")},definedProperties:function(a){if(a)return this.definedProperties(),this.definedProperties(a);var b=this.data.property("properties").keys();this.definedProperties=function(a){a=a||[];for(var c=[],e=0;e<b.length;e++)-1==a.indexOf(b[e])&&c.push(b[e]);return c};return b.slice(0)},knownProperties:function(a){if(a)return this.knownProperties(),this.knownProperties(a);var b={};this.data.property("properties").properties(function(a,
d){b[a]=!0});a=this.requiredProperties();for(var d=0;d<a.length;d++)b[a[d]]=!0;var c=Object.keys(b);this.knownProperties=function(a){a=a||[];for(var b=[],d=0;d<c.length;d++)-1==a.indexOf(c[d])&&b.push(c[d]);return b};return c.slice(0)},requiredProperties:function(){var a=this.data.propertyValue("required");"object"!=typeof a&&(a=[]);var b=this.data.property("properties");void 0!=b&&b.properties(function(b,c){var e=c.property("required");void 0!=e&&("boolean"==e.basicType()&&e.value())&&a.push(b)});
return a},allowedAdditionalProperties:function(){return!1!==this.data.propertyValue("additionalProperties")},getLink:function(a){for(var b=this.links(),d=0;d<b.length;d++)if(b[d].rel()==a)return b[d]},asList:function(){return new k([this])},format:function(){return this.data.propertyValue("format")}};D.prototype.basicTypes=D.prototype.types;D.prototype.extendSchemas=D.prototype.andSchemas;D.prototype.isComplete=D.prototype.isFull;h.extendSchema=function(a){for(var b in a)void 0==D.prototype[b]&&(D.prototype[b]=
a[b])};var Y={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};O.prototype={addHandler:function(a){this.handlers.unshift(a);return this},addPreHandler:function(a){this.preHandlers.push(a);return this},canApplyTo:function(a){var b,d,c=null;for(b=0;b<this.dataParts.length;b++)if(d=this.dataParts[b],null===d?c=a:"object"==a.basicType()?c=a.property(d):"array"==a.basicType()&&Q.test(d)&&(c=a.index(d)),void 0==c||!c.defined()||"null"==c.basicType())return!1;return!0},linkForData:function(a){var b=this.data.value(),
d=this.uriTemplate.fill(function(b){b=c(b);return null==b?a.value():"array"==a.basicType()?a.itemValue(b):a.propertyValue(b)});b.href=a.resolveUrl(d);b.rel=b.rel.toLowerCase();b.title=b.title;return new f(b,this,a)},usesKey:function(a){var b;for(b=0;b<this.dataParts.length;b++)if(this.dataParts[b]===a||null===this.dataParts[b])return!0;return!1},rel:function(){return this.data.propertyValue("rel").toLowerCase()}};var ha=[],ia=[];h.addLinkHandler=function(a){ha.unshift(a)};h.addLinkPreHandler=function(a){ia.push(a)};
var ja=n.getUniqueKey();f.prototype={toString:function(){return this.href},createSubmissionData:function(a){var b=this.hrefBase,d=this.submissionSchemas;if(void 0!=a&&0==d.length&&"PUT"==this.method)return Jsonary.getData(this.href,function(b){a(b.editableCopy())}),this;if(void 0!=a)d.createValue(function(c){c=h.create(c,b);for(var e=0;e<d.length;e++)c.addSchema(d[e],ja);a(c)});else{for(var c=d.createValue(),c=h.create(c,b),e=0;e<d.length;e++)c.addSchema(d[e],ja);return c}},follow:function(a,b){"function"==
typeof a&&(b=a,a=void 0);void 0!==a?a instanceof l||(a=h.create(a)):a=h.create(void 0);for(var d=ia.concat(this.definition.preHandlers),c=0;c<d.length;c++){var e=d[c];if(!1===e.call(this,this,a))return n.log(n.logLevel.DEBUG,"Link cancelled: "+this.href),null}c=a.value();d=h.getData({url:this.href,method:this.method,data:c,encType:this.encType},null,this.targetSchema);a=a.readOnlyCopy();var f=this.definition.handlers.concat(ha);void 0!==b&&f.unshift(b);for(c=0;c<f.length;c++){e=f[c];if("function"!==
typeof e)if(e)continue;else break;if(!1===e.call(this,this,a,d))break}return d}};e.prototype={setupXorSelectors:function(){var a=this;this.xorSelectors={};for(var b=this.schema.xorSchemas(),d=0;d<b.length;d++){var c=new z(n.getKeyVariant(this.monitorKey,"xor"+d),b[d],this.data);this.xorSelectors[d]=c;c.onMatchChange(function(b){a.update()},!1)}},setupOrSelectors:function(){var a=this;this.orSelectors={};for(var b=this.schema.orSchemas(),d=0;d<b.length;d++){var c=new q(n.getKeyVariant(this.monitorKey,
"or"+d),b[d],this.data);this.orSelectors[d]=c;c.onMatchChange(function(b){a.update()},!1)}},setupAndMatches:function(){var a=this;this.andMatches=[];this.schema.andSchemas().each(function(b,d){var c=n.getKeyVariant(a.monitorKey,"and"+b),c=a.data.addSchemaMatchMonitor(c,d,function(){a.update()},!1,!0);a.andMatches.push(c)})},setupNotMatches:function(){var a=this;this.notMatches=[];for(var b=this.schema.notSchemas(),d=0;d<b.length;d++)(function(b,d){var c=n.getKeyVariant(a.monitorKey,"not"+b),c=a.data.addSchemaMatchMonitor(c,
d,function(){a.update()},!1,!0);a.notMatches.push(c)})(d,b[d])},addMonitor:function(a,b){this.monitors.add(this.monitorKey,a);!1!==b&&a.call(this.schema,this.match,this.matchFailReason);return this},dataUpdated:function(a){if(this.schemaLoaded){var b=this;if("object"==this.data.basicType()){this.indexMatches={};this.data.properties(function(a,d){if(void 0==b.propertyMatches[a]){var c=[],e=b.schema.propertySchemas(a);e.each(function(f,m){var g=d.addSchemaMatchMonitor(b.monitorKey,e[f],function(){b.subMatchUpdated(a,
g)},!1,!0);c.push(g)});b.propertyMatches[a]=c;b.addDependencies(a)}});var d=[];for(a in this.propertyMatches)this.data.property(a).defined()||d.push(a);for(var c=0;c<d.length;c++)a=d[c],delete this.propertyMatches[a],void 0!=this.dependencyKeys[a]&&(this.data.removeSchema(this.dependencyKeys[a]),delete this.dependencies[a],delete this.dependencyKeys[a])}else if("array"==this.data.basicType()){this.propertyMatches={};this.data.indices(function(d,c){if(void 0==b.indexMatches[d]){var e=[],f=b.schema.indexSchemas(d);
f.each(function(d,m){var p=c.addSchemaMatchMonitor(b.monitorKey,f[d],function(){b.subMatchUpdated(a,p)},!1,!0);e.push(p)});b.indexMatches[d]=e}});d=[];for(a in this.indexMatches)this.data.length()<=a&&d.push(a);for(c=0;c<d.length;c++)delete this.indexMatches[d[c]]}else this.propertyMatches={},this.indexMatches={};this.update()}},addDependencies:function(a){var b=this,d=this.schema.propertyDependencies(a);this.dependencies[a]=[];this.dependencyKeys[a]=[];for(var c=0;c<d.length;c++){var e=d[c];"string"==
typeof e?this.dependencies[a].push(e):function(d){var c=n.getKeyVariant(b.monitorKey,"dep:"+a+":"+d);b.dependencyKeys[a].push(c);c=b.data.addSchemaMatchMonitor(c,e,function(){b.dependencyUpdated(a,d)},!1,!0);b.dependencies[a].push(c)}(c)}},notify:function(){this.monitors.notify(this.match,this.matchFailReason)},setMatch:function(a,b){var d=this,c=this.match,e=this.matchFailReason;this.matchFailReason=(this.match=a)?null:b;if(this.impatientCallbacks)return this.notify();this.pendingNotify||(this.pendingNotify=
!0,I.add(function(){d.pendingNotify=!1;d.match&&c||(d.match||c||!d.matchFailReason.equals(e))&&d.notify()}))},subMatchUpdated:function(a,b){this.update()},subMatchRemoved:function(a,b){this.update()},dependencyUpdated:function(a,b){this.update()},update:function(){try{this.matchAgainstBasicTypes(),this.matchAgainstSubMatches(),this.matchAgainstImmediateConstraints(),this.setMatch(!0)}catch(a){if(a instanceof g)this.setMatch(!1,a);else throw a;}},matchAgainstBasicTypes:function(){for(var a=this.data.basicType(),
b=0;b<this.basicTypes.length;b++)if(this.basicTypes[b]==a||"integer"==a&&"number"==this.basicTypes[b])return;throw new g("Data does not match any of the basic types: "+this.basicTypes,this.schema);},matchAgainstSubMatches:function(){for(var a=0;a<this.andMatches.length;a++){var b=this.andMatches[a];if(!b.match){var d="extended schema #"+a+": "+b.message;throw new g(d,this.schema,b.failReason);}}for(a=0;a<this.notMatches.length;a++)if(this.notMatches[a].match)throw d='"not" schema #'+a+" matches",
new g(d,this.schema);for(d in this.xorSelectors)if(a=this.xorSelectors[d],null==a.selectedOption)throw d="XOR #"+d+": "+a.failReason.message,new g(d,this.schema,a.failReason);for(d in this.orSelectors)if(a=this.orSelectors[d],0==a.selectedOptions.length)throw d="OR #"+d+": no matches",new g(d,this.schema);for(d in this.propertyMatches)for(var c=this.propertyMatches[d],a=0;a<c.length;a++)if(b=c[a],!b.match)throw d=d+": "+b.matchFailReason.message,new g(d,this.schema,b.matchFailReason);for(d in this.indexMatches)for(c=
this.indexMatches[d],a=0;a<c.length;a++)if(b=c[a],!b.match)throw d=d+": "+b.matchFailReason.message,new g(d,this.schema,b.matchFailReason);},matchAgainstImmediateConstraints:function(){this.matchAgainstEnums();this.matchAgainstNumberConstraints();this.matchAgainstArrayConstraints();this.matchAgainstObjectConstraints()},matchAgainstEnums:function(){var a=this.schema.enumData();if(a.defined()){for(var b=0;b<a.length();b++)if(a.index(b).equals(this.data))return;throw new g("Data does not match enum: "+
JSON.stringify(a.value())+" ("+JSON.stringify(this.data.value())+")",this.schema);}},matchAgainstNumberConstraints:function(){if("number"==this.data.basicType()||"integer"==this.data.basicType()){var a=this.data.value(),b=this.schema.numberInterval();if(void 0!=b&&0!=a%b)throw new g("Number must be divisible by "+b);b=this.schema.minimum();if(void 0!==b)if(this.schema.exclusiveMinimum()){if(a<=b)throw new g("Number must be > "+b);}else if(a<b)throw new g("Number must be >= "+b);b=this.schema.maximum();
if(void 0!=b)if(this.schema.exclusiveMaximum()){if(a>=b)throw new g("Number must be < "+b);}else if(a>b)throw new g("Number must be <= "+b);}},matchAgainstArrayConstraints:function(){if("array"==this.data.basicType()){var a=this.schema.minItems();if(void 0!==a&&a>this.data.length())throw new g("Data is not long enough - minimum length is "+a,this.schema);a=this.schema.maxItems();if(void 0!==a&&a<this.data.length())throw new g("Data is too long - maximum length is "+a,this.schema);}},matchAgainstObjectConstraints:function(){if("object"==
this.data.basicType()){for(var a=this.schema.requiredProperties(),b=0;b<a.length;b++){var d=a[b];if(!this.data.property(d).defined())throw new g("Missing key "+JSON.stringify(d),this.schema);}if(!1==this.schema.allowedAdditionalProperties())for(var a=this.schema.definedProperties(),c=this.data.keys(),b=0;b<c.length;b++)if(-1==a.indexOf(c[b]))throw new g("Not allowed additional property: "+JSON.stringify(d),this.schema);this.matchAgainstDependencies()}},matchAgainstDependencies:function(){for(var a in this.dependencies)if(void 0!=
this.data.property(a))for(var b=this.dependencies[a],d=0;d<b.length;d++){var c=b[d];if("string"==typeof c){if(!this.data.property(c).defined())throw new g("Dependency - property "+JSON.stringify(a)+" requires property "+JSON.stringify(c),this.schema);}else if(!c.match)throw new g("Dependency for "+a,this.schema,c.matchFailReason);}}};g.prototype=Error();g.prototype.toString=function(){return this.message+" in "+this.schema.title()};g.prototype.equals=function(a){if(!(a instanceof g))return!1;if(null==
this.subMatchFailReason){if(null!=a.subMatchFailReason)return!1}else if(null==a.subMatchFailReason||!this.subMatchFailReason.equals(a.subMatchFailReason))return!1;return this.message==a.message&&(null==this.schema&&null==a.schema||null!=this.schema&&null!=a.schema&&this.schema.equals(a.schema))};z.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOption);return this},update:function(){for(var a=null,b="No matches",d=0;d<this.subMatches.length;d++)if(this.subMatches[d].match)if(null==
a)a=this.options[d],b=null;else{b="multiple matches";a=null;break}this.failReason=new g(b);this.selectedOption!=a&&(this.selectedOption=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOption))}};q.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOptions);return this},update:function(){for(var a=[],b=0;b<this.subMatches.length;b++)this.subMatches[b].match&&a.push(this.options[b]);var d=!1;if(a.length!=this.selectedOptions.length)d=
!0;else for(b=0;b<a.length;b++)if(a[b]!=this.selectedOptions[b]){d=!0;break}d&&(this.selectedOptions=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOptions))}};var aa=[];h.registerSchemaChangeListener=function(a){aa.push(a)};var R={},Z=!1;ba.prototype={rel:function(a){if(void 0==a)return this;var b=[],d;for(d=0;d<this.length;d++)this[d].rel===a&&(b[b.length]=this[d]);return new ba(b)}};var pa={"null":!0,"boolean":!0,integer:!0,number:!0,string:!0,array:!0,object:!0};k.prototype=
{indexOf:function(a,b){for(var d=this.length-1;0<=d&&!a.equals(this[d],b);)d--;return d},containsUrl:function(a){if(a instanceof RegExp)for(var b=0;b<this.length;b++){var d=this[b];if(a.test(d.referenceUrl()))return!0}else for(0>a.indexOf("#")&&(a+="#"),b=0;b<this.length;b++)if(d=this[b],d=d.referenceUrl(),null!=d&&d.substring(d.length-a.length)==a)return!0;return!1},links:function(a){var b=[],d,c;for(d=0;d<this.length;d++)c=this[d],b=b.concat(c.links());this.links=function(a){for(var d=[],c=0;c<
b.length;c++){var e=b[c];void 0!=a&&e.rel!=a||d.push(e)}return d};return this.links(a)},each:function(a){for(var b=0;b<this.length;b++)a.call(this,b,this[b]);return this},concat:function(a){for(var b=[],d=0;d<this.length;d++)b.push(this[d]);for(d=0;d<a.length;d++)b.push(a[d]);return new k(b)},title:function(){for(var a=[],b=0;b<this.length;b++){var d=this[b].title();d&&a.push(d)}return a.join(" - ")},definedProperties:function(a){if(a)return this.definedProperties(),this.definedProperties(a);var b=
!0,d={};this.each(function(a,c){if(b){c.allowedAdditionalProperties()||(b=!1,d={});for(var e=c.definedProperties(),f=0;f<e.length;f++)d[e[f]]=!0}else if(!c.allowedAdditionalProperties()){b=!1;for(var m={},e=c.definedProperties(),f=0;f<e.length;f++)d[e[f]]&&(m[e[f]]=!0);d=m}});var c=Object.keys(d);r(this,{allowedAdditionalProperties:b});this.definedProperties=function(a){a=a||[];for(var b=[],d=0;d<c.length;d++)-1==a.indexOf(c[d])&&b.push(c[d]);return b};return c},knownProperties:function(a){if(a)return this.knownProperties(),
this.knownProperties(a);var b;if(this.allowedAdditionalProperties()){b=this.definedProperties().slice(0);a=this.requiredProperties();for(var d=0;d<a.length;d++)-1==b.indexOf(a[d])&&b.push(a[d])}else b=this.definedProperties();this.knownProperties=function(a){a=a||[];for(var d=[],c=0;c<b.length;c++)-1==a.indexOf(b[c])&&d.push(b[c]);return d};return b.slice(0)},allowedAdditionalProperties:function(){var a=!0;this.each(function(b,d){a=a&&d.allowedAdditionalProperties()});r(this,{additionalProperties:a});
return a},minProperties:function(){for(var a=0,b=0;b<this.length;b++){var d=this[b].minProperties();d>a&&(a=d)}return a},maxProperties:function(){for(var a=void 0,b=0;b<this.length;b++){var d=this[b].maxProperties();d>a||(a=d)}return a},types:function(){for(var a=pa,b=0;b<this.length;b++){for(var d=this[b].basicTypes(),c={},e=0;e<d.length;e++){var f=d[e];a[f]&&(c[f]=!0)}a=c}return Object.keys(a)},numberInterval:function(){for(var a=void 0,b=0;b<this.length;b++){var d=this[b].numberInterval();void 0!=
d&&(a=void 0==a?d:n.lcm(a,d))}for(b=0;b<this.length;b++){for(var d=this[b].basicTypes(),c=!1,e=0;e<d.length;e++)if("number"==d[e]){c=!1;break}else"integer"==d[e]&&(c=!0);if(c)return void 0==a?1:n.lcm(a,1)}r(this,{numberInterval:a});return a},minimum:function(){for(var a=void 0,b=!1,d=0;d<this.length;d++){var c=this[d].minimum();void 0!=c&&(void 0==a||a<c)&&(a=c,b=this[d].exclusiveMinimum())}r(this,{minimum:a,exclusiveMinimum:b});return a},exclusiveMinimum:function(){this.minimum();return this.exclusiveMinimum()},
maximum:function(){for(var a=void 0,b=!1,d=0;d<this.length;d++){var c=this[d].maximum();void 0!=c&&(void 0==a||a>c)&&(a=c,b=this[d].exclusiveMaximum())}r(this,{maximum:a,exclusiveMaximum:b});return a},exclusiveMaximum:function(){this.minimum();return this.exclusiveMinimum()},minLength:function(){for(var a=0,b=0;b<this.length;b++){var d=this[b].minLength();d>a&&(a=d)}r(this,{minLength:a});return a},maxLength:function(){for(var a=void 0,b=0;b<this.length;b++){var d=this[b].maxLength();d>a||(a=d)}r(this,
{maxLength:a});return a},minItems:function(){for(var a=0,b=0;b<this.length;b++){var d=this[b].minItems();d>a&&(a=d)}r(this,{minItems:a});return a},maxItems:function(){for(var a=void 0,b=0;b<this.length;b++){var d=this[b].maxItems();d>a||(a=d)}r(this,{maxItems:a});return a},tupleTypingLength:function(){for(var a=0,b=0;b<this.length;b++){var d=this[b].tupleTypingLength();d>a&&(a=d)}return a},requiredProperties:function(){for(var a={},b=[],d=0;d<this.length;d++)for(var c=this[d].requiredProperties(),
e=0;e<c.length;e++){var f=c[e];a[f]||(a[f]=!0,b.push(f))}return b},readOnly:function(){for(var a=!1,b=0;b<this.length;b++)if(this[b].readOnly()){a=!0;break}this.readOnly=function(){return a};return a},enumValues:function(){for(var a=void 0,b=0;b<this.length;b++){var d=this[b].enumData();if(d.defined())if(void 0==a)a=[],d.indices(function(b,d){a[b]=d});else{var c=[];d.indices(function(b,d){for(var e=0;e<a.length;e++)a[e].equals(d)&&c.push(d)});a=c}}if(void 0!=a){d=[];for(b=0;b<a.length;b++)d[b]=a[b].value();
return d}},allCombinations:function(a){function b(){l--;if(0>=l){for(var b=[new k([])],c=0;c<s.length;c++){for(var e=s[c],f=[],g=0;g<e.length;g++)for(var m=0;m<b.length;m++)f.push(b[m].concat(e[g]));b=f}for(c=0;c<b.length;c++)b[c]=d.concat(b[c]);a(b)}}if(a&&!this.isFull())return this.getFull(function(b){b.allCombinations(a)}),[];for(var d=this,c=this.xorSchemas(),e=0;e<c.length;e++){for(var f=!1,g=0;g<c[e].length;g++){var h=c[e][g];if(0<=this.indexOf(h,!!a)){f=!0;break}}if(!f){for(var n=[],q=1,g=
0;g<c[e].length;g++)h=c[e][g],a?(q++,this.concat([h]).allCombinations(function(b){n=n.concat(b);q--;0>=q&&a(n)})):(f=this.concat([h]).allCombinations(),n=n.concat(f));a&&(q--,0>=q&&a(n));return n}}for(var z=this.orSchemas(),c=null,s=[],l=1,e=0;e<z.length;e++)(function(c){for(var e=[],f=!1,g=0;g<z[c].length;g++){var m=z[c][g];-1==d.indexOf(m,!!a)?e.push(m):f=!0}if(0<e.length){g=[[]];for(m=0;m<e.length;m++){for(var p=[],h=0;h<g.length;h++)p.push(g[h]),p.push(g[h].concat([e[m]]));g=p}f||g.shift();if(a)for(s[c]=
[],e=0;e<g.length;e++)f=new k(g[e]),l++,f.allCombinations(function(a){s[c]=s[c].concat(a);b()});else s[c]=g}})(e);c=[new k([])];for(e=0;e<s.length;e++){g=s[e];f=[];for(h=0;h<g.length;h++)for(var r=0;r<c.length;r++)f.push(c[r].concat(g[h]));c=f}for(e=0;e<c.length;e++)c[e]=this.concat(c[e]);a&&b();return c},createValue:function(a,b){function d(b){if(void 0!==b){var d=n.guessBasicType(b);-1!=c.indexOf(d)||"integer"==d&&-1!=c.indexOf("number")||(b=void 0)}void 0!==b&&void 0===f&&(f=b);e--;a&&0>=e&&a(f);
if(0>=e)return f}if(b){for(var c=this.basicTypes(),e=1,f=void 0,g=0;g<this.length;g++)if(this[g].hasDefault()&&(e++,d(this[g].defaultValue())))return f;var k=this.enumValues();if(void 0!=k)for(e+=k.length,g=0;g<k.length;g++){if(d(k[g]))return f}else for(e+=c.length,g=0;g<c.length;g++)if(k=c[g],"null"==k){if(d(null))return f}else if("boolean"==k){if(d(!0))return!0}else if("integer"==k||"number"==k){if(k=this.createValueNumber(),d(k))return f}else if("string"==k){if(k=this.createValueString(),d(k))return f}else if("array"==
k)if(a)this.createValueArray(function(a){d(a)});else{if(k=this.createValueArray(),d(k))return f}else if("object"==k)if(a)k=this.createValueObject(function(a){d(a)});else if(k=this.createValueObject(),d(k))return f;return d(f)}if(null!=a)this.allCombinations(function(b){function d(c){if(c>=b.length)return a(void 0);b[c].createValue(function(b){void 0!==b?a(b):d(c+1)},!0)}d(0)});else for(var k=this.allCombinations(),g=0;g<k.length;g++){var h=k[g].createValue(null,!0);if(void 0!==h)return h}},createValueNumber:function(){var a=
this.exclusiveMinimum(),b=this.minimum(),d=this.maximum(),c=this.exclusiveMaximum(),e=this.numberInterval(),f=void 0;if(void 0!=b&&void 0!=d){if(b>d||b==d&&(a||c))return;if(void 0!=e){if(f=Math.ceil(b/e)*e,a&&f==b&&(f+=e),f>d||f==d&&c)return}else f=0.5*(b+d)}else void 0!=b?(f=b,void 0!=e&&(f=Math.ceil(f/e)*e),a&&f==b&&(void 0!=e?f+=e:f++)):void 0!=d?(f=d,void 0!=e&&(f=Math.floor(f/e)*e),c&&f==d&&(void 0!=e?f-=e:f--)):f=0;return f},createValueString:function(){return""},createValueArray:function(a){var b=
this,d=[],c=this.minItems();if(!c)return a&&a(d),d;for(var e=c,f=0;f<c;f++)(function(c){a?b.createValueForIndex(c,function(b){d[c]=b;e--;0==e&&a(d)}):d[c]=b.createValueForIndex(c)})(f);return d},createValueObject:function(a){var b=this,d={},c=this.requiredProperties();if(0==c.length)return a&&a(d),d;for(var e=c.length,f=0;f<c.length;f++)(function(c){a?b.createValueForProperty(c,function(b){d[c]=b;e--;0==e&&a(d)}):d[c]=b.createValueForProperty(c)})(c[f]);return d},createValueForIndex:function(a,b){return this.indexSchemas(a).createValue(b)},
indexSchemas:function(a){for(var b=new k,d=0;d<this.length;d++)b=b.concat(this[d].indexSchemas(a));return b},tupleTyping:function(){for(var a=0,b=0;b<this.length;b++)a=Math.max(a,this[b].tupleTyping());return a},createValueForProperty:function(a,b){return this.propertySchemas(a).createValue(b)},propertySchemas:function(a){for(var b=new k,d=0;d<this.length;d++)b=b.concat(this[d].propertySchemas(a));return b},propertyDependencies:function(a){for(var b=[],d={},c=0;c<this.length;c++)for(var e=this[c].propertyDependencies(a),
f=0;f<e.length;f++)"string"==typeof e[f]?d[e[f]]||(d[e[f]]=!0,b.push(e[f])):b.push(e[f]);return b},isFull:function(){for(var a=0;a<this.length;a++){if(!this[a].isFull())return!1;for(var b=this[a].andSchemas(),c=0;c<b.length;c++)if(-1==this.indexOf(b[c],!0))return!1}return!0},getFull:function(a){function b(g){e+=g.length;for(var h=0;h<g.length;h++)g[h].getFull(function(g){for(var h=0;h<c.length;h++)if(g.equals(c[h])){e--;0==e&&(g=new k(c,f),a.call(g,g));return}c.push(g);g=g.extendSchemas();b(g);e--;
0==e&&(g=new k(c,f),a.call(g,g))})}if(!a){var c=this;this.getFull(function(a){c=a});return c}if(0==this.length)return a.call(this,this),this;var e=0,c=[],f=this.fixed();b(this);return this},formats:function(){for(var a=[],b=0;b<this.length;b++){var c=this[b].format();null!=c&&a.push(c)}return a},xorSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].xorSchemas());return a},orSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].orSchemas());return a}};k.prototype.basicTypes=
k.prototype.types;k.prototype.potentialLinks=k.prototype.links;h.extendSchemaList=function(a){for(var b in a)void 0==k.prototype[b]&&(k.prototype[b]=a[b])};h.createSchemaList=function(a){Array.isArray(a)||(a=[a]);return new k(a)};n.getUniqueKey();ea.prototype={update:function(a){this.updateLinksWithKey(a);this.updateDependenciesWithKey(a);this.updateMatchesWithKey(a)},updateFromSelfLink:function(){this.cachedLinkList=null;var a=[],b;for(b in this.links)for(var c=this.links[b],e=0;e<c.length;e++){var f=
c[e];"self"==f.rel()&&(f.active=!1)}for(b in this.links)for(c=this.links[b],e=0;e<c.length;e++)f=c[e],"self"==f.rel()&&(f.update(),f.active&&(a.push(f),f.active=!1,this.cachedLinkList=null));for(var e=0;e<a.length;e++)a[e].active=!0;for(b in this.links)for(c=this.links[b],e=0;e<c.length;e++)f=c[e],"self"!=f.rel()&&f.update();this.dataObj.properties(function(a,b){b.addLink(null)});this.dataObj.items(function(a,b){b.addLink(null)})},updateLinksWithKey:function(a){var b,c,e,f,g=[];for(b in this.links)for(e=
this.links[b],c=0;c<e.length;c++)f=e[c],(f.usesKey(a)||null==a)&&g.push(f);if(0<g.length){a=null;for(c=0;c<g.length;c++)if(f=g[c],b=f.active?f.rawLink.rawLink.href:null,f.update(),(f.active?f.rawLink.rawLink.href:null)!=b&&"self"==f.rel()){a=f;break}null!=a&&this.updateFromSelfLink(a);this.invalidateSchemaState()}},updateMatchesWithKey:function(a){var b=[];for(schemaKey in this.matches)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++){var e=this.matches[b[c]];if(void 0!=e)for(var f=
0;f<e.length;f++)e[f].dataUpdated(a)}},updateDependenciesWithKey:function(a){var b=[];for(schemaKey in this.dependencySelectors)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++)for(var e=this.dependencySelectors[b[c]],f=0;f<e.length;f++)e[f].dataUpdated(a)},alreadyContainsSchema:function(a,b){for(var c=0;c<b.length;c++){var e=b[c];if(void 0!=this.schemas[e])for(var f=0;f<this.schemas[e].length;f++)if(a.equals(this.schemas[e][f]))return!0}return!1},addSchema:function(a,b,c,e){var f=
this;void 0==b&&(b=n.getUniqueKey());void 0==e&&(e=!0);void 0==c?c=[b]:c[c.length]=b;void 0==this.schemas[b]&&(this.schemas[b]=[]);this.schemaFlux++;"string"==typeof a&&(a=h.createSchema({$ref:a}));a.getFull(function(a,g){if(f.alreadyContainsSchema(a,c))f.schemaFlux--,f.checkForSchemasStable();else{I.increment();f.schemas[b].push(a);f.schemasFixed[b]=f.schemasFixed[b]||e;f.dataObj.properties(function(e,f){for(var g=n.getKeyVariant(b,"prop"),k=a.propertySchemas(e),h=0;h<k.length;h++)f.addSchema(k[h],
g,c)});f.dataObj.indices(function(e,f){n.getKeyVariant(b,"idx");var g=a.indexSchemas(e);for(e=0;e<g.length;e++)f.addSchema(g[e],b,c)});for(var k=a.extendSchemas(),h=0;h<k.length;h++)f.addSchema(k[h],b,c,e);f.addLinks(a.links(),b,c);f.addXorSelectors(a,b,c);f.addOrSelectors(a,b,c);f.addDependencySelector(a,b,c);f.schemaFlux--;f.invalidateSchemaState();I.decrement()}})},addLinks:function(a,b,c){var e,f;void 0==this.links[b]&&(this.links[b]=[]);var g=null;for(e=0;e<a.length;e++)f=new fa(this.dataObj,
a[e]),this.links[b].push(f),this.addMonitorForLink(f,b,c),f.update(),f.active&&"self"==f.rawLink.rawLink.rel&&(g=f);null!=g&&this.updateFromSelfLink(g);this.invalidateSchemaState()},addXorSelectors:function(a,b,c){a=a.xorSchemas();for(var e=[],f=0;f<a.length;f++){var g=new na(a[f],n.getKeyVariant(b,"xor"+f),c,this);e.push(g)}this.xorSelectors[b]=void 0==this.xorSelectors[b]?e:this.xorSelectors[b].concat(e)},addOrSelectors:function(a,b,c){a=a.orSchemas();for(var e=[],f=0;f<a.length;f++){var g=new oa(a[f],
n.getKeyVariant(b,"or"+f),c,this);e.push(g)}this.orSelectors[b]=void 0==this.orSelectors[b]?e:this.orSelectors[b].concat(e)},addDependencySelector:function(a,b,c){a=[new ga(a,n.getKeyVariant(b,"dep"),c,this)];this.dependencySelectors[b]=void 0==this.dependencySelectors[b]?a:this.dependencySelectors[b].concat(a)},addLink:function(a){if(null==a)this.updateFromSelfLink(),this.invalidateSchemaState();else if("invalidate"==a.rel||"invalidates"==a.rel){var b=this.dataObj.resolveUrl(a.href);h.invalidate(b)}else b=
n.getUniqueKey(),a=h.create(a),a=new O(a),this.addLinks([a],b)},addMonitorForLink:function(a,b,c){var e=this;if("describedby"===a.rel()){var f=n.getKeyVariant(b);a.addMonitor(f,function(b){e.removeSchema(f);b&&(b=h.createSchema({$ref:a.rawLink.href}),e.addSchema(b,f,c,!1))})}},addSchemaMatchMonitor:function(a,b,c,f,g){b=new e(a,this.dataObj,b,g);void 0==this.matches[a]&&(this.matches[a]=[]);this.matches[a].push(b);b.addMonitor(c,f);return b},removeSchema:function(a){I.increment();this.dataObj.indices(function(b,
c){c.removeSchema(a)});this.dataObj.properties(function(b,c){c.removeSchema(a)});var b,c,e=[];for(b in this.schemas)n.keyIsVariant(b,a)&&e.push(b);for(b in this.links)n.keyIsVariant(b,a)&&e.push(b);for(b in this.matches)n.keyIsVariant(b,a)&&e.push(b);for(c=0;c<e.length;c++)b=e[c],delete this.schemas[b],delete this.links[b],delete this.matches[b],delete this.xorSelectors[b],delete this.orSelectors[b],delete this.dependencySelectors[b];0<e.length&&this.invalidateSchemaState();I.decrement()},clear:function(){this.schemas=
{};this.links={};this.matches={};this.invalidateSchemaState()},getSchemas:function(){if(null!==this.cachedSchemaList)return this.cachedSchemaList;var a=[],b={},c,e,f,g,h,n;for(f in this.schemas){g=this.schemas[f];var q=this.schemasFixed[f];for(c=0;c<g.length;c++){h=g[c];q&&(b[h.data.uniqueId]=h);n=!1;for(e=0;e<a.length;e++)if(h.equals(a[e])){n=!0;break}n||a.push(h)}}c=[];for(f in b)c.push(b[f]);return this.cachedSchemaList=new k(a,c)},getLinks:function(a){var b,c,e,f;if(null!==this.cachedLinkList)return this.cachedLinkList.rel(a);
var g=[];for(b in this.links)for(f=this.links[b],c=0;c<f.length;c++)e=f[c],e.active&&g.push(e.rawLink);this.cachedLinkList=new ba(g);return this.cachedLinkList.rel(a)},invalidateSchemaState:function(){this.cachedLinkList=this.cachedSchemaList=null;this.schemasStable=!1;this.checkForSchemasStable()},checkForSchemasStable:function(){if(0<this.schemaFlux)return!1;var a,b,c,e;for(b in this.schemas)for(c=this.schemas[b],a=0;a<c.length;a++)if(e=c[a],!e.isComplete())return this.schemasStable=!1;this.schemasStable||
(this.schemasStable=!0,a=this.dataObj,R[a.uniqueId]=a,Z||(Z=!0,I.add(s)));this.schemasStableListeners.notify(this.dataObj,this.getSchemas());return!0},addSchemasForProperty:function(a,b){for(var c in this.schemas)for(var e=n.getKeyVariant(c,"prop"),f=0;f<this.schemas[c].length;f++)for(var g=this.schemas[c][f].propertySchemas(a),k=0;k<g.length;k++)b.addSchema(g[k],e)},addSchemasForIndex:function(a,b){for(var c in this.schemas)for(var e=n.getKeyVariant(c,"idx"),f=0;f<this.schemas[c].length;f++)for(var g=
this.schemas[c][f].indexSchemas(a),k=0;k<g.length;k++)b.addSchema(g[k],e)},removeSubSchemas:function(a){for(var b in this.schemas)a.removeSchema(b)},whenSchemasStable:function(a){this.schemasStableListeners.add(a);this.checkForSchemasStable()}};fa.prototype={update:function(a){this.rawLink=(a=this.potentialLink.canApplyTo(this.dataObj))?this.potentialLink.linkForData(this.dataObj):null;this.active=a;this.updateMonitors.notify(this.active)},rel:function(){return this.potentialLink.rel()},usesKey:function(a){return this.potentialLink.usesKey(a)},
addMonitor:function(a,b){this.updateMonitors.add(a,b)}};ga.prototype={dataUpdated:function(a){if(null==a)for(var b=this.schema.data.property("dependencies").keys(),c=0;c<b.length;c++)a=b[c],this.dataUpdated(a);else if(this.schemaSet.dataObj.property(a).defined())for(b=this.schema.propertyDependencies(a),c=0;c<b.length;c++){var e=b[c];"string"!=typeof e&&this.schemaSet.addSchema(e,this.inferredSchemaKeys[a],this.schemaKeyHistory,!1)}else this.schemaSet.removeSchema(this.inferredSchemaKeys[a])}};h.config=
{antiCacheUrls:!1};h.UriTemplate=K})("undefined"!==typeof module&&module.exports?exports:(this.Jsonary={},this.Jsonary));
(function(h){function v(c){return"object"==typeof c?JSON.parse(JSON.stringify(c)):c}function B(c){c=c||10;for(var f="";f.length<c;)f+=L.charAt(Math.floor(Math.random()*L.length));return f}function M(c){this.uniqueId=F++;var f=this;this.elementLookup={};void 0==c&&(c=A+"."+x++ +B(4)+".");var e=0;this.getElementId=function(){return c+e++};this.enhancementContexts={};this.enhancementActions={};this.enhancementInputs={};"undefined"!=typeof document&&(t.registerChangeListener(function(c,e){c.each(function(c,
g){for(var h=e.affectedData(g),k=0;k<h.length;k++)f.update(h[k],g)})}),t.registerSchemaChangeListener(function(c){for(var e={},h=0;h<c.length;h++){var s=c[h],l=s.uniqueId,k=f.elementLookup[l];if(void 0==k||0==k.length)return;e[l]=k.slice(0)}for(var r=0;r<c.length;r++)for(s=c[r],l=s.uniqueId,k=e[l],h=0;h<k.length;h++)if(l=document.getElementById(k[h]),void 0!=l){var t=l.jsonaryContext,u=v(this.uiStartingState),w=C(s,u,t.usedComponents);w.uniqueId==t.renderer.uniqueId?w.render(l,s,t):t.baseContext.render(l,
s,t.label,u)}}));this.rootContext=this;this.subContexts={};this.oldSubContexts={}}function K(){var c=[],f;for(f in l.elementLookup){for(var e=l.elementLookup[f],g=!1,h=0;h<e.length;h++)if(document.getElementById(e[h])){g=!0;break}g||c.push(f)}for(h=0;h<c.length;h++)delete l.elementLookup[c[h]];for(f in l.enhancementContexts)l.enhancementContexts[f]&&(c=l.enhancementContexts[f],t.log(t.logLevel.WARNING,"Orphaned context for element: "+JSON.stringify(f)+"\ncomponents:"+c.renderer.component.join(", ")+
"\ndata: "+c.data.json()),l.enhancementContexts[f]=null);for(f in l.enhancementActions)l.enhancementActions[f]&&(c=l.enhancementActions[f].context,t.log(t.logLevel.WARNING,"Orphaned action for element: "+JSON.stringify(f)+"\ncomponents:"+c.renderer.component.join(", ")+"\ndata: "+c.data.json()),l.enhancementActions[f]=null);for(f in l.enhancementInputs)l.enhancementInputs[f]&&(c=l.enhancementInputs[f].context,t.log(t.logLevel.WARNING,"Orphaned action for input: "+JSON.stringify(f)+"\ncomponents:"+
c.renderer.component.join(", ")+"\ndata: "+c.data.json()),l.enhancementInputs[f]=null)}function r(c,f,e){"string"==typeof c&&(c=document.getElementById(c));var g=document.createElement("span");g.className="jsonary";c.innerHTML="";c.appendChild(g);c=l.subContext(Math.random());l.oldSubContexts={};l.subContexts={};return c.render(g,f,"render",e)}function E(c){this.renderFunction=c.render||c.enhance;this.renderHtmlFunction=c.renderHtml;this.updateFunction=c.update;this.filterFunction=c.filter;this.actionFunction=
c.action;for(var f in c)void 0==this[f]&&(this[f]=c[f]);this.uniqueId=u++;this.name=c.name||"#"+this.uniqueId;this.component=void 0!=c.component?c.component:y[y.length-1];"string"==typeof this.component&&(this.component=[this.component]);c.saveState&&(this.saveState=c.saveState);c.loadState&&(this.loadState=c.loadState)}function J(c,f,e,g){g=!!g||void 0==g;for(var h=0;h<O.length&&!1!==(0,O[h])(c,f,e,g);h++);}function C(c,f,e){for(var g=c.schemas(),h=0;h<y.length;h++)if(-1==e.indexOf(y[h]))for(var q=
y[h],s=D.length-1;0<=s;s--){var l=D[s];if(-1!=l.component.indexOf(q)&&l.canRender(c,g,f))return l}}var t=h.Jsonary,L="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",A="Jsonary",x=0,w={ADD_REMOVE:"ADD_REMOVE",TYPE_SELECTOR:"TYPE_SELECTOR",RENDERER:"DATA_RENDERER",add:function(c,f){void 0==this[c]&&(this[c]=c,-1!=y.indexOf(f)?y.splice(y.indexOf(f),0,this[c]):y.splice(y.length-1,0,this[c]))}},y=[w.ADD_REMOVE,w.TYPE_SELECTOR,w.RENDERER],F=0;M.prototype={usedComponents:[],rootContext:null,
baseContext:null,labelForData:function(c){if(this.data&&c.document.isDefinitive){var f=c.getLink("self");if(f=f?f.href:c.referenceUrl()){var e=this.data.referenceUrl()||this.data.resolveUrl("");for(c=0;f.substring(0,e.length-c)!=e.substring(0,e.length-c);)c++;f=f.substring(e.length-c);return c?c+"!"+f:"!"+f}}else if(this.data&&this.data.document==c.document){f=this.data.pointerPath();e=c.pointerPath();for(c=0;e.substring(0,f.length-c)!=f.substring(0,f.length-c);)c++;f=e.substring(f.length-c);return c?
c+"!"+f:"!"+f}this.renderer&&t.log(t.logLevel.WARNING,"No label supplied for data in renderer "+JSON.stringify(this.renderer.name));return"$"+c.uniqueId},subContext:function(c,f){t.isData(c)&&(c=this.labelForData(c));f=f||{};var e=this.getSubContext(!1,this.data,c,f);e.renderer=this.renderer;e.uiState||e.loadState(e.uiStartingState);return e},subContextSavedStates:{},saveState:function(){var c={},f;for(f in this.subContexts)c[f]=this.subContexts[f].saveState();for(f in this.oldSubContexts)c[f]=this.oldSubContexts[f].saveState();
return(this.renderer?this.renderer.saveState:E.prototype.saveState).call(this.renderer,this.uiState,c,this.data)},loadState:function(c){c=(this.renderer?this.renderer.loadState:E.prototype.loadState).call(this.renderer,c);this.uiState=c[0];this.subContextSavedStates=c[1]},saveCompleteState:function(c){var f={};f.rendererId=this.renderer?this.renderer.uniqueId:null;f.sub={};var e={actions:{},inputs:{},rootContext:this.uniqueId,contexts:{},documents:{}};e.contexts[this.uniqueId]=f;for(var g in this.subContexts){var h=
this.subContexts[g];f.sub[g]=h.uniqueId;var h=h.saveCompleteState(!0),q;for(q in h.contexts)e.contexts[q]=h.contexts[q];for(q in h.documents)e.documents[q]=h.documents[q]}for(g in this.oldSubContexts){h=this.oldSubContexts[g];f.sub[g]=h.uniqueId;h=h.saveCompleteState(!0);for(q in h.contexts)e.contexts[q]=h.contexts[q];for(q in h.documents)e.documents[q]=h.documents[q]}this.data?(f.data={path:this.data.pointerPath(),document:this.data.document.uniqueId},e.documents[this.data.document.uniqueId]||(e.documents[this.data.document.uniqueId]=
this.data.document.deflate(!0))):f.data=null;if(!c){for(g in this.enhancementActions)for(c=this.enhancementActions[g],e.actions[g]={context:c.context.uniqueId,name:c.actionName,params:c.params},c=c.context;c&&c.baseContext!=c&&e.contexts[c.uniqueId];)e.contexts[c.uniqueId].keep=!0,c=c.baseContext;for(g in this.enhancementInputs)for(c=this.enhancementInputs[g],e.inputs[g]={context:c.context.uniqueId,name:c.actionName,params:c.params},c=c.context;c&&c.baseContext!=c&&e.contexts[c.uniqueId];)e.contexts[c.uniqueId].keep=
!0,c=c.baseContext;c={};for(g in e.contexts)e.contexts[g].keep&&(c[g]=e.contexts[g],delete c[g].keep);e.contexts=c;e.uiState=this.saveState()}return e},getSubContext:function(c,f,e,g){if("object"==typeof e&&null!=e)throw Error("Label cannot be an object");e=e||""===e?e:this.labelForData(f);void 0!=this.oldSubContexts[e]&&(this.subContexts[e]=this.oldSubContexts[e]);void 0!=this.subContexts[e]&&(null===this.subContexts[e].data?this.subContexts[e].data=f:this.subContexts[e].data!=f&&(delete this.subContexts[e],
delete this.oldSubContexts[e],delete this.subContextSavedStates[e]));this.subContextSavedStates[e]&&(g=this.subContextSavedStates[e],delete this.subContextSavedStates[e]);if(void 0==this.subContexts[e]){var h=[];this.data==f&&(h=this.usedComponents.slice(0),void 0!=this.renderer&&(h=h.concat(this.renderer.component)));"object"==typeof c&&(c=c.id);var q=function(c,e,f,g,h,q){this.uniqueId=F++;this.rootContext=c;this.baseContext=e;this.label=f;this.data=g;this.uiStartingState=v(h||{});this.usedComponents=
q;this.subContexts={};this.oldSubContexts={}};q.prototype=this.rootContext;this.subContexts[e]=new q(this.rootContext,this,e,f,g,h)}f=this.subContexts[e];f.elementId=c;f.parent=this;return f},clearOldSubContexts:function(){this.oldSubContexts=this.subContexts;this.subContexts={}},rerender:function(){if(this.parent&&!this.elementId)return this.parent.rerender();var c=document.getElementById(this.elementId);null!=c&&(this.renderer.render(c,this.data,this),this.clearOldSubContexts())},asyncRerenderHtml:function(c){var f=
this;void 0==this.uiState&&this.loadState(this.uiStartingState);this.renderer.asyncRenderHtml(this.data,this,function(e,g){if(e)return c(e,g,f);f.clearOldSubContexts();c(null,g,f)})},render:function(c,f,e,g){void 0==g&&"object"==typeof e&&(g=e,e=null);"string"==typeof f&&(f=t.getData(f));if(void 0!=f.getData){var h=this;c.innerHTML='<div class="loading"></div>';var q=this.getSubContext(c.id,null,e,g);f.getData(function(f){h.render(c,f,e,g)});return q}"object"!=typeof g&&(g={});if(void 0==c.id||""==
c.id)c.id=this.getElementId();var s=c.jsonaryContext,q=this.getSubContext(c.id,f,e,g);c.jsonaryContext=q;if(s){var s=s.data.uniqueId,l=this.elementLookup[s].indexOf(c.id);0<=l&&this.elementLookup[s].splice(l,1)}s=f.uniqueId;void 0==this.elementLookup[s]&&(this.elementLookup[s]=[]);-1==this.elementLookup[s].indexOf(c.id)&&this.elementLookup[s].push(c.id);s=C(f,g,q.usedComponents);void 0!=s?(q.renderer=s,void 0==q.uiState&&q.loadState(q.uiStartingState),s.render(c,f,q),q.clearOldSubContexts()):c.innerHTML=
"NO RENDERER FOUND";return q},renderHtml:function(c,f,e){void 0==e&&"object"==typeof f&&(e=f,f=null);var g=this.getElementId();"string"==typeof c&&(c=t.getData(c));if(void 0!=c.getData){var h=this,q=!1;c.getData(function(k){if(q){var l=document.getElementById(g);l?h.render(l,k,f,e):t.log(t.logLevel.WARNING,"Attempted delayed render to non-existent element: "+g)}else q=!0,c=k});if(!q)return q=!0,'<span id="'+g+'"><div class="loading"></div></span>'}!0===e&&(e=this.uiStartingState);"object"!=typeof e&&
(e={});var l=this.getSubContext(g,c,f,e),r=C(c,e,l.usedComponents);l.renderer=r;void 0==l.uiState&&l.loadState(l.uiStartingState);r=r.renderHtml(c,l);l.clearOldSubContexts();var k=c.uniqueId;void 0==this.elementLookup[k]&&(this.elementLookup[k]=[]);-1==this.elementLookup[k].indexOf(g)&&this.elementLookup[k].push(g);this.addEnhancement(g,l);return'<span id="'+g+'">'+r+"</span>"},asyncRenderHtml:function(c,f,e,g){var h=this;void 0==e&&"object"==typeof f&&(e=f,f=null);var q=this.getElementId();"string"==
typeof c&&(c=t.getData(c));if(void 0!=c.getData){f=f||"async"+Math.random();var l=this.getSubContext(q,null,f,e);c.getData(function(c){h.asyncRenderHtml(c,f,e,g)});return l}!0===e&&(e=this.uiStartingState);"object"!=typeof e&&(e={});l=this.getSubContext(q,c,f,e);q=C(c,e,l.usedComponents);l.renderer=q;void 0==l.uiState&&l.loadState(l.uiStartingState);q.asyncRenderHtml(c,l,function(c,e){l.clearOldSubContexts();g(null,e,l)});return l},update:function(c,f){var e=this.elementLookup[c.uniqueId];if(void 0!=
e&&0!=e.length)for(var e=e.slice(0),g=0;g<e.length;g++){var h=document.getElementById(e[g]);if(void 0!=h){var l=h.jsonaryContext||this.enhancementContexts[e[g]],s=v(this.uiStartingState),r=C(c,s,l.usedComponents);r.uniqueId==l.renderer.uniqueId?r.update(h,c,l,f):l.baseContext.render(h,c,l.label,s)}}},actionHtml:function(c,f){var e=2,g=!1,h=t.render.actionUrl(this,f);"boolean"==typeof f&&(g=arguments[1],h=arguments[2]||h,f=arguments[3],e+=2);for(var l=[];e<arguments.length;e++)l.push(arguments[e]);
e=this.getElementId();this.addEnhancementAction(e,f,this,l,g);return t.render.actionHtml(e,h,c)},inputNameForAction:function(c){var f=!1,e=1;"boolean"==typeof c&&(f=c,c=arguments[1],e++);for(var g=[];e<arguments.length;e++)g.push(arguments[e]);e=this.getElementId();this.enhancementInputs[e]={inputName:e,actionName:c,context:this,params:g,historyChange:f};return e},addEnhancement:function(c,f){this.enhancementContexts[c]=f},addEnhancementAction:function(c,f,e,g,h){null==g&&(g=[]);this.enhancementActions[c]=
{actionName:f,context:e,params:g,historyChange:h}},enhanceElement:function(c){for(var f=c;c;)if(c.firstChild)c=c.firstChild;else{for(;!c.nextSibling&&c!=f;)1==c.nodeType&&this.enhanceElementSingle(c),c=c.parentNode;1==c.nodeType&&this.enhanceElementSingle(c);if(c==f)break;c=c.nextSibling}},enhanceElementSingle:function(c){var f=c.id,e=this.enhancementContexts[f];void 0!=e&&(c.jsonaryContext=e,delete this.enhancementContexts[f],f=e.renderer,void 0!=f&&f.enhance(c,e.data,e));var g=this.enhancementActions[c.id];
void 0!=g&&(delete this.enhancementActions[c.id],c.onclick=function(){var c=g.context,e=[c,g.actionName].concat(g.params);c.renderer.action.apply(c.renderer,e)&&c.rerender();J(c.data,c,g.actionName,g.historyChange);return!1});var h=this.enhancementInputs[c.name];void 0!=h&&(delete this.enhancementInputs[c.name],c.onchange=function(){var c=this.value;"checkbox"==this.getAttribute("type")&&(c=this.checked);if("select"==this.tagName.toLowerCase()&&null!=this.getAttribute("multiple"))for(var c=[],e=0;e<
this.options.length;e++){var f=this.options[e];f.selected&&c.push(f.value)}e=h.context;c=[e,h.actionName,c].concat(h.params);e.renderer.action.apply(e.renderer,c)&&e.rerender();J(e.data,e,h.actionName,h.historyChange)});c=null}};var l=new M;r.loadDocumentsFromState=function(c,f){var e={},g=0,h=null,l;for(l in c.documents)g++,e[l]=t.inflate(c.documents[l],function(c,l){h=h||c;g--;0==g&&f&&f(h,e)});c.parsedDocuments=function(){return e};return e};r.loadCompleteState=function(c){function f(e){e=c.contexts[e];
return e.data?h[e.data.document].root.subPath(e.data.path):null}function e(h,k){var l=c.contexts[k];g[k]=h;h.renderer=P[l.rendererId];h.loadState(h.uiStartingState);if(l.sub)for(var q in l.sub){var r=l.sub[q];if(!g[r]&&c.contexts[r]){var s=f(r),s=h.getSubContext("",s,q);e(s,r)}}}var g={};c.parsedDocuments||r.loadDocumentsFromState(c);var h=c.parsedDocuments(),q=c.rootContext,s=f(q),s=l.getSubContext("",s,null,c.uiState);e(s,q);var t={},k;for(k in c.actions)(function(e,f){f=c.actions[e];var h=g[f.context];
t[e]=function(){var c=[h,f.name].concat(f.params||[]);return h.renderer.action.apply(h.renderer,c)}})(k,c.actions[k]);var u={};for(k in c.inputs)(function(e,f){f=c.inputs[e];var h=g[f.context];u[e]=function(c){c=[h,f.name,c].concat(f.params||[]);return h.renderer.action.apply(h.renderer,c)}})(k,c.inputs[k]);return{context:s,actions:t,inputs:u}};"undefined"!=typeof document&&setInterval(K,3E4);"undefined"!=typeof document&&(t.cleanup=K);r.empty=void 0!=h.jQuery?function(c){h.jQuery(c).empty()}:function(c){c.innerHTML=
""};r.Components=w;r.actionUrl=function(c,f){return"javascript:void(0)"};r.actionHtml=function(c,f,e){return'<a href="'+t.escapeHtml(f)+'" id="'+c+'" class="jsonary-action">'+e+"</a>"};r.saveData=function(c,f){if("undefined"==typeof localStorage)return"LOCALSTORAGE_MISSING";localStorage[c.saveStateId]=JSON.stringify({accessed:(new Date).getTime(),data:c.deflate()});return f};r.loadData=function(c){if("undefined"!=typeof localStorage&&(c=localStorage[c]))return c=JSON.parse(c),t.inflate(c.data)};var u=
0;E.prototype={updateAll:function(){var c=[],f;for(f in l.elementLookup)c=c.concat(l.elementLookup[f]);for(f=0;f<c.length;f++){var e=document.getElementById(c[f]);void 0!=e&&(e=e.jsonaryContext,(e.renderer.uniqueId=this.uniqueId)&&e.rerender())}},render:function(c,f,e){if(null==c)return t.log(t.logLevel.WARNING,"Attempted to render to non-existent element.\n\tData path: "+f.pointerPath()+"\n\tDocument: "+f.document.url),this;void 0!=c[0]&&(c=c[0]);r.empty(c);c.innerHTML=this.renderHtml(f,e);null!=
this.renderFunction&&this.renderFunction(c,f,e);e.enhanceElement(c);return this},renderHtml:function(c,f){var e="";void 0!=this.renderHtmlFunction&&(e=this.renderHtmlFunction(c,f));return e},asyncRenderHtml:function(c,f,e){function g(){l--;if(!(0<l)){for(var c in r);e(null,h,f)}}var h="",l=1,r={};if(void 0!=this.renderHtmlFunction)var t=function(c,e,f){var h="<<ASYNC"+Math.random()+">>",k=null;l++;this.asyncRenderHtml(c,e,f,function(c,e){k=r[h]=e;g()});return null!==k?(delete r[h],k):h},k=function(c){var e=
Object.create(c);e.renderHtml=t;e.subContext=function(){return k(c.subContext.apply(this,arguments))};return e},h=this.renderHtmlFunction(c,k(f));g()},enhance:function(c,f,e){null!=this.renderFunction&&this.renderFunction(c,f,e);return this},update:function(c,f,e,g){(void 0!=this.updateFunction?this.updateFunction(c,f,e,g):this.defaultUpdate(c,f,e,g))&&this.render(c,f,e);return this},action:function(c,f){return this.actionFunction.apply(this,arguments)},canRender:function(c,f,e){return void 0!=this.filterFunction?
this.filterFunction(c,f,e):!0},defaultUpdate:function(c,f,e,g){c=!1;e="replace"!=g.action();f=f.pointerPath();g.subjectEquals(f)||e&&!1!==g.subjectChild(f)?c=!0:void 0!=g.target()&&(g.targetEquals(f)||e&&!1!==g.targetChild(f))&&(c=!0);return c},saveState:function(c,f,e){e={};for(key in c)e[key]=c[key];for(var g in f)for(var h in f[g])e[g+"-"+h]=f[g][h];for(key in e)t.isData(e[key])&&(e[key]=this.saveStateData(e[key]));return e},saveStateData:function(c){if(c){if(c.document.isDefinitive)return"url:"+
c.referenceUrl();c.saveStateId=c.saveStateId||B();return r.saveData(c,c.saveStateId)||c.saveStateId}},loadState:function(c){var f={},e={},g;for(g in c)if(-1!=g.indexOf("-")){var h=g.split("-"),l=h.shift(),h=h.join("-");e[l]||(e[l]={});e[l][h]=c[g]}else f[g]=this.loadStateData(c[g])||c[g],t.isRequest(f[g])&&function(c){f[c].getData(function(e){f[c]=e})}(g);return[f,e]},loadStateData:function(c){if(c&&"string"==typeof c){if("url:"==c.substring(0,4)){c=c.substring(4);var f=null;c=t.getData(c,function(c){f=
c});return f||c}if(f=r.loadData(c))f.saveStateId=c;return f}}};E.prototype.super_=E.prototype;var P={},D=[];r.register=function(c){c=new E(c);P[c.uniqueId]=c;D.push(c);return c};r.deregister=function(c){"object"==typeof c&&(c=c.uniqueId);delete P[c];for(var f=0;f<D.length;f++)D[f].uniqueId==c&&(D.splice(f,1),f--)};var O=[];r.addActionHandler=function(c){O.push(c)};"undefined"!=typeof h.jQuery&&(w=function(c,f){var e=this[0];void 0!=e&&r(e,c,f);return this},t.extendData({$renderTo:function(c,f){"string"==
typeof c&&(c=jQuery(c));var e=c[0];void 0!=e&&r(e,this,f)}}),w.register=function(c){if(void 0!=c.render){var f=c.render;c.render=function(c,e){var h=$(c);f.call(this,h,e)}}if(void 0!=c.update){var e=c.update;c.update=function(c,f,h){c=$(c);e.call(this,c,f,h)}}r.register(c)},w.empty=function(c){c.each(function(c,e){r.empty(e)})},jQuery.fn.extend({renderJson:w}),jQuery.extend({renderJson:w}));t.extend({render:r,renderHtml:function(c,f){var e=l.renderHtml(c,null,f);l.oldSubContexts={};l.subContexts=
{};return'<span class="jsonary">'+e+"</span>"},asyncRenderHtml:function(c,f,e){return l.asyncRenderHtml(c,null,f,function(c,f){c&&e(c,f);e('<span class="jsonary">'+result+"</span>")})}});t.extendData({renderTo:function(c,f){"string"==typeof c&&(c=document.getElementById(c));r(c,this,f)}})})(this);