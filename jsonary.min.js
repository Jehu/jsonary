(function(G){function z(a){var b=a.match(/^[a-zA-Z\-]+:/);null!=b&&0<b.length?(this.scheme=b[0].substring(0,b[0].length-1),a=a.substring(b[0].length)):this.scheme=null;"//"==a.substring(0,2)?(this.doubleSlash=!0,a=a.substring(2)):this.doubleSlash=!1;b=a.indexOf("#");if(0<=b){var c;c=a.substring(b+1);-1!=c.indexOf("?")?(c.isQuery=!1,c=void 0):c=K(c);this.fragment=c;a=a.substring(0,b)}else this.hash=null;b=a.indexOf("?");0<=b?(c=a.substring(b+1),this.query=K(c),a=a.substring(0,b)):this.query=null;b=
a.indexOf("@");if(0<=b){c=a.substring(0,b);var e=c.indexOf(":");-1==e?(this.username=c,this.password=null):(this.username=c.substring(0,e),this.password=c.substring(e+1));a=a.substring(b+1)}else this.password=this.username=null;b=0;if(null!=this.scheme||this.doubleSlash)b=a.indexOf("/");0<=b?(this.path=a.substring(b),""==this.path&&(this.path=null),a=a.substring(0,b)):this.path=null;e=a.indexOf(":");0<=e?(this.port=a.substring(e+1),a=a.substring(0,e)):this.port=null;this.domain=""==a?null:a}function K(a){a=
a.split("&");for(var b=[],c=0;c<a.length;c++){var e=a[c],g=e.indexOf("=");if(-1==g)b.push({key:e});else{var m=e.substring(0,g),e=e.substring(g+1);b.push({key:m,value:decodeURIComponent(e)})}}for(m in Z)b[m]=Z[m];b.isQuery=!0;return b}function M(a){var b="";ha[a.charAt(0)]&&(b=a.charAt(0),a=a.substring(1));var c=",",e="",g=!0,m=!1;"+"==b?g=!1:"."==b?c=e=".":"/"==b?c=e="/":"#"==b?(e="#",g=!1):";"==b?(c=e=";",m=!0):"?"==b?(e="?",c="&",m=!0):"&"==b&&(c=e="&",m=!0);b=[];a=a.split(",");for(var d=[],x=0;x<
a.length;x++){var r=a[x],h=null;-1!=r.indexOf(":")&&(h=r.split(":"),r=h[0],h=parseInt(h[1]));for(var j={};ia[r.charAt(r.length-1)];)j[r.charAt(r.length-1)]=!0,r=r.substring(0,r.length-1);d.push({truncate:h,name:r,suffices:j});b.push(r)}a=function(a){for(var b=e,h=0;h<d.length;h++){var x=d[h];0<h&&(b+=c);var r=a(x.name);if(Array.isArray(r)){m&&(b+=x.name+"=");for(var j=0;j<r.length;j++)0<j&&(b+=x.suffices["*"]?c:",",x.suffices["*"]&&m&&(b+=x.name+"=")),b+=g?encodeURIComponent(r[j]).replace("!","%21"):
encodeURI(r[j]).replace("%25","%")}else if("object"==typeof r){m&&!x.suffices["*"]&&(b+=x.name+"=");var j=!0,k;for(k in r)j||(b+=x.suffices["*"]?c:","),j=!1,b+=g?encodeURIComponent(k).replace("!","%21"):encodeURI(k).replace("%25","%"),b+=x.suffices["*"]?"=":",",b+=g?encodeURIComponent(r[k]).replace("!","%21"):encodeURI(r[k]).replace("%25","%")}else m&&(b+=x.name+"="),null!=x.truncate&&(r=r.substring(0,x.truncate)),b+=g?encodeURIComponent(r).replace("!","%21"):encodeURI(r).replace("%25","%")}return b};
a.varNames=b;return a}function A(a){a=a.split("{");for(var b=[a.shift()],c=[],e=[];0<a.length;){var g=a.shift(),m=g.split("}")[0],g=g.substring(m.length+1),m=M(m);c.push(m);b.push(g);e=e.concat(m.varNames)}this.fill=function(a){for(var e=b[0],g=0;g<c.length;g++)e+=(0,c[g])(a),e+=b[g+1];return e};this.varNames=e}function y(a,b){for(var c in b)(function(b,c){a[b]=function(){return c}})(c,b[c])}function E(a){this.contents={};this.keyOrder=[];this.context=a}function H(a){this.listeners=[];this.context=
a}function L(a,b){var c=this;this.baseUrl=a.url;this.fragment=b;null==b&&(b="");this.url=this.baseUrl+"#"+encodeURI(b);this.getRoot=function(b){a.getRoot(function(a){b.call(a,a,c)})};this.getData=function(e){null==b||""==b?a.document.getRoot(function(a){e.call(a,a,c)}):a.document.getFragment(b,function(a){e.call(a,a,c)})};this.getRawResponse=function(b){a.getResponse(function(a){b.call(a,a,c)})}}function B(a,b,c,e,g){a=k.resolveRelativeUri(a);c=k.encodeData(c,e);"GET"==b&&""!=c&&(a=-1==a.indexOf("?")?
a+"?":a+"&",a+=c,c="");k.log(k.logLevel.STANDARD,"Sending request for: "+a);this.errorMessage=this.successful=void 0;this.url=a;var m=void 0==c||""==c;this.responseListeners=new H(this);this.document=new F(a,m,!0);this.fetched=!1;this.fetchData(a,b,c,e,g);this.invalidate=function(){"GET"==b&&this.fetchData(a,b,c,e,g)}}function C(a,b,c,e,g){e(g,this);var m=this;this.url=a;this.responseListeners=new H(this);this.document=new F(a,!0,!0);this.document.setRaw(b);this.profileUrl=c;void 0!=c&&this.document.raw.addSchema(c);
a==c?this.document.setRoot(""):this.document.raw.whenSchemasStable(function(){var a=m.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),m.document.setRoot(a)):m.document.setRoot("")});this.successful=!0;this.errorMessage=void 0;this.fetched=!1;this.invalidate=function(){this.fetchData(a,"GET",void 0,"application/x-www-form-urlencoded",c)}}function u(a){this.operations=[];void 0==a&&(a="");this.prefix=a}function D(a,b,c){this._patchType=a;this._subject=b;
this._subjectValue=void 0;"move"==a?this._target=c:this._value=c}function F(a,b,c){this.readOnly=!!c;this.url=a;this.isDefinitive=b;var e={};this.raw=new d(this,e);this.root=null;var g=[];this.registerChangeListener=function(a){g.push(a)};this.setRaw=function(a){e.setValue(a)};var m=new H(this);this.getRoot=function(a){null==this.root?m.add(a):a.call(this,this.root)};this.setRoot=function(a){this.root=this.raw.subPath(a);m.notify(this.root)};this.patch=function(a){var b=this;if(this.readOnly)throw Error("Cannot update read-only document");
if(Q)void 0==this.batchPatch&&(this.batchPatch=new u,R.push(this)),this.batchPatch.operations=this.batchPatch.operations.concat(a.operations);else{I.increment();var c=aa.concat(g);I.add(function(){for(var e=0;e<c.length;e++)c[e].call(b,a,b)});var e=a.filter("?"),m=a.filterRemainder("?");this.raw.patch(e);this.root.patch(m);I.decrement()}};this.affectedData=function(a){for(var b=a.subject(),c=null,c="?"==b||"?/"==b.substring(0,2)?this.raw.subPath(b.substring(1)):this.root.subPath(b),b=[];void 0!=c;)b.push(c),
c=c.parent();if("move"==a.action()){a=a.target();c=null;c="?"==a||"?/"==a.substring(0,2)?this.raw.subPath(a.substring(1)):this.root.subPath(a);for(b.push();void 0!=c;)b.push(c),c=c.parent()}return b}}function d(a,b,c,e){this.uniqueId=ja++;this.document=a;this.readOnly=function(){return a.readOnly};var g=void 0,m=void 0,v=0,h=[],r={},j={};this.property=function(a){void 0==r[a]&&(j[a]={},r[a]=new d(this.document,j[a],this,a),"object"==m&&(j[a].setValue(g[a]),void 0!==g[a]&&b.schemas.addSchemasForProperty(a,
r[a])));return r[a]};var l={},n={};this.item=function(a){if(!N.test(a))throw Error("Index must be a positive integer (or integer-value string)");void 0==l[a]&&(n[a]={},l[a]=new d(this.document,n[a],this,a),"array"==m&&(n[a].setValue(g[a]),void 0!==g[a]&&b.schemas.addSchemasForIndex(a,l[a])));return l[a]};this.parent=function(){return c};this.parentKey=function(){return e};this.pointerPath=function(){return this.document.root==this?"":void 0!=c?c.pointerPath()+"/"+k.encodePointerComponent(e):"?"};
this.basicType=function(){return m};this.value=function(){if("object"==m){for(var a={},b=0;b<h.length;b++){var c=h[b];a[c]=void 0!=r[c]?r[c].value():g[c]}return a}if("array"==m){a=[];for(b=0;b<v;b++)a[b]=void 0!=l[b]?l[b].value():g[b];return a}return g};this.keys=function(){return h.slice(0)};this.length=function(){return v};this.patch=function(a){var c=this,e=this.pointerPath(),d={};a.each(function(a,k){if(k.subjectEquals(e))if("replace"==k.action()||"add"==k.action())k.setSubjectValue(c.value()),
b.setValue(k.value());else{if("remove"!=k.action()&&"move"!=k.action())throw Error("Unrecognised patch operation: "+k.action());}else if(k.targetEquals(e))"move"==k.action()&&b.setValue(k.subjectValue());else{var f=k.subjectChild(e);if(f)if(d[f]=!0,"object"==m)if("add"==k.action()){var p=h.indexOf(f);if(-1!=p)throw Error("Cannot add existing key: "+f);h.push(f);g[f]=k.value();void 0!=r[f]&&(j[f].setValue(k.value()),b.schemas.addSchemasForProperty(f,r[f]))}else if("remove"==k.action()||"move"==k.action()){p=
h.indexOf(f);if(-1==p)throw Error("Cannot delete missing key: "+f);k.setSubjectValue(c.propertyValue(f));h.splice(p,1);void 0!=j[f]&&j[f].setValue(void 0);delete g[f]}else{if("replace"!=k.action())throw Error("Unrecognised patch operation: "+k.action());}else if("array"==m){if(!N.test(f))throw Error("Cannot patch non-numeric index: "+f);p=parseInt(f);if("add"==k.action()){if(p>v)throw Error("Cannot add past the end of the list");for(f=v-1;f>=p;f--)void 0!=n[f+1]&&(void 0==l[f]?n[f+1].setValue(g[f]):
n[f+1].setValue(l[f].value()));g.splice(p,0,k.value());v++;void 0!=l[g.length-1]&&b.schemas.addSchemasForIndex(g.length-1,l[g.length-1])}else if("remove"==k.action()||"move"==k.action()){if(p>=v)throw Error("Cannot remove a non-existent index");k.setSubjectValue(c.itemValue(p));for(f=p;f<v-1;f++)void 0!=n[f]&&(void 0==l[f+1]?n[f].setValue(g[f+1]):n[f].setValue(l[f+1].value()));void 0!=n[v-1]&&n[v-1].setValue(void 0);v--;g.splice(p,1)}else if("replace"!=k.action())throw Error("Unrecognised patch operation: "+
k.action());}if(f=k.targetChild(e))if(d[f]=!0,"object"==m){if("move"==k.action()){p=h.indexOf(f);if(-1!=p)throw Error("Cannot move to existing key: "+f);h.push(f);g[f]=k.subjectValue();void 0!=r[f]&&b.schemas.addSchemasForProperty(f,r[f])}}else if("array"==m){if(!N.test(f))throw Error("Cannot patch non-numeric index: "+f);p=parseInt(f);if("move"==k.action()){if(p>v)throw Error("Cannot add past the end of the list");for(f=v-1;f>=p;f--)void 0!=n[f+1]&&(void 0==l[f]?n[f+1].setValue(g[f]):n[f+1].setValue(l[f].value()));
g.splice(p,0,k.subjectValue());v++;void 0!=l[g.length-1]&&b.schemas.addSchemasForIndex(g.length-1,l[g.length-1])}}}});if("object"==m)for(var f=0;f<h.length;f++){var p=h[f],q=a.filter("/"+k.encodePointerComponent(p));q.isEmpty()||this.property(p).patch(q)}else if("array"==m)for(f=0;f<v;f++)q=a.filter("/"+k.encodePointerComponent(f)),q.isEmpty()||this.index(f).patch(q);for(p in d)b.schemas.update(p)};b.setValue=function(a){var c=k.guessBasicType(a,m),e=g;g=a;if(c!=m){if("object"==m)for(var d in r)j[d].setValue(void 0);
else if("array"==m)for(var f in l)n[f].setValue(void 0);m=c}if("object"==c){for(d in r)a.hasOwnProperty(d)?(r[d].defined()||b.schemas.addSchemasForProperty(d,r[d]),j[d].setValue(a[d])):j[d].setValue(void 0);h=Object.keys(a);v=0}else if("array"==c){for(f in l)f<a.length?(l[f].defined()||b.schemas.addSchemasForIndex(f,l[f]),n[f].setValue(a[f])):n[f].setValue(void 0);h=[];v=a.length}else h=[],v=0;void 0===a?void 0!==e&&b.schemas.clear():b.schemas.update(null)};b.schemas=new ba(this);this.schemas=function(){return b.schemas.getSchemas()};
this.whenSchemasStable=function(a){b.schemas.whenSchemasStable(a);return this};this.links=function(a){return b.schemas.getLinks(a)};this.addLink=function(a){b.schemas.addLink(a);return this};this.addSchema=function(a,c){b.schemas.addSchema(a,c);return this};this.removeSchema=function(a){b.schemas.removeSchema(a);return this};this.addSchemaMatchMonitor=function(a,c,e,g){return b.schemas.addSchemaMatchMonitor(a,c,e,g)}}function h(a,b){return f.getData(a,function(a,e){var g=a.asSchema();void 0!=b&&b.call(g,
g,e)})}function j(a){void 0==S[a]&&(S[a]=f.createSchema({type:a}));return S[a]}function l(a){this.data=a;a.referenceUrl();a.propertyValue("id");var b=[];a=a.property("links");void 0!==a&&a.indices(function(a,e){b[b.length]=new p(e)});this.links=function(){return b.slice(0)};this.schemaTitle=this.title()}function p(a){this.data=a;var b;b=a.propertyValue("href");for(var c=[],e=!1,g=!1,m=0;m<b.length;m++){var d=b.charAt(m);e?g?")"==d?")"==b.charAt(m+1)?(c.push(T[")"]),m++):g=!1:void 0!=T[d]?c.push(T[d]):
c.push(encodeURIComponent(d)):"$"==d?c.push("%73elf"):"("==d?")"==b.charAt(m+1)?(c.push("%65mpty"),m++):g=!0:("}"==d&&(e=!1),c.push(d)):("{"==d&&(e=!0),c.push(d))}b=c.join("");this.uriTemplate=new A(b);this.dataParts=[];for(b=0;b<this.uriTemplate.varNames.length;b++)this.dataParts.push(n(this.uriTemplate.varNames[b]));b=a.property("schema");b.defined()?(b=b.asSchema(),this.submissionSchemas=new w([b])):this.submissionSchemas=new w;a=a.property("targetSchema");a.defined()&&(this.targetSchema=a.asSchema());
this.handlers=[];this.preHandlers=[]}function n(a){return"%65mpty"==a?"":"%73elf"==a?null:decodeURIComponent(a)}function q(a,b,c){this.rawLink=a;this.definition=b;this.subjectData=c;this.href=a.href;b=this.href.indexOf("#");0<=b?(this.hrefBase=this.href.substring(0,b),this.hrefFragment=this.href.substring(b+1)):(this.hrefBase=this.href,this.hrefFragment="");this.rel=a.rel;this.method=void 0!=a.method?a.method:"GET";void 0!=a.enctype&&(a.encType=a.enctype,delete a.enctype);this.encType=void 0==a.encType?
"GET"==this.method?"application/x-www-form-urlencoded":"POST"==this.method||"PUT"==this.method?"application/json":"application/x-www-form-urlencoded":a.encType;null!=this.definition&&(this.submissionSchemas=this.definition.submissionSchemas,this.targetSchema=this.definition.targetSchema)}function t(a,b,c){var e=this;this.monitorKey=a;this.match=!1;this.matchFailReason=new s("initial failure",null);this.monitors=new E(c);this.propertyMatches={};this.indexMatches={};this.dependencies={};this.dependencyKeys=
{};this.schemaLoaded=!1;this.data=b;c.getFull(function(a){e.schemaLoaded=!0;e.schema=a;e.basicTypes=a.basicTypes();e.setupXorSelectors();e.setupOrSelectors();e.setupAndMatches();e.setupNotMatches();e.dataUpdated()})}function s(a,b,c){this.message=a;this.schema=b;this.subMatchFailReason=c}function U(a,b,c){var e=this;this.options=b;this.selectedOption=this.matchCallback=null;this.data=c;this.subMatches=[];this.subSchemaKeys=[];for(var g=!1,m=0;m<b.length;m++)this.subSchemaKeys[m]=k.getKeyVariant(a,
"option"+m),this.subMatches[m]=c.addSchemaMatchMonitor(this.subSchemaKeys[m],b[m],function(){g||(g=!0,I.add(function(){g=!1;e.update()}))},!1);this.update()}function V(a,b,c){var e=this;this.options=b;this.matchCallback=null;this.selectedOptions=[];this.data=c;this.subMatches=[];this.subSchemaKeys=[];for(var g=!1,m=0;m<b.length;m++)this.subSchemaKeys[m]=k.getKeyVariant(a,"option"+m),this.subMatches[m]=c.addSchemaMatchMonitor(this.subSchemaKeys[m],b[m],function(){g||(g=!0,I.add(function(){g=!1;e.update()}))},
!1);this.update()}function W(a){for(var b=0;b<a.length;b++)this[b]=a[b];this.length=a.length}function w(a,b){if(void 0==a)this.length=0;else{void 0==b&&(b=a);this.fixed=function(){var c=b.length<a.length?new w(b):this;this.fixed=function(){return c};return c};var c;for(c=0;c<a.length;c++)this[c]=a[c];this.length=a.length}}function ba(a){this.dataObj=a;this.schemas={};this.schemasFixed={};this.links={};this.matches={};this.xorSelectors={};this.orSelectors={};this.dependencySelectors={};this.schemaFlux=
0;this.schemasStable=!0;this.schemasStableListeners=new H(a);this.pendingNotify=!1;this.cachedLinkList=this.cachedSchemaList=null}function ca(a,b){this.dataObj=a;this.potentialLink=b;this.active=!1;this.rawLink=null;this.updateMonitors=new E(a)}function ka(a,b,c,e){var g=k.getKeyVariant(b,"$");this.xorSelector=new U(b,a,e.dataObj);this.xorSelector.onMatchChange(function(a){e.removeSchema(g);null!=a&&e.addSchema(a,g,c,!1)})}function la(a,b,c,e){for(var g=[],m=[],d=0;d<a.length;d++)g[d]=k.getKeyVariant(b,
"$"+d),m[d]=!1;this.orSelector=new V(b,a,e.dataObj);this.orSelector.onMatchChange(function(b){for(var d=0;d<a.length;d++){for(var f=!1,v=0;v<b.length;v++)if(a[d]==b[v]){f=!0;break}f&&!m[d]?e.addSchema(a[d],g[d],c,!1):!f&&m[d]&&e.removeSchema(g[d]);m[d]=f}})}function da(a,b,c,e){this.inferredSchemaKeys={};this.applied={};this.schema=a;this.schemaKeyHistory=c;this.schemaSet=e;a=this.schema.data.property("dependencies").keys();for(c=0;c<a.length;c++)e=a[c],this.inferredSchemaKeys[e]=k.getKeyVariant(b,
"$"+c),this.dataUpdated(e)}var f={toString:function(){return"[JsonApi]"}};G.Jsonary=f;z.prototype={toString:function(){var a="";null!=this.scheme&&(a+=this.scheme+":");this.doubleSlash&&(a+="//");null!=this.username&&(a+=this.username,null!=this.password&&(a+=":"+this.password),a+="@");null!=this.domain&&(a+=this.domain);null!=this.port&&(a+=":"+this.port);null!=this.path&&(a+=this.path);null!=this.query&&(a+="?"+this.query);null!=this.fragment&&(a+="#"+this.fragment);return a}};z.resolve=function(a,
b){if(void 0==b)return a;if(void 0==a)return b;a instanceof z||(a=new z(a));result=new z(b+"");if(null==result.scheme&&(result.scheme=a.scheme,result.doubleSlash=a.doubleSlash,null==result.domain))if(result.domain=a.domain,result.port=a.port,result.username=a.username,result.password=a.password,null==result.path)result.path=a.path,null==result.query&&(result.query=a.query);else if("/"!=result.path.charAt(0)&&null!=a.path){var c="/"==a.path.charAt(0),e;e=c?a.path.substring(1).split("/"):a.path.split("/");
".."==e[e.length-1]&&e.push("");e.pop();for(var g=e.length-1;0<=g;g--)"."==e[g]&&e.slice(g,1);for(var m=result.path.split("/"),g=0;g<m.length;g++){var d=m[g];if("."!=d)if(".."==d)if(0<e.length&&".."!=e[e.length-1])e.pop();else{if(!c){e=e.concat(m.slice(g));break}}else e.push(d)}result.path=(c?"/":"")+e.join("/")}return result.toString()};z.parse=function(a){return new z(a)};var Z={toString:function(){for(var a=[],b=0;b<this.length;b++)"undefined"==typeof this[b].value?a.push(this[b].key):a.push(this[b].key+
"="+encodeURIComponent(this[b].value));return a.join("&")},get:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a)return this[c].value;return b},set:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a){this[c].value=b;return}this.push({key:a,value:b})}};f.Uri=z;var ha={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},ia={"*":!0},k={guessBasicType:function(a){if(null===a)return"null";if(Array.isArray(a))return"array";if("object"==typeof a)return"object";if("string"==typeof a)return"string";
if("number"==typeof a)return 0==a%1?"integer":"number";if("boolean"==typeof a)return"boolean"},resolveRelativeUri:function(a,b){return z.resolve(a,b)},urlsEqual:function(a,b){"#"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));"#"==b.charAt(b.length-1)&&(b=b.substring(0,b.length-1));return a==b},linksEqual:function(a,b){if(void 0==a||void 0==b)return a==b;if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++){var e=a[c],g=b[c];if(e.href!=g.href||e.rel!=g.rel||(e.method!=g.method||e["enc-type"]!=
g["enc-type"])||e.schema!=g.schema)return!1}return!0},log:function(a,b){try{a>=k.logLevel.WARNING&&console.log("Log level "+a+": "+b)}catch(c){}},logLevel:{DEBUG:-1,STANDARD:0,WARNING:1,ERROR:2},getKeyVariant:function(a,b){void 0==b&&(b=k.getUniqueKey());b+="";if(0<=b.indexOf("."))throw Error("variant name cannot contain a dot: "+b);return a+"."+b},keyIsVariant:function(a,b){a+="";b+="";return a===b||a.substring(0,b.length+1)===b+"."},keyIsRoot:function(a){return-1==a.indexOf(".")},hcf:function(a,
b){a=Math.abs(a);for(b=Math.abs(b);;){var c=a%b;if(0==c)return b;if(isNaN(c))return NaN;a=b;b=c}},recursiveCompare:function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(!k.recursiveCompare(a[c],b[c]))return!1;return!0}if("object"==typeof a){for(c in a)if(void 0===b[c]&&void 0!==a[c])return!1;for(c in b)if(void 0===a[c]&&void 0!==a[c])return!1;for(c in a)if(!k.recursiveCompare(a[c],b[c]))return!1;return!0}return a===b},lcm:function(a,b){return Math.abs(a*
b/this.hcf(a,b))},encodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.stringify(a);if("application/x-www-form-urlencoded"==b)return k.formEncode(a);throw Error("Unknown encoding type: "+this.encType);},decodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.parse(a);if("application/x-www-form-urlencoded"==b)return k.formDecode(a);throw Error("Unknown encoding type: "+this.encType);
},formEncode:function(a,b){void 0==b&&(b="");var c=[];if(Array.isArray(a))for(var e=0;e<a.length;e++){var g=""==b?e:b+encodeURIComponent("[]"),d=""==b?e:b+encodeURIComponent("["+e+"]"),f=a[e];null==f?c.push(g+"=null"):"object"==typeof f?c.push(k.formEncode(f,d)):"boolean"==typeof f?f?c.push(g+"=true"):c.push(g+"=false"):c.push(g+"="+encodeURIComponent(f))}else if("object"==typeof a)for(g in a)a.hasOwnProperty(g)&&(f=a[g],""!=b&&(g=b+encodeURIComponent("["+g+"]")),"null"==f?c.push(g+"=null"):"object"==
typeof f?c.push(k.formEncode(f,g)):"boolean"==typeof f?f?c.push(g+"=true"):c.push(g+"=false"):c.push(g+"="+encodeURIComponent(f)));else c.push(encodeURIComponent(a));return c.join("&")},formDecode:function(a){var b={};a=a.split("&");for(var c=0;c<a.length;c++){var e=a[c],g=e,d="";0<=e.indexOf("=")&&(g=e.substring(0,e.indexOf("=")),d=decodeURIComponent(e.substring(e.indexOf("=")+1)),"true"==d?d=!0:"false"==d?d=!1:"null"==d?d=null:parseFloat(d)+""==d&&(d=parseFloat(d)));for(var g=decodeURIComponent(g),
e=b,g=g.split("["),f=1;f<g.length;f++)g[f]=g[f].substring(0,g[f].length-1);for(f=0;f<g.length;f++)Array.isArray(e)&&""==g[f]&&(g[f]=e.length),f==g.length-1?e[g[f]]=d:(void 0==e[g[f]]&&(e[g[f]]=""==g[f+1]?[]:{}),e=e[g[f]])}return b},encodePointerComponent:function(a){return a.toString().replace("~","~0").replace("/","~1")},decodePointerComponent:function(a){return a.toString().replace("~1","/").replace("~0","~")},splitPointer:function(a){a=a.split("/");""==a[0]&&a.shift();for(var b=0;b<a.length;b++)a[b]=
k.decodePointerComponent(a[b]);return a},joinPointer:function(){for(var a="",b=0;b<parts.length;b++)a+="/"+k.encodePointerComponent(parts[b]);return a}},ma=0;k.getUniqueKey=function(){return ma++};f.getMonitorKey=k.getUniqueKey;f.getKeyVariant=function(a,b){return k.getKeyVariant(a,"~"+b)};f.keyIsVariant=k.keyIsVariant;f.log=function(a,b){if("number"!=typeof a)throw alert("First argument to log() must be a number (preferably enum value from .logLevel)"),Error("First argument to log() must be a number (preferably enum value from .logLevel)");
k.log(a,b)};f.setLogFunction=function(a){k.log=a};f.logLevel=k.logLevel;f.encodeData=k.encodeData;f.decodeData=k.decodeData;f.encodePointerComponent=k.encodePointerComponent;f.decodePointerComponent=k.decodePointerComponent;f.splitPointer=k.splitPointer;f.joinPointer=k.joinPointer;f.extend=function(a){for(var b in a)void 0==f[b]&&(f[b]=a[b])};E.prototype={add:function(a,b){if("string"!=typeof a&&"number"!=typeof a)throw Error("First argument must be a monitorKey, obtained using getMonitorKey()");
this.contents[a]=b;this.addKey(a)},addKey:function(a){var b;for(b=0;b<this.keyOrder.length;b++){var c=this.keyOrder[b];if(c==a)return;if(k.keyIsVariant(a,c)){this.keyOrder.splice(b,0,a);return}}this.keyOrder.push(a)},remove:function(a){delete this.contents[a];this.removeKey(a);a+=".";for(var b in this.contents)b.substring(0,a.length)==a&&(this.removeKey(b),delete this.contents[b])},removeKey:function(a){a=this.keyOrder.indexOf(a);0<=a&&this.keyOrder.splice(a,1)},notify:function(){for(var a=arguments,
b=0;b<this.keyOrder.length;b++)this.contents[this.keyOrder[b]].apply(this.context,a)},isEmpty:function(){for(var a in this.contents)if(0!==this.contents[a].length)return!1;return!0}};H.prototype={add:function(a){this.listeners[this.listeners.length]=a},notify:function(){for(var a=arguments;0<this.listeners.length;)this.listeners.shift().apply(this.context,a)},isEmpty:function(){return 0===this.listeners.length}};var I={depth:0,callbacks:[],increment:function(){this.depth++},decrement:function(){this.depth--;
if(0>this.depth)throw Error("DelayedCallbacks.depth cannot be < 0");for(;0==this.depth&&0<this.callbacks.length;)this.callbacks.shift()()},add:function(a){0==this.depth?a():this.callbacks.push(a)}};"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}throw Error("This browser does not support XMLHttpRequest.");
});var O={};setInterval(function(){J.empty()},1E4);var J=function(a,b){if(void 0!==b)O[a]=b,(new Date).getTime();else return O[a]};J.cacheSeconds=10;J.empty=function(){};J.invalidate=function(a){"string"==typeof a&&(a=k.resolveRelativeUri(a));for(var b in O){var c=O[b],e=c.url;"string"==typeof a?-1!=e.indexOf(a)&&c.invalidate():a.test(e)&&c.invalidate()}};f.defaultCache=J;f.invalidate=J.invalidate;L.prototype={};f.addToCache=function(a,b,c,e){a=k.resolveRelativeUri(a);void 0==e&&(e=f.defaultCache);
var g=JSON.stringify(a)+":"+JSON.stringify({});new C(a,b,c,e,g)};f.getData=function(a,b,c){"string"==typeof a&&(a={url:a});var e;a:{var g=a.url,d=a.method,h=a.data,j=a.encType;a=null;if(void 0==g)throw Error("URL cannot be undefined");g=k.resolveRelativeUri(g);void 0==d&&(d="GET");void 0===h&&(h={});var l=null,p=g.indexOf("#");0<=p&&(l=decodeURI(g.substring(p+1)),g=g.substring(0,p));void 0==j&&(j="GET"==d?"application/x-www-form-urlencoded":"POST"==d||"PUT"==d?"application/json":"application/x-www-form-urlencoded");
void 0==a&&(a=f.defaultCache);if(p=a&&"GET"==d&&"application/x-www-form-urlencoded"==j){e=JSON.stringify(g)+":"+JSON.stringify(h);var n=a(e);if(void 0!=n){e=new L(n,l);break a}}c=new B(g,d,h,j,c);p&&a(e,c);e=new L(c,l)}void 0!=b&&e.getData(b);return e};var X=k.getUniqueKey();B.prototype={beingUsed:function(){return void 0==this.baseContext?(k.log(k.logLevel.DEBUG,"No base context: "+this.url),!0):0<this.baseContext.retainCount()},getResponse:function(a){this.responseListeners.add(a);this.checkForFullResponse()},
checkForFullResponse:function(){this.document.raw.defined()&&this.responseListeners.notify(this.document.raw,this)},ajaxSuccess:function(a,b,c){this.fetched=!0;var e=this;e.successful=!0;k.log(k.logLevel.STANDARD,"Request success: "+this.url);var g=b.split("\n"),d={},f=null;b={};for(var h=0;h<g.length;h++)if(f=g[h].split(": ")[0],""!=f){var j=g[h].substring(f.length+2);"\r"==j[j.length-1]&&(j=j.substring(0,j.length-1));d[f.toLowerCase()]=j}k.log(k.logLevel.DEBUG,"headers: "+JSON.stringify(d,null,
4));f=d["content-type"].split(";")[0];g=d["content-type"].substring(f.length+1).split(",");for(h=0;h<g.length;h++){var j=g[h].split("=")[0],l=g[h].substring(j.length+1),j=j.trim();""!=j&&(b[j]=l)}e.headers=d;e.contentType=f;e.contentTypeParameters=b;e.document.setRaw(a);e.profileUrl=null;e.document.raw.removeSchema(X);void 0!=b.profile?(a=b.profile,a=k.resolveRelativeUri(e.url,a),e.profileUrl=a,e.document.raw.addSchema(a,X)):void 0!=c&&e.document.raw.addSchema(c,X);void 0!=b.root&&e.document.raw.addLink({href:b.root,
rel:"root"});e.checkForFullResponse();e.document.raw.whenSchemasStable(function(){var a=e.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),e.document.setRoot(a)):e.document.setRoot("")})},ajaxError:function(a){this.fetched=!0;var b=this;b.successful=!1;b.errorMessage=a;k.log(k.logLevel.ERROR,"Error fetching: "+this.url+" ("+a+")");b.document.setRaw(void 0);b.document.raw.whenSchemasStable(function(){b.checkForFullResponse();b.document.setRoot("")})},fetchData:function(a,
b,c,e,g){var d=this,f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){var a=f.responseText;try{a=JSON.parse(a)}catch(b){d.ajaxError(b);return}var c=f.getAllResponseHeaders();if(""==c){for(var c=[],e="Cache-Control Content-Language Content-Type Expires Last-Modified Pragma".split(" "),h=0;h<e.length;h++){var j=f.getResponseHeader(e[h]);""!=j&&null!=j&&c.push(e[h]+": "+j)}c=c.join("\n")}d.ajaxSuccess(a,c,g)}else d.ajaxError("HTTP Status "+f.status)};if(("GET"==
b||"DELETE"==b)&&void 0!=c&&""!=c)a=-1==a.indexOf("?")?a+"?":a+"&",a+=c,c=void 0;f.open(b,a,!0);f.setRequestHeader("Content-Type",e);f.send(c)}};C.prototype=B.prototype;u.prototype={isEmpty:function(){return 0==this.operations.length},each:function(a){for(var b=0;b<this.operations.length;b++)a.call(this,b,this.operations[b]);return this},plain:function(){for(var a=[],b=0;b<this.operations.length;b++)a[b]=this.operations[b].plain();return a},condense:function(){},filterImmediate:function(){for(var a=
new u(this.prefix),b=0;b<this.operations.length;b++){var c=this.operations[b];c.immediateChild(this.prefix)&&a.operations.push(c)}return a},filter:function(a){a=this.prefix+a;for(var b=new u(a),c=0;c<this.operations.length;c++){var e=this.operations[c];e.hasPrefix(a)&&b.operations.push(e)}return b},filterRemainder:function(a){a=this.prefix+a;for(var b=new u(this.prefix),c=0;c<this.operations.length;c++){var e=this.operations[c];e.hasPrefix(a)||b.operations.push(e)}return b},replace:function(a,b){var c=
new D("replace",a,b);this.operations.push(c);return this},add:function(a,b){var c=new D("add",a,b);this.operations.push(c);return this},remove:function(a){a=new D("remove",a);this.operations.push(a);return this},move:function(a,b){var c=new D("move",a,b);this.operations.push(c);return this},inverse:function(){for(var a=new u(this.prefix),b=0;b<this.operations.length;b++)a.operations[b]=this.operations[b].inverse();a.operations.reverse();return a}};D.prototype={action:function(){return this._patchType},
value:function(){return this._value},subject:function(){return this._subject},setSubjectValue:function(a){this._subjectValue=a;return this},subjectValue:function(){return this._subjectValue},inverse:function(){switch(this._patchType){case "replace":return new D("replace",this._subject,this._subjectValue);case "add":return(new D("remove",this._subject)).setSubjectValue(this._value);case "remove":return new D("add",this._subject,this._subjectValue);case "move":return new D("move",this._target,this._subject);
default:throw Error("Unrecognised patch type for inverse: "+this._patchType);}},depthFrom:function(a){a+="/";var b=NaN;if(this._subject.substring(0,a.length)==a)var c=this._subject.substring(a.length),b=0==c?0:c.split("/").length;void 0!=this._target&&this._target.substring(0,a.length)==a&&(c=this._target.substring(a.length),a=0==c?0:c.split("/").length,a>b||(b=a));return b},subjectEquals:function(a){return this._subject==a},subjectChild:function(a){a+="/";return this._subject.substring(0,a.length)==
a&&(a=this._subject.substring(a.length),-1==a.indexOf("/"))?decodeURIComponent(a):!1},subjectRelative:function(a){a+="/";return this._subject.substring(0,a.length)==a?this._subject.substring(a.length-1):!1},target:function(){return this._target},targetEquals:function(a){return this._target==a},targetChild:function(a){if(void 0!=this._target)return a+="/",this._target.substring(0,a.length)==a&&(a=this._target.substring(a.length),-1==a.indexOf("/"))?decodeURIComponent(a):!1},targetRelative:function(a){a+=
"/";return this._target.substring(0,a.length)==a?this._target.substring(a.length-1):!1},plain:function(){var a={};a[this._patchType]=this._subject;"remove"!=this._patchType&&("move"==this._patchType?a.to=this._target:a.value=this._value);return a},matches:function(a){return this._subject==a||"move"==this._patchType&&this._target==a?!0:!1},hasPrefix:function(a){if(this.matches(a))return!0;a+="/";return this._subject.substring(0,a.length)==a||"move"==this._patchType&&this._target.substring(0,a.length)==
a?!0:!1}};var aa=[];f.registerChangeListener=function(a){aa.push(a)};var Q=!1,R=[];f.batch=function(a){if(void 0!=a)return f.batch(),a(),f.batchDone(),this;Q=!0;return this};f.batchDone=function(){for(Q=!1;0<R.length;){var a=R.shift(),b=a.batchPatch;delete a.batchPatch;a.patch(b)}return this};F.prototype={resolveUrl:function(a){return z.resolve(this.url,a)},getFragment:function(a,b){this.getRoot(function(c){""!=a&&(c=c.subPath(a));b.call(this,c)})},get:function(a){return this.root.get(a)},set:function(a,
b){this.root.set(a,b);return this},move:function(a,b){var c=new u;c.move(a,b);this.patch(c);return this}};var N=/^(0|[1-9]\d*)$/,ja=0;d.prototype={referenceUrl:function(){if(this.document.isDefinitive){var a=this.pointerPath();if(""==a||"/"==a.charAt(0))return this.document.url+"#"+encodeURI(this.pointerPath())}},subPath:function(a){a=a.split("/");if(""!=a[0])throw Error("Path must begin with / (or be empty)");for(var b=this,c=1;c<a.length;c++)a[c]=k.decodePointerComponent(a[c]),b="array"==b.basicType()?
b.index(a[c]):b.property(a[c]);return b},defined:function(){return void 0!=this.basicType()},setValue:function(a){if("undefined"==typeof a)return this.remove();if("object"!=this.basicType()&&"array"!=this.basicType()&&this.value()===a)return this;var b=new u;this.defined()?b.replace(this.pointerPath(),a):b.add(this.pointerPath(),a);this.document.patch(b,this);return this},remove:function(){var a=new u;a.remove(this.pointerPath());this.document.patch(a,this);return this},itemValue:function(a){return this.index(a).value()},
removeItem:function(a){this.index(a).remove();return this},insertItem:function(a,b){if("array"!=this.basicType())throw Error("cannot insert into a non-array");var c=new u;c.add(this.item(a).pointerPath(),b);this.document.patch(c,this);return this},push:function(a){if("array"==this.basicType())this.index(this.length()).setValue(a);else throw Error("Can only push() on an array");return this},propertyValue:function(a){return this.property(a).value()},removeProperty:function(a){this.property(a).remove();
return this},moveTo:function(a){if("object"==typeof a){if(a.document!=this.document){var b=this.value();this.remove();a.setValue(b);return a}a=a.pointerPath()}var b=new u,c=this.pointerPath();if(a!=c)return b.move(c,a),this.document.patch(b,this),this.document.root.subPath(a)},getLink:function(a){return this.links(a)[0]},equals:function(a){var b;b=this.basicType();if(b!=a.basicType())return!1;if("array"==b){if(this.length()!==a.length())return!1;for(b=0;b<this.length();b++)if(!this.index(b).equals(a.index(b)))return!1;
return!0}if("object"==b){var c=this.keys(),e=a.keys();if(c.length!=e.length)return!1;c.sort();e.sort();for(b=0;b<c.length;b++)if(c[b]!==e[b])return!1;for(b=0;b<c.length;b++)if(e=c[b],!this.property(e).equals(a.property(e)))return!1;return!0}return this.value()===a.value()},readOnlyCopy:function(){if(this.readOnly())return this;var a=f.create(this.value(),this.document.url+"#:copy",!0);this.schemas().each(function(b,c){a.addSchema(c)});return a},editableCopy:function(){var a=f.create(this.value(),
this.document.url+"#:copy",!1);this.schemas().each(function(b,c){a.addSchema(c)});return a},asSchema:function(){var a=new l(this.readOnlyCopy());this.readOnly()&&y(this,{asSchema:a});return a},asLink:function(a){var b=this.readOnlyCopy(),b=new p(b);a=void 0==a?b.linkForData(this):b.linkForData(a);this.readOnly()&&y(this,{asLink:a});return a},items:function(a){for(var b=0;b<this.length();b++){var c=this.index(b);a.call(c,b,c)}return this},properties:function(a){for(var b=this.keys(),c=0;c<b.length;c++){var e=
this.property(b[c]);a.call(e,b[c],e)}return this},resolveUrl:function(a){return this.document.resolveUrl(a)},get:function(a){return this.subPath(a).value()},set:function(a,b){this.subPath(a).setValue(b);return this},json:function(){return JSON.stringify(this.value())}};d.prototype.indices=d.prototype.items;d.prototype.indexValue=d.prototype.itemValue;d.prototype.removeIndex=d.prototype.removeItem;d.prototype.index=function(a){return this.item(a)};f.extendData=function(a){for(var b in a)void 0==d.prototype[b]&&
(d.prototype[b]=a[b])};f.create=function(a,b,c){var e=void 0!=b;void 0!=b&&-1!=b.indexOf("#")&&(""!=b.substring(b.indexOf("#")+1)&&(e=!1),b=b.substring(0,b.indexOf("#")));b=new F(b,e,c);b.setRaw(a);b.setRoot("");return b.root};f.createSchema=function(a,b){return f.create(a,b,!0).asSchema()};f.getSchema=h;var P="null boolean integer number string array object".split(" "),S={};l.prototype={toString:function(){return"<Schema "+this.data+">"},referenceUrl:function(){return this.data.referenceUrl()},isComplete:function(){return void 0===
this.data.propertyValue("$ref")},getFull:function(a){var b=this.data.propertyValue("$ref");if(void 0===b)a(this,void 0);else return b=this.data.resolveUrl(b),h(b,a),this},title:function(){var a=this.data.propertyValue("title");void 0==a&&(a=null);return a},hasDefault:function(){return this.data.property("default").defined()},defaultValue:function(){return this.data.propertyValue("default")},propertySchemas:function(a){var b=[],c=this.data.property("properties").property(a);c.defined()&&b.push(c.asSchema());
this.data.property("patternProperties").properties(function(c,g){RegExp(c).test(a)&&b.push(g.asSchema())});0==b.length&&(c=this.data.property("additionalProperties"),c.defined()&&b.push(c.asSchema()));return new w(b)},propertyDependencies:function(a){var b=this.data.property("dependencies");return b.defined()&&(a=b.property(a),a.defined())?"string"==a.basicType()?[a.value()]:"array"==a.basicType()?a.value():new w([a.asSchema()]):new w},indexSchemas:function(a){var b=this.data.property("items");if(!b.defined())return new w;
"array"==b.basicType()?(a=b.index(a),a.defined()||(a=this.data.property("additionalItems"))):a=b;return a.defined()?(a=a.asSchema(),new w([a])):new w},andSchemas:function(){var a=[],b=this.data.property("extends");b.defined()&&("array"==b.basicType()?b.indices(function(b,e){a.push(e.asSchema())}):a.push(b.asSchema()));this.data.property("allOf").items(function(b,e){a.push(e.asSchema())});return new w(a)},notSchemas:function(){var a=[],b=this.data.property("disallow");b.defined()&&("array"==b.basicType()?
b.indices(function(b,e){"string"==e.basicType()?a.push(f.createSchema({type:e.value()})):a.push(e.asSchema())}):"string"==b.basicType()?a.push(f.createSchema({type:b.value()})):a.push(b.asSchema()));this.data.property("not").defined()&&a.push(this.data.property("not").asSchema());return new w(a)},types:function(){var a=this.data.property("type");if(a.defined()){if("string"===a.basicType())return"all"==a.value()?P.slice(0):[a.value()];for(var b=[],c=0;c<a.length();c++)if("string"==a.item(c).basicType()){if("all"==
a.item(c).value())return P.slice(0);b.push(a.item(c).value())}else return P.slice(0);-1!=b.indexOf("number")&&-1==b.indexOf("integer")&&b.push("integer");return b}return P.slice(0)},xorSchemas:function(){var a=[],b=this.data.property("type");if(b.defined())for(var c=0;c<b.length();c++)if("string"!=b.item(c).basicType()){var e=[];b.items(function(a,b){"string"==b.basicType()?e.push(j(b.value())):e.push(b.asSchema())});a.push(e);break}this.data.property("oneOf").defined()&&(e=[],this.data.property("oneOf").items(function(a,
b){e.push(b.asSchema())}),a.push(e));return a},orSchemas:function(){var a=[];this.data.property("type");if(this.data.property("anyOf").defined()){var b=[];this.data.property("anyOf").items(function(a,e){b.push(e.asSchema())});a.push(b)}return a},equals:function(a){return this===a?!0:void 0!==this.referenceUrl()&&void 0!==a.referenceUrl()?this.referenceUrl()===a.referenceUrl():this.data.equals(a.data)},enumValues:function(){return this.data.propertyValue("enum")},enumData:function(){return this.data.property("enum")},
minItems:function(){var a=this.data.propertyValue("minItems");return void 0==a?0:a},maxItems:function(){return this.data.propertyValue("maxItems")},tupleTypingLength:function(){return"array"!=this.data.property("items").basicType()?0:this.data.property("items").length()},minLength:function(){var a=this.data.propertyValue("minLength");return void 0==a?0:a},maxLength:function(){return this.data.propertyValue("maxLength")},numberInterval:function(){return this.data.propertyValue("divisibleBy")},minimum:function(){return this.data.propertyValue("minimum")},
exclusiveMinimum:function(){return!!this.data.propertyValue("exclusiveMinimum")},maximum:function(){return this.data.propertyValue("maximum")},exclusiveMaximum:function(){return!!this.data.propertyValue("exclusiveMaximum")},minProperties:function(){var a=this.data.propertyValue("minProperties");return void 0==a?0:a},maxProperties:function(){return this.data.propertyValue("maxProperties")},definedProperties:function(){var a={};this.data.property("properties").properties(function(b){a[b]=!0});this.data.property("required").items(function(b,
c){a[c.value()]=!0});var b=[],c;for(c in a)b.push(c);return b},requiredProperties:function(){var a=this.data.propertyValue("required");"object"!=typeof a&&(a=[]);var b=this.data.property("properties");void 0!=b&&b.properties(function(b,e){var g=e.property("required");void 0!=g&&("boolean"==g.basicType()&&g.value())&&a.push(b)});return a},allowedAdditionalProperties:function(){return!1!==this.data.propertyValue("additionalProperties")},getLink:function(a){for(var b=this.links(),c=0;c<b.length;c++)if(b[c].rel()==
a)return b[c]},asList:function(){return new w([this])},format:function(){return this.data.propertyValue("format")}};l.prototype.basicTypes=l.prototype.types;l.prototype.extendSchemas=l.prototype.andSchemas;f.extendSchema=function(a){for(var b in a)void 0==l.prototype[b]&&(l.prototype[b]=a[b])};var T={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};p.prototype={addHandler:function(a){this.handlers.unshift(a);return this},addPreHandler:function(a){this.preHandlers.push(a);return this},canApplyTo:function(a){var b,
c,e=null;for(b=0;b<this.dataParts.length;b++){c=this.dataParts[b];null===c?e=a:"object"==a.basicType()?e=a.property(c):"array"==a.basicType()&&N.test(c)&&(e=a.index(c));if(void 0==e)return!1;c=e.basicType();if("string"!=c&&"number"!=c&&"integer"!=c)return!1}return!0},linkForData:function(a){var b=this.data.value(),c=this.uriTemplate.fill(function(b){b=n(b);return null==b?a.value():"array"==a.basicType()?a.itemValue(b):a.propertyValue(b)});b.href=a.resolveUrl(c);return new q(b,this,a)},usesKey:function(a){var b;
for(b=0;b<this.dataParts.length;b++)if(this.dataParts[b]===a)return!0;return!1},rel:function(){return this.data.propertyValue("rel")}};var ea=[],fa=[];f.addLinkHandler=function(a){ea.unshift(a)};f.addLinkPreHandler=function(a){fa.push(a)};var ga=k.getUniqueKey();q.prototype={toString:function(){return this.href},createSubmissionData:function(a){var b=this.hrefBase,c=this.submissionSchemas;if(void 0!=a&&0==c.length&&"PUT"==this.method)return Jsonary.getData(this.href,function(b){a(b.editableCopy())}),
this;if(void 0!=a)c.createValue(function(e){e=f.create(e,b);for(var g=0;g<c.length;g++)e.addSchema(c[g],ga);a(e)});else{for(var e=c.createValue(),e=f.create(e,b),g=0;g<c.length;g++)e.addSchema(c[g],ga);return e}},follow:function(a,b){"function"==typeof a&&(b=a,a=void 0);void 0!==a?a instanceof d||(a=f.create(a)):a=f.create(void 0);for(var c=fa.concat(this.definition.preHandlers),e=0;e<c.length;e++){var g=c[e];if(!1===g.call(this,this,a))return k.log(k.logLevel.DEBUG,"Link cancelled: "+this.href),
null}e=a.value();c=f.getData({url:this.href,method:this.method,data:e,encType:this.encType},null,this.targetSchema);a=a.readOnlyCopy();var m=this.definition.handlers.concat(ea);void 0!==b&&m.unshift(b);for(e=0;e<m.length&&!(g=m[e],!1===g.call(this,this,a,c));e++);return c}};t.prototype={setupXorSelectors:function(){var a=this;this.xorSelectors={};for(var b=this.schema.xorSchemas(),c=0;c<b.length;c++){var e=new U(k.getKeyVariant(this.monitorKey,"xor"+c),b[c],this.data);this.xorSelectors[c]=e;e.onMatchChange(function(){a.update()},
!1)}},setupOrSelectors:function(){var a=this;this.orSelectors={};for(var b=this.schema.orSchemas(),c=0;c<b.length;c++){var e=new V(k.getKeyVariant(this.monitorKey,"or"+c),b[c],this.data);this.orSelectors[c]=e;e.onMatchChange(function(){a.update()},!1)}},setupAndMatches:function(){var a=this;this.andMatches=[];this.schema.andSchemas().each(function(b,c){var e=k.getKeyVariant(a.monitorKey,"and"+b),e=a.data.addSchemaMatchMonitor(e,c,function(){a.update()},!1);a.andMatches.push(e)})},setupNotMatches:function(){var a=
this;this.notMatches=[];this.schema.notSchemas().each(function(b,c){var e=k.getKeyVariant(a.monitorKey,"not"+b),e=a.data.addSchemaMatchMonitor(e,c,function(){a.update()},!1);a.notMatches.push(e)})},addMonitor:function(a,b){this.monitors.add(this.monitorKey,a);!1!==b&&a.call(this.schema,this.match,this.matchFailReason);return this},dataUpdated:function(a){if(this.schemaLoaded){var b=this;if("object"==this.data.basicType()){this.indexMatches={};this.data.properties(function(a,c){if(void 0==b.propertyMatches[a]){var e=
[],d=b.schema.propertySchemas(a);d.each(function(f){var h=c.addSchemaMatchMonitor(b.monitorKey,d[f],function(){b.subMatchUpdated(a,h)},!1);e.push(h)});b.propertyMatches[a]=e;b.addDependencies(a)}});var c=[];for(a in this.propertyMatches)this.data.property(a).defined()||c.push(a);for(var e=0;e<c.length;e++)a=c[e],delete this.propertyMatches[a],void 0!=this.dependencyKeys[a]&&(this.data.removeSchema(this.dependencyKeys[a]),delete this.dependencies[a],delete this.dependencyKeys[a])}else if("array"==
this.data.basicType()){this.propertyMatches={};this.data.indices(function(c,e){if(void 0==b.indexMatches[c]){var d=[],f=b.schema.indexSchemas(c);f.each(function(c){var g=e.addSchemaMatchMonitor(b.monitorKey,f[c],function(){b.subMatchUpdated(a,g)},!1);d.push(g)});b.indexMatches[c]=d}});c=[];for(a in this.indexMatches)this.data.length()<=a&&c.push(a);for(e=0;e<c.length;e++)delete this.indexMatches[c[e]]}else this.propertyMatches={},this.indexMatches={};this.update()}},addDependencies:function(a){var b=
this,c=this.schema.propertyDependencies(a);this.dependencies[a]=[];this.dependencyKeys[a]=[];for(var e=0;e<c.length;e++){var g=c[e];"string"==typeof g?this.dependencies[a].push(g):function(c){var e=k.getKeyVariant(b.monitorKey,"dep:"+a+":"+c);b.dependencyKeys[a].push(e);e=b.data.addSchemaMatchMonitor(e,g,function(){b.dependencyUpdated(a,c)},!1);b.dependencies[a].push(e)}(e)}},notify:function(){this.monitors.notify(this.match,this.matchFailReason)},setMatch:function(a,b){if(!a||!this.match)if(a||this.match||
!this.matchFailReason.equals(b))this.matchFailReason=(this.match=a)?null:b,this.notify()},subMatchUpdated:function(){this.update()},subMatchRemoved:function(){this.update()},dependencyUpdated:function(){this.update()},update:function(){try{this.matchAgainstBasicTypes(),this.matchAgainstSubMatches(),this.matchAgainstImmediateConstraints(),this.setMatch(!0)}catch(a){if(a instanceof s)this.setMatch(!1,a);else throw a;}},matchAgainstBasicTypes:function(){for(var a=this.data.basicType(),b=0;b<this.basicTypes.length;b++)if(this.basicTypes[b]==
a||"integer"==a&&"number"==this.basicTypes[b])return;throw new s("Data does not match any of the basic types: "+this.basicTypes,this.schema);},matchAgainstSubMatches:function(){for(var a=0;a<this.andMatches.length;a++){var b=this.andMatches[a];if(!b.match){var c="extended schema #"+a+": "+b.message;throw new s(c,this.schema,b.failReason);}}for(a=0;a<this.notMatches.length;a++)if(this.notMatches[a].match)throw c='"not" schema #'+a+" matches",new s(c,this.schema);for(c in this.xorSelectors)if(a=this.xorSelectors[c],
null==a.selectedOption)throw c="XOR #"+c+": "+a.failReason.message,new s(c,this.schema,a.failReason);for(c in this.orSelectors)if(a=this.orSelectors[c],0==a.selectedOptions.length)throw c="OR #"+c+": no matches",new s(c,this.schema);for(c in this.propertyMatches)for(var e=this.propertyMatches[c],a=0;a<e.length;a++)if(b=e[a],!b.match)throw c=c+": "+b.matchFailReason.message,new s(c,this.schema,b.matchFailReason);for(c in this.indexMatches){e=this.indexMatches[c];for(a=0;a<e.length;a++)if(b=e[a],!b.match)throw c=
c+": "+b.matchFailReason.message,new s(c,this.schema,b.matchFailReason);}},matchAgainstImmediateConstraints:function(){this.matchAgainstEnums();this.matchAgainstNumberConstraints();this.matchAgainstArrayConstraints();this.matchAgainstObjectConstraints()},matchAgainstEnums:function(){var a=this.schema.enumData();if(a.defined()){for(var b=0;b<a.length();b++)if(a.index(b).equals(this.data))return;throw new s("Data does not match enum: "+JSON.stringify(a.value())+" ("+JSON.stringify(this.data.value())+
")",this.schema);}},matchAgainstNumberConstraints:function(){if(!("number"!=this.data.basicType()&&"integer"!=this.data.basicType())){var a=this.data.value(),b=this.schema.numberInterval();if(void 0!=b&&0!=a%b)throw new s("Number must be divisible by "+b);b=this.schema.minimum();if(void 0!==b)if(this.schema.exclusiveMinimum()){if(a<=b)throw new s("Number must be > "+b);}else if(a<b)throw new s("Number must be >= "+b);b=this.schema.maximum();if(void 0!=b)if(this.schema.exclusiveMaximum()){if(a>=b)throw new s("Number must be < "+
b);}else if(a>b)throw new s("Number must be <= "+b);}},matchAgainstArrayConstraints:function(){if("array"==this.data.basicType()){var a=this.schema.minItems();if(void 0!==a&&a>this.data.length())throw new s("Data is not long enough - minimum length is "+a,this.schema);a=this.schema.maxItems();if(void 0!==a&&a<this.data.length())throw new s("Data is too long - maximum length is "+a,this.schema);}},matchAgainstObjectConstraints:function(){if("object"==this.data.basicType()){for(var a=this.schema.requiredProperties(),
b=0;b<a.length;b++){var c=a[b];if(!this.data.property(c).defined())throw new s("Missing key "+JSON.stringify(c),this.schema);}this.matchAgainstDependencies()}},matchAgainstDependencies:function(){for(var a in this.dependencies)if(void 0!=this.data.property(a))for(var b=this.dependencies[a],c=0;c<b.length;c++){var e=b[c];if("string"==typeof e){if(!this.data.property(e).defined())throw new s("Dependency - property "+JSON.stringify(a)+" requires property "+JSON.stringify(e),this.schema);}else if(!e.match)throw new s("Dependency for "+
a,this.schema,e.matchFailReason);}}};s.prototype=Error();s.prototype.toString=function(){return this.message+" in "+this.schema.title()};s.prototype.equals=function(a){if(!(a instanceof s))return!1;if(null==this.subMatchFailReason){if(null!=a.subMatchFailReason)return!1}else if(null==a.subMatchFailReason||!this.subMatchFailReason.equals(a.subMatchFailReason))return!1;return this.message==a.message&&(null==this.schema&&null==a.schema||null!=this.schema&&null!=a.schema&&this.schema.equals(a.schema))};
U.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOption);return this},update:function(){for(var a=null,b="No matches",c=0;c<this.subMatches.length;c++)if(this.subMatches[c].match)if(null==a)a=this.options[c],b=null;else{b="multiple matches";a=null;break}this.failReason=new s(b);this.selectedOption!=a&&(this.selectedOption=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOption))}};V.prototype={onMatchChange:function(a,b){this.matchCallback=
a;!1!==b&&a.call(this,this.selectedOptions);return this},update:function(){for(var a=[],b=0;b<this.subMatches.length;b++)this.subMatches[b].match&&a.push(this.options[b]);var c=!1;if(a.length!=this.selectedOptions.length)c=!0;else for(b=0;b<a.length;b++)if(a[b]!=this.selectedOptions[b]){c=!0;break}c&&(this.selectedOptions=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOptions))}};var Y=[];f.registerSchemaChangeListener=function(a){Y.push(a)};W.prototype={rel:function(a){if(void 0==
a)return this;var b=[],c;for(c=0;c<this.length;c++)this[c].rel===a&&(b[b.length]=this[c]);return new W(b)}};var na={"null":!0,"boolean":!0,integer:!0,number:!0,string:!0,array:!0,object:!0};w.prototype={containsUrl:function(a){if(a instanceof RegExp)for(var b=0;b<this.length;b++){var c=this[b];if(a.test(c.referenceUrl()))return!0}else{0>a.indexOf("#")&&(a+="#");for(b=0;b<this.length;b++)if(c=this[b],c=c.referenceUrl(),null!=c&&c.substring(c.length-a.length)==a)return!0}return!1},potentialLinks:function(){var a=
[],b,c;for(b=0;b<this.length;b++)c=this[b],a=a.concat(c.links());return a},each:function(a){for(var b=0;b<this.length;b++)a.call(this,b,this[b]);return this},concat:function(a){for(var b=[],c=0;c<this.length;c++)b.push(this[c]);for(c=0;c<a.length;c++)b.push(a[c]);return new w(b)},definedProperties:function(){var a=!0,b={};this.each(function(c,e){if(a){e.allowedAdditionalProperties()||(a=!1,b={});for(var d=e.definedProperties(),f=0;f<d.length;f++)b[d[f]]=!0}else if(!e.allowedAdditionalProperties()){a=
!1;for(var h={},d=e.definedProperties(),f=0;f<d.length;f++)b[d[f]]&&(h[d[f]]=!0);b=h}});var c=[],e;for(e in b)c.push(e);y(this,{definedProperties:c,allowedAdditionalProperties:a});return c},allowedAdditionalProperties:function(){var a=!0;this.each(function(b,c){a=a&&c.allowedAdditionalProperties()});y(this,{additionalProperties:a});return a},minProperties:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minProperties();c>a&&(a=c)}return a},maxProperties:function(){for(var a=void 0,b=0;b<
this.length;b++){var c=this[b].maxProperties();c>a||(a=c)}return a},basicTypes:function(){for(var a=na,b=0;b<this.length;b++){for(var c=this[b].basicTypes(),e={},g=0;g<c.length;g++){var d=c[g];a[d]&&(e[d]=!0)}a=e}var b=[],f;for(f in a)b.push(f);return b},numberInterval:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].numberInterval();void 0!=c&&(a=void 0==a?c:k.lcm(a,c))}for(b=0;b<this.length;b++){for(var c=this[b].basicTypes(),e=!1,g=0;g<c.length;g++)if("number"==c[g]){e=!1;break}else"integer"==
c[g]&&(e=!0);if(e)return void 0==a?1:k.lcm(a,1)}y(this,{numberInterval:a});return a},minimum:function(){for(var a=void 0,b=!1,c=0;c<this.length;c++){var e=this[c].minimum();if(void 0!=e&&(void 0==a||a<e))a=e,b=this[c].exclusiveMinimum()}y(this,{minimum:a,exclusiveMinimum:b});return a},exclusiveMinimum:function(){this.minimum();return this.exclusiveMinimum()},maximum:function(){for(var a=void 0,b=!1,c=0;c<this.length;c++){var e=this[c].maximum();if(void 0!=e&&(void 0==a||a>e))a=e,b=this[c].exclusiveMaximum()}y(this,
{maximum:a,exclusiveMaximum:b});return a},exclusiveMaximum:function(){this.minimum();return this.exclusiveMinimum()},minLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minLength();c>a&&(a=c)}y(this,{minLength:a});return a},maxLength:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxLength();c>a||(a=c)}y(this,{maxLength:a});return a},minItems:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minItems();c>a&&(a=c)}y(this,{minItems:a});return a},maxItems:function(){for(var a=
void 0,b=0;b<this.length;b++){var c=this[b].maxItems();c>a||(a=c)}y(this,{maxItems:a});return a},tupleTypingLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].tupleTypingLength();c>a&&(a=c)}return a},requiredProperties:function(){for(var a={},b=[],c=0;c<this.length;c++)for(var e=this[c].requiredProperties(),g=0;g<e.length;g++){var d=e[g];a[d]||(a[d]=!0,b.push(d))}return b},enumValues:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].enumData();if(c.defined())if(void 0==
a)a=[],c.indices(function(b,c){a[b]=c});else{var e=[];c.indices(function(b,c){for(var d=0;d<a.length;d++)a[d].equals(c)&&e.push(c)});a=e}}if(void 0!=a){c=[];for(b=0;b<a.length;b++)c[b]=a[b].value();return c}},createValue:function(a){if(null!=a)this.getFull(function(b){a.call(this,b.createValue())});else{for(var b=[],c=0;c<this.length;c++)this[c].hasDefault()&&b.push(this[c].defaultValue());var e=this.basicTypes(),g=this.enumValues();if(void 0!=g)for(c=0;c<g.length;c++)b.push(g[c]);else for(c=0;c<
e.length;c++)g=e[c],"null"==g?b.push(null):"boolean"==g?b.push(!0):"integer"==g||"number"==g?(g=this.createValueNumber(),void 0!==g&&b.push(g)):"string"==g?(g=this.createValueString(),void 0!==g&&b.push(g)):"array"==g?(g=this.createValueArray(),void 0!==g&&b.push(g)):"object"==g&&(g=this.createValueObject(),void 0!==g&&b.push(g));for(c=0;c<b.length;c++){var g=b[c],d=k.guessBasicType(g);if(!(-1==e.indexOf(d)&&("integer"!=d||-1==e.indexOf("number"))))return g}return null}},createValueNumber:function(){var a=
this.exclusiveMinimum(),b=this.minimum(),c=this.maximum(),e=this.exclusiveMaximum(),g=this.numberInterval(),d=void 0;if(void 0!=b&&void 0!=c){if(b>c||b==c&&(a||e))return;if(void 0!=g){if(d=Math.ceil(b/g)*g,a&&d==b&&(d+=g),d>c||d==c&&e)return}else d=0.5*(b+c)}else void 0!=b?(d=b,void 0!=g&&(d=Math.ceil(d/g)*g),a&&d==b&&(void 0!=g?d+=g:d++)):void 0!=c?(d=c,void 0!=g&&(d=Math.floor(d/g)*g),e&&d==c&&(void 0!=g?d-=g:d--)):d=0;return d},createValueString:function(){return""},createValueArray:function(){var a=
[],b=this.minItems();if(void 0!=b)for(;a.length<b;)a.push(this.createValueForIndex(a.length));return a},createValueObject:function(){for(var a={},b=this.requiredProperties(),c=0;c<b.length;c++){var e=b[c];a[e]=this.createValueForProperty(e)}return a},createValueForIndex:function(a,b){return this.indexSchemas(a).createValue(b)},indexSchemas:function(a){for(var b=new w,c=0;c<this.length;c++)b=b.concat(this[c].indexSchemas(a));return b},createValueForProperty:function(a,b){return this.propertySchemas(a).createValue(b)},
propertySchemas:function(a){for(var b=new w,c=0;c<this.length;c++)b=b.concat(this[c].propertySchemas(a));return b},getFull:function(a){function b(f){c+=f.length;for(var h=0;h<f.length;h++)f[h].getFull(function(f){for(var h=0;h<e.length;h++)if(f.equals(e[h])){c--;0==c&&(f=new w(e,d),a.call(f,f));return}e.push(f);f=f.extendSchemas();b(f);c--;0==c&&(f=new w(e,d),a.call(f,f))})}if(0==this.length)return a.call(this,this),this;var c=0,e=[],d=this.fixed();b(this);return this},formats:function(){for(var a=
[],b=0;b<this.length;b++){var c=this[0].format();null!=c&&a.push(c)}return a}};f.createSchemaList=function(a){Array.isArray(a)||(a=[a]);return new w(a)};k.getUniqueKey();ba.prototype={update:function(a){this.updateLinksWithKey(a);this.updateDependenciesWithKey(a);this.updateMatchesWithKey(a)},updateLinksWithKey:function(a){var b,c,e,d,f=[];for(b in this.links){e=this.links[b];for(c=0;c<e.length;c++)d=e[c],(d.usesKey(a)||null==a)&&f.push(d)}if(0<f.length){for(c=0;c<f.length;c++)d=f[c],d.update();this.invalidateSchemaState()}},
updateMatchesWithKey:function(a){var b=[];for(schemaKey in this.matches)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++)for(var e=this.matches[b[c]],d=0;d<e.length;d++)e[d].dataUpdated(a)},updateDependenciesWithKey:function(a){var b=[];for(schemaKey in this.dependencySelectors)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++)for(var e=this.dependencySelectors[b[c]],d=0;d<e.length;d++)e[d].dataUpdated(a)},alreadyContainsSchema:function(a,b){for(var c=0;c<b.length;c++){var e=
b[c];if(void 0!=this.schemas[e])for(var d=0;d<this.schemas[e].length;d++)if(a.equals(this.schemas[e][d]))return!0}return!1},addSchema:function(a,b,c,e){var d=this;void 0==b&&(b=k.getUniqueKey());void 0==e&&(e=!0);void 0==c?c=[b]:c[c.length]=b;void 0==this.schemas[b]&&(this.schemas[b]=[]);this.schemaFlux++;"string"==typeof a&&(a=f.createSchema({$ref:a}));a.getFull(function(a){if(d.alreadyContainsSchema(a,c))d.schemaFlux--,d.checkForSchemasStable();else{d.schemas[b].push(a);d.schemasFixed[b]=d.schemasFixed[b]||
e;d.dataObj.properties(function(e,d){for(var g=a.propertySchemas(e),f=0;f<g.length;f++)d.addSchema(g[f],b,c)});d.dataObj.indices(function(e,d){var g=a.indexSchemas(e);for(e=0;e<g.length;e++)d.addSchema(g[e],b,c)});for(var f=a.extendSchemas(),h=0;h<f.length;h++)d.addSchema(f[h],b,c,e);d.addLinks(a.links(),b,c);d.addXorSelectors(a,b,c);d.addOrSelectors(a,b,c);d.addDependencySelector(a,b,c);d.schemaFlux--;d.invalidateSchemaState()}})},addLinks:function(a,b,c){var e,d;void 0==this.links[b]&&(this.links[b]=
[]);for(e=0;e<a.length;e++)d=new ca(this.dataObj,a[e]),this.links[b].push(d),this.addMonitorForLink(d,b,c),d.update();this.invalidateSchemaState()},addXorSelectors:function(a,b,c){a=a.xorSchemas();for(var e=[],d=0;d<a.length;d++){var f=new ka(a[d],k.getKeyVariant(b,"xor"+d),c,this);e.push(f)}this.xorSelectors[b]=void 0==this.xorSelectors[b]?e:this.xorSelectors[b].concat(e)},addOrSelectors:function(a,b,c){a=a.orSchemas();for(var e=[],d=0;d<a.length;d++){var f=new la(a[d],k.getKeyVariant(b,"or"+d),
c,this);e.push(f)}this.orSelectors[b]=void 0==this.orSelectors[b]?e:this.orSelectors[b].concat(e)},addDependencySelector:function(a,b,c){a=[new da(a,k.getKeyVariant(b,"dep"),c,this)];this.dependencySelectors[b]=void 0==this.dependencySelectors[b]?a:this.dependencySelectors[b].concat(a)},addLink:function(a){var b=k.getUniqueKey();a=f.create(a);a=new p(a);this.addLinks([a],b)},addMonitorForLink:function(a,b,c){var e=this;if("describedby"===a.rel()){var d=k.getKeyVariant(b);a.addMonitor(d,function(b){e.removeSchema(d);
b&&(b=f.createSchema({$ref:a.rawLink.href}),e.addSchema(b,d,c,!1))})}},addSchemaMatchMonitor:function(a,b,c,e){b=new t(a,this.dataObj,b);void 0==this.matches[a]&&(this.matches[a]=[]);this.matches[a].push(b);b.addMonitor(c,e);return b},removeSchema:function(a){this.dataObj.indices(function(b,c){c.removeSchema(a)});this.dataObj.properties(function(b,c){c.removeSchema(a)});var b,c,e=[];for(b in this.schemas)k.keyIsVariant(b,a)&&e.push(b);for(b in this.links)k.keyIsVariant(b,a)&&e.push(b);for(b in this.matches)k.keyIsVariant(b,
a)&&e.push(b);for(c=0;c<e.length;c++)b=e[c],delete this.schemas[b],delete this.links[b],delete this.matches[b];0<e.length&&this.invalidateSchemaState()},clear:function(){this.schemas={};this.links={};this.matches={};this.invalidateSchemaState()},getSchemas:function(){if(null!==this.cachedSchemaList)return this.cachedSchemaList;var a=[],b={},c,e,d,f,h,j;for(d in this.schemas){f=this.schemas[d];var k=this.schemasFixed[d];for(c=0;c<f.length;c++){h=f[c];k&&(b[h.data.uniqueId]=h);j=!1;for(e=0;e<a.length;e++)if(h.equals(a[e])){j=
!0;break}j||a.push(h)}}c=[];for(d in b)c.push(b[d]);return this.cachedSchemaList=new w(a,c)},getLinks:function(a){var b,c,e,d;if(null!==this.cachedLinkList)return this.cachedLinkList.rel(a);var f=[];for(b in this.links){d=this.links[b];for(c=0;c<d.length;c++)e=d[c],e.active&&f.push(e.rawLink)}this.cachedLinkList=new W(f);return this.cachedLinkList.rel(a)},invalidateSchemaState:function(){this.cachedLinkList=this.cachedSchemaList=null;this.schemasStable=!1;this.checkForSchemasStable()},checkForSchemasStable:function(){if(0<
this.schemaFlux)return!1;var a,b,c,e;for(b in this.schemas){c=this.schemas[b];for(a=0;a<c.length;a++)if(e=c[a],!e.isComplete())return this.schemasStable=!1}var d=this;this.pendingNotify||(this.pendingNotify=!0,I.add(function(){d.pendingNotify=!1;if(!d.schemasStable){d.schemasStable=!0;for(var a=d.dataObj,b=d.getSchemas(),c=0;c<Y.length;c++)Y[c].call(a,a,b)}d.schemasStableListeners.notify(d.dataObj,d.getSchemas())}));return!0},addSchemasForProperty:function(a,b){for(var c in this.schemas)for(var e=
0;e<this.schemas[c].length;e++)for(var d=this.schemas[c][e].propertySchemas(a),f=0;f<d.length;f++)b.addSchema(d[f],c)},addSchemasForIndex:function(a,b){for(var c in this.schemas)for(var e=0;e<this.schemas[c].length;e++)for(var d=this.schemas[c][e].indexSchemas(a),f=0;f<d.length;f++)b.addSchema(d[f],c)},removeSubSchemas:function(a){for(var b in this.schemas)a.removeSchema(b)},whenSchemasStable:function(a){this.schemasStableListeners.add(a);this.checkForSchemasStable()}};ca.prototype={update:function(){if(this.active=
this.potentialLink.canApplyTo(this.dataObj))this.rawLink=this.potentialLink.linkForData(this.dataObj);this.updateMonitors.notify(this.active)},rel:function(){return this.potentialLink.rel()},usesKey:function(a){return this.potentialLink.usesKey(a)},addMonitor:function(a,b){this.updateMonitors.add(a,b)}};da.prototype={dataUpdated:function(a){if(null==a)for(var b=this.schema.data.property("dependencies").keys(),c=0;c<b.length;c++)a=b[c],this.dataUpdated(a);else if(this.schemaSet.dataObj.property(a).defined()){b=
this.schema.propertyDependencies(a);for(c=0;c<b.length;c++){var e=b[c];"string"!=typeof e&&this.schemaSet.addSchema(e,this.inferredSchemaKeys[a],this.schemaKeyHistory,!1)}}else this.schemaSet.removeSchema(this.inferredSchemaKeys[a])}};G=f.create({intelligentLinks:!0,intelligentPut:!0});f.config=G;f.UriTemplate=A})(this);
(function(G){function z(d){d=JSON.stringify(d);return"{}"==d?null:d}function K(d){return""==d||null==d?{}:JSON.parse(d)}function M(d){var h=this;this.elementLookup={};void 0==d&&(d=H+"."+L++ +".");var j=0;this.getElementId=function(){return d+j++};this.enhancementContexts={};this.enhancementActions={};this.enhancementInputs={};Jsonary.registerChangeListener(function(d,j){d.each(function(d,l){for(var t=j.affectedData(l),s=0;s<t.length;s++)h.update(t[s],l)})});Jsonary.registerSchemaChangeListener(function(d){var j=
h.elementLookup[d.uniqueId];if(!(void 0==j||0==j.length)){for(var n=[],q=0;q<j.length;q++){var t=document.getElementById(j[q]);void 0==t?(j.splice(q,1),q--):n[q]=t}for(q=0;q<n.length;q++){var t=n[q],j=t.jsonaryContext,s=K(t.getAttribute("data-jsonary")),u=E(d,s,j.usedComponents);u.uniqueId==j.renderer.uniqueId?u.render(t,d,j):j.baseContext.render(t,d,j.label,s)}}});this.rootContext=this;this.subContexts={};this.oldSubContexts={}}function A(d,h,j){u.render(d,h,null,j);u.oldSubContexts={};u.subContexts=
{};return this}function y(d){this.renderFunction=d.render||d.enhance;this.renderHtmlFunction=d.renderHtml;this.updateFunction=d.update;this.filterFunction=d.filter;this.actionFunction=d.action;for(var h in d)void 0==this[h]&&(this[h]=d[h]);this.uniqueId=D++;this.component=void 0!=d.component?d.component:C[C.length-1];"string"==typeof this.component&&(this.component=[this.component])}function E(d,h,j){for(var l=d.schemas(),p=0;p<C.length;p++)if(-1==j.indexOf(C[p]))for(var n=C[p],q=F.length-1;0<=q;q--){var t=
F[q];if(-1!=t.component.indexOf(n)&&t.canRender(d,l,h))return t}}var H="Jsonary",L=0,B={ADD_REMOVE:"add/remove",TYPE_SELECTOR:"type-selector",RENDERER:"data renderer",add:function(d,h){void 0==this[d]&&(this[d]=d,-1!=C.indexOf(h)?C.splice(C.indexOf(h),0,this[d]):C.unshift(this[d]))}},C=[B.ADD_REMOVE,B.TYPE_SELECTOR,B.RENDERER];M.prototype={usedComponents:[],rootContext:null,baseContext:null,subContext:function(d,h){void 0==h&&(h={});return this.getSubContext(this.elementId,this.data,d,h)},getSubContext:function(d,
h,j,l){var p=h.uniqueId+":"+j;void 0!=this.oldSubContexts[p]&&(this.subContexts[p]=this.oldSubContexts[p]);if(void 0==this.subContexts[p]){var n=[];this.data==h&&(n=this.usedComponents.slice(0),void 0!=this.renderer&&(n=n.concat(this.renderer.component)));"object"==typeof d&&(d=d.id);var q=function(d,h,j,l,n,p){this.rootContext=d;this.baseContext=h;this.label=j;this.data=l;this.uiState=n;this.usedComponents=p;this.subContexts={};this.oldSubContexts={}};q.prototype=this.rootContext;this.subContexts[p]=
new q(this.rootContext,this,j,h,l,n)}h=this.subContexts[p];h.elementId=d;return h},clearOldSubContexts:function(){this.oldSubContexts=this.subContexts;this.subContexts={}},rerender:function(){var d=document.getElementById(this.elementId);null!=d&&this.renderer.render(d,this.data,this)},render:function(d,h,j,l){void 0==j&&(j="");"string"==typeof h&&(h=Jsonary.getData(h));if(void 0!=h.getData){var p=this;h.getData(function(h){p.render(d,h,j,l)})}else{"object"!=typeof l&&(l={});if(void 0==d.id||""==
d.id)d.id=this.getElementId();var n=d.jsonaryContext,q=this.getSubContext(d.id,h,j,l),t=z(l);null!=t?d.setAttribute("data-jsonary",t):d.removeAttribute("data-jsonary");d.jsonaryContext=q;n&&(n=n.data.uniqueId,t=this.elementLookup[n].indexOf(d.id),0<=t&&this.elementLookup[n].splice(t,1));n=h.uniqueId;void 0==this.elementLookup[n]&&(this.elementLookup[n]=[]);-1==this.elementLookup[n].indexOf(d.id)&&this.elementLookup[n].push(d.id);n=E(h,l,q.usedComponents);void 0!=n?(q.renderer=n,n.render(d,h,q),q.clearOldSubContexts()):
d.innerHTML="NO RENDERER FOUND"}},renderHtml:function(d,h,j){void 0==h&&(h="");var l=this.getElementId();"string"==typeof d&&(d=Jsonary.getData(d));if(void 0!=d.getData){var p=this,n=!1;d.getData(function(q){n?p.render(document.getElementById(l),q,h,j):(n=!0,d=q)});if(!n)return n=!0,'<span id="'+l+'">Loading...</span>'}"object"!=typeof j&&(j={});var q=this.getSubContext(l,d,h,j),t=z(j),s=E(d,j,q.usedComponents);q.renderer=s;s=s.renderHtml(d,q);q.clearOldSubContexts();var u=d.uniqueId;void 0==this.elementLookup[u]&&
(this.elementLookup[u]=[]);-1==this.elementLookup[u].indexOf(l)&&this.elementLookup[u].push(l);this.addEnhancement(l,q);return null!=t?'<span id="'+l+"\" data-jsonary='"+t.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("'","&#39;")+"'>"+s+"</span>":'<span id="'+l+'">'+s+"</span>"},update:function(d,h){var j=this.elementLookup[d.uniqueId];if(!(void 0==j||0==j.length)){for(var l=[],p=0;p<j.length;p++){var n=document.getElementById(j[p]);void 0==n?(j.splice(p,1),p--):l[p]=n}for(p=
0;p<l.length;p++){var n=l[p],j=n.jsonaryContext,q=K(n.getAttribute("data-jsonary")),t=E(d,q,j.usedComponents);t.uniqueId==j.renderer.uniqueId?t.update(n,d,j,h):j.baseContext.render(n,d,j.label,q)}}},actionHtml:function(d,h){for(var j=[],l=2;l<arguments.length;l++)j.push(arguments[l]);l=this.getElementId();this.addEnhancementAction(l,h,this,j);return'<a href="javascript:void(0)" id="'+l+'" style="text-decoration: none">'+d+"</a>"},inputNameForAction:function(d){var h=this.getElementId();this.enhancementInputs[h]=
{inputName:h,actionName:d,context:this};return h},addEnhancement:function(d,h){this.enhancementContexts[d]=h},addEnhancementAction:function(d,h,j,l){null==l&&(l=[]);this.enhancementActions[d]={actionName:h,context:j,params:l}},enhanceElement:function(d){for(var h=d;d;)if(1==d.nodeType&&this.enhanceElementSingle(d),d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!=h;)d=d.parentNode;if(d==h)break;d=d.nextSibling}},enhanceElementSingle:function(d){var h=d.id,j=this.enhancementContexts[h];void 0!=
j&&(d.jsonaryContext=j,delete this.enhancementContexts[h],h=j.renderer,void 0!=h&&h.enhance(d,j.data,j));var l=this.enhancementActions[d.id];void 0!=l&&(delete this.enhancementActions[d.id],d.onclick=function(){var d=l.context,h=[d,l.actionName].concat(l.params);d.renderer.action.apply(d.renderer,h)&&(h=document.getElementById(d.elementId),d.renderer.render(h,d.data,d));return!1});var p=this.enhancementInputs[d.name];void 0!=p&&(delete this.enhancementInputs[d.name],d.onchange=function(){var d=this.value;
"checkbox"==this.getAttribute("type")&&(d=this.checked);var h=p.context;h.renderer.action(h,p.actionName,d)});d=null}};var u=new M;A.empty=void 0!=G.jQuery?function(d){G.jQuery(d).empty()}:function(d){d.innerHTML=""};A.Components=B;var D=0;y.prototype={render:function(d,h,j){void 0!=d[0]&&(d=d[0]);A.empty(d);d.innerHTML=this.renderHtml(h,j);null!=this.renderFunction&&this.renderFunction(d,h,j);j.enhanceElement(d);return this},renderHtml:function(d,h){var j="";void 0!=this.renderHtmlFunction&&(j=this.renderHtmlFunction(d,
h));return j},enhance:function(d,h,j){null!=this.renderFunction&&this.renderFunction(d,h,j);return this},update:function(d,h,j,l){(void 0!=this.updateFunction?this.updateFunction(d,h,j,l):this.defaultUpdate(d,h,j,l))&&this.render(d,h,j);return this},action:function(d,h,j){return this.actionFunction.apply(this,arguments)},canRender:function(d,h,j){return void 0!=this.filterFunction?this.filterFunction(d,h,j):!0},defaultUpdate:function(d,h,j,l){d=!1;j="replace"!=l.action();h=h.pointerPath();if(l.subjectEquals(h)||
j&&!1!==l.subjectChild(h))d=!0;else if(void 0!=l.target()&&(l.targetEquals(h)||j&&!1!==l.targetChild(h)))d=!0;return d}};var F=[];A.register=function(d){d=new y(d);F.push(d)};"undefined"!=typeof G.jQuery&&(B=function(d,h){var j=this[0];void 0!=j&&A(j,d,h);return this},Jsonary.extendData({$renderTo:function(d,h){"string"==typeof d&&(d=jQuery(d));var j=d[0];void 0!=j&&A(j,this,h)}}),B.register=function(d){if(void 0!=d.render){var h=d.render;d.render=function(d,j){var n=$(d);h.call(this,n,j)}}if(void 0!=
d.update){var j=d.update;d.update=function(d,h,n){d=$(d);j.call(this,d,h,n)}}A.register(d)},B.empty=function(d){d.each(function(d,j){A.empty(j)})},jQuery.fn.extend({renderJson:B}),jQuery.extend({renderJson:B}));Jsonary.extend({render:A,renderHtml:function(d,h){var j=u.renderHtml(d,null,h);u.oldSubContexts={};u.subContexts={};return j}});Jsonary.extendData({renderTo:function(d,h){"string"==typeof d&&(d=document.getElementById(d));A(d,this,h)}})})(this);
