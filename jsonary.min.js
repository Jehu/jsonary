Array.isArray||(Array.isArray=function(y){return"[object Array]"===Object.prototype.toString.apply(y)});Array.prototype.indexOf||(Array.prototype.indexOf=function(y,w){for(var z=w||0;z<this.length;z++)if(this[z]===y)return z;return-1});Object.keys||(Object.keys=function(y){var w=[],z;for(z in y)y.hasOwnProperty(z)&&w.push(z);return w});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});"object"!==typeof JSON&&(JSON={});
(function(){function y(q){return 10>q?"0"+q:q}function w(q){A.lastIndex=0;return A.test(q)?'"'+q.replace(A,function(q){var k=F[q];return"string"===typeof k?k:"\\u"+("0000"+q.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+q+'"'}function z(q,x){var k,u,B,t,d=r,h,f=x[q];f&&("object"===typeof f&&"function"===typeof f.toJSON)&&(f=f.toJSON(q));"function"===typeof D&&(f=D.call(x,q,f));switch(typeof f){case "string":return w(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);
case "object":if(!f)return"null";r+=E;h=[];if("[object Array]"===Object.prototype.toString.apply(f)){t=f.length;for(k=0;k<t;k+=1)h[k]=z(k,f)||"null";B=0===h.length?"[]":r?"[\n"+r+h.join(",\n"+r)+"\n"+d+"]":"["+h.join(",")+"]";r=d;return B}if(D&&"object"===typeof D){t=D.length;for(k=0;k<t;k+=1)"string"===typeof D[k]&&(u=D[k],(B=z(u,f))&&h.push(w(u)+(r?": ":":")+B))}else for(u in f)Object.prototype.hasOwnProperty.call(f,u)&&(B=z(u,f))&&h.push(w(u)+(r?": ":":")+B);B=0===h.length?"{}":r?"{\n"+r+h.join(",\n"+
r)+"\n"+d+"}":"{"+h.join(",")+"}";r=d;return B}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+y(this.getUTCMonth()+1)+"-"+y(this.getUTCDate())+"T"+y(this.getUTCHours())+":"+y(this.getUTCMinutes())+":"+y(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var G=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
A=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r,E,F={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},D;"function"!==typeof JSON.stringify&&(JSON.stringify=function(q,x,k){var u;E=r="";if("number"===typeof k)for(u=0;u<k;u+=1)E+=" ";else"string"===typeof k&&(E=k);if((D=x)&&"function"!==typeof x&&("object"!==typeof x||"number"!==typeof x.length))throw Error("JSON.stringify");return z("",{"":q})});
"function"!==typeof JSON.parse&&(JSON.parse=function(q,r){function k(q,t){var d,h,f=q[t];if(f&&"object"===typeof f)for(d in f)Object.prototype.hasOwnProperty.call(f,d)&&(h=k(f,d),void 0!==h?f[d]=h:delete f[d]);return r.call(q,t,f)}var u;q=String(q);G.lastIndex=0;G.test(q)&&(q=q.replace(G,function(k){return"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(q.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return u=eval("("+q+")"),"function"===typeof r?k({"":u},""):u;throw new SyntaxError("JSON.parse");})})();
(function(y){function w(a){var b=a.match(/^[a-zA-Z\-]+:/);null!=b&&0<b.length?(this.scheme=b[0].substring(0,b[0].length-1),a=a.substring(b[0].length)):this.scheme=null;"//"==a.substring(0,2)?(this.doubleSlash=!0,a=a.substring(2)):this.doubleSlash=!1;b=a.indexOf("#");if(0<=b){var c;c=a.substring(b+1);-1!=c.indexOf("?")?(c.isQuery=!1,c=void 0):c=z(c);this.fragment=c;a=a.substring(0,b)}else this.hash=null;b=a.indexOf("?");0<=b?(c=a.substring(b+1),this.query=z(c),a=a.substring(0,b)):this.query=null;b=
a.indexOf("@");if(0<=b){c=a.substring(0,b);var e=c.indexOf(":");-1==e?(this.username=c,this.password=null):(this.username=c.substring(0,e),this.password=c.substring(e+1));a=a.substring(b+1)}else this.password=this.username=null;b=0;if(null!=this.scheme||this.doubleSlash)b=a.indexOf("/");0<=b?(this.path=a.substring(b),""==this.path&&(this.path=null),a=a.substring(0,b)):this.path=null;e=a.indexOf(":");0<=e?(this.port=a.substring(e+1),a=a.substring(0,e)):this.port=null;this.domain=""==a?null:a}function z(a){a=
a.split("&");for(var b=[],c=0;c<a.length;c++){var e=a[c],j=e.indexOf("=");if(-1==j)b.push({key:e});else{var g=e.substring(0,j),e=e.substring(j+1);b.push({key:g,value:decodeURIComponent(e)})}}for(g in Z)b[g]=Z[g];b.isQuery=!0;return b}function G(a){var b="";ha[a.charAt(0)]&&(b=a.charAt(0),a=a.substring(1));var c=",",e="",j=!0,g=!1;"+"==b?j=!1:"."==b?c=e=".":"/"==b?c=e="/":"#"==b?(e="#",j=!1):";"==b?(c=e=";",g=!0):"?"==b?(e="?",c="&",g=!0):"&"==b&&(c=e="&",g=!0);b=[];a=a.split(",");for(var P=[],d=0;d<
a.length;d++){var f=a[d],h=null;-1!=f.indexOf(":")&&(h=f.split(":"),f=h[0],h=parseInt(h[1]));for(var m={};ia[f.charAt(f.length-1)];)m[f.charAt(f.length-1)]=!0,f=f.substring(0,f.length-1);P.push({truncate:h,name:f,suffices:m});b.push(f)}a=function(a){for(var b=e,d=0;d<P.length;d++){var f=P[d];0<d&&(b+=c);var h=a(f.name);if(Array.isArray(h)){g&&(b+=f.name+"=");for(var H=0;H<h.length;H++)0<H&&(b+=f.suffices["*"]?c:",",f.suffices["*"]&&g&&(b+=f.name+"=")),b+=j?encodeURIComponent(h[H]).replace("!","%21"):
encodeURI(h[H]).replace("%25","%")}else if("object"==typeof h){g&&!f.suffices["*"]&&(b+=f.name+"=");var H=!0,L;for(L in h)H||(b+=f.suffices["*"]?c:","),H=!1,b+=j?encodeURIComponent(L).replace("!","%21"):encodeURI(L).replace("%25","%"),b+=f.suffices["*"]?"=":",",b+=j?encodeURIComponent(h[L]).replace("!","%21"):encodeURI(h[L]).replace("%25","%")}else g&&(b+=f.name+"="),null!=f.truncate&&(h=h.substring(0,f.truncate)),b+=j?encodeURIComponent(h).replace("!","%21"):encodeURI(h).replace("%25","%")}return b};
a.varNames=b;return a}function A(a){a=a.split("{");for(var b=[a.shift()],c=[],e=[];0<a.length;){var j=a.shift(),g=j.split("}")[0],j=j.substring(g.length+1),g=G(g);c.push(g);b.push(j);e=e.concat(g.varNames)}this.fill=function(a){for(var e=b[0],j=0;j<c.length;j++)e+=(0,c[j])(a),e+=b[j+1];return e};this.varNames=e}function r(a,b){for(var c in b)(function(b,c){a[b]=function(){return c}})(c,b[c])}function E(a){this.contents={};this.keyOrder=[];this.context=a}function F(a){this.listeners=[];this.context=
a}function D(a,b){var c=this;this.baseUrl=a.url;this.fragment=b;null==b&&(b="");this.url=this.baseUrl+"#"+encodeURI(b);this.getRoot=function(b){a.getRoot(function(a){b.call(a,a,c)})};this.getData=function(e){null==b||""==b?a.document.getRoot(function(a){e.call(a,a,c)}):a.document.getFragment(b,function(a){e.call(a,a,c)})};this.getRawResponse=function(b){a.getResponse(function(a){b.call(a,a,c)})}}function q(a,b,c,e,j){a=m.resolveRelativeUri(a);c=m.encodeData(c,e);"GET"==b&&""!=c&&(a=-1==a.indexOf("?")?
a+"?":a+"&",a+=c,c="");m.log(m.logLevel.STANDARD,"Sending request for: "+a);this.errorMessage=this.successful=void 0;this.url=a;var g=void 0==c||""==c;this.responseListeners=new F(this);this.document=new B(a,g,!0);this.fetched=!1;this.fetchData(a,b,c,e,j);this.invalidate=function(){"GET"==b&&this.fetchData(a,b,c,e,j)}}function x(a,b,c,e,j){e(j,this);var g=this;this.url=a;this.responseListeners=new F(this);this.document=new B(a,!0,!0);this.document.setRaw(b);this.profileUrl=c;void 0!=c&&this.document.raw.addSchema(c);
a==c?this.document.setRoot(""):this.document.raw.whenSchemasStable(function(){var a=g.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),g.document.setRoot(a)):g.document.setRoot("")});this.successful=!0;this.errorMessage=void 0;this.fetched=!1;this.invalidate=function(){this.fetchData(a,"GET",void 0,"application/x-www-form-urlencoded",c)}}function k(a){this.operations=[];void 0==a&&(a="");this.prefix=a}function u(a,b,c){this._patchType=a;this._subject=b;
this._subjectValue=void 0;"move"==a?this._target=c:this._value=c}function B(a,b,c){this.readOnly=!!c;this.url=a;this.isDefinitive=b;var e={};this.raw=new t(this,e);this.root=null;var j=[];this.registerChangeListener=function(a){j.push(a)};this.setRaw=function(a){e.setValue(a)};var g=new F(this);this.getRoot=function(a){null==this.root?g.add(a):a.call(this,this.root)};this.setRoot=function(a){this.root=this.raw.subPath(a);g.notify(this.root)};this.patch=function(a){var b=this;if(this.readOnly)throw Error("Cannot update read-only document");
if(Q)void 0==this.batchPatch&&(this.batchPatch=new k,R.push(this)),this.batchPatch.operations=this.batchPatch.operations.concat(a.operations);else{J.increment();var c=aa.concat(j);J.add(function(){for(var e=0;e<c.length;e++)c[e].call(b,a,b)});var e=a.filter("?"),g=a.filterRemainder("?");this.raw.patch(e);this.root.patch(g);J.decrement()}};this.affectedData=function(a){for(var b=a.subject(),c=null,c="?"==b||"?/"==b.substring(0,2)?this.raw.subPath(b.substring(1)):this.root.subPath(b),b=[];void 0!=c;)b.push(c),
c=c.parent();if("move"==a.action()){a=a.target();c=null;c="?"==a||"?/"==a.substring(0,2)?this.raw.subPath(a.substring(1)):this.root.subPath(a);for(b.push();void 0!=c;)b.push(c),c=c.parent()}return b}}function t(a,b,c,e){this.uniqueId=ja++;this.document=a;this.readOnly=function(){return a.readOnly};var j=void 0,g=void 0,d=0,f=[],h={},C={};this.property=function(a){void 0==h[a]&&(C[a]={},h[a]=new t(this.document,C[a],this,a),"object"==g&&(C[a].setValue(j[a]),void 0!==j[a]&&b.schemas.addSchemasForProperty(a,
h[a])));return h[a]};var p={},n={};this.item=function(a){if(!M.test(a))throw Error("Index must be a positive integer (or integer-value string)");void 0==p[a]&&(n[a]={},p[a]=new t(this.document,n[a],this,a),"array"==g&&(n[a].setValue(j[a]),void 0!==j[a]&&b.schemas.addSchemasForIndex(a,p[a])));return p[a]};this.parent=function(){return c};this.parentKey=function(){return e};this.pointerPath=function(){return this.document.root==this?"":void 0!=c?c.pointerPath()+"/"+m.encodePointerComponent(e):"?"};
this.basicType=function(){return g};this.value=function(){if("object"==g){for(var a={},b=0;b<f.length;b++){var c=f[b];a[c]=void 0!=h[c]?h[c].value():j[c]}return a}if("array"==g){a=[];for(b=0;b<d;b++)a[b]=void 0!=p[b]?p[b].value():j[b];return a}return j};this.keys=function(){return f.slice(0)};this.length=function(){return d};this.patch=function(a){var c=this,e=this.pointerPath(),s={};a.each(function(a,m){if(m.subjectEquals(e))if("replace"==m.action()||"add"==m.action())m.setSubjectValue(c.value()),
b.setValue(m.value());else{if("remove"!=m.action()&&"move"!=m.action())throw Error("Unrecognised patch operation: "+m.action());}else if(m.targetEquals(e))"move"==m.action()&&b.setValue(m.subjectValue());else{var l=m.subjectChild(e);if(l)if(s[l]=!0,"object"==g)if("add"==m.action()){var k=f.indexOf(l);if(-1!=k)throw Error("Cannot add existing key: "+l);f.push(l);j[l]=m.value();void 0!=h[l]&&(C[l].setValue(m.value()),b.schemas.addSchemasForProperty(l,h[l]))}else if("remove"==m.action()||"move"==m.action()){k=
f.indexOf(l);if(-1==k)throw Error("Cannot delete missing key: "+l);m.setSubjectValue(c.propertyValue(l));f.splice(k,1);void 0!=C[l]&&C[l].setValue(void 0);delete j[l]}else{if("replace"!=m.action())throw Error("Unrecognised patch operation: "+m.action());}else if("array"==g){if(!M.test(l))throw Error("Cannot patch non-numeric index: "+l);k=parseInt(l);if("add"==m.action()){if(k>d)throw Error("Cannot add past the end of the list");for(l=d-1;l>=k;l--)void 0!=n[l+1]&&(void 0==p[l]?n[l+1].setValue(j[l]):
n[l+1].setValue(p[l].value()));j.splice(k,0,m.value());d++;void 0!=p[j.length-1]&&b.schemas.addSchemasForIndex(j.length-1,p[j.length-1])}else if("remove"==m.action()||"move"==m.action()){if(k>=d)throw Error("Cannot remove a non-existent index");m.setSubjectValue(c.itemValue(k));for(l=k;l<d-1;l++)void 0!=n[l]&&(void 0==p[l+1]?n[l].setValue(j[l+1]):n[l].setValue(p[l+1].value()));void 0!=n[d-1]&&n[d-1].setValue(void 0);d--;j.splice(k,1)}else if("replace"!=m.action())throw Error("Unrecognised patch operation: "+
m.action());}if(l=m.targetChild(e))if(s[l]=!0,"object"==g){if("move"==m.action()){k=f.indexOf(l);if(-1!=k)throw Error("Cannot move to existing key: "+l);f.push(l);j[l]=m.subjectValue();void 0!=h[l]&&b.schemas.addSchemasForProperty(l,h[l])}}else if("array"==g){if(!M.test(l))throw Error("Cannot patch non-numeric index: "+l);k=parseInt(l);if("move"==m.action()){if(k>d)throw Error("Cannot add past the end of the list");for(l=d-1;l>=k;l--)void 0!=n[l+1]&&(void 0==p[l]?n[l+1].setValue(j[l]):n[l+1].setValue(p[l].value()));
j.splice(k,0,m.subjectValue());d++;void 0!=p[j.length-1]&&b.schemas.addSchemasForIndex(j.length-1,p[j.length-1])}}}});if("object"==g)for(var l=0;l<f.length;l++){var k=f[l],I=a.filter("/"+m.encodePointerComponent(k));I.isEmpty()||this.property(k).patch(I)}else if("array"==g)for(l=0;l<d;l++)I=a.filter("/"+m.encodePointerComponent(l)),I.isEmpty()||this.index(l).patch(I);for(k in s)b.schemas.update(k)};b.setValue=function(a){var c=m.guessBasicType(a,g),e=j;j=a;if(c!=g){if("object"==g)for(var l in h)C[l].setValue(void 0);
else if("array"==g)for(var k in p)n[k].setValue(void 0);g=c}if("object"==c){for(l in h)a.hasOwnProperty(l)?(h[l].defined()||b.schemas.addSchemasForProperty(l,h[l]),C[l].setValue(a[l])):C[l].setValue(void 0);f=Object.keys(a);d=0}else if("array"==c){for(k in p)k<a.length?(p[k].defined()||b.schemas.addSchemasForIndex(k,p[k]),n[k].setValue(a[k])):n[k].setValue(void 0);f=[];d=a.length}else f=[],d=0;void 0===a?void 0!==e&&b.schemas.clear():b.schemas.update(null)};b.schemas=new ba(this);this.schemas=function(){return b.schemas.getSchemas()};
this.whenSchemasStable=function(a){b.schemas.whenSchemasStable(a);return this};this.links=function(a){return b.schemas.getLinks(a)};this.addLink=function(a){b.schemas.addLink(a);return this};this.addSchema=function(a,c){var e=this;a instanceof v?a.each(function(a,b){e.addSchema(b,c)}):b.schemas.addSchema(a,c);return this};this.removeSchema=function(a){b.schemas.removeSchema(a);return this};this.addSchemaMatchMonitor=function(a,c,e,j){return b.schemas.addSchemaMatchMonitor(a,c,e,j)}}function d(a,b){return n.getData(a,
function(a,e){var j=a.asSchema();void 0!=b&&b.call(j,j,e)})}function h(a){void 0==S[a]&&(S[a]=n.createSchema({type:a}));return S[a]}function f(a){this.data=a;a.referenceUrl();a.propertyValue("id");var b=[];a=a.property("links");void 0!==a&&a.indices(function(a,e){b[b.length]=new C(e)});this.links=function(){return b.slice(0)};this.schemaTitle=this.title()}function C(a){this.data=a;var b;b=a.propertyValue("href");if("{@}"==b)b="{+%73elf}";else{for(var c=[],e=!1,j=!1,g=0;g<b.length;g++){var d=b.charAt(g);
e?j?")"==d?")"==b.charAt(g+1)?(c.push(T[")"]),g++):j=!1:void 0!=T[d]?c.push(T[d]):c.push(encodeURIComponent(d)):"$"==d?c.push("%73elf"):"("==d?")"==b.charAt(g+1)?(c.push("%65mpty"),g++):j=!0:("}"==d&&(e=!1),c.push(d)):("{"==d&&(e=!0),c.push(d))}b=c.join("")}this.uriTemplate=new A(b);this.dataParts=[];for(b=0;b<this.uriTemplate.varNames.length;b++)this.dataParts.push(I(this.uriTemplate.varNames[b]));b=a.property("schema");b.defined()?(b=b.asSchema(),this.submissionSchemas=new v([b])):this.submissionSchemas=
new v;a=a.property("targetSchema");a.defined()&&(this.targetSchema=a.asSchema());this.handlers=[];this.preHandlers=[]}function I(a){return"%65mpty"==a?"":"%73elf"==a?null:decodeURIComponent(a)}function s(a,b,c){this.rawLink=a;this.definition=b;this.subjectData=c;this.href=a.href;b=this.href.indexOf("#");0<=b?(this.hrefBase=this.href.substring(0,b),this.hrefFragment=this.href.substring(b+1)):(this.hrefBase=this.href,this.hrefFragment="");this.rel=a.rel;this.method=void 0!=a.method?a.method:"GET";void 0!=
a.enctype&&(a.encType=a.enctype,delete a.enctype);this.encType=void 0==a.encType?"GET"==this.method?"application/x-www-form-urlencoded":"POST"==this.method||"PUT"==this.method?"application/json":"application/x-www-form-urlencoded":a.encType;null!=this.definition&&(this.submissionSchemas=this.definition.submissionSchemas,this.targetSchema=this.definition.targetSchema)}function l(a,b,c){var e=this;this.monitorKey=a;this.match=!1;this.matchFailReason=new p("initial failure",null);this.monitors=new E(c);
this.propertyMatches={};this.indexMatches={};this.dependencies={};this.dependencyKeys={};this.schemaLoaded=!1;this.data=b;c.getFull(function(a){e.schemaLoaded=!0;e.schema=a;e.basicTypes=a.basicTypes();e.setupXorSelectors();e.setupOrSelectors();e.setupAndMatches();e.setupNotMatches();e.dataUpdated()})}function p(a,b,c){this.message=a;this.schema=b;this.subMatchFailReason=c}function U(a,b,c){var e=this;this.options=b;this.selectedOption=this.matchCallback=null;this.data=c;this.subMatches=[];this.subSchemaKeys=
[];for(var j=!1,g=0;g<b.length;g++)this.subSchemaKeys[g]=m.getKeyVariant(a,"option"+g),this.subMatches[g]=c.addSchemaMatchMonitor(this.subSchemaKeys[g],b[g],function(){j||(j=!0,J.add(function(){j=!1;e.update()}))},!1);this.update()}function V(a,b,c){var e=this;this.options=b;this.matchCallback=null;this.selectedOptions=[];this.data=c;this.subMatches=[];this.subSchemaKeys=[];for(var j=!1,g=0;g<b.length;g++)this.subSchemaKeys[g]=m.getKeyVariant(a,"option"+g),this.subMatches[g]=c.addSchemaMatchMonitor(this.subSchemaKeys[g],
b[g],function(){j||(j=!0,J.add(function(){j=!1;e.update()}))},!1);this.update()}function W(a){for(var b=0;b<a.length;b++)this[b]=a[b];this.length=a.length}function v(a,b){if(void 0==a)this.length=0;else{void 0==b&&(b=a);this.fixed=function(){var c=b.length<a.length?new v(b):this;this.fixed=function(){return c};return c};var c;for(c=0;c<a.length;c++)this[c]=a[c];this.length=a.length}}function ba(a){this.dataObj=a;this.schemas={};this.schemasFixed={};this.links={};this.matches={};this.xorSelectors=
{};this.orSelectors={};this.dependencySelectors={};this.schemaFlux=0;this.schemasStable=!0;this.schemasStableListeners=new F(a);this.pendingNotify=!1;this.cachedLinkList=this.cachedSchemaList=null}function ca(a,b){this.dataObj=a;this.potentialLink=b;this.active=!1;this.rawLink=null;this.updateMonitors=new E(a)}function ka(a,b,c,e){var j=m.getKeyVariant(b,"$");this.xorSelector=new U(b,a,e.dataObj);this.xorSelector.onMatchChange(function(a){e.removeSchema(j);null!=a&&e.addSchema(a,j,c,!1)})}function la(a,
b,c,e){for(var j=[],g=[],d=0;d<a.length;d++)j[d]=m.getKeyVariant(b,"$"+d),g[d]=!1;this.orSelector=new V(b,a,e.dataObj);this.orSelector.onMatchChange(function(b){for(var d=0;d<a.length;d++){for(var f=!1,h=0;h<b.length;h++)if(a[d]==b[h]){f=!0;break}f&&!g[d]?e.addSchema(a[d],j[d],c,!1):!f&&g[d]&&e.removeSchema(j[d]);g[d]=f}})}function da(a,b,c,e){this.inferredSchemaKeys={};this.applied={};this.schema=a;this.schemaKeyHistory=c;this.schemaSet=e;a=this.schema.data.property("dependencies").keys();for(c=
0;c<a.length;c++)e=a[c],this.inferredSchemaKeys[e]=m.getKeyVariant(b,"$"+c),this.dataUpdated(e)}var n={toString:function(){return"[JsonApi]"}};y.Jsonary=n;w.prototype={toString:function(){var a="";null!=this.scheme&&(a+=this.scheme+":");this.doubleSlash&&(a+="//");null!=this.username&&(a+=this.username,null!=this.password&&(a+=":"+this.password),a+="@");null!=this.domain&&(a+=this.domain);null!=this.port&&(a+=":"+this.port);null!=this.path&&(a+=this.path);null!=this.query&&(a+="?"+this.query);null!=
this.fragment&&(a+="#"+this.fragment);return a}};w.resolve=function(a,b){if(void 0==b)return a;if(void 0==a)return b;a instanceof w||(a=new w(a));result=new w(b+"");if(null==result.scheme&&(result.scheme=a.scheme,result.doubleSlash=a.doubleSlash,null==result.domain))if(result.domain=a.domain,result.port=a.port,result.username=a.username,result.password=a.password,null==result.path)result.path=a.path,null==result.query&&(result.query=a.query);else if("/"!=result.path.charAt(0)&&null!=a.path){var c=
"/"==a.path.charAt(0),e;e=c?a.path.substring(1).split("/"):a.path.split("/");".."==e[e.length-1]&&e.push("");e.pop();for(var j=e.length-1;0<=j;j--)"."==e[j]&&e.slice(j,1);for(var g=result.path.split("/"),j=0;j<g.length;j++){var d=g[j];if("."!=d)if(".."==d)if(0<e.length&&".."!=e[e.length-1])e.pop();else{if(!c){e=e.concat(g.slice(j));break}}else e.push(d)}result.path=(c?"/":"")+e.join("/")}return result.toString()};w.parse=function(a){return new w(a)};var Z={toString:function(){for(var a=[],b=0;b<this.length;b++)"undefined"==
typeof this[b].value?a.push(this[b].key):a.push(this[b].key+"="+encodeURIComponent(this[b].value));return a.join("&")},get:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a)return this[c].value;return b},set:function(a,b){for(var c=0;c<this.length;c++)if(this[c].key==a){this[c].value=b;return}this.push({key:a,value:b})}};n.Uri=w;var ha={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},ia={"*":!0},m={guessBasicType:function(a){if(null===a)return"null";if(Array.isArray(a))return"array";
if("object"==typeof a)return"object";if("string"==typeof a)return"string";if("number"==typeof a)return 0==a%1?"integer":"number";if("boolean"==typeof a)return"boolean"},resolveRelativeUri:function(a,b){return w.resolve(a,b)},urlsEqual:function(a,b){"#"==a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));"#"==b.charAt(b.length-1)&&(b=b.substring(0,b.length-1));return a==b},linksEqual:function(a,b){if(void 0==a||void 0==b)return a==b;if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++){var e=
a[c],j=b[c];if(e.href!=j.href||e.rel!=j.rel||(e.method!=j.method||e["enc-type"]!=j["enc-type"])||e.schema!=j.schema)return!1}return!0},log:function(a,b){try{a>=m.logLevel.ERROR&&(window.alert("ERROR: "+b),console.log("ERROR: "+b),console.trace()),a>=m.logLevel.WARNING&&console.log("WARNING: "+b)}catch(c){}},logLevel:{DEBUG:-1,STANDARD:0,WARNING:1,ERROR:2},getKeyVariant:function(a,b){void 0==b&&(b=m.getUniqueKey());b+="";if(0<=b.indexOf("."))throw Error("variant name cannot contain a dot: "+b);return a+
"."+b},keyIsVariant:function(a,b){a+="";b+="";return a===b||a.substring(0,b.length+1)===b+"."},keyIsRoot:function(a){return-1==a.indexOf(".")},hcf:function(a,b){a=Math.abs(a);for(b=Math.abs(b);;){var c=a%b;if(0==c)return b;if(isNaN(c))return NaN;a=b;b=c}},recursiveCompare:function(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(!m.recursiveCompare(a[c],b[c]))return!1;return!0}if("object"==typeof a){for(c in a)if(void 0===b[c]&&void 0!==a[c])return!1;
for(c in b)if(void 0===a[c]&&void 0!==a[c])return!1;for(c in a)if(!m.recursiveCompare(a[c],b[c]))return!1;return!0}return a===b},lcm:function(a,b){return Math.abs(a*b/this.hcf(a,b))},encodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");if("application/json"==b)return JSON.stringify(a);if("application/x-www-form-urlencoded"==b)return m.formEncode(a);throw Error("Unknown encoding type: "+this.encType);},decodeData:function(a,b){void 0==b&&(b="application/x-www-form-urlencoded");
if("application/json"==b)return JSON.parse(a);if("application/x-www-form-urlencoded"==b)return m.formDecode(a);throw Error("Unknown encoding type: "+this.encType);},formEncode:function(a,b){void 0==b&&(b="");var c=[];if(Array.isArray(a))for(var e=0;e<a.length;e++){var j=""==b?e:b+encodeURIComponent("[]"),g=""==b?e:b+encodeURIComponent("["+e+"]"),d=a[e];null==d?c.push(j+"=null"):"object"==typeof d?c.push(m.formEncode(d,g)):"boolean"==typeof d?d?c.push(j+"=true"):c.push(j+"=false"):c.push(j+"="+encodeURIComponent(d))}else if("object"==
typeof a)for(j in a)a.hasOwnProperty(j)&&(d=a[j],""!=b&&(j=b+encodeURIComponent("["+j+"]")),"null"==d?c.push(j+"=null"):"object"==typeof d?c.push(m.formEncode(d,j)):"boolean"==typeof d?d?c.push(j+"=true"):c.push(j+"=false"):c.push(j+"="+encodeURIComponent(d)));else c.push(encodeURIComponent(a));return c.join("&")},formDecode:function(a){var b={};a=a.split("&");for(var c=0;c<a.length;c++){var e=a[c],j=e,g="";0<=e.indexOf("=")&&(j=e.substring(0,e.indexOf("=")),g=decodeURIComponent(e.substring(e.indexOf("=")+
1)),"true"==g?g=!0:"false"==g?g=!1:"null"==g?g=null:parseFloat(g)+""==g&&(g=parseFloat(g)));for(var j=decodeURIComponent(j),e=b,j=j.split("["),d=1;d<j.length;d++)j[d]=j[d].substring(0,j[d].length-1);for(d=0;d<j.length;d++)Array.isArray(e)&&""==j[d]&&(j[d]=e.length),d==j.length-1?e[j[d]]=g:(void 0==e[j[d]]&&(e[j[d]]=""==j[d+1]?[]:{}),e=e[j[d]])}return b},escapeHtml:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},encodePointerComponent:function(a){return a.toString().replace("~",
"~0").replace("/","~1")},decodePointerComponent:function(a){return a.toString().replace("~1","/").replace("~0","~")},splitPointer:function(a){a=a.split("/");""==a[0]&&a.shift();for(var b=0;b<a.length;b++)a[b]=m.decodePointerComponent(a[b]);return a},joinPointer:function(){for(var a="",b=0;b<parts.length;b++)a+="/"+m.encodePointerComponent(parts[b]);return a}},ma=0;m.getUniqueKey=function(){return ma++};n.getMonitorKey=m.getUniqueKey;n.getKeyVariant=function(a,b){return m.getKeyVariant(a,"~"+b)};n.keyIsVariant=
m.keyIsVariant;n.log=function(a,b){if("number"!=typeof a)throw alert("First argument to log() must be a number (preferably enum value from .logLevel)"),Error("First argument to log() must be a number (preferably enum value from .logLevel)");m.log(a,b)};n.setLogFunction=function(a){m.log=a};n.logLevel=m.logLevel;n.encodeData=m.encodeData;n.decodeData=m.decodeData;n.encodePointerComponent=m.encodePointerComponent;n.decodePointerComponent=m.decodePointerComponent;n.splitPointer=m.splitPointer;n.joinPointer=
m.joinPointer;n.escapeHtml=m.escapeHtml;n.extend=function(a){for(var b in a)void 0==n[b]&&(n[b]=a[b])};E.prototype={add:function(a,b){if("string"!=typeof a&&"number"!=typeof a)throw Error("First argument must be a monitorKey, obtained using getMonitorKey()");this.contents[a]=b;this.addKey(a)},addKey:function(a){var b;for(b=0;b<this.keyOrder.length;b++){var c=this.keyOrder[b];if(c==a)return;if(m.keyIsVariant(a,c)){this.keyOrder.splice(b,0,a);return}}this.keyOrder.push(a)},remove:function(a){delete this.contents[a];
this.removeKey(a);a+=".";for(var b in this.contents)b.substring(0,a.length)==a&&(this.removeKey(b),delete this.contents[b])},removeKey:function(a){a=this.keyOrder.indexOf(a);0<=a&&this.keyOrder.splice(a,1)},notify:function(){for(var a=arguments,b=0;b<this.keyOrder.length;b++)this.contents[this.keyOrder[b]].apply(this.context,a)},isEmpty:function(){for(var a in this.contents)if(0!==this.contents[a].length)return!1;return!0}};F.prototype={add:function(a){this.listeners[this.listeners.length]=a},notify:function(){for(var a=
arguments;0<this.listeners.length;)this.listeners.shift().apply(this.context,a)},isEmpty:function(){return 0===this.listeners.length}};var J={depth:0,callbacks:[],increment:function(){this.depth++},decrement:function(){this.depth--;if(0>this.depth)throw Error("DelayedCallbacks.depth cannot be < 0");for(;0==this.depth&&0<this.callbacks.length;)this.callbacks.shift()()},add:function(a){0==this.depth?a():this.callbacks.push(a)}};"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}throw Error("This browser does not support XMLHttpRequest.");
});var N={};setInterval(function(){K.empty()},1E4);var K=function(a,b){if(void 0!==b)N[a]=b,(new Date).getTime();else return N[a]};K.cacheSeconds=10;K.empty=function(){};K.invalidate=function(a){"string"==typeof a&&(a=m.resolveRelativeUri(a));for(var b in N){var c=N[b],e=c.url;"string"==typeof a?-1!=e.indexOf(a)&&c.invalidate():a.test(e)&&c.invalidate()}};n.defaultCache=K;n.invalidate=K.invalidate;D.prototype={};n.addToCache=function(a,b,c,e){a=m.resolveRelativeUri(a);void 0==e&&(e=n.defaultCache);
var j=JSON.stringify(a)+":"+JSON.stringify({});new x(a,b,c,e,j)};n.getData=function(a,b,c){"string"==typeof a&&(a={url:a});var e;a:{var j=a.url,g=a.method,d=a.data,f=a.encType;a=null;if(void 0==j)throw Error("URL cannot be undefined");j=m.resolveRelativeUri(j);void 0==g&&(g="GET");void 0===d&&(d={});var h=null,l=j.indexOf("#");0<=l&&(h=decodeURI(j.substring(l+1)),j=j.substring(0,l));void 0==f&&(f="GET"==g?"application/x-www-form-urlencoded":"POST"==g||"PUT"==g?"application/json":"application/x-www-form-urlencoded");
void 0==a&&(a=n.defaultCache);if(l=a&&"GET"==g&&"application/x-www-form-urlencoded"==f){e=JSON.stringify(j)+":"+JSON.stringify(d);var p=a(e);if(void 0!=p){e=new D(p,h);break a}}c=new q(j,g,d,f,c);l&&a(e,c);e=new D(c,h)}void 0!=b&&e.getData(b);return e};var X=m.getUniqueKey();q.prototype={beingUsed:function(){return void 0==this.baseContext?(m.log(m.logLevel.DEBUG,"No base context: "+this.url),!0):0<this.baseContext.retainCount()},getResponse:function(a){this.responseListeners.add(a);this.checkForFullResponse()},
checkForFullResponse:function(){this.document.raw.defined()&&this.responseListeners.notify(this.document.raw,this)},ajaxSuccess:function(a,b,c){this.fetched=!0;var e=this;e.successful=!0;m.log(m.logLevel.STANDARD,"Request success: "+this.url);var j=b.split("\n"),g={},d=null,f={};for(b=0;b<j.length;b++){var h=j[b].split(": ")[0];""!=h&&(d=j[b].substring(h.length+2),"\r"==d[d.length-1]&&(d=d.substring(0,d.length-1)),h=h.toLowerCase(),void 0==g[h]?g[h]=d:"object"==typeof g[h]?g[h].push(d):g[h]=[g[h],
d])}m.log(m.logLevel.DEBUG,"headers: "+JSON.stringify(g,null,4));d=g["content-type"].split(";")[0];j=g["content-type"].substring(d.length+1).split(",");for(b=0;b<j.length;b++){var h=j[b].split("=")[0],l=j[b].substring(h.length+1),h=h.trim();""!=h&&(f[h]=l)}e.headers=g;e.contentType=d;e.contentTypeParameters=f;e.document.setRaw(a);e.profileUrl=null;e.document.raw.removeSchema(X);void 0!=f.profile?(b=f.profile,b=m.resolveRelativeUri(e.url,b),e.profileUrl=b,e.document.raw.addSchema(b,X)):void 0!=c&&
e.document.raw.addSchema(c,X);void 0!=f.root&&(a={href:f.root,rel:"root"},e.document.raw.addLink(a));if(g.link){g="object"==typeof g.link?g.link:[g.link];for(b=0;b<g.length;b++){a=g[b];a=a.trim().split(";");c=a.shift().trim();c=c.substring(1,c.length-2);c={href:c};for(f=0;f<a.length;f++)d=a[f],j=d.substring(0,d.indexOf("=")),d=d.substring(j.length+1),'"'==d.charAt(0)&&(d=JSON.parse(d)),"type"==j&&(j="mediaType"),c[j]=d;e.document.raw.addLink(c)}}e.checkForFullResponse();e.document.raw.whenSchemasStable(function(){var a=
e.document.raw.getLink("root");void 0!=a?(a=decodeURI(a.href.substring(a.href.indexOf("#")+1)),e.document.setRoot(a)):e.document.setRoot("")})},ajaxError:function(a){this.fetched=!0;var b=this;b.successful=!1;b.errorMessage=a;m.log(m.logLevel.WARNING,"Error fetching: "+this.url+" ("+a+")");b.document.setRaw(void 0);b.document.raw.whenSchemasStable(function(){b.checkForFullResponse();b.document.setRoot("")})},fetchData:function(a,b,c,e,j){var d=this,f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==
f.readyState)if(200==f.status){var a=f.responseText;try{a=JSON.parse(a)}catch(b){d.ajaxError(b);return}var c=f.getAllResponseHeaders();if(""==c){for(var c=[],e="Cache-Control Content-Language Content-Type Expires Last-Modified Pragma".split(" "),h=0;h<e.length;h++){var l=f.getResponseHeader(e[h]);""!=l&&null!=l&&c.push(e[h]+": "+l)}c=c.join("\n")}d.ajaxSuccess(a,c,j)}else d.ajaxError("HTTP Status "+f.status)};if(("GET"==b||"DELETE"==b)&&void 0!=c&&""!=c)a=-1==a.indexOf("?")?a+"?":a+"&",a+=c,c=void 0;
f.open(b,a,!0);f.setRequestHeader("Content-Type",e);f.send(c)}};x.prototype=q.prototype;k.prototype={isEmpty:function(){return 0==this.operations.length},each:function(a){for(var b=0;b<this.operations.length;b++)a.call(this,b,this.operations[b]);return this},plain:function(){for(var a=[],b=0;b<this.operations.length;b++)a[b]=this.operations[b].plain();return a},condense:function(){},filterImmediate:function(){for(var a=new k(this.prefix),b=0;b<this.operations.length;b++){var c=this.operations[b];
c.immediateChild(this.prefix)&&a.operations.push(c)}return a},filter:function(a){a=this.prefix+a;for(var b=new k(a),c=0;c<this.operations.length;c++){var e=this.operations[c];e.hasPrefix(a)&&b.operations.push(e)}return b},filterRemainder:function(a){a=this.prefix+a;for(var b=new k(this.prefix),c=0;c<this.operations.length;c++){var e=this.operations[c];e.hasPrefix(a)||b.operations.push(e)}return b},replace:function(a,b){var c=new u("replace",a,b);this.operations.push(c);return this},add:function(a,
b){var c=new u("add",a,b);this.operations.push(c);return this},remove:function(a){a=new u("remove",a);this.operations.push(a);return this},move:function(a,b){var c=new u("move",a,b);this.operations.push(c);return this},inverse:function(){for(var a=new k(this.prefix),b=0;b<this.operations.length;b++)a.operations[b]=this.operations[b].inverse();a.operations.reverse();return a}};u.prototype={action:function(){return this._patchType},value:function(){return this._value},subject:function(){return this._subject},
setSubjectValue:function(a){this._subjectValue=a;return this},subjectValue:function(){return this._subjectValue},inverse:function(){switch(this._patchType){case "replace":return new u("replace",this._subject,this._subjectValue);case "add":return(new u("remove",this._subject)).setSubjectValue(this._value);case "remove":return new u("add",this._subject,this._subjectValue);case "move":return new u("move",this._target,this._subject);default:throw Error("Unrecognised patch type for inverse: "+this._patchType);
}},depthFrom:function(a){"object"==typeof a&&(a=a.pointerPath());a+="/";var b=NaN;if(this._subject.substring(0,a.length)==a)var c=this._subject.substring(a.length),b=0==c?0:c.split("/").length;void 0!=this._target&&this._target.substring(0,a.length)==a&&(c=this._target.substring(a.length),a=0==c?0:c.split("/").length,a>b||(b=a));return b},subjectEquals:function(a){return this._subject==a},subjectChild:function(a){a+="/";return this._subject.substring(0,a.length)==a&&(a=this._subject.substring(a.length),
-1==a.indexOf("/"))?decodeURIComponent(a):!1},subjectRelative:function(a){a+="/";return this._subject.substring(0,a.length)==a?this._subject.substring(a.length-1):!1},target:function(){return this._target},targetEquals:function(a){return this._target==a},targetChild:function(a){if(void 0!=this._target)return a+="/",this._target.substring(0,a.length)==a&&(a=this._target.substring(a.length),-1==a.indexOf("/"))?decodeURIComponent(a):!1},targetRelative:function(a){a+="/";return this._target.substring(0,
a.length)==a?this._target.substring(a.length-1):!1},plain:function(){var a={};a[this._patchType]=this._subject;"remove"!=this._patchType&&("move"==this._patchType?a.to=this._target:a.value=this._value);return a},matches:function(a){return this._subject==a||"move"==this._patchType&&this._target==a?!0:!1},hasPrefix:function(a){"object"==typeof a&&(a=a.pointerPath());if(this.matches(a))return!0;a+="/";return this._subject.substring(0,a.length)==a||"move"==this._patchType&&this._target.substring(0,a.length)==
a?!0:!1}};var aa=[];n.registerChangeListener=function(a){aa.push(a)};var Q=!1,R=[];n.batch=function(a){if(void 0!=a)return n.batch(),a(),n.batchDone(),this;Q=!0;return this};n.batchDone=function(){for(Q=!1;0<R.length;){var a=R.shift(),b=a.batchPatch;delete a.batchPatch;a.patch(b)}return this};B.prototype={resolveUrl:function(a){return w.resolve(this.url,a)},getFragment:function(a,b){this.getRoot(function(c){""!=a&&(c=c.subPath(a));b.call(this,c)})},get:function(a){return this.root.get(a)},set:function(a,
b){this.root.set(a,b);return this},move:function(a,b){var c=new k;c.move(a,b);this.patch(c);return this}};var M=/^(0|[1-9]\d*)$/,ja=0;t.prototype={referenceUrl:function(){if(this.document.isDefinitive){var a=this.pointerPath();if(""==a||"/"==a.charAt(0))return this.document.url+"#"+encodeURI(this.pointerPath())}},subPath:function(a){a=a.split("/");if(""!=a[0])throw Error("Path must begin with / (or be empty)");for(var b=this,c=1;c<a.length;c++)a[c]=m.decodePointerComponent(a[c]),b="array"==b.basicType()?
b.index(a[c]):b.property(a[c]);return b},defined:function(){return void 0!=this.basicType()},setValue:function(a){if("undefined"==typeof a)return this.remove();if("object"!=this.basicType()&&"array"!=this.basicType()&&this.value()===a)return this;var b=new k;this.defined()?b.replace(this.pointerPath(),a):b.add(this.pointerPath(),a);this.document.patch(b,this);return this},remove:function(){var a=new k;a.remove(this.pointerPath());this.document.patch(a,this);return this},itemValue:function(a){return this.index(a).value()},
removeItem:function(a){this.index(a).remove();return this},insertItem:function(a,b){if("array"!=this.basicType())throw Error("cannot insert into a non-array");var c=new k;c.add(this.item(a).pointerPath(),b);this.document.patch(c,this);return this},push:function(a){if("array"==this.basicType())this.index(this.length()).setValue(a);else throw Error("Can only push() on an array");return this},propertyValue:function(a){return this.property(a).value()},removeProperty:function(a){this.property(a).remove();
return this},moveTo:function(a){if("object"==typeof a){if(a.document!=this.document){var b=this.value();this.remove();a.setValue(b);return a}a=a.pointerPath()}var b=new k,c=this.pointerPath();if(a!=c)return b.move(c,a),this.document.patch(b,this),this.document.root.subPath(a)},getLink:function(a){return this.links(a)[0]},equals:function(a){var b;b=this.basicType();if(b!=a.basicType())return!1;if("array"==b){if(this.length()!==a.length())return!1;for(b=0;b<this.length();b++)if(!this.index(b).equals(a.index(b)))return!1;
return!0}if("object"==b){var c=this.keys(),e=a.keys();if(c.length!=e.length)return!1;c.sort();e.sort();for(b=0;b<c.length;b++)if(c[b]!==e[b])return!1;for(b=0;b<c.length;b++)if(e=c[b],!this.property(e).equals(a.property(e)))return!1;return!0}return this.value()===a.value()},readOnlyCopy:function(){if(this.readOnly())return this;var a=n.create(this.value(),this.document.url+"#:copy",!0);this.schemas().each(function(b,c){a.addSchema(c)});return a},editableCopy:function(){var a=n.create(this.value(),
this.document.url+"#:copy",!1),b=m.getUniqueKey();this.schemas().fixed().each(function(c,e){a.addSchema(e,b)});return a},asSchema:function(){var a=new f(this.readOnlyCopy());this.readOnly()&&r(this,{asSchema:a});return a},asLink:function(a){var b=this.readOnlyCopy(),b=new C(b);a=void 0==a?b.linkForData(this):b.linkForData(a);this.readOnly()&&r(this,{asLink:a});return a},items:function(a){for(var b=0;b<this.length();b++){var c=this.index(b);a.call(c,b,c)}return this},properties:function(a){for(var b=
this.keys(),c=0;c<b.length;c++){var e=this.property(b[c]);a.call(e,b[c],e)}return this},resolveUrl:function(a){for(var b=this;b;){var c=b.getLink("self");if(c)return w.resolve(c.href,a);b=b.parent()}return this.document.resolveUrl(a)},get:function(a){return this.subPath(a).value()},set:function(a,b){this.subPath(a).setValue(b);return this},json:function(){return JSON.stringify(this.value())}};t.prototype.indices=t.prototype.items;t.prototype.indexValue=t.prototype.itemValue;t.prototype.removeIndex=
t.prototype.removeItem;t.prototype.index=function(a){return this.item(a)};n.extendData=function(a){for(var b in a)void 0==t.prototype[b]&&(t.prototype[b]=a[b])};n.create=function(a,b,c){var e=void 0!=b;void 0!=b&&-1!=b.indexOf("#")&&(""!=b.substring(b.indexOf("#")+1)&&(e=!1),b=b.substring(0,b.indexOf("#")));b=new B(b,e,c);b.setRaw(a);b.setRoot("");return b.root};n.createSchema=function(a,b){return n.create(a,b,!0).asSchema()};n.getSchema=d;var O="null boolean integer number string array object".split(" "),
S={};f.prototype={toString:function(){return"<Schema "+this.data+">"},referenceUrl:function(){return this.data.referenceUrl()},isComplete:function(){return void 0===this.data.propertyValue("$ref")},getFull:function(a){var b=this.data.propertyValue("$ref");if(void 0===b)a(this,void 0);else{b=this.data.resolveUrl(b);if("#"==b.charAt(0)&&(1==b.length||"/"==b.charAt(1))){var c=this.data.document.root,b=decodeURIComponent(b.substring(1)),c=c.subPath(b).asSchema();a.call(c,c,null)}else d(b,a);return this}},
title:function(){var a=this.data.propertyValue("title");void 0==a&&(a=null);return a},hasDefault:function(){return this.data.property("default").defined()},defaultValue:function(){return this.data.propertyValue("default")},propertySchemas:function(a){var b=[],c=this.data.property("properties").property(a);c.defined()&&b.push(c.asSchema());this.data.property("patternProperties").properties(function(c,j){RegExp(c).test(a)&&b.push(j.asSchema())});0==b.length&&(c=this.data.property("additionalProperties"),
c.defined()&&b.push(c.asSchema()));return new v(b)},propertyDependencies:function(a){var b=this.data.property("dependencies");return b.defined()&&(a=b.property(a),a.defined())?"string"==a.basicType()?[a.value()]:"array"==a.basicType()?a.value():[a.asSchema()]:[]},indexSchemas:function(a){var b=this.data.property("items");if(!b.defined())return new v;"array"==b.basicType()?(a=b.index(a),a.defined()||(a=this.data.property("additionalItems"))):a=b;return a.defined()?(a=a.asSchema(),new v([a])):new v},
andSchemas:function(){var a=[],b=this.data.property("extends");b.defined()&&("array"==b.basicType()?b.indices(function(b,e){a.push(e.asSchema())}):a.push(b.asSchema()));this.data.property("allOf").items(function(b,e){a.push(e.asSchema())});return new v(a)},notSchemas:function(){var a=[],b=this.data.property("disallow");b.defined()&&("array"==b.basicType()?b.indices(function(b,e){"string"==e.basicType()?a.push(n.createSchema({type:e.value()})):a.push(e.asSchema())}):"string"==b.basicType()?a.push(n.createSchema({type:b.value()})):
a.push(b.asSchema()));this.data.property("not").defined()&&a.push(this.data.property("not").asSchema());return a},types:function(){var a=this.data.property("type");if(a.defined()){if("string"===a.basicType())return"all"==a.value()?O.slice(0):[a.value()];for(var b=[],c=0;c<a.length();c++)if("string"==a.item(c).basicType()){if("all"==a.item(c).value())return O.slice(0);b.push(a.item(c).value())}else return O.slice(0);-1!=b.indexOf("number")&&-1==b.indexOf("integer")&&b.push("integer");return b}return O.slice(0)},
xorSchemas:function(){var a=[],b=this.data.property("type");if(b.defined())for(var c=0;c<b.length();c++)if("string"!=b.item(c).basicType()){var e=[];b.items(function(a,b){"string"==b.basicType()?e.push(h(b.value())):e.push(b.asSchema())});a.push(e);break}this.data.property("oneOf").defined()&&(e=[],this.data.property("oneOf").items(function(a,b){e.push(b.asSchema())}),a.push(e));return a},orSchemas:function(){var a=[];this.data.property("type");if(this.data.property("anyOf").defined()){var b=[];this.data.property("anyOf").items(function(a,
e){b.push(e.asSchema())});a.push(b)}return a},equals:function(a){return this===a?!0:void 0!==this.referenceUrl()&&void 0!==a.referenceUrl()?this.referenceUrl()===a.referenceUrl():this.data.equals(a.data)},enumValues:function(){return this.data.propertyValue("enum")},enumData:function(){return this.data.property("enum")},minItems:function(){var a=this.data.propertyValue("minItems");return void 0==a?0:a},maxItems:function(){return this.data.propertyValue("maxItems")},tupleTypingLength:function(){return"array"!=
this.data.property("items").basicType()?0:this.data.property("items").length()},minLength:function(){var a=this.data.propertyValue("minLength");return void 0==a?0:a},maxLength:function(){return this.data.propertyValue("maxLength")},numberInterval:function(){return this.data.propertyValue("divisibleBy")},minimum:function(){return this.data.propertyValue("minimum")},exclusiveMinimum:function(){return!!this.data.propertyValue("exclusiveMinimum")},maximum:function(){return this.data.propertyValue("maximum")},
exclusiveMaximum:function(){return!!this.data.propertyValue("exclusiveMaximum")},minProperties:function(){var a=this.data.propertyValue("minProperties");return void 0==a?0:a},maxProperties:function(){return this.data.propertyValue("maxProperties")},definedProperties:function(){var a={};this.data.property("properties").properties(function(b){a[b]=!0});return Object.keys(a)},knownProperties:function(){var a={};this.data.property("properties").properties(function(b){a[b]=!0});for(var b=this.requiredProperties(),
c=0;c<b.length;c++)a[b[c]]=!0;return Object.keys(a)},requiredProperties:function(){var a=this.data.propertyValue("required");"object"!=typeof a&&(a=[]);var b=this.data.property("properties");void 0!=b&&b.properties(function(b,e){var j=e.property("required");void 0!=j&&("boolean"==j.basicType()&&j.value())&&a.push(b)});return a},allowedAdditionalProperties:function(){return!1!==this.data.propertyValue("additionalProperties")},getLink:function(a){for(var b=this.links(),c=0;c<b.length;c++)if(b[c].rel()==
a)return b[c]},asList:function(){return new v([this])},format:function(){return this.data.propertyValue("format")}};f.prototype.basicTypes=f.prototype.types;f.prototype.extendSchemas=f.prototype.andSchemas;n.extendSchema=function(a){for(var b in a)void 0==f.prototype[b]&&(f.prototype[b]=a[b])};var T={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};C.prototype={addHandler:function(a){this.handlers.unshift(a);return this},addPreHandler:function(a){this.preHandlers.push(a);return this},canApplyTo:function(a){var b,
c,e=null;for(b=0;b<this.dataParts.length;b++){c=this.dataParts[b];null===c?e=a:"object"==a.basicType()?e=a.property(c):"array"==a.basicType()&&M.test(c)&&(e=a.index(c));if(void 0==e)return!1;c=e.basicType();if("string"!=c&&"number"!=c&&"integer"!=c)return!1}return!0},linkForData:function(a){var b=this.data.value(),c=this.uriTemplate.fill(function(b){b=I(b);return null==b?a.value():"array"==a.basicType()?a.itemValue(b):a.propertyValue(b)});b.href=a.resolveUrl(c);return new s(b,this,a)},usesKey:function(a){var b;
for(b=0;b<this.dataParts.length;b++)if(this.dataParts[b]===a)return!0;return!1},rel:function(){return this.data.propertyValue("rel")}};var ea=[],fa=[];n.addLinkHandler=function(a){ea.unshift(a)};n.addLinkPreHandler=function(a){fa.push(a)};var ga=m.getUniqueKey();s.prototype={toString:function(){return this.href},createSubmissionData:function(a){var b=this.hrefBase,c=this.submissionSchemas;if(void 0!=a&&0==c.length&&"PUT"==this.method)return Jsonary.getData(this.href,function(b){a(b.editableCopy())}),
this;if(void 0!=a)c.createValue(function(e){e=n.create(e,b);for(var j=0;j<c.length;j++)e.addSchema(c[j],ga);a(e)});else{for(var e=c.createValue(),e=n.create(e,b),j=0;j<c.length;j++)e.addSchema(c[j],ga);return e}},follow:function(a,b){"function"==typeof a&&(b=a,a=void 0);void 0!==a?a instanceof t||(a=n.create(a)):a=n.create(void 0);for(var c=fa.concat(this.definition.preHandlers),e=0;e<c.length;e++){var j=c[e];if(!1===j.call(this,this,a))return m.log(m.logLevel.DEBUG,"Link cancelled: "+this.href),
null}e=a.value();c=n.getData({url:this.href,method:this.method,data:e,encType:this.encType},null,this.targetSchema);a=a.readOnlyCopy();var d=this.definition.handlers.concat(ea);void 0!==b&&d.unshift(b);for(e=0;e<d.length&&!(j=d[e],!1===j.call(this,this,a,c));e++);return c}};l.prototype={setupXorSelectors:function(){var a=this;this.xorSelectors={};for(var b=this.schema.xorSchemas(),c=0;c<b.length;c++){var e=new U(m.getKeyVariant(this.monitorKey,"xor"+c),b[c],this.data);this.xorSelectors[c]=e;e.onMatchChange(function(){a.update()},
!1)}},setupOrSelectors:function(){var a=this;this.orSelectors={};for(var b=this.schema.orSchemas(),c=0;c<b.length;c++){var e=new V(m.getKeyVariant(this.monitorKey,"or"+c),b[c],this.data);this.orSelectors[c]=e;e.onMatchChange(function(){a.update()},!1)}},setupAndMatches:function(){var a=this;this.andMatches=[];this.schema.andSchemas().each(function(b,c){var e=m.getKeyVariant(a.monitorKey,"and"+b),e=a.data.addSchemaMatchMonitor(e,c,function(){a.update()},!1);a.andMatches.push(e)})},setupNotMatches:function(){var a=
this;this.notMatches=[];for(var b=this.schema.notSchemas(),c=0;c<b.length;c++)(function(b,c){var d=m.getKeyVariant(a.monitorKey,"not"+b),d=a.data.addSchemaMatchMonitor(d,c,function(){a.update()},!1);a.notMatches.push(d)})(c,b[c])},addMonitor:function(a,b){this.monitors.add(this.monitorKey,a);!1!==b&&a.call(this.schema,this.match,this.matchFailReason);return this},dataUpdated:function(a){if(this.schemaLoaded){var b=this;if("object"==this.data.basicType()){this.indexMatches={};this.data.properties(function(a,
c){if(void 0==b.propertyMatches[a]){var e=[],d=b.schema.propertySchemas(a);d.each(function(f){var h=c.addSchemaMatchMonitor(b.monitorKey,d[f],function(){b.subMatchUpdated(a,h)},!1);e.push(h)});b.propertyMatches[a]=e;b.addDependencies(a)}});var c=[];for(a in this.propertyMatches)this.data.property(a).defined()||c.push(a);for(var e=0;e<c.length;e++)a=c[e],delete this.propertyMatches[a],void 0!=this.dependencyKeys[a]&&(this.data.removeSchema(this.dependencyKeys[a]),delete this.dependencies[a],delete this.dependencyKeys[a])}else if("array"==
this.data.basicType()){this.propertyMatches={};this.data.indices(function(c,e){if(void 0==b.indexMatches[c]){var d=[],f=b.schema.indexSchemas(c);f.each(function(c){var j=e.addSchemaMatchMonitor(b.monitorKey,f[c],function(){b.subMatchUpdated(a,j)},!1);d.push(j)});b.indexMatches[c]=d}});c=[];for(a in this.indexMatches)this.data.length()<=a&&c.push(a);for(e=0;e<c.length;e++)delete this.indexMatches[c[e]]}else this.propertyMatches={},this.indexMatches={};this.update()}},addDependencies:function(a){var b=
this,c=this.schema.propertyDependencies(a);this.dependencies[a]=[];this.dependencyKeys[a]=[];for(var e=0;e<c.length;e++){var j=c[e];"string"==typeof j?this.dependencies[a].push(j):function(c){var e=m.getKeyVariant(b.monitorKey,"dep:"+a+":"+c);b.dependencyKeys[a].push(e);e=b.data.addSchemaMatchMonitor(e,j,function(){b.dependencyUpdated(a,c)},!1);b.dependencies[a].push(e)}(e)}},notify:function(){this.monitors.notify(this.match,this.matchFailReason)},setMatch:function(a,b){if(!a||!this.match)if(a||this.match||
!this.matchFailReason.equals(b))this.matchFailReason=(this.match=a)?null:b,this.notify()},subMatchUpdated:function(){this.update()},subMatchRemoved:function(){this.update()},dependencyUpdated:function(){this.update()},update:function(){try{this.matchAgainstBasicTypes(),this.matchAgainstSubMatches(),this.matchAgainstImmediateConstraints(),this.setMatch(!0)}catch(a){if(a instanceof p)this.setMatch(!1,a);else throw a;}},matchAgainstBasicTypes:function(){for(var a=this.data.basicType(),b=0;b<this.basicTypes.length;b++)if(this.basicTypes[b]==
a||"integer"==a&&"number"==this.basicTypes[b])return;throw new p("Data does not match any of the basic types: "+this.basicTypes,this.schema);},matchAgainstSubMatches:function(){for(var a=0;a<this.andMatches.length;a++){var b=this.andMatches[a];if(!b.match){var c="extended schema #"+a+": "+b.message;throw new p(c,this.schema,b.failReason);}}for(a=0;a<this.notMatches.length;a++)if(this.notMatches[a].match)throw c='"not" schema #'+a+" matches",new p(c,this.schema);for(c in this.xorSelectors)if(a=this.xorSelectors[c],
null==a.selectedOption)throw c="XOR #"+c+": "+a.failReason.message,new p(c,this.schema,a.failReason);for(c in this.orSelectors)if(a=this.orSelectors[c],0==a.selectedOptions.length)throw c="OR #"+c+": no matches",new p(c,this.schema);for(c in this.propertyMatches)for(var e=this.propertyMatches[c],a=0;a<e.length;a++)if(b=e[a],!b.match)throw c=c+": "+b.matchFailReason.message,new p(c,this.schema,b.matchFailReason);for(c in this.indexMatches){e=this.indexMatches[c];for(a=0;a<e.length;a++)if(b=e[a],!b.match)throw c=
c+": "+b.matchFailReason.message,new p(c,this.schema,b.matchFailReason);}},matchAgainstImmediateConstraints:function(){this.matchAgainstEnums();this.matchAgainstNumberConstraints();this.matchAgainstArrayConstraints();this.matchAgainstObjectConstraints()},matchAgainstEnums:function(){var a=this.schema.enumData();if(a.defined()){for(var b=0;b<a.length();b++)if(a.index(b).equals(this.data))return;throw new p("Data does not match enum: "+JSON.stringify(a.value())+" ("+JSON.stringify(this.data.value())+
")",this.schema);}},matchAgainstNumberConstraints:function(){if(!("number"!=this.data.basicType()&&"integer"!=this.data.basicType())){var a=this.data.value(),b=this.schema.numberInterval();if(void 0!=b&&0!=a%b)throw new p("Number must be divisible by "+b);b=this.schema.minimum();if(void 0!==b)if(this.schema.exclusiveMinimum()){if(a<=b)throw new p("Number must be > "+b);}else if(a<b)throw new p("Number must be >= "+b);b=this.schema.maximum();if(void 0!=b)if(this.schema.exclusiveMaximum()){if(a>=b)throw new p("Number must be < "+
b);}else if(a>b)throw new p("Number must be <= "+b);}},matchAgainstArrayConstraints:function(){if("array"==this.data.basicType()){var a=this.schema.minItems();if(void 0!==a&&a>this.data.length())throw new p("Data is not long enough - minimum length is "+a,this.schema);a=this.schema.maxItems();if(void 0!==a&&a<this.data.length())throw new p("Data is too long - maximum length is "+a,this.schema);}},matchAgainstObjectConstraints:function(){if("object"==this.data.basicType()){for(var a=this.schema.requiredProperties(),
b=0;b<a.length;b++){var c=a[b];if(!this.data.property(c).defined())throw new p("Missing key "+JSON.stringify(c),this.schema);}this.matchAgainstDependencies()}},matchAgainstDependencies:function(){for(var a in this.dependencies)if(void 0!=this.data.property(a))for(var b=this.dependencies[a],c=0;c<b.length;c++){var e=b[c];if("string"==typeof e){if(!this.data.property(e).defined())throw new p("Dependency - property "+JSON.stringify(a)+" requires property "+JSON.stringify(e),this.schema);}else if(!e.match)throw new p("Dependency for "+
a,this.schema,e.matchFailReason);}}};p.prototype=Error();p.prototype.toString=function(){return this.message+" in "+this.schema.title()};p.prototype.equals=function(a){if(!(a instanceof p))return!1;if(null==this.subMatchFailReason){if(null!=a.subMatchFailReason)return!1}else if(null==a.subMatchFailReason||!this.subMatchFailReason.equals(a.subMatchFailReason))return!1;return this.message==a.message&&(null==this.schema&&null==a.schema||null!=this.schema&&null!=a.schema&&this.schema.equals(a.schema))};
U.prototype={onMatchChange:function(a,b){this.matchCallback=a;!1!==b&&a.call(this,this.selectedOption);return this},update:function(){for(var a=null,b="No matches",c=0;c<this.subMatches.length;c++)if(this.subMatches[c].match)if(null==a)a=this.options[c],b=null;else{b="multiple matches";a=null;break}this.failReason=new p(b);this.selectedOption!=a&&(this.selectedOption=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOption))}};V.prototype={onMatchChange:function(a,b){this.matchCallback=
a;!1!==b&&a.call(this,this.selectedOptions);return this},update:function(){for(var a=[],b=0;b<this.subMatches.length;b++)this.subMatches[b].match&&a.push(this.options[b]);var c=!1;if(a.length!=this.selectedOptions.length)c=!0;else for(b=0;b<a.length;b++)if(a[b]!=this.selectedOptions[b]){c=!0;break}c&&(this.selectedOptions=a,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOptions))}};var Y=[];n.registerSchemaChangeListener=function(a){Y.push(a)};W.prototype={rel:function(a){if(void 0==
a)return this;var b=[],c;for(c=0;c<this.length;c++)this[c].rel===a&&(b[b.length]=this[c]);return new W(b)}};var na={"null":!0,"boolean":!0,integer:!0,number:!0,string:!0,array:!0,object:!0};v.prototype={indexOf:function(a){for(var b=this.length-1;0<=b&&!a.equals(this[b]);)b--;return b},containsUrl:function(a){if(a instanceof RegExp)for(var b=0;b<this.length;b++){var c=this[b];if(a.test(c.referenceUrl()))return!0}else{0>a.indexOf("#")&&(a+="#");for(b=0;b<this.length;b++)if(c=this[b],c=c.referenceUrl(),
null!=c&&c.substring(c.length-a.length)==a)return!0}return!1},links:function(){var a=[],b,c;for(b=0;b<this.length;b++)c=this[b],a=a.concat(c.links());return a},each:function(a){for(var b=0;b<this.length;b++)a.call(this,b,this[b]);return this},concat:function(a){for(var b=[],c=0;c<this.length;c++)b.push(this[c]);for(c=0;c<a.length;c++)b.push(a[c]);return new v(b)},definedProperties:function(){var a=!0,b={};this.each(function(c,j){if(a){j.allowedAdditionalProperties()||(a=!1,b={});for(var d=j.definedProperties(),
f=0;f<d.length;f++)b[d[f]]=!0}else if(!j.allowedAdditionalProperties()){a=!1;for(var h={},d=j.definedProperties(),f=0;f<d.length;f++)b[d[f]]&&(h[d[f]]=!0);b=h}});var c=Object.keys(b);r(this,{definedProperties:c,allowedAdditionalProperties:a});return c},knownProperties:function(){if(this.allowedAdditionalProperties()){for(var a=this.definedProperties().slice(0),b=this.requiredProperties(),c=0;c<b.length;c++)-1==a.indexOf(b[c])&&a.push(b[c]);return a}return this.definedProperties()},allowedAdditionalProperties:function(){var a=
!0;this.each(function(b,c){a=a&&c.allowedAdditionalProperties()});r(this,{additionalProperties:a});return a},minProperties:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minProperties();c>a&&(a=c)}return a},maxProperties:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxProperties();c>a||(a=c)}return a},types:function(){for(var a=na,b=0;b<this.length;b++){for(var c=this[b].basicTypes(),e={},j=0;j<c.length;j++){var d=c[j];a[d]&&(e[d]=!0)}a=e}return Object.keys(a)},numberInterval:function(){for(var a=
void 0,b=0;b<this.length;b++){var c=this[b].numberInterval();void 0!=c&&(a=void 0==a?c:m.lcm(a,c))}for(b=0;b<this.length;b++){for(var c=this[b].basicTypes(),e=!1,j=0;j<c.length;j++)if("number"==c[j]){e=!1;break}else"integer"==c[j]&&(e=!0);if(e)return void 0==a?1:m.lcm(a,1)}r(this,{numberInterval:a});return a},minimum:function(){for(var a=void 0,b=!1,c=0;c<this.length;c++){var e=this[c].minimum();if(void 0!=e&&(void 0==a||a<e))a=e,b=this[c].exclusiveMinimum()}r(this,{minimum:a,exclusiveMinimum:b});
return a},exclusiveMinimum:function(){this.minimum();return this.exclusiveMinimum()},maximum:function(){for(var a=void 0,b=!1,c=0;c<this.length;c++){var e=this[c].maximum();if(void 0!=e&&(void 0==a||a>e))a=e,b=this[c].exclusiveMaximum()}r(this,{maximum:a,exclusiveMaximum:b});return a},exclusiveMaximum:function(){this.minimum();return this.exclusiveMinimum()},minLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minLength();c>a&&(a=c)}r(this,{minLength:a});return a},maxLength:function(){for(var a=
void 0,b=0;b<this.length;b++){var c=this[b].maxLength();c>a||(a=c)}r(this,{maxLength:a});return a},minItems:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].minItems();c>a&&(a=c)}r(this,{minItems:a});return a},maxItems:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].maxItems();c>a||(a=c)}r(this,{maxItems:a});return a},tupleTypingLength:function(){for(var a=0,b=0;b<this.length;b++){var c=this[b].tupleTypingLength();c>a&&(a=c)}return a},requiredProperties:function(){for(var a=
{},b=[],c=0;c<this.length;c++)for(var e=this[c].requiredProperties(),j=0;j<e.length;j++){var d=e[j];a[d]||(a[d]=!0,b.push(d))}return b},enumValues:function(){for(var a=void 0,b=0;b<this.length;b++){var c=this[b].enumData();if(c.defined())if(void 0==a)a=[],c.indices(function(b,c){a[b]=c});else{var e=[];c.indices(function(b,c){for(var d=0;d<a.length;d++)a[d].equals(c)&&e.push(c)});a=e}}if(void 0!=a){c=[];for(b=0;b<a.length;b++)c[b]=a[b].value();return c}},allCombinations:function(){for(var a=this.xorSchemas(),
b=0;b<a.length;b++){for(var c=!1,e=0;e<a[b].length;e++){var d=a[b][e];if(0<=this.indexOf(d)){c=!0;break}}if(!c){for(var g=[],e=0;e<a[b].length;e++)d=a[b][e],c=this.concat([d]).allCombinations(),g=g.concat(c);return g}}a=this.orSchemas();g=[[]];for(b=0;b<a.length;b++){for(var f=[],c=!1,e=0;e<a[b].length;e++)d=a[b][e],-1==this.indexOf(d)?f.push(d):c=!0;if(0<f.length){e=[[]];for(d=0;d<f.length;d++){for(var h=[],l=0;l<e.length;l++)h.push(e[l]),h.push(e[l].concat([f[d]]));e=h}c||e.shift();c=[];for(f=0;f<
g.length;f++)for(d=0;d<e.length;d++)c.push(g[f].concat(e[d]));g=c}}for(b=0;b<g.length;b++)g[b]=this.concat(g[b]);return g},createValue:function(a,b){if(null!=a)this.getFull(function(b){a.call(this,b.createValue())});else if(b){for(var c=[],e=0;e<this.length;e++)this[e].hasDefault()&&c.push(this[e].defaultValue());var d=this.basicTypes(),g=this.enumValues();if(void 0!=g)for(e=0;e<g.length;e++)c.push(g[e]);else for(e=0;e<d.length;e++)g=d[e],"null"==g?c.push(null):"boolean"==g?c.push(!0):"integer"==
g||"number"==g?(g=this.createValueNumber(),void 0!==g&&c.push(g)):"string"==g?(g=this.createValueString(),void 0!==g&&c.push(g)):"array"==g?(g=this.createValueArray(),void 0!==g&&c.push(g)):"object"==g&&(g=this.createValueObject(),void 0!==g&&c.push(g));for(e=0;e<c.length;e++){var g=c[e],f=m.guessBasicType(g);if(!(-1==d.indexOf(f)&&("integer"!=f||-1==d.indexOf("number"))))return g}}else for(var c=this.allCombinations(),e=0;e<c.length;e++)if(d=c[e].createValue(null,!0),void 0!==d)return d},createValueNumber:function(){var a=
this.exclusiveMinimum(),b=this.minimum(),c=this.maximum(),e=this.exclusiveMaximum(),d=this.numberInterval(),g=void 0;if(void 0!=b&&void 0!=c){if(b>c||b==c&&(a||e))return;if(void 0!=d){if(g=Math.ceil(b/d)*d,a&&g==b&&(g+=d),g>c||g==c&&e)return}else g=0.5*(b+c)}else void 0!=b?(g=b,void 0!=d&&(g=Math.ceil(g/d)*d),a&&g==b&&(void 0!=d?g+=d:g++)):void 0!=c?(g=c,void 0!=d&&(g=Math.floor(g/d)*d),e&&g==c&&(void 0!=d?g-=d:g--)):g=0;return g},createValueString:function(){return""},createValueArray:function(){var a=
[],b=this.minItems();if(void 0!=b)for(;a.length<b;)a.push(this.createValueForIndex(a.length));return a},createValueObject:function(){for(var a={},b=this.requiredProperties(),c=0;c<b.length;c++){var e=b[c];a[e]=this.createValueForProperty(e)}return a},createValueForIndex:function(a,b){return this.indexSchemas(a).createValue(b)},indexSchemas:function(a){for(var b=new v,c=0;c<this.length;c++)b=b.concat(this[c].indexSchemas(a));return b},createValueForProperty:function(a,b){return this.propertySchemas(a).createValue(b)},
propertySchemas:function(a){for(var b=new v,c=0;c<this.length;c++)b=b.concat(this[c].propertySchemas(a));return b},propertyDependencies:function(a){for(var b=[],c={},e=0;e<this.length;e++)for(var d=this[e].propertyDependencies(a),g=0;g<d.length;g++)"string"==typeof d[g]?c[d[g]]||(c[d[g]]=!0,b.push(d[g])):b.push(d[g]);return b},getFull:function(a){function b(g){c+=g.length;for(var f=0;f<g.length;f++)g[f].getFull(function(g){for(var f=0;f<e.length;f++)if(g.equals(e[f])){c--;0==c&&(g=new v(e,d),a.call(g,
g));return}e.push(g);g=g.extendSchemas();b(g);c--;0==c&&(g=new v(e,d),a.call(g,g))})}if(0==this.length)return a.call(this,this),this;var c=0,e=[],d=this.fixed();b(this);return this},formats:function(){for(var a=[],b=0;b<this.length;b++){var c=this[0].format();null!=c&&a.push(c)}return a},xorSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].xorSchemas());return a},orSchemas:function(){for(var a=[],b=0;b<this.length;b++)a=a.concat(this[b].orSchemas());return a}};v.prototype.basicTypes=
v.prototype.types;v.prototype.potentialLinks=v.prototype.links;n.extendSchemaList=function(a){for(var b in a)void 0==v.prototype[b]&&(v.prototype[b]=a[b])};n.createSchemaList=function(a){Array.isArray(a)||(a=[a]);return new v(a)};m.getUniqueKey();ba.prototype={update:function(a){this.updateLinksWithKey(a);this.updateDependenciesWithKey(a);this.updateMatchesWithKey(a)},updateLinksWithKey:function(a){var b,c,e,d,g=[];for(b in this.links){e=this.links[b];for(c=0;c<e.length;c++)d=e[c],(d.usesKey(a)||
null==a)&&g.push(d)}if(0<g.length){a=null;for(c=0;c<g.length;c++)if(d=g[c],d.update(),d.active&&"self"==d.rawLink.rawLink.rel){a=d;break}if(null!=a)for(b in this.cachedLinkList=null,this.links){e=this.links[b];for(c=0;c<e.length;c++)d=e[c],d!=a&&d.update()}this.invalidateSchemaState()}},updateMatchesWithKey:function(a){var b=[];for(schemaKey in this.matches)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++)for(var e=this.matches[b[c]],d=0;d<e.length;d++)e[d].dataUpdated(a)},updateDependenciesWithKey:function(a){var b=
[];for(schemaKey in this.dependencySelectors)b.push(schemaKey);b.sort();b.reverse();for(var c=0;c<b.length;c++)for(var e=this.dependencySelectors[b[c]],d=0;d<e.length;d++)e[d].dataUpdated(a)},alreadyContainsSchema:function(a,b){for(var c=0;c<b.length;c++){var e=b[c];if(void 0!=this.schemas[e])for(var d=0;d<this.schemas[e].length;d++)if(a.equals(this.schemas[e][d]))return!0}return!1},addSchema:function(a,b,c,e){var d=this;void 0==b&&(b=m.getUniqueKey());void 0==e&&(e=!0);void 0==c?c=[b]:c[c.length]=
b;void 0==this.schemas[b]&&(this.schemas[b]=[]);this.schemaFlux++;"string"==typeof a&&(a=n.createSchema({$ref:a}));a.getFull(function(a){if(d.alreadyContainsSchema(a,c))d.schemaFlux--,d.checkForSchemasStable();else{d.schemas[b].push(a);d.schemasFixed[b]=d.schemasFixed[b]||e;d.dataObj.properties(function(e,d){for(var j=m.getKeyVariant(b,"prop"),f=a.propertySchemas(e),h=0;h<f.length;h++)d.addSchema(f[h],j,c)});d.dataObj.indices(function(e,d){m.getKeyVariant(b,"idx");var j=a.indexSchemas(e);for(e=0;e<
j.length;e++)d.addSchema(j[e],b,c)});for(var f=a.extendSchemas(),h=0;h<f.length;h++)d.addSchema(f[h],b,c,e);d.addLinks(a.links(),b,c);d.addXorSelectors(a,b,c);d.addOrSelectors(a,b,c);d.addDependencySelector(a,b,c);d.schemaFlux--;d.invalidateSchemaState()}})},addLinks:function(a,b,c){var e,d;void 0==this.links[b]&&(this.links[b]=[]);var g=null;for(e=0;e<a.length;e++)d=new ca(this.dataObj,a[e]),this.links[b].push(d),this.addMonitorForLink(d,b,c),d.update(),d.active&&"self"==d.rawLink.rawLink.rel&&(g=
d);if(null!=g)for(b in this.cachedLinkList=null,this.links){linkList=this.links[b];for(e=0;e<linkList.length;e++)d=linkList[e],d!=g&&d.update()}this.invalidateSchemaState()},addXorSelectors:function(a,b,c){a=a.xorSchemas();for(var e=[],d=0;d<a.length;d++){var g=new ka(a[d],m.getKeyVariant(b,"xor"+d),c,this);e.push(g)}this.xorSelectors[b]=void 0==this.xorSelectors[b]?e:this.xorSelectors[b].concat(e)},addOrSelectors:function(a,b,c){a=a.orSchemas();for(var e=[],d=0;d<a.length;d++){var g=new la(a[d],
m.getKeyVariant(b,"or"+d),c,this);e.push(g)}this.orSelectors[b]=void 0==this.orSelectors[b]?e:this.orSelectors[b].concat(e)},addDependencySelector:function(a,b,c){a=[new da(a,m.getKeyVariant(b,"dep"),c,this)];this.dependencySelectors[b]=void 0==this.dependencySelectors[b]?a:this.dependencySelectors[b].concat(a)},addLink:function(a){var b=m.getUniqueKey();a=n.create(a);a=new C(a);this.addLinks([a],b)},addMonitorForLink:function(a,b,c){var d=this;if("describedby"===a.rel()){var j=m.getKeyVariant(b);
a.addMonitor(j,function(b){d.removeSchema(j);b&&(b=n.createSchema({$ref:a.rawLink.href}),d.addSchema(b,j,c,!1))})}},addSchemaMatchMonitor:function(a,b,c,d){b=new l(a,this.dataObj,b);void 0==this.matches[a]&&(this.matches[a]=[]);this.matches[a].push(b);b.addMonitor(c,d);return b},removeSchema:function(a){this.dataObj.indices(function(b,c){c.removeSchema(a)});this.dataObj.properties(function(b,c){c.removeSchema(a)});var b,c,d=[];for(b in this.schemas)m.keyIsVariant(b,a)&&d.push(b);for(b in this.links)m.keyIsVariant(b,
a)&&d.push(b);for(b in this.matches)m.keyIsVariant(b,a)&&d.push(b);for(c=0;c<d.length;c++)b=d[c],delete this.schemas[b],delete this.links[b],delete this.matches[b];0<d.length&&this.invalidateSchemaState()},clear:function(){this.schemas={};this.links={};this.matches={};this.invalidateSchemaState()},getSchemas:function(){if(null!==this.cachedSchemaList)return this.cachedSchemaList;var a=[],b={},c,d,j,g,f,h;for(j in this.schemas){g=this.schemas[j];var l=this.schemasFixed[j];for(c=0;c<g.length;c++){f=
g[c];l&&(b[f.data.uniqueId]=f);h=!1;for(d=0;d<a.length;d++)if(f.equals(a[d])){h=!0;break}h||a.push(f)}}c=[];for(j in b)c.push(b[j]);return this.cachedSchemaList=new v(a,c)},getLinks:function(a){var b,c,d,f;if(null!==this.cachedLinkList)return this.cachedLinkList.rel(a);var g=[];for(b in this.links){f=this.links[b];for(c=0;c<f.length;c++)d=f[c],d.active&&g.push(d.rawLink)}this.cachedLinkList=new W(g);return this.cachedLinkList.rel(a)},invalidateSchemaState:function(){this.cachedLinkList=this.cachedSchemaList=
null;this.schemasStable=!1;this.checkForSchemasStable()},checkForSchemasStable:function(){if(0<this.schemaFlux)return!1;var a,b,c,d;for(b in this.schemas){c=this.schemas[b];for(a=0;a<c.length;a++)if(d=c[a],!d.isComplete())return this.schemasStable=!1}var f=this;this.pendingNotify||(this.pendingNotify=!0,J.add(function(){f.pendingNotify=!1;if(!f.schemasStable){f.schemasStable=!0;for(var a=f.dataObj,b=f.getSchemas(),c=0;c<Y.length;c++)Y[c].call(a,a,b)}f.schemasStableListeners.notify(f.dataObj,f.getSchemas())}));
return!0},addSchemasForProperty:function(a,b){for(var c in this.schemas)for(var d=m.getKeyVariant(c,"prop"),f=0;f<this.schemas[c].length;f++)for(var g=this.schemas[c][f].propertySchemas(a),h=0;h<g.length;h++)b.addSchema(g[h],d)},addSchemasForIndex:function(a,b){for(var c in this.schemas)for(var d=m.getKeyVariant(c,"idx"),f=0;f<this.schemas[c].length;f++)for(var g=this.schemas[c][f].indexSchemas(a),h=0;h<g.length;h++)b.addSchema(g[h],d)},removeSubSchemas:function(a){for(var b in this.schemas)a.removeSchema(b)},
whenSchemasStable:function(a){this.schemasStableListeners.add(a);this.checkForSchemasStable()}};ca.prototype={update:function(){var a=this.potentialLink.canApplyTo(this.dataObj);this.rawLink=a?this.potentialLink.linkForData(this.dataObj):null;this.active=a;this.updateMonitors.notify(this.active)},rel:function(){return this.potentialLink.rel()},usesKey:function(a){return this.potentialLink.usesKey(a)},addMonitor:function(a,b){this.updateMonitors.add(a,b)}};da.prototype={dataUpdated:function(a){if(null==
a)for(var b=this.schema.data.property("dependencies").keys(),c=0;c<b.length;c++)a=b[c],this.dataUpdated(a);else if(this.schemaSet.dataObj.property(a).defined()){b=this.schema.propertyDependencies(a);for(c=0;c<b.length;c++){var d=b[c];"string"!=typeof d&&this.schemaSet.addSchema(d,this.inferredSchemaKeys[a],this.schemaKeyHistory,!1)}}else this.schemaSet.removeSchema(this.inferredSchemaKeys[a])}};y=n.create({intelligentLinks:!0,intelligentPut:!0});n.config=y;n.UriTemplate=A})(this);
(function(y){function w(d){d=JSON.stringify(d);return"{}"==d?null:d}function z(d){return""==d||null==d?{}:JSON.parse(d)}function G(d){var h=this;this.elementLookup={};void 0==d&&(d=F+"."+D++ +".");var f=0;this.getElementId=function(){return d+f++};this.enhancementContexts={};this.enhancementActions={};this.enhancementInputs={};Jsonary.registerChangeListener(function(d,f){d.each(function(d,l){for(var p=f.affectedData(l),k=0;k<p.length;k++)h.update(p[k],l)})});Jsonary.registerSchemaChangeListener(function(d){var f=
h.elementLookup[d.uniqueId];if(!(void 0==f||0==f.length))for(var f=f.slice(0),k=0;k<f.length;k++){var l=document.getElementById(f[k]);if(void 0!=l){var p=l.jsonaryContext,q=z(l.getAttribute("data-jsonary")),r=E(d,q,p.usedComponents);r.uniqueId==p.renderer.uniqueId?r.render(l,d,p):p.baseContext.render(l,d,p.label,q)}}});this.rootContext=this;this.subContexts={};this.oldSubContexts={}}function A(d,h,f){k.render(d,h,null,f);k.oldSubContexts={};k.subContexts={};return this}function r(d){this.renderFunction=
d.render||d.enhance;this.renderHtmlFunction=d.renderHtml;this.updateFunction=d.update;this.filterFunction=d.filter;this.actionFunction=d.action;for(var h in d)void 0==this[h]&&(this[h]=d[h]);this.uniqueId=u++;this.component=void 0!=d.component?d.component:x[x.length-1];"string"==typeof this.component&&(this.component=[this.component])}function E(d,h,f){for(var k=d.schemas(),q=0;q<x.length;q++)if(-1==f.indexOf(x[q]))for(var s=x[q],l=t.length-1;0<=l;l--){var p=t[l];if(-1!=p.component.indexOf(s)&&p.canRender(d,
k,h))return p}}var F="Jsonary",D=0,q={ADD_REMOVE:"ADD_REMOVE",TYPE_SELECTOR:"TYPE_SELECTOR",RENDERER:"DATA_RENDERER",add:function(d,h){void 0==this[d]&&(this[d]=d,-1!=x.indexOf(h)?x.splice(x.indexOf(h),0,this[d]):x.splice(x.length-1,0,this[d]))}},x=[q.ADD_REMOVE,q.TYPE_SELECTOR,q.RENDERER];G.prototype={usedComponents:[],rootContext:null,baseContext:null,subContext:function(d,h){void 0==h&&(h={});return this.getSubContext(this.elementId,this.data,d,h)},getSubContext:function(d,h,f,k){var q=h.uniqueId+
":"+f;void 0!=this.oldSubContexts[q]&&(this.subContexts[q]=this.oldSubContexts[q]);if(void 0==this.subContexts[q]){var s=[];this.data==h&&(s=this.usedComponents.slice(0),void 0!=this.renderer&&(s=s.concat(this.renderer.component)));"object"==typeof d&&(d=d.id);var l=function(d,f,h,l,k,C){this.rootContext=d;this.baseContext=f;this.label=h;this.data=l;this.uiState=k;this.usedComponents=C;this.subContexts={};this.oldSubContexts={}};l.prototype=this.rootContext;this.subContexts[q]=new l(this.rootContext,
this,f,h,k,s)}h=this.subContexts[q];h.elementId=d;return h},clearOldSubContexts:function(){this.oldSubContexts=this.subContexts;this.subContexts={}},rerender:function(){var d=document.getElementById(this.elementId);null!=d&&this.renderer.render(d,this.data,this)},render:function(d,h,f,k){void 0==f&&(f="");"string"==typeof h&&(h=Jsonary.getData(h));if(void 0!=h.getData){var q=this;h.getData(function(h){q.render(d,h,f,k)})}else{"object"!=typeof k&&(k={});if(void 0==d.id||""==d.id)d.id=this.getElementId();
var s=d.jsonaryContext,l=this.getSubContext(d.id,h,f,k),p=w(k);null!=p?d.setAttribute("data-jsonary",p):d.removeAttribute("data-jsonary");d.jsonaryContext=l;s&&(s=s.data.uniqueId,p=this.elementLookup[s].indexOf(d.id),0<=p&&this.elementLookup[s].splice(p,1));s=h.uniqueId;void 0==this.elementLookup[s]&&(this.elementLookup[s]=[]);-1==this.elementLookup[s].indexOf(d.id)&&this.elementLookup[s].push(d.id);s=E(h,k,l.usedComponents);void 0!=s?(l.renderer=s,s.render(d,h,l),l.clearOldSubContexts()):d.innerHTML=
"NO RENDERER FOUND"}},renderHtml:function(d,h,f){void 0==h&&(h="");var k=this.getElementId();"string"==typeof d&&(d=Jsonary.getData(d));if(void 0!=d.getData){var q=this,s=!1;d.getData(function(l){s?q.render(document.getElementById(k),l,h,f):(s=!0,d=l)});if(!s)return s=!0,'<span id="'+k+'">Loading...</span>'}"object"!=typeof f&&(f={});var l=this.getSubContext(k,d,h,f),p=w(f),r=E(d,f,l.usedComponents);l.renderer=r;r=r.renderHtml(d,l);l.clearOldSubContexts();var t=d.uniqueId;void 0==this.elementLookup[t]&&
(this.elementLookup[t]=[]);-1==this.elementLookup[t].indexOf(k)&&this.elementLookup[t].push(k);this.addEnhancement(k,l);return null!=p?'<span id="'+k+"\" data-jsonary='"+p.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace("'","&#39;")+"'>"+r+"</span>":'<span id="'+k+'">'+r+"</span>"},update:function(d,h){var f=this.elementLookup[d.uniqueId];if(!(void 0==f||0==f.length))for(var f=f.slice(0),k=0;k<f.length;k++){var q=document.getElementById(f[k]);if(void 0!=q){var s=q.jsonaryContext,
l=z(q.getAttribute("data-jsonary")),p=E(d,l,s.usedComponents);p.uniqueId==s.renderer.uniqueId?p.update(q,d,s,h):s.baseContext.render(q,d,s.label,l)}}},actionHtml:function(d,h){for(var f=[],k=2;k<arguments.length;k++)f.push(arguments[k]);k=this.getElementId();this.addEnhancementAction(k,h,this,f);return'<a href="javascript:void(0)" id="'+k+'" style="text-decoration: none">'+d+"</a>"},inputNameForAction:function(d){for(var h=[],f=1;f<arguments.length;f++)h.push(arguments[f]);f=this.getElementId();this.enhancementInputs[f]=
{inputName:f,actionName:d,context:this,params:h};return f},addEnhancement:function(d,h){this.enhancementContexts[d]=h},addEnhancementAction:function(d,h,f,k){null==k&&(k=[]);this.enhancementActions[d]={actionName:h,context:f,params:k}},enhanceElement:function(d){for(var h=d;d;)if(1==d.nodeType&&this.enhanceElementSingle(d),d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!=h;)d=d.parentNode;if(d==h)break;d=d.nextSibling}},enhanceElementSingle:function(d){var h=d.id,f=this.enhancementContexts[h];
void 0!=f&&(d.jsonaryContext=f,delete this.enhancementContexts[h],h=f.renderer,void 0!=h&&h.enhance(d,f.data,f));var k=this.enhancementActions[d.id];void 0!=k&&(delete this.enhancementActions[d.id],d.onclick=function(){var d=k.context.elementId,f=k.context,h=[f,k.actionName].concat(k.params);f.renderer.action.apply(f.renderer,h)&&(d=document.getElementById(d),f.renderer.render(d,f.data,f));return!1});var q=this.enhancementInputs[d.name];void 0!=q&&(delete this.enhancementInputs[d.name],d.onchange=
function(){var d=this.value;"checkbox"==this.getAttribute("type")&&(d=this.checked);if("select"==this.tagName.toLowerCase()&&null!=this.getAttribute("multiple"))for(var d=[],f=0;f<this.options.length;f++){var h=this.options[f];h.selected&&d.push(h.value)}h=q.context.elementId;f=q.context;d=[f,q.actionName,d].concat(q.params);f.renderer.action.apply(f.renderer,d)&&(d=document.getElementById(h),f.renderer.render(d,f.data,f))});d=null}};var k=new G;A.empty=void 0!=y.jQuery?function(d){y.jQuery(d).empty()}:
function(d){d.innerHTML=""};A.Components=q;var u=0;r.prototype={render:function(d,h,f){if(null==d)return Jsonary.log(Jsonary.logLevel.ERROR,"Attempted to render to non-existent element.\n\tData path: "+h.pointerPath()+"\n\tDocument: "+h.document.url),this;void 0!=d[0]&&(d=d[0]);A.empty(d);d.innerHTML=this.renderHtml(h,f);null!=this.renderFunction&&this.renderFunction(d,h,f);f.enhanceElement(d);return this},renderHtml:function(d,h){var f="";void 0!=this.renderHtmlFunction&&(f=this.renderHtmlFunction(d,
h));return f},enhance:function(d,h,f){null!=this.renderFunction&&this.renderFunction(d,h,f);return this},update:function(d,h,f,k){(void 0!=this.updateFunction?this.updateFunction(d,h,f,k):this.defaultUpdate(d,h,f,k))&&this.render(d,h,f);return this},action:function(d,h,f){return this.actionFunction.apply(this,arguments)},canRender:function(d,h,f){return void 0!=this.filterFunction?this.filterFunction(d,h,f):!0},defaultUpdate:function(d,h,f,k){d=!1;f="replace"!=k.action();h=h.pointerPath();if(k.subjectEquals(h)||
f&&!1!==k.subjectChild(h))d=!0;else if(void 0!=k.target()&&(k.targetEquals(h)||f&&!1!==k.targetChild(h)))d=!0;return d}};var B={},t=[];A.register=function(d){d=new r(d);B[d.uniqueId]=d;t.push(d);return d};A.deregister=function(d){"object"==typeof d&&(d=d.uniqueId);delete B[d];for(var h=0;h<t.length;h++)t[h].uniqueId==d&&(t.splice(h,1),h--)};"undefined"!=typeof y.jQuery&&(q=function(d,h){var f=this[0];void 0!=f&&A(f,d,h);return this},Jsonary.extendData({$renderTo:function(d,h){"string"==typeof d&&
(d=jQuery(d));var f=d[0];void 0!=f&&A(f,this,h)}}),q.register=function(d){if(void 0!=d.render){var h=d.render;d.render=function(d,f){var k=$(d);h.call(this,k,f)}}if(void 0!=d.update){var f=d.update;d.update=function(d,h,k){d=$(d);f.call(this,d,h,k)}}A.register(d)},q.empty=function(d){d.each(function(d,f){A.empty(f)})},jQuery.fn.extend({renderJson:q}),jQuery.extend({renderJson:q}));Jsonary.extend({render:A,renderHtml:function(d,h){var f=k.renderHtml(d,null,h);k.oldSubContexts={};k.subContexts={};return f}});
Jsonary.extendData({renderTo:function(d,h){"string"==typeof d&&(d=document.getElementById(d));A(d,this,h)}})})(this);