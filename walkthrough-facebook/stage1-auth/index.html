<html>
  <head>
		<title>Jsonary - Forwarding to Facebook</title>
		<link rel="stylesheet" href="../../css/main.css">
		<meta name="viewport" content="width=960">
	</head>
	<body>
		<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
		<div align="center">
			<div id="content">
				<h1>Forwarding to Facebook</h1>
				<div class="tagline">the beginnings of logging in</div>

				<div id="nav">
					back to
					<a class="nav-link" href="../../">main page</a>
					<a class="nav-link" href="../">Facebook walkthrough</a>
				</div>
				
				<div class="resource-list">
					The demos on this page use the following files:
					<ul>
						<li><span class="filename">jquery.js</span> - the jQuery library, to help assemble our interface faster
						<li><span class="filename">jsonary.js</span> - the core Jsonary library
						<li><span class="filename">jsonary.hash.js</span> - the Jsonary.Hash plugin
						<li><span class="filename">basic.jsonary.js</span> - a default set of renderers, that look similar to plain JSON
						<li><span class="filename">basic.jsonary.css</span> - the stylesheet used by the above renderers
					</ul>
				</div>
	
				<h2>Login link</h2>
				<div class="section">
					<p>The first thing we need to do is to forward the user to Facebook, to authorise our application, providing us with an OAuth bearer token:
<pre class="example code">
function forwardToFacebook() {
	var facebookAppId = 219375971524697;
	var facebookRedirectUri = window.location;
	var facebookPermissions = ["user_about_me"];
	var facebookAuthUrl = "https://www.facebook.com/dialog/oauth?client_id=" + facebookAppId + "&redirect_uri=" + encodeURIComponent(facebookRedirectUri + window.location.hash) + "&response_type=token&scope=" + facebookPermissions.join(",");
	window.location.replace(facebookAuthUrl);
}
</pre>
					<p><a href="fb-forward.html" target="forwardToFacebook">Click here</a> to try it out.  Because of Facebook's security settings, that <code>facebookAppId</code> only works on the main site, but you should first see a link, and then after successfully authorising with Facebook, it should display an OAuth token.
				</div>

				<h2>Displaying user information</h2>
				<div class="section">
					<p>The next thing we're going to do is to use this access token to display data about the current user.
					<p>The relevant code looks like this:
<pre class="example code">
var authToken = Jsonary.hash.propertyValue("access_token");
if (authToken == undefined) {
	$('<a>Authorise with Facebook</a>').attr("href", "javascript:forwardToFacebook()").appendTo($('#main'));
} else {
	Jsonary.getData({
		url: "https://graph.facebook.com/me",
		data: {access_token: authToken}
	}, function (data) {
		$('&lt;div&gt;&lt;/div&gt;').renderJson(data).appendTo('#main');
	});
}
</pre>
					<p>This code uses the Jsonary.Hash plugin (which decodes data in the hash as a query string) to check for an auth token.  If so, it makes a request to the Facebook Graph API using that token.
					<p><a href="fb-forward-display.html" target="forwardToFacebookDisplay">Click here</a> to try it out - you should see some basic data about yourself displayed.  Again, because of Facebook's security settings, that <code>facebookAppId</code> only works on the main site.
				</div>
			</div>
		</div>
	</body>
</html>
