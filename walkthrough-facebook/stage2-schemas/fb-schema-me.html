<html>
	<head>
		<title>Forward to Facebook demo</title>
		<link rel="stylesheet" href="../../renderers/basic.jsonary.css">
		<meta name="viewport" content="width=960">
	</head>
	<body>
		<div id="main"></div>
		<script src="../../jsonary.js"></script>
		<script src="../../plugins/jsonary.hash.js"></script>
		<script src="../../renderers/basic.jsonary.js"></script>
		<script>
			// Facebook auth
			function forwardToFacebook() {
				var facebookAppId = 219375971524697;
				var facebookRedirectUri = window.location;
				var facebookPermissions = ["user_about_me"];
				var facebookAuthUrl = "https://www.facebook.com/dialog/oauth?client_id=" + facebookAppId + "&redirect_uri=" + encodeURIComponent(facebookRedirectUri) + "&response_type=token&scope=" + facebookPermissions.join(",");
				window.location.replace(facebookAuthUrl);
			}
			
			var authToken = Jsonary.hash.propertyValue("access_token");
			var mainElement = document.getElementById("main");
			if (authToken == undefined) {
				mainElement.innerHTML = '<a href="javascript:forwardToFacebook()">Authorise with Facebook</a>';
			} else {
				Jsonary.getData({
					url: "https://graph.facebook.com/me",
					data: {access_token: authToken}
				}, function (data) {
					Jsonary.render(mainElement, data);
				}, "schemas/me.json");
			}
		</script>
	</body>
</html>
