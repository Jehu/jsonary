!function(){"undefined"!=typeof window&&"undefined"==typeof localStorage&&(window.localStorage={}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0;n<this.length;n++)if(this[n]===e)return n;return-1}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Date.prototype.toISOString||function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),Object.create||(Object.create=function(){function e(){}return function(t){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,a,s,o=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(a=u.length,n=0;a>n;n+=1)s[n]=str(n,u)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,r}if(rep&&"object"==typeof rep)for(a=rep.length,n=0;a>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,u),r&&s.push(quote(i)+(gap?": ":":")+r));else for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(r=str(i,u),r&&s.push(quote(i)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e){function t(e){var t=e.match(/^[a-zA-Z\-]+:/);null!=t&&t.length>0?(this.scheme=t[0].substring(0,t[0].length-1),e=e.substring(t[0].length)):this.scheme=null,"//"==e.substring(0,2)?(this.doubleSlash=!0,e=e.substring(2)):this.doubleSlash=!1;var r=e.indexOf("#");if(r>=0){var a=e.substring(r+1);this.fragment=i(a),e=e.substring(0,r)}else this.hash=null;var s=e.indexOf("?");if(s>=0){var o=e.substring(s+1);this.query=n(o),e=e.substring(0,s)}else this.query=null;var u=e.indexOf("@");if(u>=0){var h=e.substring(0,u),l=h.indexOf(":");-1==l?(this.username=h,this.password=null):(this.username=h.substring(0,l),this.password=h.substring(l+1));var e=e.substring(u+1)}else this.username=null,this.password=null;var c=0;(null!=this.scheme||this.doubleSlash)&&(c=e.indexOf("/")),c>=0?(this.path=e.substring(c),""==this.path&&(this.path=null),e=e.substring(0,c)):this.path=null;var l=e.indexOf(":");l>=0?(this.port=e.substring(l+1),e=e.substring(0,l)):this.port=null,this.domain=""==e?null:e}function n(e){for(var t=e.split("&"),n=[],i=0;i<t.length;i++){var r=t[i],a=r.indexOf("=");if(-1==a)n.push({key:r});else{var s=r.substring(0,a),o=r.substring(a+1);n.push({key:s,value:decodeURIComponent(o)})}}for(var s in J)n[s]=J[s];var u=JSON.stringify(n);return n.toString=function(){return JSON.stringify(this)==u?e:J.toString.call(this)},n.isQuery=!0,n}function i(e){return-1==e.indexOf("?")?n(e):(e.isQuery=!1,void 0)}function r(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function a(e){var t="";K[e.charAt(0)]&&(t=e.charAt(0),e=e.substring(1));var n="",i="",a=!0,s=!1,o=!1;"+"==t?a=!1:"."==t?(i=".",n="."):"/"==t?(i="/",n="/"):"#"==t?(i="#",a=!1):";"==t?(i=";",n=";",s=!0,o=!0):"?"==t?(i="?",n="&",s=!0):"&"==t&&(i="&",n="&",s=!0);for(var u=[],h=e.split(","),l=[],c={},d=0;d<h.length;d++){var f=h[d],p=null;if(-1!=f.indexOf(":")){var v=f.split(":");f=v[0],p=parseInt(v[1])}for(var m={};_[f.charAt(f.length-1)];)m[f.charAt(f.length-1)]=!0,f=f.substring(0,f.length-1);var g={truncate:p,name:f,suffices:m};l.push(g),c[f]=g,u.push(f)}var y=function(e){for(var t="",u=0,h=0;h<l.length;h++){var c=l[h],d=e(c.name);if(null==d||Array.isArray(d)&&0==d.length||"object"==typeof d&&0==Object.keys(d).length)u++;else if(t+=h==u?i:n||",",Array.isArray(d)){s&&(t+=c.name+"=");for(var f=0;f<d.length;f++)f>0&&(t+=c.suffices["*"]?n||",":",",c.suffices["*"]&&s&&(t+=c.name+"=")),t+=a?encodeURIComponent(d[f]).replace(/!/g,"%21"):r(d[f])}else if("object"==typeof d){s&&!c.suffices["*"]&&(t+=c.name+"=");var p=!0;for(var v in d)p||(t+=c.suffices["*"]?n||",":","),p=!1,t+=a?encodeURIComponent(v).replace(/!/g,"%21"):r(v),t+=c.suffices["*"]?"=":",",t+=a?encodeURIComponent(d[v]).replace(/!/g,"%21"):r(d[v])}else s&&(t+=c.name,o&&""==d||(t+="=")),null!=c.truncate&&(d=d.substring(0,c.truncate)),t+=a?encodeURIComponent(d).replace(/!/g,"%21"):r(d)}return t},b=function(e,t){if(i){if(e.substring(0,i.length)!=i)return null;e=e.substring(i.length)}if(1==l.length&&l[0].suffices["*"]){for(var r=l[0],o=r.name,u=r.suffices["*"]?e.split(n||","):[e],h=a&&-1!=e.indexOf("="),d=1;d<u.length;d++){var e=u[d];h&&-1==e.indexOf("=")&&(u[d-1]+=(n||",")+e,u.splice(d,1),d--)}for(var d=0;d<u.length;d++){var e=u[d];a&&-1!=e.indexOf("=")&&(h=!0);for(var f=e.split(","),p=0;p<f.length;p++)a&&(f[p]=decodeURIComponent(f[p]));u[d]=1==f.length?f[0]:f}if(s||h){for(var v=t[o]||{},p=0;p<u.length;p++){var m=e;if("string"==typeof u[p]){var e=u[p],g=e.split("=",1)[0],e=e.substring(g.length+1);m=e}else{var e=u[p][0],g=e.split("=",1)[0],e=e.substring(g.length+1);u[p][0]=e,m=u[p]}void 0!==v[g]?Array.isArray(v[g])?v[g].push(m):v[g]=[v[g],m]:v[g]=m}t[o]=1==Object.keys(v).length&&void 0!==v[o]?v[o]:v}else t[o]=void 0!==t[o]?Array.isArray(t[o])?t[o].concat(u):[t[o]].concat(u):1!=u.length||r.suffices["*"]?u:u[0]}else{for(var u=1==l.length?[e]:e.split(n||","),y={},d=0;d<u.length;d++){for(var b=0;b<l.length-1&&d>b&&!l[b].suffices["*"];b++);if(p!=d){for(var S=l.length-1;S>0&&l.length-S<u.length-d&&!l[S].suffices["*"];S--);y[d]=l.length-S!=u.length-d?b:S}else y[d]=d}for(var d=0;d<u.length;d++){var e=u[d],f=e.split(",");if(s){var e=f[0],o=e.split("=",1)[0],e=e.substring(o.length+1);f[0]=e;var r=c[o]||l[0]}else var r=l[y[d]],o=r.name;for(var p=0;p<f.length;p++)a&&(f[p]=decodeURIComponent(f[p]));t[o]=(s||r.suffices["*"])&&void 0!==t[o]?Array.isArray(t[o])?t[o].concat(f):[t[o]].concat(f):1!=f.length||r.suffices["*"]?f:f[0]}}};return y.varNames=u,{prefix:i,substitution:y,unSubstitution:b}}function s(e){if(!(this instanceof s))return new s(e);for(var t=e.split("{"),n=[t.shift()],i=[],r=[],o=[],u=[];t.length>0;){var h=t.shift(),l=h.split("}")[0],c=h.substring(l.length+1),d=a(l);r.push(d.substitution),o.push(d.unSubstitution),i.push(d.prefix),n.push(c),u=u.concat(d.substitution.varNames)}this.fill=function(e){for(var t=n[0],i=0;i<r.length;i++){var a=r[i];t+=a(e),t+=n[i+1]}return t},this.fromUri=function(e){for(var t={},r=0;r<n.length;r++){var a=n[r];if(e.substring(0,a.length)!==a)return void 0;if(e=e.substring(a.length),r>=n.length-1){if(""==e)break;return void 0}for(var s=n[r+1],u=r;;){if(u==n.length-2){var h=e.substring(e.length-s.length);if(h!==s)return void 0;var l=e.substring(0,e.length-s.length);e=h}else if(s){var c=e.indexOf(s),l=e.substring(0,c);e=e.substring(c)}else if(i[u+1]){var c=e.indexOf(i[u+1]),l=e.substring(0,c);e=e.substring(c)}else{if(n.length>u+2){u++,s=n[u+1];continue}var l=e;e=""}break}o[r](l,t)}return t},this.varNames=u}function o(e,t){for(var n in t)!function(t,n){e[t]=function(){return n}}(n,t[n])}function u(e){this.contents={},this.keyOrder=[],this.context=e}function h(e){this.listeners=[],this.context=e}function l(e,t){var n=this;this.baseUrl=e.url,this.fragment=t,null==t&&(t=""),this.url=this.baseUrl+"#"+encodeURI(t),this.getRoot=function(t){return e.getRoot(function(e){t.call(e,e,n)}),this},this.getData=function(i){return null==t||""==t?e.document.getRoot(function(e){i.call(e,e,n)}):e.document.getFragment(t,function(e){i.call(e,e,n)}),this},this.getRawResponse=function(t){return e.getResponse(function(e){t.call(e,e,n)}),this}}function c(t,n,i,r,a,s){if(void 0==t)throw new Error("URL cannot be undefined");t=$.resolveRelativeUri(t),void 0==n&&(n="GET"),void 0===i&&(i={});var o=null,u=t.indexOf("#");u>=0&&(o=decodeURI(t.substring(u+1)),t=t.substring(0,u)),void 0==r&&(r="GET"==n?"application/x-www-form-urlencoded":"POST"==n||"PUT"==n?"application/json":"application/x-www-form-urlencoded"),void 0==a&&(a=e.defaultCache),"GET"==n&&(i=q.encodeData(i,r),""!=i&&(t.indexOf("?")==t.length-1||(t+=-1==t.indexOf("?")?"?":"&"),t+=i),i={});var h=a&&"GET"==n&&"application/x-www-form-urlencoded"==r;if(h){var c=JSON.stringify(t)+":"+JSON.stringify(i),d=a(c);if(void 0!=d)return{request:d,fragmentRequest:new l(d,o)}}var f=new p(t,n,i,r,s,function(e){h&&a(c,e)});return{request:f,fragmentRequest:new l(f,o)}}function d(t,n,i,r){t=$.resolveRelativeUri(t),void 0==r&&(r=e.defaultCache);var a={},s=JSON.stringify(t)+":"+JSON.stringify(a);new v(t,n,i,r,s)}function f(e){this.httpCode=e,this.message="HTTP Status: "+e}function p(e,t,n,i,r,a){a(this),e=$.resolveRelativeUri(e),n="GET"==t||"DELETE"==t?null:$.encodeData(n,i),$.log($.logLevel.STANDARD,"Sending request for: "+e),this.successful=null,this.error=null,this.url=e;var s=void 0==n||""==n;this.responseListeners=new h(this),this.document=new y(e,s,!0),this.fetched=!1,this.fetchData(e,t,n,i,r),this.invalidate=function(){var a=function(){null!=s.successful&&"GET"==t&&s.fetchData(e,t,n,i,r)},s=this;this.document.whenAccessed(a),this.document.whenStable=function(e){return delete s.document.whenStable,a(),s.document.whenStable(e)}}}function v(e,t,n,i,r){i(r,this);var a=this;this.url=e,this.responseListeners=new h(this),this.document=new y(e,!0,!0),this.document.setRaw(t),this.profileUrl=n,void 0!=n&&this.document.raw.addSchema(n),e==n?this.document.setRoot(""):this.document.raw.whenSchemasStable(function(){var e=a.document.raw.getLink("root");if(void 0!=e){var t=decodeURI(e.href.substring(e.href.indexOf("#")+1));a.document.setRoot(t)}else a.document.setRoot("")}),this.successful=!0,this.error=null,this.fetched=!1,this.invalidate=function(){this.fetchData(e,"GET",void 0,"application/x-www-form-urlencoded",n)}}function m(e){this.operations=[],void 0==e&&(e=""),this.prefix=e}function g(e,t,n){this._patchType=e,this._subject=t,this._subjectValue=void 0,"move"==e?this._target=n:this._value=n}function y(e,t,n){function i(e){G.increment();var t=W.concat(o);G.add(function(){for(var n=0;n<t.length;n++)t[n].call(r,e,r)}),G.decrement()}var r=this;this.readOnly=!!n,this.isDefinitive=!!t,this.url=e,this.error=null;var a=null;this.rootPath=function(){return a};var s={};this.raw=new S(this,s),this.uniqueId=this.raw.uniqueId,this.root=null;var o=[];this.registerChangeListener=function(e){o.push(e)};var u=[];this.access=function(){for(;u.length;)u.shift().call(this)},this.whenAccessed=function(e){u.push(e)},this.setRaw=function(e){var t=this.raw.defined();if(s.setValue(e),t){s.setValue(e);var n=new m;n.replace(this.raw.pointerPath(),e),i(n)}};var l=new h(this);this.getRoot=function(e){null==this.root?l.add(e):e.call(this,this.root)},this.setRoot=function(e){a=e,this.root=this.raw.subPath(e),l.notify(this.root)},this.patch=function(e){if(this.access(),this.readOnly)throw new Error("Cannot update read-only document");if(Q)return void 0==this.batchPatch&&(this.batchPatch=new m,Y.push(this)),this.batchPatch.operations=this.batchPatch.operations.concat(e.operations),void 0;G.increment();var t=e.filter("?"),n=e.filterRemainder("?");this.raw.patch(t),this.root.patch(n),i(e),G.decrement()},this.affectedData=function(e){var t=e.subject(),n=null;n="?"==t||"?/"==t.substring(0,2)?this.raw.subPath(t.substring(1)):this.root.subPath(t);for(var i=[];void 0!=n;)i.push(n),n=n.parent();if("move"==e.action()){var r=e.target(),a=null;for(a="?"==r||"?/"==r.substring(0,2)?this.raw.subPath(r.substring(1)):this.root.subPath(r),i.push();void 0!=a;)i.push(a),a=a.parent()}return i};var c=(this.url||"").split("#")[0],d={};this.addSelfLink=function(e){var t=e.rawLink.href;if(t.substring(0,c.length+1)==c+"#"){var n=decodeURIComponent(t.substring(c.length+1));d[n]=e.dataObj}},this.removeSelfLink=function(e){var t=e.rawLink.href;if(t.substring(0,c.length+1)==c+"#"){var n=decodeURIComponent(t.substring(c.length+1));d[n]==e.dataObj&&delete d[n]}},this.getFragment=function(e,t){return void 0!==d[e]?(t.call(this,d[e]),void 0):(this.getRoot(function(n){if(""==e)t.call(this,n);else{var i=n.subPath(e);t.call(this,i)}}),void 0)}}function b(e){return z.test(e)}function S(e,t,n,i){this.uniqueId=et++,this.document=e,this.readOnly=function(t){return t||void 0===t?e.readOnly||this.schemas().readOnly()||void 0!=n&&n.readOnly(!0):e.readOnly};var r=void 0,a=void 0,s=0,o=[],u={},h={};this.property=function(e){return void 0==u[e]&&(h[e]={},u[e]=new S(this.document,h[e],this,e),"object"==a&&(h[e].setValue(r[e]),void 0!==r[e]&&t.schemas.addSchemasForProperty(e,u[e]))),u[e]};var l={},c={};this.item=function(e){if(!b(e))throw new Error("Index must be a positive integer (or integer-value string)");return void 0==l[e]&&(c[e]={},l[e]=new S(this.document,c[e],this,e),"array"==a&&(c[e].setValue(r[e]),void 0!==r[e]&&t.schemas.addSchemasForIndex(e,l[e]))),l[e]},this.parent=function(){return n},this.parentKey=function(){return i},this.pointerPath=function(){return this.document.root==this?"":void 0!=n?n.pointerPath()+"/"+$.encodePointerComponent(i):"?"},this.basicType=function(){return e.access(),a},this.value=function(){if(e.access(),"object"==a){for(var t={},n=0;n<o.length;n++){var i=o[n];t[i]=void 0!=u[i]?u[i].value():r[i]}return t}if("array"==a){for(var t=[],n=0;s>n;n++)t[n]=void 0!=l[n]?l[n].value():r[n];return t}return r},this.keys=function(){return e.access(),o.slice(0)},this.length=function(){return e.access(),s},this.patch=function(e){var n=this,i=this.pointerPath(),d={};if(e.each(function(e,f){if(f.subjectEquals(i)){if("replace"==f.action()||"add"==f.action())f.setSubjectValue(n.value()),t.setValue(f.value());else if("remove"==f.action());else if("move"!=f.action())throw new Error("Unrecognised patch operation: "+f.action())}else if(f.targetEquals(i))"move"==f.action()&&t.setValue(f.subjectValue());else{var p=f.subjectChild(i);if("string"==typeof p)if(d[p]=!0,"object"==a){if("add"==f.action()){var v=o.indexOf(p);if(-1!=v)throw new Error("Cannot add existing key: "+p);o.push(p),r[p]=f.value(),void 0!=u[p]&&(h[p].setValue(f.value()),t.schemas.addSchemasForProperty(p,u[p]))}else if("remove"==f.action()||"move"==f.action()){var v=o.indexOf(p);if(-1==v)throw new Error("Cannot delete missing key: "+p);f.setSubjectValue(n.propertyValue(p)),o.splice(v,1),void 0!=h[p]&&h[p].setValue(void 0),delete r[p]}else if("replace"!=f.action())throw new Error("Unrecognised patch operation: "+f.action())}else if("array"==a){if(!b(p))throw new Error("Cannot patch non-numeric index: "+p);var m=parseInt(p);if("add"==f.action()){if(m>s)throw new Error("Cannot add past the end of the list");for(var g=s-1;g>=m;g--)void 0!=c[g+1]&&(void 0==l[g]?c[g+1].setValue(r[g]):c[g+1].setValue(l[g].value()));r.splice(m,0,f.value()),s++,void 0!=l[r.length-1]&&t.schemas.addSchemasForIndex(r.length-1,l[r.length-1])}else if("remove"==f.action()||"move"==f.action()){if(m>=s)throw new Error("Cannot remove a non-existent index");f.setSubjectValue(n.itemValue(m));for(var g=m;s-1>g;g++)void 0!=c[g]&&(void 0==l[g+1]?c[g].setValue(r[g+1]):c[g].setValue(l[g+1].value()));void 0!=c[s-1]&&c[s-1].setValue(void 0),s--,r.splice(m,1)}else if("replace"!=f.action())throw new Error("Unrecognised patch operation: "+f.action())}var y=f.targetChild(i);if("string"==typeof y)if(d[y]=!0,"object"==a){if("move"==f.action()){var v=o.indexOf(y);if(-1!=v)throw new Error("Cannot move to existing key: "+y);o.push(y),r[y]=f.subjectValue(),void 0!=u[y]&&t.schemas.addSchemasForProperty(y,u[y])}}else if("array"==a){if(!b(y))throw new Error("Cannot patch non-numeric index: "+y);var m=parseInt(y);if("move"==f.action()){if(m>s)throw new Error("Cannot add past the end of the list");for(var g=s-1;g>=m;g--)void 0!=c[g+1]&&(void 0==l[g]?c[g+1].setValue(r[g]):c[g+1].setValue(l[g].value()));r.splice(m,0,f.subjectValue()),s++,void 0!=l[r.length-1]&&t.schemas.addSchemasForIndex(r.length-1,l[r.length-1])}}}}),"object"==a)for(var f=0;f<o.length;f++){var p=o[f],v=e.filter("/"+$.encodePointerComponent(p));v.isEmpty()||this.property(p).patch(v)}else if("array"==a)for(var f=0;s>f;f++){var v=e.filter("/"+$.encodePointerComponent(f));v.isEmpty()||this.index(f).patch(v)}for(var p in d)t.schemas.update(p)},t.setValue=function(e){var n=$.guessBasicType(e,a),i=r;if(r=e,n!=a){if("object"==a)for(var d in u)h[d].setValue(void 0);else if("array"==a)for(var f in l)c[f].setValue(void 0);a=n}if("object"==n){for(var d in u)e.hasOwnProperty(d)?(u[d].defined()||t.schemas.addSchemasForProperty(d,u[d]),h[d].setValue(e[d])):h[d].setValue(void 0);o=Object.keys(e),s=0}else if("array"==n){for(var f in l)f<e.length?(l[f].defined()||t.schemas.addSchemasForIndex(f,l[f]),c[f].setValue(e[f])):c[f].setValue(void 0);o=[],s=e.length}else o=[],s=0;void 0===e?void 0!==i&&t.schemas.clear():t.schemas.update(null)},t.schemas=new E(this),this.schemas=function(r){if(r&&void 0==a&&n){if("array"===n.basicType()&&b(i))return n.schemas(!0).indexSchemas(i);if("object"===n.basicType())return n.schemas(!0).propertySchemas(i)}return e.access(),t.schemas.getSchemas()},this.whenSchemasStable=function(n){return e.access(),t.schemas.whenSchemasStable(n),this},this.links=function(n){return e.access(),t.schemas.getLinks(n)},this.addLink=function(n){return e.access(),t.schemas.addLink(n),this},this.addSchema=function(n,i){e.access();var r=this;return n instanceof D?n.each(function(e,t){r.addSchema(t,i)}):t.schemas.addSchema(n,i),this},this.removeSchema=function(n){return e.access(),t.schemas.removeSchema(n),this},this.addSchemaMatchMonitor=function(n,i,r,a,s){return e.access(),t.schemas.addSchemaMatchMonitor(n,i,r,a,s)}}function x(t,n){return e.getData(t).getRawResponse(function(e){e.document.root||e.document.setRoot("")}).getData(function(e,t){var i=e.asSchema();void 0!=n&&n.call(i,i,t)})}function w(t){return void 0==nt[t]&&(nt[t]=e.createSchema({type:t})),nt[t]}function O(e){this.data=e,e.referenceUrl(),e.propertyValue("id");var t=[],n=e.property("links");void 0!==n&&n.indices(function(e,n){t[t.length]=new k(n)}),this.links=function(e){for(var n=[],i=0;i<t.length;i++){var r=t[i];(void 0==e||r.rel==e)&&n.push(r)}return n},this.schemaTitle=this.title()}function j(e){if("{@}"==e)return"{+%73elf}";for(var t=[],n=!1,i=!1,r=0;r<e.length;r++){var a=e.charAt(r);if(n)if(i){if(")"==a){")"==e.charAt(r+1)?(t.push(it[")"]),r++):i=!1;continue}void 0!=it[a]?t.push(it[a]):t.push(encodeURIComponent(a))}else{if("$"==a){t.push("%73elf");continue}if("("==a){")"==e.charAt(r+1)?(t.push("%65mpty"),r++):i=!0;continue}"}"==a&&(n=!1),t.push(a)}else"{"==a&&(n=!0),t.push(a)}return t.join("")}function k(e){this.data=e,this.uriTemplate=new s(j(e.propertyValue("href"))),this.dataParts=[];for(var t=0;t<this.uriTemplate.varNames.length;t++)this.dataParts.push(C(this.uriTemplate.varNames[t]));var n=e.property("schema");if(n.defined()){var i=n.asSchema();this.submissionSchemas=new D([i])}else this.submissionSchemas=new D;var r=e.property("targetSchema");r.defined()&&(this.targetSchema=r.asSchema()),this.handlers=[],this.preHandlers=[]}function C(e){return"%65mpty"==e?"":"%73elf"==e?null:decodeURIComponent(e)}function T(e,t,n){this.rawLink=e,this.definition=t,this.subjectData=n,this.href=e.href;var i=this.href.indexOf("#");i>=0?(this.hrefBase=this.href.substring(0,i),this.hrefFragment=this.href.substring(i+1)):(this.hrefBase=this.href,this.hrefFragment=""),this.rel=e.rel,this.title=e.title,this.method=void 0!=e.method?e.method:"edit"==e.rel?"PUT":"create"==e.rel?"POST":"delete"==e.rel?"DELETE":"GET",void 0!=e.enctype&&(e.encType=e.enctype,delete e.enctype),this.encType=void 0==e.encType?"GET"==this.method?"application/x-www-form-urlencoded":"POST"==this.method||"PUT"==this.method?"application/json":"application/x-www-form-urlencoded":e.encType,null!=this.definition&&(this.submissionSchemas=this.definition.submissionSchemas,this.targetSchema=this.definition.targetSchema)}function I(e,t,n,i){var r=this;this.monitorKey=e,this.match=!1,this.matchFailReason=new L("initial failure",null),this.monitors=new u(n),this.impatientCallbacks=i,this.propertyMatches={},this.indexMatches={},this.dependencies={},this.dependencyKeys={},this.schemaLoaded=!1,this.data=t,n.getFull(function(e){r.schemaLoaded=!0,r.schema=e,r.basicTypes=e.basicTypes(),r.setupXorSelectors(),r.setupOrSelectors(),r.setupAndMatches(),r.setupNotMatches(),r.dataUpdated()})}function L(e,t,n){this.message=e,this.schema=t,this.subMatchFailReason=n}function V(e,t,n){var i=this;this.options=t,this.matchCallback=null,this.selectedOption=null,this.data=n,this.subMatches=[],this.subSchemaKeys=[];for(var r=0;r<t.length;r++)this.subSchemaKeys[r]=$.getKeyVariant(e,"option"+r),this.subMatches[r]=n.addSchemaMatchMonitor(this.subSchemaKeys[r],t[r],function(){i.update()},!1,!0);this.update()}function M(e,t,n){var i=this;this.options=t,this.matchCallback=null,this.selectedOptions=[],this.data=n,this.subMatches=[],this.subSchemaKeys=[];for(var r=0;r<t.length;r++)this.subSchemaKeys[r]=$.getKeyVariant(e,"option"+r),this.subMatches[r]=n.addSchemaMatchMonitor(this.subSchemaKeys[r],t[r],function(){i.update()},!1,!0);this.update()}function P(){ht=!1;var e=[];for(var t in ut){var n=ut[t];e.push({data:n,pointerPath:n.pointerPath()})}ut={},e.sort(function(e,t){return e.pointerPath.length-t.pointerPath.length});for(var i=[],r=0;r<e.length;r++)i[r]=e[r].data;for(var r=0;r<ot.length;r++)ot[r].call(null,i)}function A(e){ut[e.uniqueId]=e,ht||(ht=!0,G.add(P))}function R(e){for(var t=0;t<e.length;t++)this[t]=e[t];this.length=e.length}function D(e,t){if(void 0==e)return this.length=0,void 0;void 0==t&&(t=e),this.fixed=function(){var n=t.length<e.length?new D(t):this;return this.fixed=function(){return n},n};var n;for(n=0;n<e.length;n++)this[n]=e[n];this.length=e.length}function E(e){this.dataObj=e,this.schemas={},this.schemasFixed={},this.links={},this.matches={},this.xorSelectors={},this.orSelectors={},this.dependencySelectors={},this.schemaFlux=0,this.schemasStable=!0,this.schemasStableListeners=new h(e),this.pendingNotify=!1,this.cachedSchemaList=null,this.cachedLinkList=null}function F(e,t){this.dataObj=e,this.potentialLink=t,this.active=!1,this.rawLink=null,this.updateMonitors=new u(e)}function N(e,t,n,i){var r=$.getKeyVariant(t,"$");this.xorSelector=new V(t,e,i.dataObj),this.xorSelector.onMatchChange(function(t){i.removeSchema(r),null!=t?i.addSchema(t,r,n,!1):e.length>0&&i.addSchema(e[0],r,n,!1)})}function U(e,t,n,i){for(var r=[],a=[],s=0;s<e.length;s++)r[s]=$.getKeyVariant(t,"$"+s),a[s]=!1;this.orSelector=new M(t,e,i.dataObj),this.orSelector.onMatchChange(function(t){for(var s=0;s<e.length;s++){for(var o=!1,u=0;u<t.length;u++)if(e[s]==t[u]){o=!0;break}o&&!a[s]?i.addSchema(e[s],r[s],n,!1):!o&&a[s]&&i.removeSchema(r[s]),a[s]=o}0==t.length&&e.length>0&&i.addSchema(e[0],r[0],n,!1)})}function H(e,t,n,i){this.inferredSchemaKeys={},this.applied={},this.schema=e,this.schemaKeyHistory=n,this.schemaSet=i;for(var r=this.schema.data.property("dependencies").keys(),a=0;a<r.length;a++){var s=r[a];this.inferredSchemaKeys[s]=$.getKeyVariant(t,"$"+a),this.dataUpdated(s)}}var q=e;e.toString=function(){return"<Jsonary>"},e.plugins={},t.prototype={toString:function(){var e="";return null!=this.scheme&&(e+=this.scheme+":"),this.doubleSlash&&(e+="//"),null!=this.username&&(e+=this.username,null!=this.password&&(e+=":"+this.password),e+="@"),null!=this.domain&&(e+=this.domain),null!=this.port&&(e+=":"+this.port),null!=this.path&&(e+=this.path),null!=this.query&&(e+="?"+this.query),null!=this.fragment&&(e+="#"+this.fragment),e},queryObj:function(){var e={};if(this.query)for(var t=0;t<this.query.length;t++){var n=this.query[t];e[n.key]=n.value}return e},resolve:function(e){var n=new t(e+"");if(null==n.scheme&&(n.scheme=this.scheme,n.doubleSlash=this.doubleSlash,null==n.domain))if(n.domain=this.domain,n.port=this.port,n.username=this.username,n.password=this.password,null==n.path)n.path=this.path,null==n.query&&(n.query=this.query);else if("/"!=n.path.charAt(0)&&null!=this.path){var i,r="/"==this.path.charAt(0);i=r?this.path.substring(1).split("/"):this.path.split("/"),".."==i[i.length-1]&&i.push(""),i.pop();for(var a=i.length-1;a>=0;a--)"."==i[a]&&i.slice(a,1);for(var s=n.path.split("/"),a=0;a<s.length;a++){var o=s[a];if("."!=o)if(".."==o){if(i.length>0&&".."!=i[i.length-1])i.pop();else if(!r){i=i.concat(s.slice(a));break}}else i.push(o)}n.path=(r?"/":"")+i.join("/")}return n.toString()}},e.baseUri=null,t.resolve=function(n,i){if(void 0==i)if(i=n,e.baseUri)n=e.baseUri;else{if("undefined"==typeof window)return n;n=window.location.href}return void 0==n?i:(n instanceof t||(n=new t(n)),n.resolve(i))},t.parse=function(e){return new t(e)};var J={toString:function(){for(var e=[],t=0;t<this.length;t++)"undefined"==typeof this[t].value?e.push(this[t].key):e.push(this[t].key+"="+encodeURIComponent(this[t].value));return e.join("&")},get:function(e,t){for(var n=this.length-1;n>=0;n--)if(this[n].key==e)return this[n].value;return t},set:function(e,t){for(var n=this.length-1;n>=0;n--)if(this[n].key==e)return this[n].value=t,void 0;this.push({key:e,value:t})}};e.Uri=t;var K={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},_={"*":!0};s.prototype={fillFromObject:function(e){return this.fill(function(t){return e[t]})}};var $={guessBasicType:function(e){return null===e?"null":Array.isArray(e)?"array":"object"==typeof e?"object":"string"==typeof e?"string":"number"==typeof e?0==e%1?"integer":"number":"boolean"==typeof e?"boolean":void 0},resolveRelativeUri:function(e,n){return t.resolve(e,n)},urlsEqual:function(e,t){return"#"==e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),"#"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),e==t},linksEqual:function(e,t){if(void 0==e||void 0==t)return e==t;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(i.href!=r.href||i.rel!=r.rel)return!1;if(i.method!=r.method||i["enc-type"]!=r["enc-type"])return!1;if(i.schema!=r.schema)return!1}return!0},log:function(e,t){try{e>=$.logLevel.ERROR&&(window.alert("ERROR: "+t),console.log("ERROR: "+t),console.trace()),e>=$.logLevel.WARNING&&console.log("WARNING: "+t)}catch(n){}},logLevel:{DEBUG:-1,STANDARD:0,WARNING:1,ERROR:2},getKeyVariant:function(e,t){if(void 0==t&&(t=$.getUniqueKey()),t+="",t.indexOf(".")>=0)throw new Error("variant name cannot contain a dot: "+t);return e+"."+t},keyIsVariant:function(e,t){return e+="",t+="",e===t||e.substring(0,t.length+1)===t+"."},keyIsRoot:function(e){return-1==e.indexOf(".")},hcf:function(e,t){for(e=Math.abs(e),t=Math.abs(t);;){var n=e%t;if(0==n)return t;if(isNaN(n))return 0/0;e=t,t=n}},recursiveCompare:function(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!$.recursiveCompare(e[n],t[n]))return!1;return!0}if("object"==typeof e){for(var i in e)if(void 0===t[i]&&void 0!==e[i])return!1;for(var i in t)if(void 0===e[i]&&void 0!==e[i])return!1;for(var i in e)if(!$.recursiveCompare(e[i],t[i]))return!1;return!0}return e===t},lcm:function(e,t){return Math.abs(e*t/this.hcf(e,t))},encodeData:function(e,t,n){if(void 0==t&&(t="application/x-www-form-urlencoded"),"application/json"==t)return JSON.stringify(e);if("application/x-www-form-urlencoded"==t)return"dotted"==n?$.formEncode(e,"",".","","|").replace(/%20/g,"+").replace(/%2F/g,"/"):"pretty"==n?$.formEncode(e,"","[","]").replace(/%20/g,"+").replace(/%2F/g,"/").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%7C/g,"|"):$.formEncode(e,"","[","]").replace(/%20/g,"+");throw new Error("Unknown encoding type: "+this.encType)},decodeData:function(e,t,n){if(void 0==t&&(t="application/x-www-form-urlencoded"),"application/json"==t)return JSON.parse(e);if("application/x-www-form-urlencoded"==t)return e=e.replace(/\+/g,"%20"),"dotted"==n?$.formDecode(e.replace(/%7C/g,"|"),".","","|"):$.formDecode(e,"[","]");throw new Error("Unknown encoding type: "+this.encType)},formEncode:function(e,t,n,i,r){void 0==t&&(t="");var a=[];if(Array.isArray(e))for(var s=0;s<e.length;s++){var o=""==t?s:t+encodeURIComponent(n+i),u=""==t?s:t+encodeURIComponent(n+s+i),h=e[s];if(null==h)a.push(o+"=null");else if("object"==typeof h){var l=$.formEncode(h,u,n,i,r);l&&a.push(l)}else"boolean"==typeof h?h?a.push(o+"=true"):a.push(o+"=false"):""===h?a.push(o):a.push(o+"="+encodeURIComponent(h))}else if("object"==typeof e){for(var o in e)if(e.hasOwnProperty(o)){var h=e[o];if(o=""!=t?t+encodeURIComponent(n+o+i):encodeURIComponent(o),void 0===h);else if(null===h)a.push(o+"=null");else if(r&&Array.isArray(h)){if(h.length>0){for(var c=[];c.length<h.length;)c[c.length]=encodeURIComponent(h[c.length]);var d=r+c.join(r);a.push(o+"="+d)}}else if("object"==typeof h){var l=$.formEncode(h,o,n,i,r);l&&a.push(l)}else"boolean"==typeof h?h?a.push(o+"=true"):a.push(o+"=false"):""===h?a.push(o):a.push(o+"="+encodeURIComponent(h))}}else a.push(encodeURIComponent(e));return a.join("&")},formDecodeString:function(e){return"true"==e?e=!0:"false"==e?e=!1:"null"==e?e=null:parseFloat(e)+""==e&&(e=parseFloat(e)),e},formDecode:function(e,t,n,i){for(var r={},a=e.split("&"),s=0;s<a.length;s++){var o=a[s],u=o,h="";if(o.indexOf("=")>=0)if(u=o.substring(0,o.indexOf("=")),h=decodeURIComponent(o.substring(o.indexOf("=")+1)),i&&h.charAt(0)==i){h=h.split(i),h.shift();for(var l=0;l<h.length;l++)h[l]=$.formDecodeString(h[l])}else h=$.formDecodeString(h);u=decodeURIComponent(u);for(var c=r,d=u.split(t),l=1;l<d.length;l++)d[l]=d[l].substring(0,d[l].length-n.length);for(var l=0;l<d.length;l++)Array.isArray(c)&&""==d[l]&&(d[l]=c.length),l==d.length-1?c[d[l]]=h:(void 0==c[d[l]]&&(c[d[l]]=""==d[l+1]?[]:{}),c=c[d[l]])}return r},escapeHtml:function(e,t){e+="";
var n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;");return t?n:n.replace(/"/g,"&quot;")},encodePointerComponent:function(e){return e.toString().replace("~","~0").replace("/","~1")},decodePointerComponent:function(e){return e.toString().replace("~1","/").replace("~0","~")},splitPointer:function(e){var t=e.split("/");""==t[0]&&t.shift();for(var n=0;n<t.length;n++)t[n]=$.decodePointerComponent(t[n]);return t},joinPointer:function(e){for(var t="",n=0;n<e.length;n++)t+="/"+$.encodePointerComponent(e[n]);return t},prettyJson:function(e){function t(e){try{for(var t=JSON.stringify(JSON.parse(e)),n=t.split('"'),i=0;i<n.length;i++){var r=n[i];for(r=r.replace(/:/g,": "),r=r.replace(/,/g,", "),n[i]=r,i++;i<n.length&&"\\"==n[i].charAt(n[i].length-1);)i++}return n.join('"')}catch(a){return e}}var n=JSON.stringify(e,null,"	");return n=n.replace(/\{[^\{,}]*\}/g,t),n=n.replace(/\[[^\[,\]]*\]/g,t),n=n.replace(/\[[^\{\[\}\]]*\]/g,t)}};!function(){var e=0;$.getUniqueKey=function(){return e++}}();for(var B in $.logLevel)$.logLevel[$.logLevel[B]]=$.logLevel[$.logLevel[B]]||B;e.getMonitorKey=$.getUniqueKey,e.getKeyVariant=function(e,t){return $.getKeyVariant(e,"~"+t)},e.keyIsVariant=$.keyIsVariant,e.log=function(e,t){if("number"!=typeof e)throw alert("First argument to log() must be a number (preferably enum value from .logLevel)"),new Error("First argument to log() must be a number (preferably enum value from .logLevel)");$.log(e,t)},e.setLogFunction=function(e){$.log=e},e.logLevel=$.logLevel,e.encodeData=$.encodeData,e.decodeData=$.decodeData,e.encodePointerComponent=$.encodePointerComponent,e.decodePointerComponent=$.decodePointerComponent,e.splitPointer=$.splitPointer,e.joinPointer=$.joinPointer,e.escapeHtml=$.escapeHtml,e.prettyJson=$.prettyJson,e.extend=function(t){for(var n in t)void 0==e[n]&&(e[n]=t[n])},u.prototype={add:function(e,t){if("string"!=typeof e&&"number"!=typeof e)throw new Error("First argument must be a monitorKey, obtained using getMonitorKey()");this.contents[e]=t,this.addKey(e)},addKey:function(e){var t;for(t=0;t<this.keyOrder.length;t++){var n=this.keyOrder[t];if(n==e)return;if($.keyIsVariant(e,n))return this.keyOrder.splice(t,0,e),void 0}this.keyOrder.push(e)},remove:function(e){delete this.contents[e],this.removeKey(e);var t=e+".";for(var n in this.contents)n.substring(0,t.length)==t&&(this.removeKey(n),delete this.contents[n])},removeKey:function(e){var t=this.keyOrder.indexOf(e);t>=0&&this.keyOrder.splice(t,1)},notify:function(){for(var e=arguments,t=0;t<this.keyOrder.length;t++){var n=this.keyOrder[t],i=this.contents[n];i.apply(this.context,e)}},isEmpty:function(){var e;for(e in this.contents)if(0!==this.contents[e].length)return!1;return!0}},h.prototype={add:function(e){this.listeners[this.listeners.length]=e},notify:function(){for(var e=arguments;this.listeners.length>0;){var t=this.listeners.shift();t.apply(this.context,e)}},isEmpty:function(){return 0===this.listeners.length}};var G={depth:0,callbacks:[],increment:function(){this.depth++},decrement:function(){if(this.depth--,this.depth<0)throw new Error("DelayedCallbacks.depth cannot be < 0");for(;0==this.depth&&this.callbacks.length>0;){var e=this.callbacks.shift();this.depth++,e(),this.depth--}},add:function(e){this.depth++,this.callbacks.push(e),this.decrement()}};"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")}),e.ajaxFunction=function(e,t){var n=e.url,i=e.data,r=e.encType,a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(a.status>=200&&a.status<300){var e=a.responseText||null;try{e=JSON.parse(e)}catch(n){if(204!=a.status)return t(n,e),void 0;e=null}var i=a.getAllResponseHeaders();if(""==i){i=[];for(var r=["Cache-Control","Content-Language","Content-Type","Expires","Last-Modified","Pragma"],s=0;s<r.length;s++){var o=a.getResponseHeader(r[s]);""!=o&&null!=o&&i.push(r[s]+": "+o)}i=i.join("\n")}t(null,e,i)}else{var e=a.responseText||null;try{e=JSON.parse(e)}catch(n){}var i=a.getAllResponseHeaders();if(""==i){i=[];for(var r=["Cache-Control","Content-Language","Content-Type","Expires","Last-Modified","Pragma"],s=0;s<r.length;s++){var o=a.getResponseHeader(r[s]);""!=o&&null!=o&&i.push(r[s]+": "+o)}i=i.join("\n")}t(new f(a.status,a),e,i)}},a.open(e.method,n,!0),a.setRequestHeader("Content-Type",r),a.setRequestHeader("If-Modified-Since","Thu, 01 Jan 1970 00:00:00 GMT"),a.send(i)},function(){var t={},n={},i=function(e,i){return void 0!==i?(t[e]=i,n[e]=(new Date).getTime(),void 0):t[e]};i.cacheSeconds=10,i.empty=function(e){return},i.invalidate=function(e){"string"==typeof e&&(e=$.resolveRelativeUri(e));for(var n in t){var i=t[n],r=i.url;"string"==typeof e?-1!=r.indexOf(e)&&i.invalidate():e.test(r)&&i.invalidate()}},e.defaultCache=i,e.invalidate=i.invalidate}(),l.prototype={},e.addToCache=d,e.getData=function(e,t,n){"string"==typeof e&&(e={url:e});var i=c(e.url,e.method,e.data,e.encType,null,n).fragmentRequest;return void 0!=t&&i.getData(t),i},e.isRequest=function(e){return e instanceof p||e instanceof l};var X=$.getUniqueKey();f.prototype=new Error,e.HttpError=f,p.prototype={beingUsed:function(){return void 0==this.baseContext?($.log($.logLevel.DEBUG,"No base context: "+this.url),!0):this.baseContext.retainCount()>0},getResponse:function(e){this.responseListeners.add(e),this.checkForFullResponse()},checkForFullResponse:function(){this.document.raw.defined()&&this.responseListeners.notify(this.document.raw,this)},ajaxSuccess:function(e,t,n){this.fetched=!0;var i=this;i.successful=!0,$.log($.logLevel.STANDARD,"Request success: "+this.url);for(var r=t.replace(/\r\n/g,"\n").split("\n"),a={},s=null,o={},u=0;u<r.length;u++){var h=r[u].split(": ")[0];if(""!=h){var l=r[u].substring(h.length+2);"\r"==l[l.length-1]&&(l=l.substring(0,l.length-1)),h=h.toLowerCase();for(var c=l.split(", "),d=0;d<c.length;d++){var l=c[d];void 0==a[h]?a[h]=l:"object"==typeof a[h]?a[h].push(l):a[h]=[a[h],l]}}}$.log($.logLevel.DEBUG,"headers: "+JSON.stringify(a,null,4));for(var s=a["content-type"].split(";")[0],f=a["content-type"].substring(s.length+1);f.length>0;){f=f.replace(/^,\s*/,"");var p=f.split("=",1)[0];if(f=f.substring(p.length+1).trim(),p=p.trim(),""!=p)if('"'===f.charAt(0)){partValue=/^"([^\\"]|\\.)*("|$)/.exec(f)[0],f=f.substring(partValue.length).trim();try{o[p]=JSON.parse(partValue)}catch(v){o[p]=partValue}}else partValue=/^[^,]*/.exec(f)[0],f=f.substring(partValue.length).trim(),o[p]=partValue}if(i.headers=a,i.contentType=s,i.contentTypeParameters=o,i.document.setRaw(e),i.profileUrl=null,i.document.raw.removeSchema(X),void 0!=o.profile){var m=o.profile;m=$.resolveRelativeUri(i.url,m),i.profileUrl=m,i.document.raw.addSchema(m,X)}else void 0!=n&&i.document.raw.addSchema(n,X);if(void 0!=o.root){var g={href:o.root,rel:"root"};i.document.raw.addLink(g)}if(a.link)for(var y="object"==typeof a.link?a.link:[a.link],u=0;u<y.length;u++){var g=y[u],b=g.trim().split(";"),S=b.shift().trim();S=S.substring(1,S.length-1);for(var x={href:S},d=0;d<b.length;d++){var w=b[d],O=w.substring(0,w.indexOf("=")),l=w.substring(O.length+1);O=O.trim(),'"'==l.charAt(0)&&(l=JSON.parse(l)),"type"==O&&(O="mediaType"),x[O]=l}i.document.raw.addLink(x)}i.checkForFullResponse(),i.waitingForRoot=!0,i.document.raw.whenSchemasStable(function(){delete i.waitingForRoot;var e=i.document.raw.getLink("root");if(void 0!=e){var t=decodeURI(e.href.substring(e.href.indexOf("#")+1));i.document.setRoot(t)}else i.document.setRoot("")})},ajaxError:function(e,t){this.fetched=!0;var n=this;n.successful=!1,n.error=e,$.log($.logLevel.WARNING,"Error fetching: "+this.url+" ("+e.message+")"),n.document.error=e,n.document.setRaw(t),n.document.raw.whenSchemasStable(function(){n.checkForFullResponse(),n.document.setRoot("")})},fetchData:function(t,n,i,r,a){q.log(q.logLevel.DEBUG,"Document "+this.document.uniqueId+" is unstable");var s=new h(this);this.document.whenStable=function(e){return s.add(e),this};var o=this;this.successful=null;var u=t,l=i;if("GET"!=n&&"DELETE"!=n||void 0==l||""==l||(u+=-1==u.indexOf("?")?"?":"&",u+=l,l=void 0),e.config.antiCacheUrls){var c="_="+Math.random();u+=-1==u.indexOf("?")?"?"+c:"&"+c}var d={url:u,data:l,encType:r,method:n};e.ajaxFunction(d,function(t,n,i){t?o.ajaxError(t,n):(o.ajaxSuccess(n,i,a),"PUT"==d.method&&e.invalidate(d.url)),q.log(q.logLevel.DEBUG,"Document "+o.document.uniqueId+" is stable"),delete o.document.whenStable,s.notify(o.document)})}},v.prototype=p.prototype,m.prototype={isEmpty:function(){return 0==this.operations.length},each:function(e){for(var t=0;t<this.operations.length;t++)e.call(this,t,this.operations[t]);return this},plain:function(){for(var e=[],t=0;t<this.operations.length;t++)e[t]=this.operations[t].plain();return e},condense:function(){},filterImmediate:function(){for(var e=new m(this.prefix),t=0;t<this.operations.length;t++){var n=this.operations[t];n.immediateChild(this.prefix)&&e.operations.push(n)}return e},filter:function(e){e=this.prefix+e;for(var t=new m(e),n=0;n<this.operations.length;n++){var i=this.operations[n];i.hasPrefix(e)&&t.operations.push(i)}return t},filterRemainder:function(e){e=this.prefix+e;for(var t=new m(this.prefix),n=0;n<this.operations.length;n++){var i=this.operations[n];i.hasPrefix(e)||t.operations.push(i)}return t},replace:function(e,t){var n=new g("replace",e,t);return this.operations.push(n),this},add:function(e,t){var n=new g("add",e,t);return this.operations.push(n),this},remove:function(e){var t=new g("remove",e);return this.operations.push(t),this},move:function(e,t){var n=new g("move",e,t);return this.operations.push(n),this},inverse:function(){for(var e=new m(this.prefix),t=0;t<this.operations.length;t++)e.operations[t]=this.operations[t].inverse();return e.operations.reverse(),e}},g.prototype={action:function(){return this._patchType},value:function(){return this._value},subject:function(){return this._subject},setSubjectValue:function(e){return this._subjectValue=e,this},subjectValue:function(){return this._subjectValue},inverse:function(){switch(this._patchType){case"replace":return new g("replace",this._subject,this._subjectValue);case"add":return new g("remove",this._subject).setSubjectValue(this._value);case"remove":return new g("add",this._subject,this._subjectValue);case"move":return new g("move",this._target,this._subject);default:throw new Error("Unrecognised patch type for inverse: "+this._patchType)}},depthFrom:function(e){"object"==typeof e&&(e=e.pointerPath());var t=0/0;if(this._subject.substring(0,e.length)==e){var n=this._subject.substring(e.length);0==n.length?t=0:"/"==n.charAt(0)&&(t=n.split("/").length)}if(void 0!=this._target&&this._target.substring(0,e.length)==e){var i,n=this._target.substring(e.length);0==n.length?i=0:"/"==n.charAt(0)&&(i=n.split("/").length),!isNaN(i)&&t>i&&(t=i)}return t},subjectEquals:function(e){return this._subject==e},subjectChild:function(e){if(e+="/",this._subject.substring(0,e.length)==e){var t=this._subject.substring(e.length);if(-1==t.indexOf("/"))return $.decodePointerComponent(t)}return!1},subjectRelative:function(e){return e+="/",this._subject.substring(0,e.length)==e?this._subject.substring(e.length-1):!1},target:function(){return this._target},targetEquals:function(e){return this._target==e},targetChild:function(e){if(void 0!=this._target){if(e+="/",this._target.substring(0,e.length)==e){var t=this._target.substring(e.length);if(-1==t.indexOf("/"))return $.decodePointerComponent(t)}return!1}},targetRelative:function(e){return e+="/",this._target.substring(0,e.length)==e?this._target.substring(e.length-1):!1},plain:function(){var e={};return e[this._patchType]=this._subject,"remove"==this._patchType||("move"==this._patchType?e.to=this._target:e.value=this._value),e},matches:function(e){return this._subject==e?!0:"move"==this._patchType&&this._target==e?!0:!1},hasPrefix:function(e){return"object"==typeof e&&(e=e.pointerPath()),this.matches(e)?!0:(e+="/",this._subject.substring(0,e.length)==e?!0:"move"==this._patchType&&this._target.substring(0,e.length)==e?!0:!1)}};var W=[];e.registerChangeListener=function(e){W.push(e)};var Q=!1,Y=[];e.batch=function(t){return void 0!=t?(e.batch(),t(),e.batchDone(),this):(Q=!0,this)},e.batchDone=function(){for(Q=!1;Y.length>0;){var e=Y.shift(),t=e.batchPatch;delete e.batchPatch,e.patch(t)}return this},y.prototype={resolveUrl:function(e){return t.resolve(this.url,e)},get:function(e){return this.root.get(e)},set:function(e,t){return this.root.set(e,t),this},move:function(e,t){var n=new m;return n.move(e,t),this.patch(n),this},whenStable:function(e){return e.call(this,this),this}};var z=/^(0|[1-9]\d*)$/,Z="meta-schema-key",et=0;S.prototype={referenceUrl:function(){if(this.document.isDefinitive){var e=this.pointerPath();if(""==e||"/"==e.charAt(0))return this.document.url+"#"+encodeURI(this.pointerPath())}},subPath:function(e){var t=e.split("/");if(""!=t[0])throw new Error("Path must begin with / (or be empty): "+e);for(var n=this,i=1;i<t.length;i++)t[i]=$.decodePointerComponent(t[i]),n="array"==n.basicType()?n.index(t[i]):n.property(t[i]);return n},defined:function(){return void 0!=this.basicType()},setValue:function(e){if("undefined"==typeof e)return this.remove();if("object"!=this.basicType()&&"array"!=this.basicType()&&this.value()===e)return this;var t=new m;return this.defined()?t.replace(this.pointerPath(),e):t.add(this.pointerPath(),e),this.document.patch(t,this),this},remove:function(){var e=new m;return e.remove(this.pointerPath()),this.document.patch(e,this),this},itemValue:function(e){return this.index(e).value()},removeItem:function(e){return this.index(e).remove(),this},insertItem:function(e,t){if("array"!=this.basicType())throw Error("cannot insert into a non-array");var n=new m;return n.add(this.item(e).pointerPath(),t),this.document.patch(n,this),this},push:function(e){if("array"!=this.basicType())throw new Error("Can only push() on an array");return this.index(this.length()).setValue(e),this},propertyValue:function(e){return this.property(e).value()},removeProperty:function(e){return this.property(e).remove(),this},moveTo:function(e){if("object"==typeof e){if(e.document!=this.document){var t=this.value();return this.remove(),e.setValue(t),e}e=e.pointerPath()}var n=new m,i=this.pointerPath();return e!=i?(n.move(i,e),this.document.patch(n,this),this.document.root.subPath(e)):void 0},getLink:function(e){var t=this.links(e);return t[0]},equals:function(e){var t,n=this.basicType();if(n!=e.basicType())return!1;if("array"==n){if(this.length()!==e.length())return!1;for(t=0;t<this.length();t++)if(!this.index(t).equals(e.index(t)))return!1;return!0}if("object"==n){var t,i=this.keys(),r=e.keys();if(i.length!=r.length)return!1;for(i.sort(),r.sort(),t=0;t<i.length;t++)if(i[t]!==r[t])return!1;for(t=0;t<i.length;t++){var a=i[t];if(!this.property(a).equals(e.property(a)))return!1}return!0}return this.value()===e.value()},readOnlyCopy:function(){if(this.readOnly(!1))return this;var t=e.create(this.value(),this.document.url+"#:copy",!0);return this.schemas().each(function(e,n){t.addSchema(n)}),t},editableCopy:function(){var t=e.create(this.value(),this.document.url+"#:copy",!1),n=$.getUniqueKey();return this.schemas().fixed().each(function(e,i){t.addSchema(i,n)}),t},asSchema:function(){var e=this.readOnlyCopy(),t=new O(e);return this.readOnly(!1)&&o(this,{asSchema:t}),e.property("$ref").defined()||e.addSchema("http://json-schema.org/hyper-schema",Z),t},asLink:function(e){var t,n=this.readOnlyCopy(),i=new k(n);return t=void 0==e?i.linkForData(this):i.linkForData(e),this.readOnly(!1)&&o(this,{asLink:t}),t},items:function(e){for(var t=0;t<this.length();t++){var n=this.index(t);e.call(n,t,n)}return this},properties:function(e,t,n){var i;if("function"==typeof e&&(t=e,e=this.keys()),t)for(var r=0;r<e.length;r++){var a=this.property(e[r]);t.call(a,e[r],a)}if(n){"function"!=typeof n&&(n=t);for(var i=this.keys(),r=0;r<i.length;r++)if(-1==e.indexOf(i[r])){var a=this.property(i[r]);n.call(a,i[r],a)}}return this},resolveUrl:function(e){for(var n=this;n;){var i=n.getLink("self");if(i)return t.resolve(i.href,e);n=n.parent()}return this.document.resolveUrl(e)},get:function(e){return this.subPath(e).value()},set:function(e,t){return this.subPath(e).setValue(t),this},json:function(){return JSON.stringify(this.value())},whenStable:function(e){var t=this;return this.document.whenStable(function(){e.call(t,t)}),this}},S.prototype.indices=S.prototype.items,S.prototype.indexValue=S.prototype.itemValue,S.prototype.removeIndex=S.prototype.removeItem,S.prototype.index=function(e){return this.item(e)},e.extendData=function(e){for(var t in e)void 0==S.prototype[t]&&(S.prototype[t]=e[t])},e.create=function(e,t,n){var e="object"==typeof e?JSON.parse(JSON.stringify(e)):e,i=void 0!=t&&n;if(void 0!=t&&-1!=t.indexOf("#")){var r=t.substring(t.indexOf("#")+1);""!=r&&(i=!1),t=t.substring(0,t.indexOf("#"))}var a=new y(t,i,n);return a.setRaw(e),a.setRoot(""),a.root},e.isData=function(e){return e instanceof S},S.prototype.deflate=function(){return this.document.deflate(),{document:this.document.deflate(),path:this.pointerPath()}},y.prototype.deflate=function(){if(this.isDefinitive)return this.url;var e=this.raw,t=[];e.schemas().each(function(e,n){void 0!=n.referenceUrl()?t.push(n.referenceUrl()):t.push(n.data.deflate())});var n={baseUrl:this.url,readOnly:this.readOnly,value:e.value(),schemas:t,root:this.rootPath()};return n},e.inflate=function(t,n){if(void 0!==t.path&&void 0!==t.document)return e.inflate(t.document).root.subPath(t.path);if("string"==typeof t){var i=c(t).request;return n&&i.document.getRoot(function(e){e.whenSchemasStable(function(){n(null,i.document)})}),i.document}for(var r=e.create(t.value,t.baseUrl,t.readOnly),a=0;a<t.schemas.length;a++){var s=t.schemas[a];if("object"==typeof s)var s=e.inflate(s).asSchema();r.addSchema(s)}r.document.setRoot(t.root);var o=r.document;return n&&n(null,o),o},e.createSchema=function(t,n){var i=e.create(t,n,!0);return i.asSchema()},e.isSchema=function(e){return e instanceof O},e.getSchema=x;var tt=["null","boolean","integer","number","string","array","object"],nt={};O.prototype={toString:function(){return"<Schema "+this.data+">"},referenceUrl:function(e){return e&&this.data.property("$ref").defined()?this.data.resolveUrl(this.data.propertyValue("$ref")):this.data.referenceUrl()},isFull:function(){var e=this.data.propertyValue("$ref");return void 0===e},getFull:function(e){var t=this.data.propertyValue("$ref");if(void 0===t)return e&&e.call(this,this,void 0),this;if(t=this.data.resolveUrl(t),"#"!=t.charAt(0)||1!=t.length&&"/"!=t.charAt(1)){if(!e){var n=this;return this.getFull(function(e){n=e}),n}if("#"==t.charAt(0)){var i=decodeURIComponent(t.substring(1)),r=this.data.document;r.getFragment(i,function(t){var n=t.asSchema();e.call(n,n,null)})}else x(t,e)}else{var a=this.data.document.root,s=decodeURIComponent(t.substring(1)),o=a.subPath(s).asSchema();if(!e)return o;e.call(o,o,null)}},title:function(){return this.data.propertyValue("title")||null},forceTitle:function(){var e=this.data.propertyValue("title")||null;if(null===e){if(this.enumData().defined())return"enum";var t=this.basicTypes();if(1==t.length){if("array"!=t[0]||this.tupleTyping())return t[0];var n=this.indexSchemas(0),i=n.forceTitle();if(i)return"array of "+i+" items"}}return e},hasDefault:function(){return this.data.property("default").defined()},defaultValue:function(){return this.data.propertyValue("default")},propertySchemas:function(e){var t=[],n=this.data.property("properties").property(e);return n.defined()&&t.push(n.asSchema().getFull()),this.data.property("patternProperties").properties(function(n,i){var r=new RegExp(n);r.test(e)&&t.push(i.asSchema().getFull())}),0==t.length&&(n=this.data.property("additionalProperties"),n.defined()&&t.push(n.asSchema().getFull())),new D(t)},propertyDependencies:function(e){var t=this.data.property("dependencies");if(t.defined()){var n=t.property(e);if(n.defined())return"string"==n.basicType()?[n.value()]:"array"==n.basicType()?n.value():[n.asSchema()]}return[]},itemSchemas:function(e){var t,n=this.data.property("items");if(!n.defined())return new D;if("array"==n.basicType()?(t=n.index(e),t.defined()||(t=this.data.property("additionalItems"))):t=n,t.defined()){var i=t.asSchema().getFull();return new D([i])}return new D},tupleTyping:function(){var e=this.data.property("items");return"array"==e.basicType()?e.length():0},andSchemas:function(){var e=[],t=this.data.property("extends");return t.defined()&&("array"==t.basicType()?t.indices(function(t,n){e.push(n.asSchema())}):e.push(t.asSchema())),this.data.property("allOf").items(function(t,n){e.push(n.asSchema())}),new D(e)},notSchemas:function(){var t=[],n=this.data.property("disallow");return n.defined()&&("array"==n.basicType()?n.indices(function(n,i){"string"==i.basicType()?t.push(e.createSchema({type:i.value()})):t.push(i.asSchema())}):"string"==n.basicType()?t.push(e.createSchema({type:n.value()})):t.push(n.asSchema())),this.data.property("not").defined()&&t.push(this.data.property("not").asSchema()),t},types:function(){var e=this.data.property("type");if(e.defined()){if("string"===e.basicType())return"all"==e.value()?tt.slice(0):[e.value()];for(var t=[],n=0;n<e.length();n++){if("string"!=e.item(n).basicType())return tt.slice(0);if("all"==e.item(n).value())return tt.slice(0);t.push(e.item(n).value())}return-1!=t.indexOf("number")&&-1==t.indexOf("integer")&&t.push("integer"),t}return tt.slice(0)},xorSchemas:function(){var e=[],t=this.data.property("type");if(t.defined())for(var n=0;n<t.length();n++)if("string"!=t.item(n).basicType()){var i=[];t.items(function(e,t){"string"==t.basicType()?i.push(w(t.value())):i.push(t.asSchema())}),e.push(i);break}if(this.data.property("oneOf").defined()){var i=[];this.data.property("oneOf").items(function(e,t){i.push(t.asSchema())}),e.push(i)}return e},orSchemas:function(){var e=[];if(this.data.property("type"),this.data.property("anyOf").defined()){var t=[];this.data.property("anyOf").items(function(e,n){t.push(n.asSchema())}),e.push(t)}return e},equals:function(e,t){var n=this;if(t&&(e=e.getFull(),n=this.getFull()),n===e)return!0;var i=n.referenceUrl(),r=e.referenceUrl();return t&&!n.isFull()&&(i=n.data.resolveUrl(this.data.propertyValue("$ref"))),t&&!e.isFull()&&(r=e.data.resolveUrl(e.data.propertyValue("$ref"))),void 0!==i&&void 0!==r?$.urlsEqual(i,r):this.data.equals(e.data)},readOnly:function(){return!(!this.data.propertyValue("readOnly")&&!this.data.propertyValue("readonly"))},enumValues:function(){return this.data.propertyValue("enum")},enumData:function(){return this.data.property("enum")},minItems:function(){var e=this.data.propertyValue("minItems");return void 0==e?0:e},maxItems:function(){return this.data.propertyValue("maxItems")},tupleTypingLength:function(){return"array"!=this.data.property("items").basicType()?0:this.data.property("items").length()},minLength:function(){var e=this.data.propertyValue("minLength");return void 0==e?0:e},maxLength:function(){return this.data.propertyValue("maxLength")},pattern:function(){var e=this.data.propertyValue("pattern");return void 0!==e?new RegExp(e):null},numberInterval:function(){return this.data.propertyValue("divisibleBy")},minimum:function(){return this.data.propertyValue("minimum")},exclusiveMinimum:function(){return!!this.data.propertyValue("exclusiveMinimum")},maximum:function(){return this.data.propertyValue("maximum")},exclusiveMaximum:function(){return!!this.data.propertyValue("exclusiveMaximum")},minProperties:function(){var e=this.data.propertyValue("minProperties");return void 0==e?0:e},maxProperties:function(){return this.data.propertyValue("maxProperties")},definedProperties:function(e){if(e)return this.definedProperties(),this.definedProperties(e);var t=this.data.property("properties").keys();return this.definedProperties=function(e){e=e||[];for(var n=[],i=0;i<t.length;i++)-1==e.indexOf(t[i])&&n.push(t[i]);return n},t.slice(0)},knownProperties:function(e){if(e)return this.knownProperties(),this.knownProperties(e);var t={};this.data.property("properties").properties(function(e){t[e]=!0});for(var n=this.requiredProperties(),i=0;i<n.length;i++)t[n[i]]=!0;var r=Object.keys(t);return this.knownProperties=function(e){e=e||[];for(var t=[],n=0;n<r.length;n++)-1==e.indexOf(r[n])&&t.push(r[n]);return t},r.slice(0)},requiredProperties:function(){var e=this.data.propertyValue("required");"object"!=typeof e&&(e=[]);var t=this.data.property("properties");return void 0!=t&&t.properties(function(t,n){var i=n.property("required");void 0!=i&&"boolean"==i.basicType()&&i.value()&&e.push(t)}),e},allowedAdditionalProperties:function(){return!(this.data.propertyValue("additionalProperties")===!1)},getLink:function(e){for(var t=this.links(),n=0;n<t.length;n++)if(t[n].rel()==e)return t[n]},asList:function(){return new D([this])},format:function(){return this.data.propertyValue("format")},createValue:function(){var e=this.asList();return e.createValue.apply(e,arguments)},createData:function(){var e=this.asList();return e.createData.apply(e,arguments)}},O.prototype.basicTypes=O.prototype.types,O.prototype.extendSchemas=O.prototype.andSchemas,O.prototype.indexSchemas=O.prototype.itemSchemas,O.prototype.isComplete=O.prototype.isFull,e.extendSchema=function(e){for(var t in e)void 0==O.prototype[t]&&(O.prototype[t]=e[t])};var it={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};k.prototype={addHandler:function(e){return this.handlers.unshift(e),this},addPreHandler:function(e){return this.preHandlers.push(e),this},canApplyTo:function(e){var t,n,i=null;for(t=0;t<this.dataParts.length;t++){if(n=this.dataParts[t],null===n?i=e:"object"==e.basicType()?i=e.property(n):"array"==e.basicType()&&b(n)&&(i=e.index(n)),void 0==i||!i.defined())return!1;if("null"==i.basicType())return!1}return!0},linkForData:function(e){var t=this.data.value(),n=this.uriTemplate.fill(function(t){return t=C(t),null==t?e.value():"array"==e.basicType()?e.itemValue(t):e.propertyValue(t)});return t.href=e.resolveUrl(n),t.rel=t.rel.toLowerCase(),t.title=t.title,new T(t,this,e)},usesKey:function(e){var t;for(t=0;t<this.dataParts.length;t++)if(this.dataParts[t]===e||null===this.dataParts[t])return!0;return!1},rel:function(){return this.data.propertyValue("rel").toLowerCase()}};var rt=[],at=[];e.addLinkHandler=function(e){rt.unshift(e)},e.addLinkPreHandler=function(e){at.push(e)};var st=$.getUniqueKey();T.prototype={toString:function(){return this.href},createSubmissionData:function(t,n){"function"==typeof t&&(n=t,t=void 0);var i=this.hrefBase,r=this.submissionSchemas;if(void 0!=n&&0==r.length&&"PUT"==this.method)return q.getData(this.href,function(e){n(t||e.editableCopy())}),this;if(void 0==n){for(var a=r.createValue(t),s=e.create(a,i),o=0;o<r.length;o++)s.addSchema(r[o],st);return s}r.createValue(t,function(t){for(var a=e.create(t,i),s=0;s<r.length;s++)a.addSchema(r[s],st);n(a)})},follow:function(t,n){"function"==typeof t&&(n=t,t=void 0),void 0!==t?t instanceof S||(t=e.create(t)):t=e.create(void 0);for(var i=at.concat(this.definition.preHandlers),r=0;r<i.length;r++){var a=i[r];if(a.call(this,this,t)===!1)return $.log($.logLevel.DEBUG,"Link cancelled: "+this.href),null}var s=t.value(),o=e.getData({url:this.href,method:this.method,data:s,encType:this.encType},null,this.targetSchema);t=t.readOnlyCopy();var u=this.definition.handlers.concat(rt);void 0!==n&&u.unshift(n);for(var r=0;r<u.length;r++){var a=u[r];if("function"!=typeof a){if(a)continue;break}if(a.call(this,this,t,o)===!1)break}return o},valueForUrl:function(e){function t(e,t){t=t.getFull();var n=t.types();return-1!=n.indexOf("null")&&"null"==e?null:-1==n.indexOf("boolean")||"true"!=e&&"false"!=e?-1!=n.indexOf("string")?e:-1==n.indexOf("number")||isNaN(parseFloat(e))?-1!=n.indexOf("integer")&&0==parseFloat(e)%1?parseFloat(e):n.indexOf("object")?q.decodeData(e):void 0:parseFloat(e):"true"==e}var n=this.definition.uriTemplate,i=n.fromUri(e),r={},a=this.subjectData.schemas();for(var s in i){var o=i[s],u=C(s);if(null==u){if("string"==typeof o&&(o=t(o,a)),void 0===o)return void 0;r=o}else{if("string"==typeof o&&(o=t(o,a.propertySchemas(u))),void 0===o)return void 0;r[u]=o}}return r}},I.prototype={setupXorSelectors:function(){var e=this;this.xorSelectors={};for(var t=this.schema.xorSchemas(),n=0;n<t.length;n++){var i=new V($.getKeyVariant(this.monitorKey,"xor"+n),t[n],this.data);this.xorSelectors[n]=i,i.onMatchChange(function(){e.update()},!1)}},setupOrSelectors:function(){var e=this;this.orSelectors={};for(var t=this.schema.orSchemas(),n=0;n<t.length;n++){var i=new M($.getKeyVariant(this.monitorKey,"or"+n),t[n],this.data);this.orSelectors[n]=i,i.onMatchChange(function(){e.update()},!1)}},setupAndMatches:function(){var e=this;this.andMatches=[];var t=this.schema.andSchemas();t.each(function(t,n){var i=$.getKeyVariant(e.monitorKey,"and"+t),r=e.data.addSchemaMatchMonitor(i,n,function(){e.update()},!1,!0);e.andMatches.push(r)})},setupNotMatches:function(){var e=this;this.notMatches=[];for(var t=this.schema.notSchemas(),n=0;n<t.length;n++)!function(t,n){var i=$.getKeyVariant(e.monitorKey,"not"+t),r=e.data.addSchemaMatchMonitor(i,n,function(){e.update()},!1,!0);e.notMatches.push(r)}(n,t[n])},addMonitor:function(e,t){return this.monitors.add(this.monitorKey,e),t!==!1&&e.call(this.schema,this.match,this.matchFailReason),this},dataUpdated:function(e){if(this.schemaLoaded){var t=this;if("object"==this.data.basicType()){this.indexMatches={},this.data.properties(function(e,n){if(void 0==t.propertyMatches[e]){var i=[],r=t.schema.propertySchemas(e);r.each(function(a){var s=n.addSchemaMatchMonitor(t.monitorKey,r[a],function(){t.subMatchUpdated(e,s)},!1,!0);i.push(s)}),t.propertyMatches[e]=i,t.addDependencies(e)}});var n=[];for(var e in this.propertyMatches)this.data.property(e).defined()||n.push(e);for(var i=0;i<n.length;i++){var e=n[i];delete this.propertyMatches[e],void 0!=this.dependencyKeys[e]&&(this.data.removeSchema(this.dependencyKeys[e]),delete this.dependencies[e],delete this.dependencyKeys[e])}}else if("array"==this.data.basicType()){this.propertyMatches={},this.data.indices(function(n,i){if(void 0==t.indexMatches[n]){var r=[],a=t.schema.indexSchemas(n);a.each(function(n){var s=i.addSchemaMatchMonitor(t.monitorKey,a[n],function(){t.subMatchUpdated(e,s)},!1,!0);r.push(s)}),t.indexMatches[n]=r}});var n=[];for(var e in this.indexMatches)this.data.length()<=e&&n.push(e);for(var i=0;i<n.length;i++)delete this.indexMatches[n[i]]}else this.propertyMatches={},this.indexMatches={};this.update()}},addDependencies:function(e){var t=this,n=this.schema.propertyDependencies(e);this.dependencies[e]=[],this.dependencyKeys[e]=[];for(var i=0;i<n.length;i++){var r=n[i];"string"==typeof r?this.dependencies[e].push(r):function(n){var i=$.getKeyVariant(t.monitorKey,"dep:"+e+":"+n);t.dependencyKeys[e].push(i);var a=t.data.addSchemaMatchMonitor(i,r,function(){t.dependencyUpdated(e,n)},!1,!0);t.dependencies[e].push(a)}(i)}},notify:function(){this.monitors.notify(this.match,this.matchFailReason)},setMatch:function(e,t){var n=this,i=this.match,r=this.matchFailReason;return this.match=e,this.matchFailReason=e?null:t,this.impatientCallbacks?this.notify():(this.pendingNotify||(this.pendingNotify=!0,G.add(function(){n.pendingNotify=!1,n.match&&i||(n.match||i||!n.matchFailReason.equals(r))&&n.notify()})),void 0)},subMatchUpdated:function(){this.update()},subMatchRemoved:function(){this.update()},dependencyUpdated:function(){this.update()},update:function(){try{this.matchAgainstBasicTypes(),this.matchAgainstSubMatches(),this.matchAgainstImmediateConstraints(),this.setMatch(!0)}catch(e){if(!(e instanceof L))throw e;this.setMatch(!1,e)}},matchAgainstBasicTypes:function(){for(var e=this.data.basicType(),t=0;t<this.basicTypes.length;t++)if(this.basicTypes[t]==e||"integer"==e&&"number"==this.basicTypes[t])return;
throw new L("Data does not match any of the basic types: "+this.basicTypes,this.schema)},matchAgainstSubMatches:function(){for(var e=0;e<this.andMatches.length;e++){var t=this.andMatches[e];if(!t.match){var n="extended schema #"+e+": "+t.message;throw new L(n,this.schema,t.failReason)}}for(var e=0;e<this.notMatches.length;e++){var i=this.notMatches[e];if(i.match){var n='"not" schema #'+e+" matches";throw new L(n,this.schema)}}for(var r in this.xorSelectors){var a=this.xorSelectors[r];if(null==a.selectedOption){var n="XOR #"+r+": "+a.failReason.message;throw new L(n,this.schema,a.failReason)}}for(var r in this.orSelectors){var a=this.orSelectors[r];if(0==a.selectedOptions.length){var n="OR #"+r+": no matches";throw new L(n,this.schema)}}for(var r in this.propertyMatches)for(var s=this.propertyMatches[r],e=0;e<s.length;e++){var o=s[e];if(!o.match){var n=r+": "+o.matchFailReason.message;throw new L(n,this.schema,o.matchFailReason)}}for(var r in this.indexMatches)for(var s=this.indexMatches[r],e=0;e<s.length;e++){var o=s[e];if(!o.match){var n=r+": "+o.matchFailReason.message;throw new L(n,this.schema,o.matchFailReason)}}},matchAgainstImmediateConstraints:function(){this.matchAgainstEnums(),this.matchAgainstNumberConstraints(),this.matchAgainstArrayConstraints(),this.matchAgainstObjectConstraints()},matchAgainstEnums:function(){var e=this.schema.enumData();if(e.defined()){for(var t=0;t<e.length();t++){var n=e.index(t);if(n.equals(this.data))return}throw new L("Data does not match enum: "+JSON.stringify(e.value())+" ("+JSON.stringify(this.data.value())+")",this.schema)}},matchAgainstNumberConstraints:function(){if("number"==this.data.basicType()||"integer"==this.data.basicType()){var e=this.data.value(),t=this.schema.numberInterval();if(void 0!=t&&0!=e%t)throw new L("Number must be divisible by "+t);var n=this.schema.minimum();if(void 0!==n)if(this.schema.exclusiveMinimum()){if(n>=e)throw new L("Number must be > "+n)}else if(n>e)throw new L("Number must be >= "+n);var i=this.schema.maximum();if(void 0!=i)if(this.schema.exclusiveMaximum()){if(e>=i)throw new L("Number must be < "+i)}else if(e>i)throw new L("Number must be <= "+i)}},matchAgainstArrayConstraints:function(){if("array"==this.data.basicType()){var e=this.schema.minItems();if(void 0!==e&&e>this.data.length())throw new L("Data is not long enough - minimum length is "+e,this.schema);var t=this.schema.maxItems();if(void 0!==t&&t<this.data.length())throw new L("Data is too long - maximum length is "+t,this.schema)}},matchAgainstObjectConstraints:function(){if("object"==this.data.basicType()){for(var e=this.schema.requiredProperties(),t=0;t<e.length;t++){var n=e[t];if(!this.data.property(n).defined())throw new L("Missing key "+JSON.stringify(n),this.schema)}if(0==this.schema.allowedAdditionalProperties())for(var i=this.schema.definedProperties(),r=this.data.keys(),t=0;t<r.length;t++)if(-1==i.indexOf(r[t]))throw new L("Not allowed additional property: "+JSON.stringify(n),this.schema);this.matchAgainstDependencies()}},matchAgainstDependencies:function(){for(var e in this.dependencies)if(void 0!=this.data.property(e))for(var t=this.dependencies[e],n=0;n<t.length;n++){var i=t[n];if("string"==typeof i){if(!this.data.property(i).defined())throw new L("Dependency - property "+JSON.stringify(e)+" requires property "+JSON.stringify(i),this.schema)}else if(!i.match)throw new L("Dependency for "+e,this.schema,i.matchFailReason)}}},L.prototype=new Error,L.prototype.toString=function(){return this.message+" in "+this.schema.title()},L.prototype.equals=function(e){if(!(e instanceof L))return!1;if(null==this.subMatchFailReason){if(null!=e.subMatchFailReason)return!1}else if(null==e.subMatchFailReason||!this.subMatchFailReason.equals(e.subMatchFailReason))return!1;return this.message==e.message&&(null==this.schema&&null==e.schema||null!=this.schema&&null!=e.schema&&this.schema.equals(e.schema))},V.prototype={onMatchChange:function(e,t){return this.matchCallback=e,t!==!1&&e.call(this,this.selectedOption),this},update:function(){for(var e=null,t="No matches",n=0;n<this.subMatches.length;n++)if(this.subMatches[n].match){if(null!=e){t="multiple matches",e=null;break}e=this.options[n],t=null}this.failReason=new L(t),this.selectedOption!=e&&(this.selectedOption=e,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOption))}},M.prototype={onMatchChange:function(e,t){return this.matchCallback=e,t!==!1&&e.call(this,this.selectedOptions),this},update:function(){for(var e=[],t=0;t<this.subMatches.length;t++)this.subMatches[t].match&&e.push(this.options[t]);var n=!1;if(e.length!=this.selectedOptions.length)n=!0;else for(var t=0;t<e.length;t++)if(e[t]!=this.selectedOptions[t]){n=!0;break}n&&(this.selectedOptions=e,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOptions))}};var ot=[];e.registerSchemaChangeListener=function(e){ot.push(e)};var ut={},ht=!1;R.prototype={rel:function(e){if(void 0==e)return this;var t,n=[];for(t=0;t<this.length;t++)this[t].rel===e&&(n[n.length]=this[t]);return new R(n)}};var lt={"null":!0,"boolean":!0,integer:!0,number:!0,string:!0,array:!0,object:!0};D.prototype={indexOf:function(e,t){for(var n=this.length-1;n>=0;){if(e.equals(this[n],t))return n;n--}return n},containsUrl:function(e){if(e instanceof RegExp)for(var t=0;t<this.length;t++){var n=this[t];if(e.test(n.referenceUrl(!0)))return!0}else{e.indexOf("#")<0&&(e+="#");for(var t=0;t<this.length;t++){var n=this[t],i=n.referenceUrl(!0);if(null!=i&&i.substring(i.length-e.length)==e)return!0}}return!1},links:function(e){var t,n,i=[];for(t=0;t<this.length;t++){var n=this[t];i=i.concat(n.links())}return this.links=function(e){for(var t=[],n=0;n<i.length;n++){var r=i[n];(void 0==e||r.rel==e)&&t.push(r)}return t},this.links(e)},each:function(e){for(var t=0;t<this.length;t++)e.call(this,t,this[t]);return this},concat:function(e){for(var t=[],n=0;n<this.length;n++)t.push(this[n]);for(var n=0;n<e.length;n++)t.push(e[n]);return new D(t)},title:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].title();n&&e.push(n)}return e.join(" - ")},forceTitle:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].forceTitle();n&&e.push(n)}return e.join(" - ")},definedProperties:function(e){if(e)return this.definedProperties(),this.definedProperties(e);var t=!0,n={};this.each(function(e,i){if(t){i.allowedAdditionalProperties()||(t=!1,n={});for(var r=i.definedProperties(),a=0;a<r.length;a++)n[r[a]]=!0}else if(!i.allowedAdditionalProperties()){t=!1;for(var s={},r=i.definedProperties(),a=0;a<r.length;a++)n[r[a]]&&(s[r[a]]=!0);n=s}});var i=Object.keys(n);return o(this,{allowedAdditionalProperties:t}),this.definedProperties=function(e){e=e||[];for(var t=[],n=0;n<i.length;n++)-1==e.indexOf(i[n])&&t.push(i[n]);return t},i.slice(0)},knownProperties:function(e){if(e)return this.knownProperties(),this.knownProperties(e);var t;if(this.allowedAdditionalProperties()){t=this.requiredProperties();for(var n=this.definedProperties(),i=0;i<n.length;i++)-1==t.indexOf(n[i])&&t.push(n[i])}else var t=this.definedProperties();return this.knownProperties=function(e){e=e||[];for(var n=[],i=0;i<t.length;i++)-1==e.indexOf(t[i])&&n.push(t[i]);return n},t.slice(0)},allowedAdditionalProperties:function(){var e=!0;return this.each(function(t,n){e=e&&n.allowedAdditionalProperties()}),o(this,{additionalProperties:e}),e},minProperties:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].minProperties();n>e&&(e=n)}return e},maxProperties:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].maxProperties();n>e||(e=n)}return e},types:function(){for(var e=lt,t=0;t<this.length;t++){for(var n=this[t].basicTypes(),i={},r=0;r<n.length;r++){var a=n[r];e[a]&&(i[a]=!0)}e=i}return Object.keys(e)},numberInterval:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].numberInterval();void 0!=n&&(e=void 0==e?n:$.lcm(e,n))}for(var t=0;t<this.length;t++){for(var i=this[t].basicTypes(),r=!1,a=0;a<i.length;a++){if("number"==i[a]){r=!1;break}"integer"==i[a]&&(r=!0)}if(r)return void 0==e?1:$.lcm(e,1)}return o(this,{numberInterval:e}),e},minimum:function(){for(var e=void 0,t=!1,n=0;n<this.length;n++){var i=this[n].minimum();void 0!=i&&(void 0==e||i>e)&&(e=i,t=this[n].exclusiveMinimum())}return o(this,{minimum:e,exclusiveMinimum:t}),e},exclusiveMinimum:function(){return this.minimum(),this.exclusiveMinimum()},maximum:function(){for(var e=void 0,t=!1,n=0;n<this.length;n++){var i=this[n].maximum();void 0!=i&&(void 0==e||e>i)&&(e=i,t=this[n].exclusiveMaximum())}return o(this,{maximum:e,exclusiveMaximum:t}),e},exclusiveMaximum:function(){return this.minimum(),this.exclusiveMinimum()},minLength:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].minLength();n>e&&(e=n)}return o(this,{minLength:e}),e},maxLength:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].maxLength();n>e||(e=n)}return o(this,{maxLength:e}),e},patterns:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].pattern();n&&e.push(n)}return e},minItems:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].minItems();n>e&&(e=n)}return o(this,{minItems:e}),e},maxItems:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].maxItems();n>e||(e=n)}return o(this,{maxItems:e}),e},tupleTypingLength:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].tupleTypingLength();n>e&&(e=n)}return e},requiredProperties:function(){for(var e={},t=[],n=0;n<this.length;n++)for(var i=this[n].requiredProperties(),r=0;r<i.length;r++){var a=i[r];e[a]||(e[a]=!0,t.push(a))}return t},readOnly:function(){for(var e=!1,t=0;t<this.length;t++)if(this[t].readOnly()){e=!0;break}return this.readOnly=function(){return e},e},enumValues:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].enumData();if(n.defined())if(void 0==e)e=[],n.indices(function(t,n){e[t]=n});else{var i=[];n.indices(function(t,n){for(var r=0;r<e.length;r++)e[r].equals(n)&&i.push(n)}),e=i}}if(void 0!=e){for(var r=[],t=0;t<e.length;t++)r[t]=e[t].value();return r}},allCombinations:function(e){function t(){if(v--,0>=v){for(var t=[new D([])],i=0;i<p.length;i++){for(var r=p[i],a=[],s=0;s<r.length;s++)for(var o=0;o<t.length;o++)a.push(t[o].concat(r[s]));t=a}for(var u=0;u<t.length;u++)t[u]=n.concat(t[u]);e(t)}}if(e&&!this.isFull())return this.getFull(function(t){t.allCombinations(e)}),[];for(var n=this,i=this.xorSchemas(),r=0;r<i.length;r++){for(var a=!1,s=0;s<i[r].length;s++){var o=i[r][s];if(this.indexOf(o,!!e)>=0){a=!0;break}}if(!a){for(var u=[],h=1,l=function(){h--,0>=h&&e(u)},s=0;s<i[r].length;s++){var o=i[r][s];if(e)h++,this.concat([o]).allCombinations(function(e){u=u.concat(e),l()});else{var c=this.concat([o]).allCombinations();u=u.concat(c)}}return e&&l(),u}}for(var d=this.orSchemas(),f=null,p=[],v=1,r=0;r<d.length;r++)!function(i){for(var r=[],a=!1,s=0;s<d[i].length;s++){var o=d[i][s];-1==n.indexOf(o,!!e)?r.push(o):a=!0}if(r.length>0){for(var u=[[]],h=0;h<r.length;h++){for(var l=[],c=0;c<u.length;c++)l.push(u[c]),l.push(u[c].concat([r[h]]));u=l}if(a||u.shift(),e){p[i]=[];for(var f=0;f<u.length;f++){var m=new D(u[f]);v++,m.allCombinations(function(e){p[i]=p[i].concat(e),t()})}}else p[i]=u}}(r);for(var f=[new D([])],m=0;m<p.length;m++){for(var g=p[m],y=[],b=0;b<g.length;b++)for(var S=0;S<f.length;S++)y.push(f[S].concat(g[b]));f=y}for(var r=0;r<f.length;r++)f[r]=this.concat(f[r]);return e&&t(),f},createValue:function(t,n,i,r,a){function s(e){if(void 0!==e){var t=$.guessBasicType(e);-1!=y.indexOf(t)||"integer"==t&&-1!=y.indexOf("number")||(e=void 0)}return void 0!==e&&void 0===S&&(S=e),b--,n&&0>=b&&n(S),0>=b?S:void 0}var o=this;if("function"==typeof t){var u=t;t=n,n=u}if(e.isData(t)&&(t=t.value()),"undefined"==typeof a){if(n)return this.createValue(t,function(e){"undefined"==typeof e?o.createValue(t,n,i,r,!1):n(e)},i,r,!0),void 0;var h=this.createValue(t,n,i,r,!0);return"undefined"==typeof h&&(h=this.createValue(t,n,i,r,!1)),h}if(!r){var l=function(){return l=d,t},c=0,d=function(){for(;c<o.length;){var e=o[c++];if(e.hasDefault())return e.defaultValue()}l=p},f=0,p=function(){for(;f<ct.length;){var e=ct[f++];return e(o)}l=null};if(n){var v=function(e){if("undefined"!=typeof e)return n(e);for(;l;){var t=l();if("undefined"!=typeof t)return o.createValue(t,v,i,!0,a)}a?n(void 0):o.createValue(n,void 0,i,!0,a)};return v(void 0)}for(;l;){var m=l();if("undefined"!=typeof m){var g=this.createValue(m,void 0,i,!0,a);if("undefined"!=typeof g)return g}}return a?void 0:this.createValue(void 0,void 0,i,!0,a)}if(i){var y=this.basicTypes(),b=1,S=void 0,x=this.enumValues();if(void 0!=x){for(var w=0;w<x.length;w++)if(("undefined"==typeof t||$.recursiveCompare(t,x[w]))&&(b++,s(x[w])))return S}else{if("undefined"!=typeof t){var O=$.guessBasicType(t);if("integer"==O){var j=y.indexOf("number");-1!==j&&(y.splice(j,1),y.unshift("number"))}var k=y.indexOf(O);-1!==k&&(y.splice(k,1),y.unshift(O))}for(var w=0;"undefined"==typeof S&&w<y.length;w++){b++;var O=y[w];if("null"==O){if(s(null))return S}else if("boolean"==O){var C=this.createValueBoolean(t,a);if(s(C))return!0}else if("integer"==O||"number"==O){var C=this.createValueNumber(t,a);if(s(C))return S}else if("string"==O){var C=this.createValueString(t,a);if(s(C))return S}else if("array"==O)if(n)this.createValueArray(t,function(e){s(e)},a);else{var C=this.createValueArray(t,void 0,a);if(s(C))return S}else if("object"==O)if(n)var C=this.createValueObject(t,function(e){s(e)},a);else{var C=this.createValueObject(t,void 0,a);if(s(C))return S}}}return s(S)}if(null!=n)return this.allCombinations(function(e){function i(s){return s>=e.length?n(void 0):(e[s].createValue(t,function(e){"undefined"!=typeof e?n(e):i(s+1)},!0,r,a),void 0)}i(0)}),void 0;for(var T=this.allCombinations(),w=0;w<T.length;w++){var h=T[w].createValue(t,void 0,!0,r,a);if(void 0!==h)return h}},createValueBoolean:function(e,t){return void 0===e?!0:t&&"boolean"!=typeof e?void 0:!!e},createValueNumber:function(e,t){if(!t&&"string"==typeof e){var n=parseFloat(e);if(isNaN(n))return void 0;e=n}if("number"==typeof e){if(void 0!=o&&0!=e%o&&(e=Math.round(e/o)*o),(void 0==r||e>r||e==r&&!i)&&(void 0==a||a>e||e==a&&s))return e}else if("undefined"!=typeof e)return void 0;var i=this.exclusiveMinimum(),r=this.minimum(),a=this.maximum(),s=this.exclusiveMaximum(),o=this.numberInterval(),u=void 0;if(void 0!=r&&void 0!=a){if(r>a||r==a&&(i||s))return;if(void 0!=o){if(u=Math.ceil(r/o)*o,i&&u==r&&(u+=o),u>a||u==a&&s)return}else u=.5*(r+a)}else void 0!=r?(u=r,void 0!=o&&(u=Math.ceil(u/o)*o),i&&u==r&&(void 0!=o?u+=o:u++)):void 0!=a?(u=a,void 0!=o&&(u=Math.floor(u/o)*o),s&&u==a&&(void 0!=o?u-=o:u--)):u=0;return u},createValueString:function(e,t){var n=[""];if("undefined"!=typeof e)if("string"==typeof e)n.unshift(e);else{if(t)return void 0;if("number"==typeof e)n.unshift(""+e);else{if("boolean"!=typeof e)return void 0;n.unshift(e?"true":"false")}}var i=this.minLength(),r=this.maxLength(),a=this.patterns();if(null!=r&&i>r)return void 0;for(var s=0;s<n.length;s++){var o=n[s];if(o.length<i){var u="?";o+=new Array(i-o.length+1).join(u)}else o.length>r&&(o=o.substring(0,r));for(var h=0;h<a.length;h++)a[h].test(o);return o}},createValueArray:function(e,t,n){if("function"==typeof e){var i=e;e=t,t=i}if("undefined"!=typeof e&&!Array.isArray(e))return void 0;var r=this,a=[],s=this.minItems(),o=this.maxItems();if(!(null!=o&&s>o)){for(var u=1,h=0;a&&s>h;h++)!function(i){u++;var s=Array.isArray(e)?e[i]:void 0;if(t)r.createValueForIndex(i,s,function(e){"undefined"==typeof e?a=void 0:a&&(a[i]=e),u--,0==u&&t(a)},n||void 0);else{var o=r.createValueForIndex(i,s,void 0,n||void 0);"undefined"==typeof o?a=void 0:a&&(a[i]=o)}}(h);if(a&&Array.isArray(e)){null!=o&&e.length>o?e=e.slice(0,o):o=e.length;for(var h=s;a&&h<=e.length&&o>h;h++)!function(i){u++;var s=Array.isArray(e)?e[i]:void 0;if(t)r.createValueForIndex(i,s,function(e){a&&"undefined"!=typeof e&&o>i?a[i]=e:n?a=void 0:o>i&&(o=i),u--,0==u&&t(a)},n||void 0);else{var h=r.createValueForIndex(i,s,void 0,n||void 0);a&&"undefined"!=typeof h?a[i]=h:n?a=void 0:o>i&&(o=i)}}(h)}return u--,t&&0==u&&t(a),a}},createValueObject:function(e,t,n){if("function"==typeof e){var i=e;e=t,t=i}if("undefined"!=typeof e&&("object"!=typeof e||Array.isArray(e)))return void 0;for(var r=this,a={},s=1,o=this.requiredProperties(),u=0;a&&u<o.length;u++)!function(i){s++;var o="object"!=typeof e||Array.isArray(e)?void 0:e[i];if(t)r.createValueForProperty(i,o,function(e){"undefined"==typeof e?a=void 0:a&&(a[i]=e),s--,0==s&&t(a)},n||void 0);else{var u=r.createValueForProperty(i,o,void 0,n||void 0);"undefined"==typeof u?a=void 0:a&&(a[i]=u)}}(o[u]);if(a&&"object"==typeof e&&!Array.isArray(e))for(var h=this.definedProperties(),u=0;a&&u<h.length;u++){var l=h[u];a&&"undefined"==typeof a[l]&&function(i){s++;var o=e[i];if(t)r.createValueForProperty(i,o,function(e){a&&"undefined"!=typeof e?a[i]=e:n&&(a=void 0),s--,0==s&&t(a)},n||void 0);else{var u=r.createValueForProperty(i,o,void 0,n||void 0);a&&"undefined"!=typeof u?a[i]=u:n&&(a=void 0)}}(l)}return s--,t&&0==s&&t(a),a},createValueForIndex:function(t,n,i,r){if("function"==typeof n){var a=n;n=i,i=a}e.isData(n)&&(n=n.value());var s=this.indexSchemas(t);return s.createValue(n,i,void 0,void 0,r)},createValueForProperty:function(t,n,i,r){if("function"==typeof n){var a=n;n=i,i=a}e.isData(n)&&(n=n.value());var s=this.propertySchemas(t);return s.createValue(n,i,void 0,void 0,r)},createData:function(t,n){var i=this;if("function"==typeof t){var r=t;t=n,n=r}return e.isData(t)&&t==t.value(),n?(this.createValue(t,function(t){var r=e.create(t).addSchema(i.fixed());n(r)}),this):e.create(this.createValue(void 0,t)).addSchema(this)},indexSchemas:function(e){for(var t=new D,n=0;n<this.length;n++)t=t.concat(this[n].indexSchemas(e));return t},tupleTyping:function(){for(var e=0,t=0;t<this.length;t++)e=Math.max(e,this[t].tupleTyping());return e},propertySchemas:function(e){for(var t=new D,n=0;n<this.length;n++)t=t.concat(this[n].propertySchemas(e));return t},propertyDependencies:function(e){for(var t=[],n={},i=0;i<this.length;i++)for(var r=this[i].propertyDependencies(e),a=0;a<r.length;a++)"string"==typeof r[a]?n[r[a]]||(n[r[a]]=!0,t.push(r[a])):t.push(r[a]);return t},isFull:function(){for(var e=0;e<this.length;e++){if(!this[e].isFull())return!1;for(var t=this[e].andSchemas(),n=0;n<t.length;n++)if(-1==this.indexOf(t[n],!0))return!1}return!0},getFull:function(e){function t(i){r+=i.length;for(var s=0;s<i.length;s++)i[s].getFull(function(i){for(var s=0;s<n.length;s++)if(i.equals(n[s])){if(r--,0==r){var o=new D(n,a);e.call(o,o)}return}n.push(i);var u=i.extendSchemas();if(t(u),r--,0==r){var o=new D(n,a);e.call(o,o)}})}if(!e){for(var n=[],i=0;i<this.length;i++)n[i]=this[i].getFull();return new D(n)}if(0==this.length)return e.call(this,this),this;var r=0,n=[],a=this.fixed();return t(this),this},formats:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].format();null!=n&&e.push(n)}return e},containsFormat:function(e){return-1!==this.formats().indexOf(e)},xorSchemas:function(){for(var e=[],t=0;t<this.length;t++)e=e.concat(this[t].xorSchemas());return e},orSchemas:function(){for(var e=[],t=0;t<this.length;t++)e=e.concat(this[t].orSchemas());return e}},D.prototype.basicTypes=D.prototype.types,D.prototype.potentialLinks=D.prototype.links,e.extendSchemaList=function(e){for(var t in e)void 0==D.prototype[t]&&(D.prototype[t]=e[t])};var ct=[];e.extendCreateValue=function(e){ct.push(e)},e.createSchemaList=function(e){return Array.isArray(e)||(e=[e]),new D(e)},$.getUniqueKey();var dt=$.getUniqueKey(),ft=0;E.prototype={update:function(e){this.updateLinksWithKey(e),this.updateDependenciesWithKey(e),this.updateMatchesWithKey(e)},updateFromSelfLink:function(){this.cachedLinkList=null;var e=[];for(var t in this.links){var n=this.links[t];for(r=0;r<n.length;r++){var i=n[r];"self"==i.rel()&&(i.active=!1)}}for(var t in this.links){var n=this.links[t];for(r=0;r<n.length;r++){var i=n[r];"self"==i.rel()&&(i.update(),i.active&&(e.push(i),i.active=!1,this.cachedLinkList=null))}}for(var r=0;r<e.length;r++)e[r].active=!0;for(var t in this.links){var n=this.links[t];for(r=0;r<n.length;r++){var i=n[r];"self"!=i.rel()&&i.update()}}this.dataObj.properties(function(e,t){t.addLink(null)}),this.dataObj.items(function(e,t){t.addLink(null)})},updateLinksWithKey:function(e){var t,n,i,r,a=[];for(t in this.links)for(i=this.links[t],n=0;n<i.length;n++)r=i[n],(r.usesKey(e)||null==e)&&a.push(r);if(a.length>0){var s=null;for(n=0;n<a.length;n++){r=a[n];var o=r.active?r.rawLink.rawLink.href:null;r.update();var u=r.active?r.rawLink.rawLink.href:null;if(u!=o&&"self"==r.rel()){s=r;break}}null!=s&&this.updateFromSelfLink(s),this.invalidateSchemaState()}},updateMatchesWithKey:function(e){var t=[];for(schemaKey in this.matches)t.push(schemaKey);t.sort(),t.reverse();for(var n=0;n<t.length;n++){var i=this.matches[t[n]];if(void 0!=i)for(var r=0;r<i.length;r++)i[r].dataUpdated(e)}},updateDependenciesWithKey:function(e){var t=[];for(schemaKey in this.dependencySelectors)t.push(schemaKey);t.sort(),t.reverse();for(var n=0;n<t.length;n++)for(var i=this.dependencySelectors[t[n]],r=0;r<i.length;r++)i[r].dataUpdated(e)},alreadyContainsSchema:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(void 0!=this.schemas[i])for(var r=0;r<this.schemas[i].length;r++){var a=this.schemas[i][r];if(e.equals(a))return!0}}return!1},addSchema:function(t,n,i,r){var a=this;void 0==n&&(n=$.getUniqueKey(),ft=0),void 0==r&&(r=!0),void 0==i?i=[n]:i[i.length]=n,void 0==this.schemas[n]&&(this.schemas[n]=[]),this.schemaFlux++,"string"==typeof t&&(t=e.createSchema({$ref:t})),t.getFull(function(e){if(a.alreadyContainsSchema(e,i))return a.schemaFlux--,a.checkForSchemasStable(),void 0;G.increment(),a.schemas[n].push(e),a.schemasFixed[n]=a.schemasFixed[n]||r,a.dataObj.properties(function(t,r){for(var a=$.getKeyVariant(n,"prop"),s=e.propertySchemas(t),o=0;o<s.length;o++)r.addSchema(s[o],a,i)}),a.dataObj.indices(function(t,r){$.getKeyVariant(n,"idx");for(var a=e.indexSchemas(t),t=0;t<a.length;t++)r.addSchema(a[t],n,i)});for(var t=e.extendSchemas(),s=0;s<t.length;s++)a.addSchema(t[s],n,i,r);a.addLinks(e.links(),n,i),a.addXorSelectors(e,n,i),a.addOrSelectors(e,n,i),a.addDependencySelector(e,n,i),a.schemaFlux--,a.invalidateSchemaState(),G.decrement()})},addLinks:function(e,t,n){var i,r;void 0==this.links[t]&&(this.links[t]=[]);var a=null;for(i=0;i<e.length;i++)r=new F(this.dataObj,e[i]),this.links[t].push(r),this.addMonitorForLink(r,t,n),r.update(),r.active&&"self"==r.rawLink.rawLink.rel&&(a=r);null!=a&&this.updateFromSelfLink(a),this.invalidateSchemaState()},addXorSelectors:function(e,t,n){for(var i=e.xorSchemas(),r=[],a=0;a<i.length;a++){var s=new N(i[a],$.getKeyVariant(t,"xor"+a),n,this);r.push(s)}this.xorSelectors[t]=void 0==this.xorSelectors[t]?r:this.xorSelectors[t].concat(r)},addOrSelectors:function(e,t,n){for(var i=e.orSchemas(),r=[],a=0;a<i.length;a++){var s=new U(i[a],$.getKeyVariant(t,"or"+a),n,this);r.push(s)}this.orSelectors[t]=void 0==this.orSelectors[t]?r:this.orSelectors[t].concat(r)},addDependencySelector:function(e,t,n){var i=new H(e,$.getKeyVariant(t,"dep"),n,this),r=[i];this.dependencySelectors[t]=void 0==this.dependencySelectors[t]?r:this.dependencySelectors[t].concat(r)},addLink:function(t){if(null==t)return this.updateFromSelfLink(),this.invalidateSchemaState(),void 0;if("invalidate"==t.rel||"invalidates"==t.rel){var n=this.dataObj.resolveUrl(t.href);return e.invalidate(n),void 0}var i=dt,r=e.create(t),a=new k(r);this.addLinks([a],i)},addMonitorForLink:function(t,n,i){var r=this,a=t.rel();if("describedby"===a){var s=$.getKeyVariant(n);t.addMonitor(s,function(a){if(r.removeSchema(s),a){var o=t.rawLink,u=e.createSchema({$ref:o.href});r.addSchema(u,s,i,n==dt)}})}},addSchemaMatchMonitor:function(e,t,n,i,r){var a=new I(e,this.dataObj,t,r);return void 0==this.matches[e]&&(this.matches[e]=[]),this.matches[e].push(a),a.addMonitor(n,i),a},removeSchema:function(e){G.increment(),this.dataObj.indices(function(t,n){n.removeSchema(e)}),this.dataObj.properties(function(t,n){n.removeSchema(e)});var t,n,i=[];for(t in this.schemas)$.keyIsVariant(t,e)&&i.push(t);for(t in this.links)$.keyIsVariant(t,e)&&i.push(t);for(t in this.matches)$.keyIsVariant(t,e)&&i.push(t);for(n=0;n<i.length;n++)t=i[n],delete this.schemas[t],delete this.links[t],delete this.matches[t],delete this.xorSelectors[t],delete this.orSelectors[t],delete this.dependencySelectors[t];i.length>0&&this.invalidateSchemaState(),G.decrement()},clear:function(){this.schemas={},this.links={},this.matches={},this.invalidateSchemaState()},getSchemas:function(){if(null!==this.cachedSchemaList)return this.cachedSchemaList;var e,t,n,i,r,a,s=[],o={};for(n in this.schemas){i=this.schemas[n];var u=this.schemasFixed[n];for(e=0;e<i.length;e++){for(r=i[e],u&&(o[r.data.uniqueId]=r),a=!1,t=0;t<s.length;t++)if(r.equals(s[t])){a=!0;break}a||s.push(r)}}var h=[];for(var n in o)h.push(o[n]);return this.cachedSchemaList=new D(s,h),this.cachedSchemaList},getLinks:function(e){var t,n,i,r;if(null!==this.cachedLinkList)return this.cachedLinkList.rel(e);var a=[];for(t in this.links)for(r=this.links[t],n=0;n<r.length;n++)i=r[n],i.active&&a.push(i.rawLink);return this.cachedLinkList=new R(a),this.cachedLinkList.rel(e)},invalidateSchemaState:function(){this.cachedSchemaList=null,this.cachedLinkList=null,this.schemasStable=!1,this.checkForSchemasStable()},checkForSchemasStable:function(){if(this.schemaFlux>0)return!1;var e,t,n,i;for(t in this.schemas)for(n=this.schemas[t],e=0;e<n.length;e++)if(i=n[e],!i.isComplete())return this.schemasStable=!1,!1;var r=this;return r.schemasStable||(r.schemasStable=!0,A(r.dataObj)),r.schemasStableListeners.notify(r.dataObj,r.getSchemas()),!0},addSchemasForProperty:function(e,t){for(var n in this.schemas)for(var i=$.getKeyVariant(n,"prop"),r=0;r<this.schemas[n].length;r++)for(var a=this.schemas[n][r],s=a.propertySchemas(e),o=0;o<s.length;o++)t.addSchema(s[o],i)},addSchemasForIndex:function(e,t){for(var n in this.schemas)for(var i=$.getKeyVariant(n,"idx"),r=0;r<this.schemas[n].length;r++)for(var a=this.schemas[n][r],s=a.indexSchemas(e),o=0;o<s.length;o++)t.addSchema(s[o],i)},removeSubSchemas:function(e){for(var t in this.schemas)e.removeSchema(t)},whenSchemasStable:function(e){this.schemasStableListeners.add(e),this.checkForSchemasStable()}},F.prototype={update:function(){var e=this.potentialLink.canApplyTo(this.dataObj);e?(this.rawLink=this.potentialLink.linkForData(this.dataObj),"self"==this.potentialLink.rel()&&this.dataObj.document.addSelfLink(this)):this.rawLink&&("self"==this.potentialLink.rel()&&this.dataObj.document.removeSelfLink(this),this.rawLink=null),this.active=e,this.updateMonitors.notify(this.active)},rel:function(){return this.potentialLink.rel()},usesKey:function(e){return this.potentialLink.usesKey(e)},addMonitor:function(e,t){this.updateMonitors.add(e,t)}},H.prototype={dataUpdated:function(e){if(null!=e)if(this.schemaSet.dataObj.property(e).defined())for(var t=this.schema.propertyDependencies(e),n=0;n<t.length;n++){var i=t[n];"string"!=typeof i&&this.schemaSet.addSchema(i,this.inferredSchemaKeys[e],this.schemaKeyHistory,!1)}else this.schemaSet.removeSchema(this.inferredSchemaKeys[e]);else for(var r=this.schema.data.property("dependencies").keys(),n=0;n<r.length;n++){var e=r[n];this.dataUpdated(e)}}},e.config={antiCacheUrls:!1,debug:!1},e.UriTemplate=s}(this.Jsonary={}),function(e){function t(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function n(e){e=e||10;for(var t="";t.length<e;)t+=p.charAt(Math.floor(Math.random()*p.length));return t}function i(e){this.uniqueId=b++;var i=this;this.elementLookup={},void 0==e&&(e=v+"."+m++ +n(4)+".");var r=0;this.getElementId=function(){return e+r++},this.enhancementContexts={},this.enhancementActions={},this.enhancementInputs={},"undefined"!=typeof document&&(f.registerChangeListener(function(e,t){e.each(function(e,n){for(var r=t.affectedData(n),a=0;a<r.length;a++)i.update(r[a],n)})}),f.registerSchemaChangeListener(function(e){for(var n={},r=0;r<e.length;r++){var s=e[r],o=s.uniqueId,u=i.elementLookup[o];n[o]=u?u.slice(0):[]}for(var h=0;h<e.length;h++)for(var s=e[h],o=s.uniqueId,u=n[o],r=0;r<u.length;r++){var l=a.getElementById(u[r]);if(void 0!=l){var c=l.jsonaryContext,f=t(this.uiStartingState),p=d(s,f,c.usedComponents);p.uniqueId==c.renderer.uniqueId?p.render(l,s,c):c.baseContext.render(l,s,c.label,f)}}})),this.rootContext=this,this.subContexts={},this.oldSubContexts={}}function r(){var e=[];for(var t in S.elementLookup){for(var n=S.elementLookup[t],i=!1,r=0;r<n.length;r++){var s=a.getElementById(n[r]);if(s){i=!0;break}}i||e.push(t)}for(var r=0;r<e.length;r++)delete S.elementLookup[e[r]];for(var t in S.enhancementContexts)if(S.enhancementContexts[t]){var o=S.enhancementContexts[t];f.log(f.logLevel.WARNING,"Orphaned context for element: "+JSON.stringify(t)+"\renderer:"+o.renderer.name+"\ncomponents:"+o.renderer.filterObj.component.join(", ")+"\ndata: "+o.data.json()),S.enhancementContexts[t]=null}for(var t in S.enhancementActions)if(S.enhancementActions[t]){var o=S.enhancementActions[t].context;f.log(f.logLevel.WARNING,"Orphaned action for element: "+JSON.stringify(t)+"\renderer:"+o.renderer.name+"\ncomponents:"+o.renderer.filterObj.component.join(", ")+"\ndata: "+o.data.json()),S.enhancementActions[t]=null}for(var t in S.enhancementInputs)if(S.enhancementInputs[t]){var o=S.enhancementInputs[t].context;f.log(f.logLevel.WARNING,"Orphaned action for input: "+JSON.stringify(t)+"\renderer:"+o.renderer.name+"\ncomponents:"+o.renderer.filterObj.component.join(", ")+"\ndata: "+o.data.json()),S.enhancementInputs[t]=null}}function a(e,t,n){"string"==typeof e&&(e=a.getElementById(e));var i=document.createElement("span");i.className="jsonary",e.innerHTML="",e.appendChild(i);var r=S.subContext(Math.random());return S.oldSubContexts={},S.subContexts={},r.render(i,t,"render",n)}function s(e,t){var n=S.renderHtml(e,null,t);return S.oldSubContexts={},S.subContexts={},'<span class="jsonary">'+n+"</span>"}function o(e,t,n){return S.asyncRenderHtml(e,null,t,function(e,t,i){e&&n(e,t,i),n(null,'<span class="jsonary">'+t+"</span>",i)})}function u(e){this.renderFunction=e.render||e.enhance,this.renderHtmlFunction=e.renderHtml,this.updateFunction=e.update,"function"==typeof e.filter?(this.filterFunction=e.filter,this.filterObj={}):(this.filterObj=e.filter||{},this.filterFunction=this.filterObj.filter),this.actionFunction=e.action;for(var t in e)void 0==this[t]&&(this[t]=e[t]);this.uniqueId=x++,this.name=e.name||"#"+this.uniqueId;var n=e.component||this.filterObj.component;void 0==n&&(n=y[y.length-1]),"string"==typeof n&&(n=[n]),this.component=this.filterObj.component=n,(e.saveState||e.saveUiState)&&(this.saveUiState=e.saveState||e.saveUiState),(e.loadState||e.loadUiState)&&(this.loadUiState=e.loadState||e.loadUiState)}function h(e){var t=new u(e);w[t.uniqueId]=t;var n=t.filterObj.type||["undefined","null","boolean","integer","number","string","object","array"],i=t.filterObj.component;Array.isArray(n)||(n=[n]),-1!==n.indexOf("number")&&-1===n.indexOf("integer")&&n.push("integer");for(var r=0;r<n.length;r++){var a=n[r];if(!O[a])throw new Error("Invalid type(s): "+a);for(var s=O[a],o=0;o<i.length;o++){var h=i[o];s[h]=s[h]||[],s[h].push(t)}}return t}function l(e){"object"==typeof e&&(e=e.uniqueId),delete w[e];for(var t in O)for(var n in O[t])for(var i=O[t][n],r=0;r<i.length;r++)i[r].uniqueId==e&&(i.splice(r,1),r--)}function c(e,t,n,i){i=!!i||void 0==i;for(var r=0;r<k.length;r++){var a=k[r],s=a(e,t,n,i);if(s===!1)break}}function d(e,t,n){for(var i=e.schemas(),r=e.basicType(),a=0;a<y.length;a++)if(-1==n.indexOf(y[a])){var s=y[a],o=O[r];if(o[s])for(var u=o[s],h=u.length-1;h>=0;h--){var l=u[h];if(l.canRender(e,i,t))return l}}}var f=e.Jsonary;f.config.checkTagParity=["div","span"];var p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",v="Jsonary",m=0,g={ADD_REMOVE:"ADD_REMOVE",TYPE_SELECTOR:"TYPE_SELECTOR",RENDERER:"DATA_RENDERER",add:function(e,t){if(void 0!=this[e]){if(void 0===t)return;-1!=y.indexOf(e)&&y.splice(y.indexOf(e),1)
}if(this[e]=e,"number"==typeof t){var n=Math.max(0,Math.min(y.length-1,Math.round(t)));y.splice(n,0,this[e])}else-1!=y.indexOf(t)?y.splice(y.indexOf(t),0,this[e]):-1!=y.indexOf(g[t])?y.splice(y.indexOf(g[t]),0,this[e]):y.splice(y.length-1,0,this[e])}},y=[g.ADD_REMOVE,g.TYPE_SELECTOR,g.RENDERER],b=0;i.prototype={usedComponents:[],rootContext:null,baseContext:null,labelSequence:function(){return this.parent&&this.parent!=S?this.parent.labelSequence().concat([this.label]):[]},labelSequenceContext:function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(t=t.subContexts[i]||t.oldSubContexts[i],!t)return null}return t},labelForData:function(e){if(this.data&&e.document.isDefinitive){var t=e.getLink("self"),n=t?t.href:e.referenceUrl();if(n){for(var i=this.data.referenceUrl()||this.data.resolveUrl(""),r=0;n.substring(0,i.length-r)!=i.substring(0,i.length-r);)r++;var a=n.substring(i.length-r);return r?r+"!"+a:"!"+a}}else if(this.data&&this.data.document==e.document){for(var s=this.data.pointerPath(),o=e.pointerPath(),r=0;o.substring(0,s.length-r)!=s.substring(0,s.length-r);)r++;var a=o.substring(s.length-r);return r?r+"!"+a:"!"+a}return this.renderer&&f.log(f.logLevel.WARNING,"No label supplied for data in renderer "+JSON.stringify(this.renderer.name)),"$"+e.uniqueId},subContext:function(e,t){f.isData(e)&&(e=this.labelForData(e)),t=t||{};var n=this.getSubContext(!1,this.data,e,t);return n.renderer=this.renderer,n.uiState||n.loadState(n.uiStartingState),n},subContextSavedStates:{},saveUiState:function(){var e={};for(var t in this.subContexts)e[t]=this.subContexts[t].saveUiState();for(var t in this.oldSubContexts)e[t]=this.oldSubContexts[t].saveUiState();var n=this.renderer?this.renderer.saveUiState:u.prototype.saveUiState;return n.call(this.renderer,this.uiState,e,this.data)},loadUiState:function(e){var t=this.renderer?this.renderer.loadUiState:u.prototype.loadUiState,n=t.call(this.renderer,e);this.uiState=n[0],this.subContextSavedStates=n[1]},getSubContext:function(e,n,i,r){function a(e,n,i,r,a,s){this.uniqueId=b++,this.rootContext=e,this.baseContext=n,this.label=i,this.data=r,this.uiStartingState=t(a||{}),this.usedComponents=s,this.subContexts={},this.oldSubContexts={}}if("object"==typeof i&&null!=i)throw new Error("Label cannot be an object");if(i||""===i)var s=i;else var s=this.labelForData(n);if(void 0!=this.oldSubContexts[s]&&(this.subContexts[s]=this.oldSubContexts[s]),void 0!=this.subContexts[s]&&(null===this.subContexts[s].data?this.subContexts[s].data=n:this.subContexts[s].data!=n&&(delete this.subContexts[s],delete this.oldSubContexts[s],delete this.subContextSavedStates[s])),this.subContextSavedStates[s]&&(r=this.subContextSavedStates[s],delete this.subContextSavedStates[s]),void 0==this.subContexts[s]){var o=[];this.data==n&&(o=this.usedComponents.slice(0),void 0!=this.renderer&&(o=o.concat(this.renderer.filterObj.component))),"object"==typeof e&&(e=e.id),a.prototype=this.rootContext,this.subContexts[s]=new a(this.rootContext,this,s,n,r,o)}var u=this.subContexts[s];return u.elementId=e,u.parent=this,u},clearOldSubContexts:function(){this.oldSubContexts=this.subContexts,this.subContexts={}},rerender:function(){if(this.parent&&!this.elementId)return this.parent.rerender();var e=a.getElementById(this.elementId);null!=e&&(this.renderer.render(e,this.data,this),this.clearOldSubContexts())},asyncRerenderHtml:function(e){var t=this;void 0==this.uiState&&this.loadState(this.uiStartingState);var n=this.renderer;console.log("async rendering from document "+this.data.document.uniqueId),this.data.whenStable(function(i){n.asyncRenderHtml(i,t,function(n,i){return n?e(n,i,t):(t.clearOldSubContexts(),i='<span class="jsonary">'+i+"</span>",e(null,i,t),void 0)})})},render:function(e,t,n,i){if(void 0==i&&"object"==typeof n&&(i=n,n=null),"string"==typeof t&&(t=f.getData(t)),void 0!=t.getData){var r=this;e.innerHTML='<div class="loading"></div>';var a=this.getSubContext(e.id,null,n,i);return t.getData(function(t){r.render(e,t,n,i)}),a}"object"!=typeof i&&(i={}),(void 0==e.id||""==e.id)&&(e.id=this.getElementId());var s=e.jsonaryContext,a=this.getSubContext(e.id,t,n,i);if(e.jsonaryContext=a,s){var o=s.data.uniqueId,u=this.elementLookup[o].indexOf(e.id);u>=0&&this.elementLookup[o].splice(u,1)}var h=t.uniqueId;void 0==this.elementLookup[h]&&(this.elementLookup[h]=[]),-1==this.elementLookup[h].indexOf(e.id)&&this.elementLookup[h].push(e.id);var l=d(t,i,a.usedComponents);return void 0!=l?(a.renderer=l,void 0==a.uiState&&a.loadState(a.uiStartingState),l.render(e,t,a),a.clearOldSubContexts()):e.innerHTML="NO RENDERER FOUND",a},renderHtml:function(e,t,n){void 0==n&&"object"==typeof t&&(n=t,t=null);var i=this.getElementId();if("string"==typeof e&&(e=f.getData(e)),void 0!=e.getData){var r=this,s=!1;if(e.getData(function(o){if(s){var u=a.getElementById(i);u?r.render(u,o,t,n):f.log(f.logLevel.WARNING,"Attempted delayed render to non-existent element: "+i)}else s=!0,e=o}),!s)return s=!0,'<span id="'+i+'"><div class="loading"></div></span>'}n===!0&&(n=this.uiStartingState),"object"!=typeof n&&(n={});var o=this.getSubContext(i,e,t,n),u=d(e,n,o.usedComponents);o.renderer=u,void 0==o.uiState&&o.loadState(o.uiStartingState);var h=u.renderHtml(e,o);o.clearOldSubContexts();var l=e.uniqueId;return void 0==this.elementLookup[l]&&(this.elementLookup[l]=[]),-1==this.elementLookup[l].indexOf(i)&&this.elementLookup[l].push(i),this.addEnhancement(i,o),'<span id="'+i+'">'+h+"</span>"},asyncRenderHtml:function(e,t,n,i){var r=this;void 0==n&&"object"==typeof t&&(n=t,t=null);var a=this.getElementId();if("string"==typeof e&&(e=f.getData(e)),void 0!=e.getData){t=t||"async"+Math.random();var s=this.getSubContext(a,null,t,n);return e.getData(function(e){r.asyncRenderHtml(e,t,n,i)}),s}n===!0&&(n=this.uiStartingState),"object"!=typeof n&&(n={});var s=this.getSubContext(a,e,t,n),o=d(e,n,s.usedComponents);return s.renderer=o,void 0==s.uiState&&s.loadState(s.uiStartingState),o.asyncRenderHtml(e,s,function(e,t){s.clearOldSubContexts(),i(null,t,s)}),s},update:function(e,n){var i=e.uniqueId,r=this.elementLookup[i];if(void 0!=r&&0!=r.length)for(var r=r.slice(0),s=0;s<r.length;s++){var o=a.getElementById(r[s]);if(void 0!=o){var u=o.jsonaryContext||this.enhancementContexts[r[s]],h=t(this.uiStartingState),l=d(e,h,u.usedComponents);l.uniqueId==u.renderer.uniqueId?l.update(o,e,u,n):u.baseContext.render(o,e,u.label,h)}}},actionHtml:function(e,t){var n=2,i=!1,r=null;"boolean"==typeof t&&(i=arguments[1],r=arguments[2]||null,t=arguments[3],n+=2);for(var a=[],s=n;s<arguments.length;s++)a.push(arguments[s]);var o=this.getElementId();this.addEnhancementAction(o,t,this,a,i);var u={context:this,linkUrl:r,actionName:t,params:a,historyChange:i};return u.linkUrl=r||f.render.actionUrl(u),f.render.actionHtml(o,e,u)},inputNameForAction:function(e){var t=!1,n=1;"boolean"==typeof e&&(t=e,e=arguments[1],n++);for(var i=[],r=n;r<arguments.length;r++)i.push(arguments[r]);var a={context:this,actionName:e},s=f.render.actionInputName(a);return this.enhancementInputs[s]={inputName:s,actionName:e,context:this,params:i,historyChange:t},s},addEnhancement:function(e,t){this.enhancementContexts[e]=t},addEnhancementAction:function(e,t,n,i,r){null==i&&(i=[]),this.enhancementActions[e]={actionName:t,context:n,params:i,historyChange:r}},enhanceElement:function(e){for(var t=e;e;)if(e.firstChild)e=e.firstChild;else{for(;!e.nextSibling&&e!=t;)1==e.nodeType&&this.enhanceElementSingle(e),e=e.parentNode;if(1==e.nodeType&&this.enhanceElementSingle(e),e==t)break;if(e.parentNode!=e.nextSibling.parentNode)throw new Error("DOM mismatch - did you forget a close tag? "+e.innerHTML);e=e.nextSibling}},action:function(){for(var e=[this],t=0;t<arguments.length;t++)e.push(arguments[t]);return this.renderer.action.apply(this.renderer,e)},actionArgs:function(e,t){return t=[this,e].concat(t||[]),this.renderer.action.apply(this.renderer,t)},enhanceElementSingle:function(e){var t=e.id,n=this.enhancementContexts[t];if(void 0!=n){e.jsonaryContext=n,delete this.enhancementContexts[t];var i=n.renderer;void 0!=i&&i.enhance(e,n.data,n)}var r=this.enhancementActions[e.id];void 0!=r&&(delete this.enhancementActions[e.id],e.onclick=function(){r.context.elementId;var e=r.context,t=[r.actionName].concat(r.params);return e.action.apply(e,t)&&e.rerender(),c(e.data,e,r.actionName,r.historyChange),!1});var a=this.enhancementInputs[e.name];void 0!=a&&(delete this.enhancementInputs[e.name],e.onchange=function(){var e=this.value;if("checkbox"==this.getAttribute("type")&&(e=this.checked),"select"==this.tagName.toLowerCase()&&null!=this.getAttribute("multiple")){e=[];for(var t=0;t<this.options.length;t++){var n=this.options[t];n.selected&&e.push(n.value)}}a.context.elementId;var i=a.context,r=[a.actionName,e].concat(a.params);i.action.apply(i,r)&&i.rerender(),c(i.data,i,a.actionName,a.historyChange)}),e=null}},i.prototype.saveState=i.prototype.saveUiState,i.prototype.loadState=i.prototype.loadUiState;var S=new i;"undefined"!=typeof document&&setInterval(r,3e4),"undefined"!=typeof document&&(f.cleanup=r),a.empty=void 0!=e.jQuery?function(t){e.jQuery(t).empty()}:function(e){e.innerHTML=""},a.Components=g,a.actionInputName=function(e){var t=e.context;return t.getElementId()},a.actionUrl=function(){return"javascript:void(0)"},a.actionHtml=function(e,t,n){return'<a href="'+f.escapeHtml(n.linkUrl)+'" id="'+e+'" class="jsonary-action">'+t+"</a>"},a.rendered=function(e){var t=e.uniqueId;if(!S.elementLookup[t])return!1;for(var n=S.elementLookup[t],i=0;i<n.length;i++){var r=n[i],s=a.getElementById(r);if(s)return!0}return!1},a.saveData=function(e,t){if("undefined"==typeof localStorage)return"LOCALSTORAGE_MISSING";for(var n=(new Date).getTime()-72e5,i=Object.keys(localStorage),r=0;r<i.length;r++){var a=i[r];try{var s=JSON.parse(localStorage[a]);s.accessed<n&&delete localStorage[a]}catch(o){}}return localStorage[e.saveStateId]=JSON.stringify({accessed:(new Date).getTime(),data:e.deflate()}),t},a.loadData=function(e){if("undefined"==typeof localStorage)return void 0;var t=localStorage[e];return t?(t=JSON.parse(t),f.inflate(t.data)):void 0};var x=0;u.prototype={updateAll:function(){var e=[];for(var t in S.elementLookup)e=e.concat(S.elementLookup[t]);for(var n=0;n<e.length;n++){var i=a.getElementById(e[n]);if(void 0!=i){var r=i.jsonaryContext;(r.renderer.uniqueId=this.uniqueId)&&r.rerender()}}},render:function(e,t,n){return null==e?(f.log(f.logLevel.WARNING,"Attempted to render to non-existent element.\n	Data path: "+t.pointerPath()+"\n	Document: "+t.document.url),this):(void 0!=e[0]&&(e=e[0]),a.empty(e),e.innerHTML=this.renderHtml(t,n),null!=this.renderFunction&&this.renderFunction(e,t,n),n.enhanceElement(e),this)},renderHtml:function(e,t){var n="";if(void 0!=this.renderHtmlFunction&&(n=this.renderHtmlFunction(e,t),f.config.debug))for(var i=0;i<f.config.checkTagParity.length;i++){var r=f.config.checkTagParity[i],a=n.match(new RegExp("<s*"+r,"gi")),s=n.match(new RegExp("</s*"+r,"gi"));!a||s&&a.length==s.length||(f.log(f.logLevel.ERROR,"<"+r+"> mismatch in: "+this.name),n='<div class="error">&lt;'+r+"&gt; mismatch in "+f.escapeHtml(this.name)+"</div>")}return n},asyncRenderHtml:function(e,t,n){function i(e){var t=Object.create(e);return t.renderHtml=u,t.subContext=function(){return i(e.subContext.apply(this,arguments))},t}function r(){if(s--,!(s>0)){for(var e in o);n(null,a,t)}}var a="",s=1,o={};if(void 0!=this.renderHtmlFunction){var u=function(e,t,n){var i="<<ASYNC"+Math.random()+">>",a=null;return s++,this.asyncRenderHtml(e,t,n,function(e,t){o[i]=t,a=t,r()}),null!==a?(delete o[i],a):i};a=this.renderHtmlFunction(e,i(t))}r()},enhance:function(e,t,n){return null!=this.renderFunction&&this.renderFunction(e,t,n),this},update:function(e,t,n,i){var r;return r=void 0!=this.updateFunction?this.updateFunction(e,t,n,i):this.defaultUpdate(e,t,n,i),r&&this.render(e,t,n),this},action:function(){var e=this.actionFunction.apply(this,arguments);return e},canRender:function(e,t,n){return void 0!=this.filterFunction?this.filterFunction(e,t,n):!0},defaultUpdate:function(e,t,n,i){var r=!1,a="replace"!=i.action(),s=t.pointerPath();return i.subjectEquals(s)||a&&i.subjectChild(s)!==!1?r=!0:void 0!=i.target()&&(i.targetEquals(s)||a&&i.targetChild(s)!==!1)&&(r=!0),r},saveUiState:function(e,t){var n={};for(key in e)n[key]=e[key];for(var i in t)for(var r in t[i])n[i+"-"+r]=t[i][r];for(key in n)f.isData(n[key])&&(n[key]=this.saveStateData(n[key]));return n},saveStateData:function(e){return e?e.document.isDefinitive?"url:"+e.referenceUrl():(e.saveStateId=e.saveStateId||n(),a.saveData(e,e.saveStateId)||e.saveStateId):void 0},loadUiState:function(e){var t={},n={};for(var i in e)if(-1!=i.indexOf("-")){var r=i.split("-"),a=r.shift(),s=r.join("-");n[a]||(n[a]={}),n[a][s]=e[i]}else t[i]=this.loadStateData(e[i])||e[i],f.isRequest(t[i])&&function(e){t[e].getData(function(n){t[e]=n})}(i);return[t,n]},loadStateData:function(e){if(!e||"string"!=typeof e)return void 0;if("url:"==e.substring(0,4)){var t=e.substring(4),n=null,i=f.getData(t,function(e){n=e});return n||i}var n=a.loadData(e);return n&&(n.saveStateId=e),n}},u.prototype.super_=u.prototype;var w={},O={undefined:{},"null":{},"boolean":{},integer:{},number:{},string:{},object:{},array:{}};if(a.register=h,a.deregister=l,"undefined"!=typeof document){var j=[document];a.addDocument=function(e){return j.push(e),this},a.removeDocument=function(e){var t=j.indexOf(e);return-1!==t&&j.splice(t,1),this},a.getElementById=function(e){for(var t=0;t<j.length;t++){var n=j[t].getElementById(e);if(n)return n}return null}}var k=[];if(a.addActionHandler=function(e){k.push(e)},"undefined"!=typeof e.jQuery){var C=function(e,t){var n=this[0];return void 0!=n&&a(n,e,t),this};f.extendData({$renderTo:function(e,t){"string"==typeof e&&(e=jQuery(e));var n=e[0];void 0!=n&&a(n,this,t)}}),C.register=function(e){if(void 0!=e.render){var t=e.render;e.render=function(e,n){var i=$(e);t.call(this,i,n)}}if(void 0!=e.update){var n=e.update;e.update=function(e,t,i){var r=$(e);n.call(this,r,t,i)}}a.register(e)},C.empty=function(e){e.each(function(e,t){a.empty(t)})},jQuery.fn.extend({renderJson:C}),jQuery.extend({renderJson:C})}f.extend({render:a,renderHtml:s,asyncRenderHtml:o}),f.extendData({renderTo:function(e,t){"string"==typeof e&&(e=a.getElementById(e)),a(e,this,t)}}),f.invalidate=function(e){return function(){var t=e.apply(this,arguments),n=[];for(var i in S.elementLookup){var r=S.elementLookup[i];n=n.concat(r)}for(var s=0;s<n.length;s++){var o=a.getElementById(n[s]);o&&o.jsonaryContext&&o.jsonaryContext.data.document.access()}return t}}(f.invalidate)}(this);var Jsonary=this.Jsonary,baseSchema={id:"http://json-schema.org/draft-04/schema#",$schema:"http://json-schema.org/draft-04/schema#",title:"JSON Schema",description:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},positiveInteger:{type:"integer",minimum:0},positiveIntegerDefault0:{allOf:[{$ref:"#/definitions/positiveInteger"},{"default":0}]},simpleTypes:{title:"Simple type","enum":["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},minItems:1,uniqueItems:!0}},type:"object",properties:{id:{type:"string",format:"uri"},$schema:{type:"string",format:"uri"},title:{type:"string"},description:{type:"string"},"default":{},multipleOf:{type:"number",minimum:0,exclusiveMinimum:!0},maximum:{type:"number"},exclusiveMaximum:{type:"boolean","default":!1},minimum:{type:"number"},exclusiveMinimum:{type:"boolean","default":!1},maxLength:{$ref:"#/definitions/positiveInteger"},minLength:{$ref:"#/definitions/positiveIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{oneOf:[{type:"boolean"},{$ref:"#"}],"default":{}},items:{oneOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],"default":{}},maxItems:{$ref:"#/definitions/positiveInteger"},minItems:{$ref:"#/definitions/positiveIntegerDefault0"},uniqueItems:{type:"boolean","default":!1},maxProperties:{$ref:"#/definitions/positiveInteger"},minProperties:{$ref:"#/definitions/positiveIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{oneOf:[{type:"boolean"},{$ref:"#"}],"default":{}},definitions:{type:"object",additionalProperties:{$ref:"#"},"default":{}},properties:{type:"object",additionalProperties:{$ref:"#"},"default":{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},"default":{}},dependencies:{type:"object",additionalProperties:{oneOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},"enum":{type:"array",minItems:1,uniqueItems:!0},type:{oneOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},dependencies:{exclusiveMaximum:["maximum"],exclusiveMinimum:["minimum"]},"default":{}},hyperSchema={$schema:"http://json-schema.org/draft-04/hyper-schema#",id:"http://json-schema.org/draft-04/hyper-schema#",title:"JSON Hyper-Schema",allOf:[{$ref:"http://json-schema.org/draft-04/schema#"}],properties:{additionalItems:{oneOf:[{type:"boolean"},{$ref:"#"}]},additionalProperties:{oneOf:[{type:"boolean"},{$ref:"#"}]},dependencies:{additionalProperties:{oneOf:[{$ref:"#"},{type:"array"}]}},items:{oneOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}]},definitions:{additionalProperties:{$ref:"#"}},patternProperties:{additionalProperties:{$ref:"#"}},properties:{additionalProperties:{$ref:"#"}},allOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"},links:{type:"array",items:{$ref:"#/definitions/linkDescription"}},fragmentResolution:{type:"string"},media:{type:"object",properties:{type:{description:"A media type, as described in RFC 2046",type:"string"},binaryEncoding:{description:"A content encoding scheme, as described in RFC 2045",type:"string"}}},pathStart:{description:"Instances' URIs must start with this value for this schema to apply to them",type:"string",format:"uri"}},definitions:{schemaArray:{title:"Array of schemas",type:"array",items:{$ref:"#"}},linkDescription:{title:"Link Description Object",type:"object",required:["href","rel"],properties:{href:{description:"a URI template, as defined by RFC 6570, with the addition of the $, ( and ) characters for pre-processing",type:"string"},rel:{description:"relation to the target resource of the link",type:"string"},title:{description:"a title for the link",type:"string"},targetSchema:{description:"JSON Schema describing the link target",$ref:"#"},mediaType:{description:"media type (as defined by RFC 2046) describing the link target",type:"string"},method:{description:'method for requesting the target of the link (e.g. for HTTP this might be "GET" or "DELETE")',type:"string"},encType:{description:"The media type in which to submit data along with the request",type:"string","default":"application/json"},schema:{description:"Schema describing the data to submit along with the request",$ref:"#"}}}},links:[{rel:"self",href:"{+id}"},{rel:"full",href:"{+($ref)}"}]};return Jsonary.addToCache("http://json-schema.org/schema",{allOf:[{$ref:"draft-04/schema"}]}),Jsonary.addToCache("http://json-schema.org/draft-04/schema",baseSchema),Jsonary.addToCache("http://json-schema.org/hyper-schema",{allOf:[{$ref:"draft-04/hyper-schema"}]}),Jsonary.addToCache("http://json-schema.org/draft-04/hyper-schema",hyperSchema),function(e){e.render.Components.add("LIST_LINKS"),e.render.register({name:"Jsonary list links with prompt",component:e.render.Components.LIST_LINKS,update:function(){return!1},renderHtml:function(t,n){if(!t.readOnly())return n.renderHtml(t);var i="";if(n.uiState.editInPlace){var r='<span class="button action">save</span>';i+=n.actionHtml(r,"submit");var r='<span class="button action">cancel</span>';return i+=n.actionHtml(r,"cancel"),i+=n.renderHtml(n.uiState.submissionData,"~linkData")}var a=t.links();if(a.length){i+='<span class="link-list">';for(var s=0;s<a.length;s++){var o=a[s];if("self"!=o.rel){var r='<span class="button link">'+e.escapeHtml(o.title||o.rel)+"</span>";i+=n.actionHtml(r,"follow-link",s)}}i+="</span>"}if(void 0!=n.uiState.submitLink){var o=t.links()[n.uiState.submitLink];i+='<div class="prompt-outer"><div class="prompt-inner">',i+=n.actionHtml('<div class="prompt-overlay"></div>',"cancel"),i+='<div class="prompt-box"><h1>'+e.escapeHtml(o.title||o.rel)+"</h1><h2>"+e.escapeHtml(o.method)+" "+e.escapeHtml(o.href)+"</h2>",i+="<div>"+n.renderHtml(n.uiState.submissionData,"~linkData")+"</div>",i+="</div>",i+='<div class="prompt-buttons">',i+=n.actionHtml('<span class="button">Submit</span>',"submit"),i+=n.actionHtml('<span class="button">cancel</span>',"cancel"),i+="</div>",i+="</div></div>"}return i+=n.renderHtml(t,"data")},action:function(t,n,i){if("follow-link"==n){var r=t.data.links()[i];return"GET"==r.method&&0==r.submissionSchemas.length?(r.follow(),!1):(t.uiState.submitLink=i,"PUT"==r.method&&0==r.submissionSchemas.length?(console.log(r),t.uiState.editing=t.data.editableCopy(),t.uiState.submissionData=t.data.editableCopy()):(t.uiState.submissionData=e.create().addSchema(r.submissionSchemas),r.submissionSchemas.createValue(function(e){t.uiState.submissionData.setValue(e)})),"PUT"==r.method&&(t.uiState.editInPlace=!0),!0)}if("submit"==n){var r=t.data.links()[t.uiState.submitLink];return r.follow(t.uiState.submissionData),delete t.uiState.submitLink,delete t.uiState.editInPlace,delete t.uiState.submissionData,!0}return delete t.uiState.submitLink,delete t.uiState.editInPlace,delete t.uiState.submissionData,!0},filter:function(){return!0},saveState:function(e,t){var n={};for(var i in t.data)n[i]=t.data[i];if(void 0!=n.link||void 0!=n.inPlace||void 0!=n.linkData||void 0!=n[""]){var r={"":"-"};for(var i in n)r["-"+i]=n[i];n=r}if(void 0!==e.submitLink){var a=[e.submitLink];a.push(e.editInPlace?1:0),a.push(this.saveStateData(e.submissionData)),n.link=a.join("-")}return n},loadState:function(e){var t={};if(void 0!=e.link){var n=e.link.split("-");t.submitLink=parseInt(n.shift())||0,parseInt(n.shift())&&(t.editInPlace=!0),t.submissionData=this.loadStateData(n.join("-")),delete e.link,t.submissionData||(t={})}if("-"!=e[""]){delete e[""];var i={};for(var r in e){var a="-"==r.charAt(0)?r.substring(1):r;i[a]=e[r]}e=i}return[t,{data:e}]}})}(Jsonary),function(e){function t(e,t){var n=getComputedStyle(e,null);for(var i in n)("font"==i.substring(0,4)||"text"==i.substring(0,4))&&(t.style[i]=n[i])}function n(e,t,n){t.innerHTML="",t.appendChild(document.createTextNode(e.value+n));var i=getComputedStyle(t,null);e.style.width=parseInt(i.width.substring(0,i.width.length-2))+4+"px",e.style.height=parseInt(i.height.substring(0,i.height.length-2))+4+"px"}function i(e){for(var t="",n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1==r.nodeType){var a=r.tagName.toLowerCase();if("br"==a){t+="\n";continue}"li"==r.tagName&&(t+="\n*	"),("p"==a||/^h[0-6]$/.test(a)||"header"==a||"aside"==a||"blockquote"==a||"footer"==a||"div"==a||"table"==a||"hr"==a)&&""!=t&&(t+="\n"),("td"==a||"th"==a)&&(t+="	"),t+=i(r),"tr"==a&&(t+="\n")}else 3==r.nodeType&&(t+=r.nodeValue)}return t=t.replace("\r\n","\n"),t=t.replace(/\n$/,"")}var r=Jsonary.escapeHtml;void 0==e.escapeHtml&&(e.escapeHtml=r),Jsonary.render.register({name:"Jsonary plain add/remove",component:Jsonary.render.Components.ADD_REMOVE,renderHtml:function(e,t){if(!e.defined()){t.uiState.undefined=!0;var n="add",i=e.parent();if(i&&"array"==i.basicType()){var r=i.schemas().indexSchemas(e.parentKey());r.getFull(function(e){r=e}),n=r.title()||n}else if(i&&"object"==i.basicType()){var r=i.schemas().propertySchemas(e.parentKey());r.getFull(function(e){r=e}),n=r.title()||e.parentKey()||n}return t.actionHtml('<span class="json-undefined-create">+ '+Jsonary.escapeHtml(n)+"</span>","create")}delete t.uiState.undefined;var a=!1;if(null!=e.parent()){var i=e.parent();if("object"==i.basicType()){var s=i.schemas().requiredProperties(),o=i.schemas().minProperties();a=-1==s.indexOf(e.parentKey())&&i.keys().length>o}else if("array"==i.basicType()){var u=i.schemas().tupleTypingLength(),h=i.schemas().minItems(),l=parseInt(e.parentKey());(l>=u||l==i.length()-1)&&i.length()>h&&(a=!0)}}var c="";if(a){var d=i.basicType();c+="<div class='json-"+d+"-delete-container'>",c+=t.actionHtml("<span class='json-"+d+"-delete'>X</span>","remove")+" ",c+=t.renderHtml(e,"data"),c+="</div>"}else c+=t.renderHtml(e,"data");return c},action:function(e,t){if("create"==t){var n=e.data,i=n.parent(),r=n.parentKey();if(void 0!=i){var a=i.schemas();"array"==i.basicType()?a.createValueForIndex(r,function(e){i.index(r).setValue(e)}):("object"!=i.basicType()&&i.setValue({}),a.createValueForProperty(r,function(e){i.property(r).setValue(e)}))}else n.schemas().createValue(function(e){n.setValue(e)})}else"remove"==t?e.data.remove():alert("Unkown action: "+t)},update:function(e,t,n){return t.defined()==!!n.uiState.undefined},filter:function(e){return!e.readOnly()},saveState:function(e,t){return t.data||{}},loadState:function(e){return[{},{data:e}]}}),Jsonary.render.register({name:"Jsonary plain type-selector",component:Jsonary.render.Components.TYPE_SELECTOR,renderHtml:function(e,t){var n="",i=e.schemas().enumValues(),r=e.schemas().basicTypes();if(r.length>1&&null==i){console.log(r),n+='<select name="'+t.inputNameForAction("select-basic-type")+'">';for(var a=0;a<r.length;a++)if("integer"!=r[a]||-1==r.indexOf("number")){var s=Jsonary.escapeHtml(r[a]);n+=r[a]==e.basicType()||"number"==r[a]&&"integer"==e.basicType()?'<option value="'+s+'" selected>'+s+"</option>":'<option value="'+s+'">'+s+"</option>"}n+="</select> "}return n+=t.renderHtml(e,"data")},action:function(e,t,n){if("select-basic-type"==t){e.uiState.dialogOpen=!1;var i=e.data.schemas().concat([Jsonary.createSchema({type:n})]);return i.createValue(function(t){e.data.setValue(t)}),!0}alert("Unkown action: "+t)},update:function(){return!1},filter:function(e){return!e.readOnly()},saveState:function(e,t){var n={};if(e.dialogOpen&&(n.dialogOpen=!0),!t.data||void 0==t.data._&&void 0==t.data.dialogOpen)for(var i in t.data)n[i]=t.data[i];else n._=t.data;return n},loadState:function(e){var t=e,n={};if(void 0!=e._){var n=e._;delete e._}else{var t={};e.dialogOpen&&(t.dialogOpen=!0),delete e.dialogOpen,n=e}return[t,{data:n}]}}),Jsonary.render.Components.add("SCHEMA_SWITCHER",Jsonary.render.Components.TYPE_SELECTOR),Jsonary.render.register({name:"Jsonary plain schema-switcher",component:Jsonary.render.Components.SCHEMA_SWITCHER,renderHtml:function(e,t){var n,i="",r=e.schemas().fixed(),a=!1,s=r.orSchemas();if(0==s.length&&(n=r.xorSchemas(),1==n.length&&(a=!0)),t.uiState.xorSelected=[],t.uiState.orSelected=[],a)for(var o=0;o<n.length;o++){var u=n[o],h=t.inputNameForAction("selectXorSchema",o);i+='<select name="'+h+'">';for(var l=0;l<u.length;l++){var c=u[l];c.getFull(function(e){c=e});var d="";-1!=e.schemas().indexOf(c)&&(t.uiState.xorSelected[o]=l,d=" selected"),i+='<option value="'+l+'"'+d+">"+c.forceTitle()+"</option>"}i+="</select>"}if(t.uiState.dialogOpen){i+='<div class="json-select-type-dialog-outer"><span class="json-select-type-dialog">',i+=t.actionHtml("close","closeDialog"),n=n||r.xorSchemas();for(var o=0;o<n.length;o++){var u=n[o],h=t.inputNameForAction("selectXorSchema",o);i+='<br><select name="'+h+'">';for(var l=0;l<u.length;l++){var c=u[l];c.getFull(function(e){c=e});var d="";-1!=e.schemas().indexOf(c)&&(t.uiState.xorSelected[o]=l,d=" selected"),i+='<option value="'+l+'"'+d+">"+c.title()+"</option>"}i+="</select>"}for(var o=0;o<s.length;o++){var u=s[o],h=t.inputNameForAction("selectOrSchema",o);i+='<br><select name="'+h+'" multiple size="'+u.length+'">',t.uiState.orSelected[o]=[];for(var l=0;l<u.length;l++){var c=u[l];c.getFull(function(e){c=e});var d="";-1!=e.schemas().indexOf(c)?(t.uiState.orSelected[o][l]=!0,d=" selected"):t.uiState.orSelected[o][l]=!1,i+='<option value="'+l+'"'+d+">"+c.title()+"</option>"}i+="</select>"}i+="</span></div>"}return!a&&r.length<e.schemas().length&&(i+=t.actionHtml('<span class="json-select-type button">Schemas</span>',"openDialog")+" "),i+=t.renderHtml(e,"data")},createValue:function(e){for(var t=e.data,n=e.data.schemas().fixed(),i=e.data.schemas().fixed().xorSchemas(),r=0;r<i.length;r++)n=n.concat([i[r][e.uiState.xorSelected[r]].getFull()]);for(var a=e.data.schemas().fixed().orSchemas(),r=0;r<a.length;r++)for(var s=a[r],o=0;o<s.length;o++)e.uiState.orSelected[r][o]&&(n=n.concat([s[o].getFull()]));n=n.getFull(),t.setValue(n.createValue()),n.createValue(function(e){t.setValue(e)})},action:function(e,t,n,i){if("closeDialog"==t)return e.uiState.dialogOpen=!1,!0;if("openDialog"==t)return e.uiState.dialogOpen=!0,!0;if("selectXorSchema"==t)return e.uiState.xorSelected[i]=n,this.createValue(e),!0;if("selectOrSchema"==t){e.uiState.orSelected[i]=[];for(var r=0;r<n.length;r++)e.uiState.orSelected[i][n[r]]=!0;return this.createValue(e),!0}alert("Unkown action: "+t)},update:function(){return!1},filter:function(e){return!e.readOnly()},saveState:function(e,t){var n={};if(e.dialogOpen&&(n.dialogOpen=!0),void 0!=t.data._||void 0!=t.data.dialogOpen)n._=t.data;else for(var i in t.data)n[i]=t.data[i];return n},loadState:function(e){var t=e,n={};if(void 0!=e._){var n=e._;delete e._}else{var t={};e.dialogOpen&&(t.dialogOpen=!0),delete e.dialogOpen,n=e}return[t,{data:n}]}}),Jsonary.render.register({name:"Jsonary plain raw JSON display",renderHtml:function(e){return e.defined()?'<span class="json-raw">'+r(JSON.stringify(e.value()))+"</span>":""},filter:function(){return!0}}),Jsonary.render.register({name:"Jsonary plain null",renderHtml:function(){return'<span class="json-null">null</span>'},filter:function(e){return"null"==e.basicType()}}),Jsonary.render.register({name:"Jsonary plain objects",renderHtml:function(e,t){t.uiState;var n="";n+='<fieldset class="json-object-outer">';var i=e.schemas().title();i&&(n+='<legend class="json-object-title">'+Jsonary.escapeHtml(i)+"</legend>"),n+='<table class="json-object"><tbody>';var a=function(e,i){if(i.defined())var a=i.schemas().fixed().title();else{var s=i.parent().schemas().propertySchemas(i.parentKey());if(s.readOnly())return;var a=s.title()}n+='<tr class="json-object-pair">',n+=""==a?'<td class="json-object-key"><div class="json-object-key-title">'+r(e)+"</div></td>":'<td class="json-object-key"><div class="json-object-key-title">'+r(e)+'</div><div class="json-object-key-text">'+r(a)+"</div></td>",n+='<td class="json-object-value">'+t.renderHtml(i)+"</td>",n+="</tr>"};if(e.readOnly()){var s=e.schemas().knownProperties();e.properties(s,function(e,t){t.defined()&&a(e,t)},!0)}else{var o=e.schemas(),s=o.knownProperties(),u=s.length-o.requiredProperties().length>5,h=o.maxProperties(),l=null==h||h>o.keys().length;if(e.properties(s,function(e,t){(!u&&l||t.defined())&&a(e,t)},a),l&&(o.allowedAdditionalProperties()||u))if(t.uiState.addInput){if(n+='<tr class="json-object-pair"><td class="json-object-key"><div class="json-object-key-text">',n+=t.actionHtml('<span class="button">add</span>',"add-confirm"),n+="<br>",n+="</div></td><td>",u){var c=[];e.properties(s,function(e,t){t.defined()||c.push(e)}),n+='<select name="'+t.inputNameForAction("select-preset")+'">',o.allowedAdditionalProperties()&&(n+='<option value="custom">Enter your own:</option>'),n+='<optgroup label="Known properties">',c.sort();for(var d=0;d<c.length;d++){var f=c[d];n+=f==t.uiState.addInputSelect?'<option value="key-'+Jsonary.escapeHtml(f)+'" selected>'+Jsonary.escapeHtml(f)+"</option>":'<option value="key-'+Jsonary.escapeHtml(f)+'">'+Jsonary.escapeHtml(f)+"</option>"}n+="</optgroup></select>"}!o.allowedAdditionalProperties()||u&&null!=t.uiState.addInputSelect?n+=t.actionHtml('<span class="button">cancel</span>',"add-cancel"):(n+='<input type="text" class="json-object-add-input" name="'+t.inputNameForAction("add-input")+'" value="'+Jsonary.escapeHtml(t.uiState.addInputValue)+'"></input>',n+=t.actionHtml('<span class="button">cancel</span>',"add-cancel"),e.property(t.uiState.addInputValue).defined()&&(n+='<span class="warning"><code>'+Jsonary.escapeHtml(t.uiState.addInputValue)+"</code> already exists</span>")),n+="</td></tr>"
}else n+='<tr class="json-object-pair"><td class="json-object-key"><div class="json-object-key-text">',n+=t.actionHtml('<span class="button">add</span>',"add-input"),n+="</div></td><td></td></tr>"}return n+="</table>",n+="</fieldset>"},action:function(e,t,n){var i=e.data;if("select-preset"==t){if("custom"==n)delete e.uiState.addInputSelect;else{var r=n;e.uiState.addInputSelect=r.substring(4)}return!0}if("add-input"==t)return e.uiState.addInput=!0,e.uiState.addInputValue=void 0==n?"key":n,!0;if("add-cancel"==t)return delete e.uiState.addInput,delete e.uiState.addInputValue,delete e.uiState.addInputSelect,!0;if("add-confirm"==t){var r=null!=e.uiState.addInputSelect?e.uiState.addInputSelect:e.uiState.addInputValue;null==r||i.property(r).defined()||(delete e.uiState.addInput,delete e.uiState.addInputValue,delete e.uiState.addInputSelect,i.schemas().createValueForProperty(r,function(e){i.property(r).setValue(e)}))}},filter:function(e){return"object"==e.basicType()}}),Jsonary.render.register({name:"Jsonary plain arrays",renderHtml:function(e,t){e.schemas().tupleTypingLength();var n=e.schemas().maxItems(),i="";if(e.indices(function(e,n){i+='<div class="json-array-item">',i+='<span class="json-array-value">'+t.renderHtml(n)+"</span>",i+="</div>"}),!e.readOnly()&&(null==n||e.length()<n)){var r='<span class="json-array-add">+ add</span>';i+=t.actionHtml(r,"add")}return i},action:function(e,t){var n=e.data;if("add"==t){var i=n.length();n.schemas().createValueForIndex(i,function(e){n.index(i).setValue(e)})}},filter:function(e){return"array"==e.basicType()}}),Jsonary.render.register({name:"Jsonary plain display string",renderHtml:function(e){return'<span class="json-string">'+r(e.value())+"</span>"},filter:function(e){return"string"==e.basicType()&&e.readOnly()}}),Jsonary.render.register({name:"Jsonary plain edit string",renderHtml:function(e,t){e.schemas().maxLength();var n=t.inputNameForAction("new-value"),i=r(e.value());return'<textarea class="json-string" name="'+n+'">'+i+"</textarea>"},action:function(e,t,n){"new-value"==t&&e.data.setValue(n)},render:function(e,a){function s(e){l.innerHTML=e.length<u?"Too short (minimum "+u+" characters)":null!=h&&e.length>h?"Too long (+"+(e.length-h)+" characters)":null!=h?h-e.length+" characters left":""}if(null!==e.contentEditable){e.innerHTML='<div class="json-string json-string-content-editable">'+r(a.value()).replace(/\n/g,"<br>")+"</div>";var o=e.childNodes[0];return o.contentEditable="true",o.onblur=function(){var e=i(o);a.setValue(e)},void 0}if("function"==typeof window.getComputedStyle){var u=a.schemas().minLength(),h=a.schemas().maxLength(),l=document.createElement("span");l.className="json-string-notice";for(var c=document.createElement("div"),d=null,f=0;f<e.childNodes.length;f++)if(1==e.childNodes[f].nodeType){d=e.childNodes[f];break}e.insertBefore(c,d),t(d,c),c.style.display="inline",c.style.position="absolute",c.style.width="auto",c.style.height="auto",c.style.left="-100000px",c.style.top="0px",c.style.whiteSpace="pre",c.style.zIndex=-1e4;var p="MMMMM";n(d,c,p),d.value=a.value(),d.onkeyup=function(){s(this.value),n(this,c,p)},d.onfocus=function(){s(a.value()),p="MMMMM\nMMM",n(this,c,p)},d.onblur=function(){a.setValue(this.value),l.innerHTML="",p="MMMMM",n(this,c,p)},e.appendChild(l),d=null,e=null}},update:function(e,t,n,i){if(null!==e.contentEditable){var a=e.childNodes[0];return a.innerHTML=r(t.value()).replace(/\n/g,"<br>"),!1}if("replace"==i.action()){for(var s=null,o=0;o<e.childNodes.length;o++)if("textarea"==e.childNodes[o].tagName.toLowerCase()){s=e.childNodes[o];break}return s.value=t.value(),s.onkeyup(),!1}return!0},filter:function(e){return"string"==e.basicType()&&!e.readOnly()}}),Jsonary.render.register({name:"Jsonary plain booleans",renderHtml:function(e,t){if(e.readOnly())return e.value()?'<span class="json-boolean-true">yes</span>':'<span class="json-boolean-false">no</span>';var n=t.inputNameForAction("switch");return'<input type="checkbox" class="json-boolean" name="'+n+'" value="1" '+(e.value()?"checked":"")+"></input>"},action:function(e,t,n){"switch"==t&&e.data.setValue(!!n)},filter:function(e){return"boolean"==e.basicType()}}),Jsonary.render.register({name:"Jsonary plain edit number",renderHtml:function(e,t){var n="";if(e.value().toString().length>3){var i=e.value().toString().length;n='style="width: '+i+'em;"'}var r='<input class="json-number-input" type="text" value="'+e.value()+'" name="'+t.inputNameForAction("input")+'" '+n+"></input>",a=e.schemas().numberInterval();if(void 0!=a){var s=e.schemas().minimum();r=null==s||e.value()>s+a||e.value()==s+a&&!e.schemas().exclusiveMinimum()?t.actionHtml('<span class="json-number-decrement button">-</span>',"decrement")+r:'<span class="json-number-decrement button disabled" onmousedown="event.preventDefault();">-</span>'+r;var o=e.schemas().maximum();r+=null==o||e.value()<o-a||e.value()==o-a&&!e.schemas().exclusiveMaximum()?t.actionHtml('<span class="json-number-increment button">+</span>',"increment"):'<span class="json-number-increment button disabled" onmousedown="event.preventDefault;">+</span>'}return'<span class="json-number">'+r+"</span>"},action:function(e,t,n){var i=e.data,r=i.schemas().numberInterval();if("increment"==t){var a=i.value()+r,s=!0,o=i.schemas().maximum();void 0!=o&&(a>o||a==o&&i.schemas().exclusiveMaximum())&&(s=!1),s&&i.setValue(a)}else if("decrement"==t){var a=i.value()-r,s=!0,u=i.schemas().minimum();void 0!=u&&(u>a||a==u&&i.schemas().exclusiveMinimum())&&(s=!1),s&&i.setValue(a)}else if("input"==t){var h=n,a=parseFloat(h);if(!isNaN(a)){void 0!=r&&(a=Math.round(a/r)*r);var s=!0,u=i.schemas().minimum();void 0!=u&&(u>a||a==u&&i.schemas().exclusiveMinimum())&&(s=!1);var o=i.schemas().maximum();void 0!=o&&(a>o||a==o&&i.schemas().exclusiveMaximum())&&(s=!1),s||(a=i.schemas().createValueNumber()),i.setValue(a)}}},filter:function(e){return("number"==e.basicType()||"integer"==e.basicType())&&!e.readOnly()}}),Jsonary.render.register({name:"Jsonary plain enums",render:function(e,t){var n=t.schemas().enumValues();if(0==n.length)return e.innerHTML='<span class="json-enum-invalid">invalid</span>',void 0;if(1!=n.length){for(var i=document.createElement("select"),a=0;a<n.length;a++){var s=document.createElement("option");s.setAttribute("value",a),t.equals(Jsonary.create(n[a]))&&(s.selected=!0),s.appendChild(document.createTextNode(n[a])),i.appendChild(s)}i.onchange=function(){var e=this.value;t.setValue(n[e])},e.appendChild(i),e=i=s=null}else if("string"==typeof n[0])e.innerHTML='<span class="json-string">'+r(n[0])+"</span>";else if("number"==typeof n[0])e.innerHTML='<span class="json-number">'+n[0]+"</span>";else if("boolean"==typeof n[0]){var o=n[0]?"true":"false";e.innerHTML='<span class="json-boolean-'+o+'">'+o+"</span>"}else e.innerHTML='<span class="json-raw">'+r(JSON.stringify(n[0]))+"</span>"},filter:function(e){return!e.readOnly()&&null!=e.schemas().enumValues()}})}(this),this}.call(this);