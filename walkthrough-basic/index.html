<html>
  <head>
		<title>JSON Browser</title>
		<link rel="stylesheet" href="../css/main.css">
		<meta name="viewport" content="width=960">
	</head>
	<body>
		<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
		<div align="center">
			<div id="content">
				<h1>JSON browser</h1>
				<div class="tagline">a generic client powered by Jsonary</div>

				<div id="nav">
					back to
					<a class="nav-link" href="../">main page</a>
				</div>
				
				<div class="resource-list">
					The demos on this page use the following files:
					<ul>
						<li><span class="filename">jquery.js</span> - the jQuery library, to help assemble our interface faster
						<li><span class="filename">jsonary.js</span> - the core Jsonary library
						<li><span class="filename">basic.jsonary.js</span> - a default set of renderers, that look similar to plain JSON
						<li><span class="filename">basic.jsonary.css</span> - the stylesheet used by the above renderers
					</ul>
				</div>
	
				<h2>Page layout</h2>
				<div class="section">
					<p>Our page layout is going to be quite simple.  It's just a table containing a URL bar and a "Go" button, and a div.
<pre class="example code">
&lt;html&gt;
	&lt;head&gt;
		&lt;title&gt;JSON browser&lt;/title&gt;
		&lt;link rel=&quot;stylesheet&quot; href=&quot;page.index.css&quot; /&gt;
		&lt;link rel=&quot;stylesheet&quot; href=&quot;../renderers/basic.jsonary.css&quot; /&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;table width=100%&gt;
			&lt;tr&gt;
				&lt;td width=80%&gt;
					&lt;input id=&quot;url-bar&quot; value=&quot;{starting URL}&quot;/&gt;
				&lt;/td&gt;
				&lt;td&gt;
					&lt;input id=&quot;go&quot; type=&quot;button&quot; value=&quot;Go&quot; /&gt;
				&lt;/td&gt;
			&lt;/tr&gt;
		&lt;/table&gt;
		&lt;div id=&quot;main&quot;&gt;
		&lt;script src=&quot;../js/jquery.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;../jsonary.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;../renderers/basic.jsonary.js&quot;&gt;&lt;/script&gt;
		&lt;script src=&quot;page.index.js&quot;&gt;&lt;/script&gt;
	&lt;/body&gt;
&lt;/html&gt;
</pre>
				<p>We also include some Javascript files.  The first three are standard (jQuery, Jsonary and the standard set of basic renderers) and the fourth is where we're going to put the code for this page.
				</div>

				<h2>Fetching the URL from the URL bar</h2>
				<div class="section">
					<p>When the "Go" button is clicked, we take the URL from the URL bar, and use it to fill the div.  Here's the Javascript:
<pre class="example code">
var currentUrl = "";
function navigateTo(itemUrl) {
	currentUrl = itemUrl;
	window.location = "#" + itemUrl;
	$('#url-bar').val(itemUrl);
	
	$('#main').renderJson(itemUrl);
}

$('#go').click(function () {
	var itemUrl = $('#url-bar').val();
	navigateTo(itemUrl);
});
</pre>
				</div>
				
				<h2>Fetching the URL from the page fragment</h2>
				<div class="section">
					<p>We also want the browser's forward, back and refresh buttons to work.  That means we need to get the URL from the page fragment as well.
					<p>We're going to do something quite naive: poll every 100ms to see if the fragment has changed.
				</div>

<pre class="example code">
var interval = setInterval(function() {
	var hash = window.location.hash.substring(1);
	if (hash != currentUrl) {
		navigateTo(hash);
	}
}, 100);

// When the page opens, navigate straight to the initial URL
if (window.location.hash == "#" || window.location.hash == "") {
	window.location.replace("#" + $('#url-bar').val());
} else {
	var url = window.location.hash.substring(1);
	$('#url-bar').val(url);
}
$('#go').click();
</pre>

				<h2>Handling links</h2>
				<div class="section">
					<p>The default renderer also includes a list of clickable links.  We would like to catch those links and use them to display a new page:
<pre class="example code">
Jsonary.addLinkHandler(function(link, data, request) {
	navigateTo(link.href);
	return true;
});
</pre>
					<p>However, this is a bit strange - a request is made when the link was followed.  There's no point requesting that URL again, especially if that first request has user-inputted data submitted along with it.
					<p>So we need to modify our <code>navigateTo()</code> function so that it takes an optional second argument, <code>request</code>:
<pre class="example code">
function navigateTo(itemUrl, request) {
	currentUrl = itemUrl;
	window.location = "#" + itemUrl;
	$('#url-bar').val(itemUrl);
	
	if (request == undefined) {
		request = Jsonary.getData(itemUrl);
	}
	request.getData(function(data, request) {
		$('#main').renderJson(data);
	});
}

Jsonary.addLinkHandler(function(link, data, request) {
	navigateTo(link.href, request);
	return true;
});
</pre>
				</div>

				<h2>... and we're done</h2>
				<div class="section">
					<p>You can <a href="browser.html" target="browser-demo">take a look</a> at the finished product here.
				</div>
			</div>
		</div>
	</body>
</html>
